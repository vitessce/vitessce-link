const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./troika-three-text.esm-dffc428b-CxAbcxt8.js","./index-C5HvPDkI.js","./index-ppYdnIj2.css"])))=>i.map(i=>d[i]);
import{r as I,J as Je,Q as go,a as Cd,E as Il,y as Qe,t as G,b as Di,c as dn,S as Zr,d as kl,e as be,g as Hn,h as ne,i as Is,j as ll,k as Np,P as jp,z as Gn,C as or,M as ki,G as ul,I as Sn,H as ir,l as zl,Z as Id,V as qr,f as kd,m as uo,N as xn,n as Bp,o as sr,p as zd,q as Op,s as Dp,u as Up,W as Fp,v as Nl,x as Hp,A as Gp,_ as Ni,B as Vp,F as po,K as Nd,O as cl,R as Kp,T as Yp,U as jd,X as Wp,Y as Qp,$ as qp,a0 as Xp,a1 as Zp,a2 as $p,a3 as Vr,a4 as Bd,a5 as Kr,a6 as Jp,a7 as Od,a8 as eh,a9 as th,aa as Dd,ab as ks,ac as nh,ad as rh,ae as ih,af as ah,ag as dl,ah as Ud,ai as Fd,aj as oh,ak as Pr,al as Mr,am as ho,an as Rc,ao as sh,ap as lh,aq as uh,ar as ch,as as dh,at as fh,au as ph,av as ar,aw as hh,ax as Cc,ay as mh,az as Dt,aA as fl,aB as gh,aC as vh,aD as yh,aE as bh,aF as xh,aG as wh,aH as Sh,aI as _h,aJ as Eh,aK as Ah,aL as Th,aM as Ph,aN as Ic,aO as pl,aP as Mh,aQ as Lh,aR as kc,aS as Rh,aT as Ch,aU as Ih,aV as kh}from"./index-C5HvPDkI.js";var Hd={exports:{}},cr={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */cr.ConcurrentRoot=1;cr.ContinuousEventPriority=4;cr.DefaultEventPriority=16;cr.DiscreteEventPriority=1;cr.IdleEventPriority=536870912;cr.LegacyRoot=0;Hd.exports=cr;var Yr=Hd.exports,Gd={exports:{}},Vd={exports:{}},Kd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function r(V,ee){var Z=V.length;V.push(ee);e:for(;0<Z;){var ae=Z-1>>>1,pe=V[ae];if(0<o(pe,ee))V[ae]=ee,V[Z]=pe,Z=ae;else break e}}function n(V){return V.length===0?null:V[0]}function l(V){if(V.length===0)return null;var ee=V[0],Z=V.pop();if(Z!==ee){V[0]=Z;e:for(var ae=0,pe=V.length,Te=pe>>>1;ae<Te;){var ke=2*(ae+1)-1,St=V[ke],dt=ke+1,Yt=V[dt];if(0>o(St,Z))dt<pe&&0>o(Yt,St)?(V[ae]=Yt,V[dt]=Z,ae=dt):(V[ae]=St,V[ke]=Z,ae=ke);else if(dt<pe&&0>o(Yt,Z))V[ae]=Yt,V[dt]=Z,ae=dt;else break e}}return ee}function o(V,ee){var Z=V.sortIndex-ee.sortIndex;return Z!==0?Z:V.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var u=Date,d=u.now();i.unstable_now=function(){return u.now()-d}}var f=[],p=[],m=1,g=null,v=3,b=!1,A=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(V){for(var ee=n(p);ee!==null;){if(ee.callback===null)l(p);else if(ee.startTime<=V)l(p),ee.sortIndex=ee.expirationTime,r(f,ee);else break;ee=n(p)}}function P(V){if(S=!1,E(V),!A)if(n(f)!==null)A=!0,fe(M);else{var ee=n(p);ee!==null&&ve(P,ee.startTime-V)}}function M(V,ee){A=!1,S&&(S=!1,x(N),N=-1),b=!0;var Z=v;try{for(E(ee),g=n(f);g!==null&&(!(g.expirationTime>ee)||V&&!B());){var ae=g.callback;if(typeof ae=="function"){g.callback=null,v=g.priorityLevel;var pe=ae(g.expirationTime<=ee);ee=i.unstable_now(),typeof pe=="function"?g.callback=pe:g===n(f)&&l(f),E(ee)}else l(f);g=n(f)}if(g!==null)var Te=!0;else{var ke=n(p);ke!==null&&ve(P,ke.startTime-ee),Te=!1}return Te}finally{g=null,v=Z,b=!1}}var L=!1,R=null,N=-1,z=5,D=-1;function B(){return!(i.unstable_now()-D<z)}function F(){if(R!==null){var V=i.unstable_now();D=V;var ee=!0;try{ee=R(!0,V)}finally{ee?Y():(L=!1,R=null)}}else L=!1}var Y;if(typeof _=="function")Y=function(){_(F)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,le=$.port2;$.port1.onmessage=F,Y=function(){le.postMessage(null)}}else Y=function(){w(F,0)};function fe(V){R=V,L||(L=!0,Y())}function ve(V,ee){N=w(function(){V(i.unstable_now())},ee)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(V){V.callback=null},i.unstable_continueExecution=function(){A||b||(A=!0,fe(M))},i.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<V?Math.floor(1e3/V):5},i.unstable_getCurrentPriorityLevel=function(){return v},i.unstable_getFirstCallbackNode=function(){return n(f)},i.unstable_next=function(V){switch(v){case 1:case 2:case 3:var ee=3;break;default:ee=v}var Z=v;v=ee;try{return V()}finally{v=Z}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(V,ee){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Z=v;v=V;try{return ee()}finally{v=Z}},i.unstable_scheduleCallback=function(V,ee,Z){var ae=i.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?ae+Z:ae):Z=ae,V){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Z+pe,V={id:m++,callback:ee,priorityLevel:V,startTime:Z,expirationTime:pe,sortIndex:-1},Z>ae?(V.sortIndex=Z,r(p,V),n(f)===null&&V===n(p)&&(S?(x(N),N=-1):S=!0,ve(P,Z-ae))):(V.sortIndex=pe,r(f,V),A||b||(A=!0,fe(M))),V},i.unstable_shouldYield=B,i.unstable_wrapCallback=function(V){var ee=v;return function(){var Z=v;v=ee;try{return V.apply(this,arguments)}finally{v=Z}}}})(Kd);Vd.exports=Kd;var hl=Vd.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zh=function(i){var r={},n=Ih,l=hl,o=Object.assign;function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d=Symbol.for("react.element"),f=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),b=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),E=Symbol.for("react.offscreen"),P=Symbol.iterator;function M(e){return e===null||typeof e!="object"?null:(e=P&&e[P]||e["@@iterator"],typeof e=="function"?e:null)}function L(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case p:return"Fragment";case f:return"Portal";case g:return"Profiler";case m:return"StrictMode";case S:return"Suspense";case w:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case b:return(e.displayName||"Context")+".Consumer";case v:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case x:return t=e.displayName||null,t!==null?t:L(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return L(e(t))}catch{}}return null}function R(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return L(t);case 8:return t===m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function N(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function z(e){if(N(e)!==e)throw Error(s(188))}function D(e){var t=e.alternate;if(!t){if(t=N(e),t===null)throw Error(s(188));return t!==e?null:e}for(var a=e,c=t;;){var h=a.return;if(h===null)break;var y=h.alternate;if(y===null){if(c=h.return,c!==null){a=c;continue}break}if(h.child===y.child){for(y=h.child;y;){if(y===a)return z(h),e;if(y===c)return z(h),t;y=y.sibling}throw Error(s(188))}if(a.return!==c.return)a=h,c=y;else{for(var T=!1,C=h.child;C;){if(C===a){T=!0,a=h,c=y;break}if(C===c){T=!0,c=h,a=y;break}C=C.sibling}if(!T){for(C=y.child;C;){if(C===a){T=!0,a=y,c=h;break}if(C===c){T=!0,c=y,a=h;break}C=C.sibling}if(!T)throw Error(s(189))}}if(a.alternate!==c)throw Error(s(190))}if(a.tag!==3)throw Error(s(188));return a.stateNode.current===a?e:t}function B(e){return e=D(e),e!==null?F(e):null}function F(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=F(e);if(t!==null)return t;e=e.sibling}return null}function Y(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){if(e.tag!==4){var t=Y(e);if(t!==null)return t}e=e.sibling}return null}var $=Array.isArray,le=i.getPublicInstance,fe=i.getRootHostContext,ve=i.getChildHostContext,V=i.prepareForCommit,ee=i.resetAfterCommit,Z=i.createInstance,ae=i.appendInitialChild,pe=i.finalizeInitialChildren,Te=i.prepareUpdate,ke=i.shouldSetTextContent,St=i.createTextInstance,dt=i.scheduleTimeout,Yt=i.cancelTimeout,_n=i.noTimeout,fn=i.isPrimaryRenderer,me=i.supportsMutation,K=i.supportsPersistence,te=i.supportsHydration,Me=i.getInstanceFromNode,he=i.preparePortalMount,Ve=i.getCurrentEventPriority,we=i.detachDeletedInstance,Le=i.supportsMicrotasks,je=i.scheduleMicrotask,et=i.supportsTestSelectors,Fi=i.findFiberRoot,Jr=i.getBoundingRect,ei=i.getTextContent,En=i.isHiddenSubtree,bo=i.matchAccessibilityRole,xo=i.setFocusIfFocusable,Hi=i.setupIntersectionObserver,ti=i.appendChild,wo=i.appendChildToContainer,So=i.commitTextUpdate,Gi=i.commitMount,_o=i.commitUpdate,Vi=i.insertBefore,Ki=i.insertInContainerBefore,ni=i.removeChild,j=i.removeChildFromContainer,Q=i.resetTextContent,se=i.hideInstance,Se=i.hideTextInstance,ft=i.unhideInstance,_t=i.unhideTextInstance,fr=i.clearContainer,Yi=i.cloneInstance,Lt=i.createContainerChildSet,Rt=i.appendChildToContainerChildSet,Kn=i.finalizeContainerChildren,An=i.replaceContainerChildren,Tn=i.cloneHiddenInstance,Yn=i.cloneHiddenTextInstance,Tf=i.canHydrateInstance,Pf=i.canHydrateTextInstance,Mf=i.canHydrateSuspenseInstance,Wl=i.isSuspenseInstancePending,Eo=i.isSuspenseInstanceFallback,Lf=i.registerSuspenseInstanceRetry,ri=i.getNextHydratableSibling,Rf=i.getFirstHydratableChild,Cf=i.getFirstHydratableChildWithinContainer,If=i.getFirstHydratableChildWithinSuspenseInstance,kf=i.hydrateInstance,zf=i.hydrateTextInstance,Nf=i.hydrateSuspenseInstance,jf=i.getNextHydratableInstanceAfterSuspenseInstance,Ql=i.commitHydratedContainer,Bf=i.commitHydratedSuspenseInstance,Of=i.clearSuspenseBoundary,Df=i.clearSuspenseBoundaryFromContainer,Uf=i.shouldDeleteUnhydratedTailInstances,Ff=i.didNotMatchHydratedContainerTextInstance,Hf=i.didNotMatchHydratedTextInstance,Ao;function ii(e){if(Ao===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Ao=t&&t[1]||""}return`
`+Ao+e}var To=!1;function Po(e,t){if(!e||To)return"";To=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(W){var c=W}Reflect.construct(e,[],t)}else{try{t.call()}catch(W){c=W}e.call(t.prototype)}else{try{throw Error()}catch(W){c=W}e()}}catch(W){if(W&&c&&typeof W.stack=="string"){for(var h=W.stack.split(`
`),y=c.stack.split(`
`),T=h.length-1,C=y.length-1;1<=T&&0<=C&&h[T]!==y[C];)C--;for(;1<=T&&0<=C;T--,C--)if(h[T]!==y[C]){if(T!==1||C!==1)do if(T--,C--,0>C||h[T]!==y[C]){var H=`
`+h[T].replace(" at new "," at ");return e.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",e.displayName)),H}while(1<=T&&0<=C);break}}}finally{To=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?ii(e):""}var Gf=Object.prototype.hasOwnProperty,Mo=[],pr=-1;function Pn(e){return{current:e}}function Ce(e){0>pr||(e.current=Mo[pr],Mo[pr]=null,pr--)}function Re(e,t){pr++,Mo[pr]=e.current,e.current=t}var Mn={},at=Pn(Mn),gt=Pn(!1),Wn=Mn;function hr(e,t){var a=e.type.contextTypes;if(!a)return Mn;var c=e.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===t)return c.__reactInternalMemoizedMaskedChildContext;var h={},y;for(y in a)h[y]=t[y];return c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=h),h}function vt(e){return e=e.childContextTypes,e!=null}function Wi(){Ce(gt),Ce(at)}function ql(e,t,a){if(at.current!==Mn)throw Error(s(168));Re(at,t),Re(gt,a)}function Xl(e,t,a){var c=e.stateNode;if(t=t.childContextTypes,typeof c.getChildContext!="function")return a;c=c.getChildContext();for(var h in c)if(!(h in t))throw Error(s(108,R(e)||"Unknown",h));return o({},a,c)}function Qi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mn,Wn=at.current,Re(at,e),Re(gt,gt.current),!0}function Zl(e,t,a){var c=e.stateNode;if(!c)throw Error(s(169));a?(e=Xl(e,t,Wn),c.__reactInternalMemoizedMergedChildContext=e,Ce(gt),Ce(at),Re(at,e)):Ce(gt),Re(gt,a)}var Wt=Math.clz32?Math.clz32:Yf,Vf=Math.log,Kf=Math.LN2;function Yf(e){return e>>>=0,e===0?32:31-(Vf(e)/Kf|0)|0}var qi=64,Xi=4194304;function ai(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Zi(e,t){var a=e.pendingLanes;if(a===0)return 0;var c=0,h=e.suspendedLanes,y=e.pingedLanes,T=a&268435455;if(T!==0){var C=T&~h;C!==0?c=ai(C):(y&=T,y!==0&&(c=ai(y)))}else T=a&~h,T!==0?c=ai(T):y!==0&&(c=ai(y));if(c===0)return 0;if(t!==0&&t!==c&&!(t&h)&&(h=c&-c,y=t&-t,h>=y||h===16&&(y&4194240)!==0))return t;if(c&4&&(c|=a&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=c;0<t;)a=31-Wt(t),h=1<<a,c|=e[a],t&=~h;return c}function Wf(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qf(e,t){for(var a=e.suspendedLanes,c=e.pingedLanes,h=e.expirationTimes,y=e.pendingLanes;0<y;){var T=31-Wt(y),C=1<<T,H=h[T];H===-1?(!(C&a)||C&c)&&(h[T]=Wf(C,t)):H<=t&&(e.expiredLanes|=C),y&=~C}}function Lo(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Ro(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function oi(e,t,a){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Wt(t),e[t]=a}function qf(e,t){var a=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var c=e.eventTimes;for(e=e.expirationTimes;0<a;){var h=31-Wt(a),y=1<<h;t[h]=0,c[h]=-1,e[h]=-1,a&=~y}}function Co(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var c=31-Wt(a),h=1<<c;h&t|e[c]&t&&(e[c]|=t),a&=~h}}var _e=0;function $l(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Io=l.unstable_scheduleCallback,Jl=l.unstable_cancelCallback,Xf=l.unstable_shouldYield,Zf=l.unstable_requestPaint,Xe=l.unstable_now,ko=l.unstable_ImmediatePriority,$f=l.unstable_UserBlockingPriority,zo=l.unstable_NormalPriority,Jf=l.unstable_IdlePriority,$i=null,Jt=null;function ep(e){if(Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot($i,e,void 0,(e.current.flags&128)===128)}catch{}}function tp(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var en=typeof Object.is=="function"?Object.is:tp,pn=null,Ji=!1,No=!1;function eu(e){pn===null?pn=[e]:pn.push(e)}function np(e){Ji=!0,eu(e)}function tn(){if(!No&&pn!==null){No=!0;var e=0,t=_e;try{var a=pn;for(_e=1;e<a.length;e++){var c=a[e];do c=c(!0);while(c!==null)}pn=null,Ji=!1}catch(h){throw pn!==null&&(pn=pn.slice(e+1)),Io(ko,tn),h}finally{_e=t,No=!1}}return null}var rp=u.ReactCurrentBatchConfig;function ea(e,t){if(en(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),c=Object.keys(t);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var h=a[c];if(!Gf.call(t,h)||!en(e[h],t[h]))return!1}return!0}function ip(e){switch(e.tag){case 5:return ii(e.type);case 16:return ii("Lazy");case 13:return ii("Suspense");case 19:return ii("SuspenseList");case 0:case 2:case 15:return e=Po(e.type,!1),e;case 11:return e=Po(e.type.render,!1),e;case 1:return e=Po(e.type,!0),e;default:return""}}function Qt(e,t){if(e&&e.defaultProps){t=o({},t),e=e.defaultProps;for(var a in e)t[a]===void 0&&(t[a]=e[a]);return t}return t}var ta=Pn(null),na=null,mr=null,jo=null;function Bo(){jo=mr=na=null}function tu(e,t,a){fn?(Re(ta,t._currentValue),t._currentValue=a):(Re(ta,t._currentValue2),t._currentValue2=a)}function Oo(e){var t=ta.current;Ce(ta),fn?e._currentValue=t:e._currentValue2=t}function Do(e,t,a){for(;e!==null;){var c=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,c!==null&&(c.childLanes|=t)):c!==null&&(c.childLanes&t)!==t&&(c.childLanes|=t),e===a)break;e=e.return}}function gr(e,t){na=e,jo=mr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Tt=!0),e.firstContext=null)}function Ct(e){var t=fn?e._currentValue:e._currentValue2;if(jo!==e)if(e={context:e,memoizedValue:t,next:null},mr===null){if(na===null)throw Error(s(308));mr=e,na.dependencies={lanes:0,firstContext:e}}else mr=mr.next=e;return t}var nn=null,Ln=!1;function Uo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function nu(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function hn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Rn(e,t){var a=e.updateQueue;a!==null&&(a=a.shared,Ke!==null&&e.mode&1&&!(ye&2)?(e=a.interleaved,e===null?(t.next=t,nn===null?nn=[a]:nn.push(a)):(t.next=e.next,e.next=t),a.interleaved=t):(e=a.pending,e===null?t.next=t:(t.next=e.next,e.next=t),a.pending=t))}function ra(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194240)!==0)){var c=t.lanes;c&=e.pendingLanes,a|=c,t.lanes=a,Co(e,a)}}function ru(e,t){var a=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var h=null,y=null;if(a=a.firstBaseUpdate,a!==null){do{var T={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};y===null?h=y=T:y=y.next=T,a=a.next}while(a!==null);y===null?h=y=t:y=y.next=t}else h=y=t;a={baseState:c.baseState,firstBaseUpdate:h,lastBaseUpdate:y,shared:c.shared,effects:c.effects},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}function ia(e,t,a,c){var h=e.updateQueue;Ln=!1;var y=h.firstBaseUpdate,T=h.lastBaseUpdate,C=h.shared.pending;if(C!==null){h.shared.pending=null;var H=C,W=H.next;H.next=null,T===null?y=W:T.next=W,T=H;var J=e.alternate;J!==null&&(J=J.updateQueue,C=J.lastBaseUpdate,C!==T&&(C===null?J.firstBaseUpdate=W:C.next=W,J.lastBaseUpdate=H))}if(y!==null){var ce=h.baseState;T=0,J=W=H=null,C=y;do{var oe=C.lane,Pe=C.eventTime;if((c&oe)===oe){J!==null&&(J=J.next={eventTime:Pe,lane:0,tag:C.tag,payload:C.payload,callback:C.callback,next:null});e:{var re=e,ut=C;switch(oe=t,Pe=a,ut.tag){case 1:if(re=ut.payload,typeof re=="function"){ce=re.call(Pe,ce,oe);break e}ce=re;break e;case 3:re.flags=re.flags&-65537|128;case 0:if(re=ut.payload,oe=typeof re=="function"?re.call(Pe,ce,oe):re,oe==null)break e;ce=o({},ce,oe);break e;case 2:Ln=!0}}C.callback!==null&&C.lane!==0&&(e.flags|=64,oe=h.effects,oe===null?h.effects=[C]:oe.push(C))}else Pe={eventTime:Pe,lane:oe,tag:C.tag,payload:C.payload,callback:C.callback,next:null},J===null?(W=J=Pe,H=ce):J=J.next=Pe,T|=oe;if(C=C.next,C===null){if(C=h.shared.pending,C===null)break;oe=C,C=oe.next,oe.next=null,h.lastBaseUpdate=oe,h.shared.pending=null}}while(!0);if(J===null&&(H=ce),h.baseState=H,h.firstBaseUpdate=W,h.lastBaseUpdate=J,t=h.shared.interleaved,t!==null){h=t;do T|=h.lane,h=h.next;while(h!==t)}else y===null&&(h.shared.lanes=0);Ar|=T,e.lanes=T,e.memoizedState=ce}}function iu(e,t,a){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var c=e[t],h=c.callback;if(h!==null){if(c.callback=null,c=a,typeof h!="function")throw Error(s(191,h));h.call(c)}}}var au=new n.Component().refs;function Fo(e,t,a,c){t=e.memoizedState,a=a(c,t),a=a==null?t:o({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var aa={isMounted:function(e){return(e=e._reactInternals)?N(e)===e:!1},enqueueSetState:function(e,t,a){e=e._reactInternals;var c=ht(),h=kn(e),y=hn(c,h);y.payload=t,a!=null&&(y.callback=a),Rn(e,y),t=jt(e,h,c),t!==null&&ra(t,e,h)},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var c=ht(),h=kn(e),y=hn(c,h);y.tag=1,y.payload=t,a!=null&&(y.callback=a),Rn(e,y),t=jt(e,h,c),t!==null&&ra(t,e,h)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=ht(),c=kn(e),h=hn(a,c);h.tag=2,t!=null&&(h.callback=t),Rn(e,h),t=jt(e,c,a),t!==null&&ra(t,e,c)}};function ou(e,t,a,c,h,y,T){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,y,T):t.prototype&&t.prototype.isPureReactComponent?!ea(a,c)||!ea(h,y):!0}function su(e,t,a){var c=!1,h=Mn,y=t.contextType;return typeof y=="object"&&y!==null?y=Ct(y):(h=vt(t)?Wn:at.current,c=t.contextTypes,y=(c=c!=null)?hr(e,h):Mn),t=new t(a,y),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=aa,e.stateNode=t,t._reactInternals=e,c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=h,e.__reactInternalMemoizedMaskedChildContext=y),t}function lu(e,t,a,c){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,c),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,c),t.state!==e&&aa.enqueueReplaceState(t,t.state,null)}function Ho(e,t,a,c){var h=e.stateNode;h.props=a,h.state=e.memoizedState,h.refs=au,Uo(e);var y=t.contextType;typeof y=="object"&&y!==null?h.context=Ct(y):(y=vt(t)?Wn:at.current,h.context=hr(e,y)),h.state=e.memoizedState,y=t.getDerivedStateFromProps,typeof y=="function"&&(Fo(e,t,y,a),h.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(t=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),t!==h.state&&aa.enqueueReplaceState(h,h.state,null),ia(e,a,h,c),h.state=e.memoizedState),typeof h.componentDidMount=="function"&&(e.flags|=4194308)}var vr=[],yr=0,oa=null,sa=0,It=[],kt=0,Qn=null,mn=1,gn="";function qn(e,t){vr[yr++]=sa,vr[yr++]=oa,oa=e,sa=t}function uu(e,t,a){It[kt++]=mn,It[kt++]=gn,It[kt++]=Qn,Qn=e;var c=mn;e=gn;var h=32-Wt(c)-1;c&=~(1<<h),a+=1;var y=32-Wt(t)+h;if(30<y){var T=h-h%5;y=(c&(1<<T)-1).toString(32),c>>=T,h-=T,mn=1<<32-Wt(t)+h|a<<h|c,gn=y+e}else mn=1<<y|a<<h|c,gn=e}function Go(e){e.return!==null&&(qn(e,1),uu(e,1,0))}function Vo(e){for(;e===oa;)oa=vr[--yr],vr[yr]=null,sa=vr[--yr],vr[yr]=null;for(;e===Qn;)Qn=It[--kt],It[kt]=null,gn=It[--kt],It[kt]=null,mn=It[--kt],It[kt]=null}var Et=null,At=null,ze=!1,si=!1,qt=null;function cu(e,t){var a=Bt(5,null,null,0);a.elementType="DELETED",a.stateNode=t,a.return=e,t=e.deletions,t===null?(e.deletions=[a],e.flags|=16):t.push(a)}function du(e,t){switch(e.tag){case 5:return t=Tf(t,e.type,e.pendingProps),t!==null?(e.stateNode=t,Et=e,At=Rf(t),!0):!1;case 6:return t=Pf(t,e.pendingProps),t!==null?(e.stateNode=t,Et=e,At=null,!0):!1;case 13:if(t=Mf(t),t!==null){var a=Qn!==null?{id:mn,overflow:gn}:null;return e.memoizedState={dehydrated:t,treeContext:a,retryLane:1073741824},a=Bt(18,null,null,0),a.stateNode=t,a.return=e,e.child=a,Et=e,At=null,!0}return!1;default:return!1}}function Ko(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Yo(e){if(ze){var t=At;if(t){var a=t;if(!du(e,t)){if(Ko(e))throw Error(s(418));t=ri(a);var c=Et;t&&du(e,t)?cu(c,a):(e.flags=e.flags&-4097|2,ze=!1,Et=e)}}else{if(Ko(e))throw Error(s(418));e.flags=e.flags&-4097|2,ze=!1,Et=e}}}function fu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Et=e}function li(e){if(!te||e!==Et)return!1;if(!ze)return fu(e),ze=!0,!1;if(e.tag!==3&&(e.tag!==5||Uf(e.type)&&!ke(e.type,e.memoizedProps))){var t=At;if(t){if(Ko(e)){for(e=At;e;)e=ri(e);throw Error(s(418))}for(;t;)cu(e,t),t=ri(t)}}if(fu(e),e.tag===13){if(!te)throw Error(s(316));if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));At=jf(e)}else At=Et?ri(e.stateNode):null;return!0}function br(){te&&(At=Et=null,si=ze=!1)}function Wo(e){qt===null?qt=[e]:qt.push(e)}function ui(e,t,a){if(e=a.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(s(309));var c=a.stateNode}if(!c)throw Error(s(147,e));var h=c,y=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===y?t.ref:(t=function(T){var C=h.refs;C===au&&(C=h.refs={}),T===null?delete C[y]:C[y]=T},t._stringRef=y,t)}if(typeof e!="string")throw Error(s(284));if(!a._owner)throw Error(s(290,e))}return e}function la(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pu(e){var t=e._init;return t(e._payload)}function hu(e){function t(O,k){if(e){var U=O.deletions;U===null?(O.deletions=[k],O.flags|=16):U.push(k)}}function a(O,k){if(!e)return null;for(;k!==null;)t(O,k),k=k.sibling;return null}function c(O,k){for(O=new Map;k!==null;)k.key!==null?O.set(k.key,k):O.set(k.index,k),k=k.sibling;return O}function h(O,k){return O=Nn(O,k),O.index=0,O.sibling=null,O}function y(O,k,U){return O.index=U,e?(U=O.alternate,U!==null?(U=U.index,U<k?(O.flags|=2,k):U):(O.flags|=2,k)):(O.flags|=1048576,k)}function T(O){return e&&O.alternate===null&&(O.flags|=2),O}function C(O,k,U,X){return k===null||k.tag!==6?(k=Ls(U,O.mode,X),k.return=O,k):(k=h(k,U),k.return=O,k)}function H(O,k,U,X){var ie=U.type;return ie===p?J(O,k,U.props.children,X,U.key):k!==null&&(k.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===_&&pu(ie)===k.type)?(X=h(k,U.props),X.ref=ui(O,k,U),X.return=O,X):(X=Da(U.type,U.key,U.props,null,O.mode,X),X.ref=ui(O,k,U),X.return=O,X)}function W(O,k,U,X){return k===null||k.tag!==4||k.stateNode.containerInfo!==U.containerInfo||k.stateNode.implementation!==U.implementation?(k=Rs(U,O.mode,X),k.return=O,k):(k=h(k,U.children||[]),k.return=O,k)}function J(O,k,U,X,ie){return k===null||k.tag!==7?(k=nr(U,O.mode,X,ie),k.return=O,k):(k=h(k,U),k.return=O,k)}function ce(O,k,U){if(typeof k=="string"&&k!==""||typeof k=="number")return k=Ls(""+k,O.mode,U),k.return=O,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case d:return U=Da(k.type,k.key,k.props,null,O.mode,U),U.ref=ui(O,null,k),U.return=O,U;case f:return k=Rs(k,O.mode,U),k.return=O,k;case _:var X=k._init;return ce(O,X(k._payload),U)}if($(k)||M(k))return k=nr(k,O.mode,U,null),k.return=O,k;la(O,k)}return null}function oe(O,k,U,X){var ie=k!==null?k.key:null;if(typeof U=="string"&&U!==""||typeof U=="number")return ie!==null?null:C(O,k,""+U,X);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case d:return U.key===ie?H(O,k,U,X):null;case f:return U.key===ie?W(O,k,U,X):null;case _:return ie=U._init,oe(O,k,ie(U._payload),X)}if($(U)||M(U))return ie!==null?null:J(O,k,U,X,null);la(O,U)}return null}function Pe(O,k,U,X,ie){if(typeof X=="string"&&X!==""||typeof X=="number")return O=O.get(U)||null,C(k,O,""+X,ie);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case d:return O=O.get(X.key===null?U:X.key)||null,H(k,O,X,ie);case f:return O=O.get(X.key===null?U:X.key)||null,W(k,O,X,ie);case _:var ge=X._init;return Pe(O,k,U,ge(X._payload),ie)}if($(X)||M(X))return O=O.get(U)||null,J(k,O,X,ie,null);la(k,X)}return null}function re(O,k,U,X){for(var ie=null,ge=null,de=k,Ee=k=0,$e=null;de!==null&&Ee<U.length;Ee++){de.index>Ee?($e=de,de=null):$e=de.sibling;var Ae=oe(O,de,U[Ee],X);if(Ae===null){de===null&&(de=$e);break}e&&de&&Ae.alternate===null&&t(O,de),k=y(Ae,k,Ee),ge===null?ie=Ae:ge.sibling=Ae,ge=Ae,de=$e}if(Ee===U.length)return a(O,de),ze&&qn(O,Ee),ie;if(de===null){for(;Ee<U.length;Ee++)de=ce(O,U[Ee],X),de!==null&&(k=y(de,k,Ee),ge===null?ie=de:ge.sibling=de,ge=de);return ze&&qn(O,Ee),ie}for(de=c(O,de);Ee<U.length;Ee++)$e=Pe(de,O,Ee,U[Ee],X),$e!==null&&(e&&$e.alternate!==null&&de.delete($e.key===null?Ee:$e.key),k=y($e,k,Ee),ge===null?ie=$e:ge.sibling=$e,ge=$e);return e&&de.forEach(function(jn){return t(O,jn)}),ze&&qn(O,Ee),ie}function ut(O,k,U,X){var ie=M(U);if(typeof ie!="function")throw Error(s(150));if(U=ie.call(U),U==null)throw Error(s(151));for(var ge=ie=null,de=k,Ee=k=0,$e=null,Ae=U.next();de!==null&&!Ae.done;Ee++,Ae=U.next()){de.index>Ee?($e=de,de=null):$e=de.sibling;var jn=oe(O,de,Ae.value,X);if(jn===null){de===null&&(de=$e);break}e&&de&&jn.alternate===null&&t(O,de),k=y(jn,k,Ee),ge===null?ie=jn:ge.sibling=jn,ge=jn,de=$e}if(Ae.done)return a(O,de),ze&&qn(O,Ee),ie;if(de===null){for(;!Ae.done;Ee++,Ae=U.next())Ae=ce(O,Ae.value,X),Ae!==null&&(k=y(Ae,k,Ee),ge===null?ie=Ae:ge.sibling=Ae,ge=Ae);return ze&&qn(O,Ee),ie}for(de=c(O,de);!Ae.done;Ee++,Ae=U.next())Ae=Pe(de,O,Ee,Ae.value,X),Ae!==null&&(e&&Ae.alternate!==null&&de.delete(Ae.key===null?Ee:Ae.key),k=y(Ae,k,Ee),ge===null?ie=Ae:ge.sibling=Ae,ge=Ae);return e&&de.forEach(function(zp){return t(O,zp)}),ze&&qn(O,Ee),ie}function Ot(O,k,U,X){if(typeof U=="object"&&U!==null&&U.type===p&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case d:e:{for(var ie=U.key,ge=k;ge!==null;){if(ge.key===ie){if(ie=U.type,ie===p){if(ge.tag===7){a(O,ge.sibling),k=h(ge,U.props.children),k.return=O,O=k;break e}}else if(ge.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===_&&pu(ie)===ge.type){a(O,ge.sibling),k=h(ge,U.props),k.ref=ui(O,ge,U),k.return=O,O=k;break e}a(O,ge);break}else t(O,ge);ge=ge.sibling}U.type===p?(k=nr(U.props.children,O.mode,X,U.key),k.return=O,O=k):(X=Da(U.type,U.key,U.props,null,O.mode,X),X.ref=ui(O,k,U),X.return=O,O=X)}return T(O);case f:e:{for(ge=U.key;k!==null;){if(k.key===ge)if(k.tag===4&&k.stateNode.containerInfo===U.containerInfo&&k.stateNode.implementation===U.implementation){a(O,k.sibling),k=h(k,U.children||[]),k.return=O,O=k;break e}else{a(O,k);break}else t(O,k);k=k.sibling}k=Rs(U,O.mode,X),k.return=O,O=k}return T(O);case _:return ge=U._init,Ot(O,k,ge(U._payload),X)}if($(U))return re(O,k,U,X);if(M(U))return ut(O,k,U,X);la(O,U)}return typeof U=="string"&&U!==""||typeof U=="number"?(U=""+U,k!==null&&k.tag===6?(a(O,k.sibling),k=h(k,U),k.return=O,O=k):(a(O,k),k=Ls(U,O.mode,X),k.return=O,O=k),T(O)):a(O,k)}return Ot}var xr=hu(!0),mu=hu(!1),ci={},zt=Pn(ci),di=Pn(ci),wr=Pn(ci);function rn(e){if(e===ci)throw Error(s(174));return e}function Qo(e,t){Re(wr,t),Re(di,e),Re(zt,ci),e=fe(t),Ce(zt),Re(zt,e)}function Sr(){Ce(zt),Ce(di),Ce(wr)}function gu(e){var t=rn(wr.current),a=rn(zt.current);t=ve(a,e.type,t),a!==t&&(Re(di,e),Re(zt,t))}function qo(e){di.current===e&&(Ce(zt),Ce(di))}var Be=Pn(0);function ua(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Wl(a)||Eo(a)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Xo=[];function Zo(){for(var e=0;e<Xo.length;e++){var t=Xo[e];fn?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}Xo.length=0}var ca=u.ReactCurrentDispatcher,Nt=u.ReactCurrentBatchConfig,_r=0,Ue=null,ot=null,Ze=null,da=!1,fi=!1,pi=0,ap=0;function st(){throw Error(s(321))}function $o(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!en(e[a],t[a]))return!1;return!0}function Jo(e,t,a,c,h,y){if(_r=y,Ue=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ca.current=e===null||e.memoizedState===null?up:cp,e=a(c,h),fi){y=0;do{if(fi=!1,pi=0,25<=y)throw Error(s(301));y+=1,Ze=ot=null,t.updateQueue=null,ca.current=dp,e=a(c,h)}while(fi)}if(ca.current=ga,t=ot!==null&&ot.next!==null,_r=0,Ze=ot=Ue=null,da=!1,t)throw Error(s(300));return e}function es(){var e=pi!==0;return pi=0,e}function vn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ze===null?Ue.memoizedState=Ze=e:Ze=Ze.next=e,Ze}function an(){if(ot===null){var e=Ue.alternate;e=e!==null?e.memoizedState:null}else e=ot.next;var t=Ze===null?Ue.memoizedState:Ze.next;if(t!==null)Ze=t,ot=e;else{if(e===null)throw Error(s(310));ot=e,e={memoizedState:ot.memoizedState,baseState:ot.baseState,baseQueue:ot.baseQueue,queue:ot.queue,next:null},Ze===null?Ue.memoizedState=Ze=e:Ze=Ze.next=e}return Ze}function Xn(e,t){return typeof t=="function"?t(e):t}function fa(e){var t=an(),a=t.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=e;var c=ot,h=c.baseQueue,y=a.pending;if(y!==null){if(h!==null){var T=h.next;h.next=y.next,y.next=T}c.baseQueue=h=y,a.pending=null}if(h!==null){y=h.next,c=c.baseState;var C=T=null,H=null,W=y;do{var J=W.lane;if((_r&J)===J)H!==null&&(H=H.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),c=W.hasEagerState?W.eagerState:e(c,W.action);else{var ce={lane:J,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};H===null?(C=H=ce,T=c):H=H.next=ce,Ue.lanes|=J,Ar|=J}W=W.next}while(W!==null&&W!==y);H===null?T=c:H.next=C,en(c,t.memoizedState)||(Tt=!0),t.memoizedState=c,t.baseState=T,t.baseQueue=H,a.lastRenderedState=c}if(e=a.interleaved,e!==null){h=e;do y=h.lane,Ue.lanes|=y,Ar|=y,h=h.next;while(h!==e)}else h===null&&(a.lanes=0);return[t.memoizedState,a.dispatch]}function pa(e){var t=an(),a=t.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=e;var c=a.dispatch,h=a.pending,y=t.memoizedState;if(h!==null){a.pending=null;var T=h=h.next;do y=e(y,T.action),T=T.next;while(T!==h);en(y,t.memoizedState)||(Tt=!0),t.memoizedState=y,t.baseQueue===null&&(t.baseState=y),a.lastRenderedState=y}return[y,c]}function vu(){}function yu(e,t){var a=Ue,c=an(),h=t(),y=!en(c.memoizedState,h);if(y&&(c.memoizedState=h,Tt=!0),c=c.queue,mi(wu.bind(null,a,c,e),[e]),c.getSnapshot!==t||y||Ze!==null&&Ze.memoizedState.tag&1){if(a.flags|=2048,hi(9,xu.bind(null,a,c,h,t),void 0,null),Ke===null)throw Error(s(349));_r&30||bu(a,t,h)}return h}function bu(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=Ue.updateQueue,t===null?(t={lastEffect:null,stores:null},Ue.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function xu(e,t,a,c){t.value=a,t.getSnapshot=c,Su(t)&&jt(e,1,-1)}function wu(e,t,a){return a(function(){Su(t)&&jt(e,1,-1)})}function Su(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!en(e,a)}catch{return!0}}function ts(e){var t=vn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:e},t.queue=e,e=e.dispatch=lp.bind(null,Ue,e),[t.memoizedState,e]}function hi(e,t,a,c){return e={tag:e,create:t,destroy:a,deps:c,next:null},t=Ue.updateQueue,t===null?(t={lastEffect:null,stores:null},Ue.updateQueue=t,t.lastEffect=e.next=e):(a=t.lastEffect,a===null?t.lastEffect=e.next=e:(c=a.next,a.next=e,e.next=c,t.lastEffect=e)),e}function _u(){return an().memoizedState}function ha(e,t,a,c){var h=vn();Ue.flags|=e,h.memoizedState=hi(1|t,a,void 0,c===void 0?null:c)}function ma(e,t,a,c){var h=an();c=c===void 0?null:c;var y=void 0;if(ot!==null){var T=ot.memoizedState;if(y=T.destroy,c!==null&&$o(c,T.deps)){h.memoizedState=hi(t,a,y,c);return}}Ue.flags|=e,h.memoizedState=hi(1|t,a,y,c)}function ns(e,t){return ha(8390656,8,e,t)}function mi(e,t){return ma(2048,8,e,t)}function Eu(e,t){return ma(4,2,e,t)}function Au(e,t){return ma(4,4,e,t)}function Tu(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Pu(e,t,a){return a=a!=null?a.concat([e]):null,ma(4,4,Tu.bind(null,t,e),a)}function rs(){}function Mu(e,t){var a=an();t=t===void 0?null:t;var c=a.memoizedState;return c!==null&&t!==null&&$o(t,c[1])?c[0]:(a.memoizedState=[e,t],e)}function Lu(e,t){var a=an();t=t===void 0?null:t;var c=a.memoizedState;return c!==null&&t!==null&&$o(t,c[1])?c[0]:(e=e(),a.memoizedState=[e,t],e)}function op(e,t){var a=_e;_e=a!==0&&4>a?a:4,e(!0);var c=Nt.transition;Nt.transition={};try{e(!1),t()}finally{_e=a,Nt.transition=c}}function Ru(){return an().memoizedState}function sp(e,t,a){var c=kn(e);a={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null},Cu(e)?Iu(t,a):(ku(e,t,a),a=ht(),e=jt(e,c,a),e!==null&&zu(e,t,c))}function lp(e,t,a){var c=kn(e),h={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null};if(Cu(e))Iu(t,h);else{ku(e,t,h);var y=e.alternate;if(e.lanes===0&&(y===null||y.lanes===0)&&(y=t.lastRenderedReducer,y!==null))try{var T=t.lastRenderedState,C=y(T,a);if(h.hasEagerState=!0,h.eagerState=C,en(C,T))return}catch{}finally{}a=ht(),e=jt(e,c,a),e!==null&&zu(e,t,c)}}function Cu(e){var t=e.alternate;return e===Ue||t!==null&&t===Ue}function Iu(e,t){fi=da=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function ku(e,t,a){Ke!==null&&e.mode&1&&!(ye&2)?(e=t.interleaved,e===null?(a.next=a,nn===null?nn=[t]:nn.push(t)):(a.next=e.next,e.next=a),t.interleaved=a):(e=t.pending,e===null?a.next=a:(a.next=e.next,e.next=a),t.pending=a)}function zu(e,t,a){if(a&4194240){var c=t.lanes;c&=e.pendingLanes,a|=c,t.lanes=a,Co(e,a)}}var ga={readContext:Ct,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useInsertionEffect:st,useLayoutEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useMutableSource:st,useSyncExternalStore:st,useId:st,unstable_isNewReconciler:!1},up={readContext:Ct,useCallback:function(e,t){return vn().memoizedState=[e,t===void 0?null:t],e},useContext:Ct,useEffect:ns,useImperativeHandle:function(e,t,a){return a=a!=null?a.concat([e]):null,ha(4194308,4,Tu.bind(null,t,e),a)},useLayoutEffect:function(e,t){return ha(4194308,4,e,t)},useInsertionEffect:function(e,t){return ha(4,2,e,t)},useMemo:function(e,t){var a=vn();return t=t===void 0?null:t,e=e(),a.memoizedState=[e,t],e},useReducer:function(e,t,a){var c=vn();return t=a!==void 0?a(t):t,c.memoizedState=c.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},c.queue=e,e=e.dispatch=sp.bind(null,Ue,e),[c.memoizedState,e]},useRef:function(e){var t=vn();return e={current:e},t.memoizedState=e},useState:ts,useDebugValue:rs,useDeferredValue:function(e){var t=ts(e),a=t[0],c=t[1];return ns(function(){var h=Nt.transition;Nt.transition={};try{c(e)}finally{Nt.transition=h}},[e]),a},useTransition:function(){var e=ts(!1),t=e[0];return e=op.bind(null,e[1]),vn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,a){var c=Ue,h=vn();if(ze){if(a===void 0)throw Error(s(407));a=a()}else{if(a=t(),Ke===null)throw Error(s(349));_r&30||bu(c,t,a)}h.memoizedState=a;var y={value:a,getSnapshot:t};return h.queue=y,ns(wu.bind(null,c,y,e),[e]),c.flags|=2048,hi(9,xu.bind(null,c,y,a,t),void 0,null),a},useId:function(){var e=vn(),t=Ke.identifierPrefix;if(ze){var a=gn,c=mn;a=(c&~(1<<32-Wt(c)-1)).toString(32)+a,t=":"+t+"R"+a,a=pi++,0<a&&(t+="H"+a.toString(32)),t+=":"}else a=ap++,t=":"+t+"r"+a.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cp={readContext:Ct,useCallback:Mu,useContext:Ct,useEffect:mi,useImperativeHandle:Pu,useInsertionEffect:Eu,useLayoutEffect:Au,useMemo:Lu,useReducer:fa,useRef:_u,useState:function(){return fa(Xn)},useDebugValue:rs,useDeferredValue:function(e){var t=fa(Xn),a=t[0],c=t[1];return mi(function(){var h=Nt.transition;Nt.transition={};try{c(e)}finally{Nt.transition=h}},[e]),a},useTransition:function(){var e=fa(Xn)[0],t=an().memoizedState;return[e,t]},useMutableSource:vu,useSyncExternalStore:yu,useId:Ru,unstable_isNewReconciler:!1},dp={readContext:Ct,useCallback:Mu,useContext:Ct,useEffect:mi,useImperativeHandle:Pu,useInsertionEffect:Eu,useLayoutEffect:Au,useMemo:Lu,useReducer:pa,useRef:_u,useState:function(){return pa(Xn)},useDebugValue:rs,useDeferredValue:function(e){var t=pa(Xn),a=t[0],c=t[1];return mi(function(){var h=Nt.transition;Nt.transition={};try{c(e)}finally{Nt.transition=h}},[e]),a},useTransition:function(){var e=pa(Xn)[0],t=an().memoizedState;return[e,t]},useMutableSource:vu,useSyncExternalStore:yu,useId:Ru,unstable_isNewReconciler:!1};function is(e,t){try{var a="",c=t;do a+=ip(c),c=c.return;while(c);var h=a}catch(y){h=`
Error generating stack: `+y.message+`
`+y.stack}return{value:e,source:t,stack:h}}function as(e,t){try{console.error(t.value)}catch(a){setTimeout(function(){throw a})}}var fp=typeof WeakMap=="function"?WeakMap:Map;function Nu(e,t,a){a=hn(-1,a),a.tag=3,a.payload={element:null};var c=t.value;return a.callback=function(){Ia||(Ia=!0,Ss=c),as(e,t)},a}function ju(e,t,a){a=hn(-1,a),a.tag=3;var c=e.type.getDerivedStateFromError;if(typeof c=="function"){var h=t.value;a.payload=function(){return c(h)},a.callback=function(){as(e,t)}}var y=e.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(a.callback=function(){as(e,t),typeof c!="function"&&(Cn===null?Cn=new Set([this]):Cn.add(this));var T=t.stack;this.componentDidCatch(t.value,{componentStack:T!==null?T:""})}),a}function Bu(e,t,a){var c=e.pingCache;if(c===null){c=e.pingCache=new fp;var h=new Set;c.set(t,h)}else h=c.get(t),h===void 0&&(h=new Set,c.set(t,h));h.has(a)||(h.add(a),e=Tp.bind(null,e,t,a),t.then(e,e))}function Ou(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Du(e,t,a,c,h){return e.mode&1?(e.flags|=65536,e.lanes=h,e):(e===t?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(t=hn(-1,1),t.tag=2,Rn(a,t))),a.lanes|=1),e)}function on(e){e.flags|=4}function Uu(e,t){if(e!==null&&e.child===t.child)return!0;if(t.flags&16)return!1;for(e=t.child;e!==null;){if(e.flags&12854||e.subtreeFlags&12854)return!1;e=e.sibling}return!0}var gi,vi,va,ya;if(me)gi=function(e,t){for(var a=t.child;a!==null;){if(a.tag===5||a.tag===6)ae(e,a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}},vi=function(){},va=function(e,t,a,c,h){if(e=e.memoizedProps,e!==c){var y=t.stateNode,T=rn(zt.current);a=Te(y,a,e,c,h,T),(t.updateQueue=a)&&on(t)}},ya=function(e,t,a,c){a!==c&&on(t)};else if(K){gi=function(e,t,a,c){for(var h=t.child;h!==null;){if(h.tag===5){var y=h.stateNode;a&&c&&(y=Tn(y,h.type,h.memoizedProps,h)),ae(e,y)}else if(h.tag===6)y=h.stateNode,a&&c&&(y=Yn(y,h.memoizedProps,h)),ae(e,y);else if(h.tag!==4){if(h.tag===22&&h.memoizedState!==null)y=h.child,y!==null&&(y.return=h),gi(e,h,!0,!0);else if(h.child!==null){h.child.return=h,h=h.child;continue}}if(h===t)break;for(;h.sibling===null;){if(h.return===null||h.return===t)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};var Fu=function(e,t,a,c){for(var h=t.child;h!==null;){if(h.tag===5){var y=h.stateNode;a&&c&&(y=Tn(y,h.type,h.memoizedProps,h)),Rt(e,y)}else if(h.tag===6)y=h.stateNode,a&&c&&(y=Yn(y,h.memoizedProps,h)),Rt(e,y);else if(h.tag!==4){if(h.tag===22&&h.memoizedState!==null)y=h.child,y!==null&&(y.return=h),Fu(e,h,!0,!0);else if(h.child!==null){h.child.return=h,h=h.child;continue}}if(h===t)break;for(;h.sibling===null;){if(h.return===null||h.return===t)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};vi=function(e,t){var a=t.stateNode;if(!Uu(e,t)){e=a.containerInfo;var c=Lt(e);Fu(c,t,!1,!1),a.pendingChildren=c,on(t),Kn(e,c)}},va=function(e,t,a,c,h){var y=e.stateNode,T=e.memoizedProps;if((e=Uu(e,t))&&T===c)t.stateNode=y;else{var C=t.stateNode,H=rn(zt.current),W=null;T!==c&&(W=Te(C,a,T,c,h,H)),e&&W===null?t.stateNode=y:(y=Yi(y,W,a,T,c,t,e,C),pe(y,a,c,h,H)&&on(t),t.stateNode=y,e?on(t):gi(y,t,!1,!1))}},ya=function(e,t,a,c){a!==c?(e=rn(wr.current),a=rn(zt.current),t.stateNode=St(c,e,a,t),on(t)):t.stateNode=e.stateNode}}else vi=function(){},va=function(){},ya=function(){};function yi(e,t){if(!ze)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function lt(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,c=0;if(t)for(var h=e.child;h!==null;)a|=h.lanes|h.childLanes,c|=h.subtreeFlags&14680064,c|=h.flags&14680064,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)a|=h.lanes|h.childLanes,c|=h.subtreeFlags,c|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=c,e.childLanes=a,t}function pp(e,t,a){var c=t.pendingProps;switch(Vo(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return lt(t),null;case 1:return vt(t.type)&&Wi(),lt(t),null;case 3:return c=t.stateNode,Sr(),Ce(gt),Ce(at),Zo(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(e===null||e.child===null)&&(li(t)?on(t):e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,qt!==null&&(As(qt),qt=null))),vi(e,t),lt(t),null;case 5:qo(t),a=rn(wr.current);var h=t.type;if(e!==null&&t.stateNode!=null)va(e,t,h,c,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!c){if(t.stateNode===null)throw Error(s(166));return lt(t),null}if(e=rn(zt.current),li(t)){if(!te)throw Error(s(175));e=kf(t.stateNode,t.type,t.memoizedProps,a,e,t,!si),t.updateQueue=e,e!==null&&on(t)}else{var y=Z(h,c,a,e,t);gi(y,t,!1,!1),t.stateNode=y,pe(y,h,c,a,e)&&on(t)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return lt(t),null;case 6:if(e&&t.stateNode!=null)ya(e,t,e.memoizedProps,c);else{if(typeof c!="string"&&t.stateNode===null)throw Error(s(166));if(e=rn(wr.current),a=rn(zt.current),li(t)){if(!te)throw Error(s(176));if(e=t.stateNode,c=t.memoizedProps,(a=zf(e,c,t,!si))&&(h=Et,h!==null))switch(y=(h.mode&1)!==0,h.tag){case 3:Ff(h.stateNode.containerInfo,e,c,y);break;case 5:Hf(h.type,h.memoizedProps,h.stateNode,e,c,y)}a&&on(t)}else t.stateNode=St(c,e,a,t)}return lt(t),null;case 13:if(Ce(Be),c=t.memoizedState,ze&&At!==null&&t.mode&1&&!(t.flags&128)){for(e=At;e;)e=ri(e);return br(),t.flags|=98560,t}if(c!==null&&c.dehydrated!==null){if(c=li(t),e===null){if(!c)throw Error(s(318));if(!te)throw Error(s(344));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Nf(e,t)}else br(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;return lt(t),null}return qt!==null&&(As(qt),qt=null),t.flags&128?(t.lanes=a,t):(c=c!==null,a=!1,e===null?li(t):a=e.memoizedState!==null,c&&!a&&(t.child.flags|=8192,t.mode&1&&(e===null||Be.current&1?qe===0&&(qe=3):Ps())),t.updateQueue!==null&&(t.flags|=4),lt(t),null);case 4:return Sr(),vi(e,t),e===null&&he(t.stateNode.containerInfo),lt(t),null;case 10:return Oo(t.type._context),lt(t),null;case 17:return vt(t.type)&&Wi(),lt(t),null;case 19:if(Ce(Be),h=t.memoizedState,h===null)return lt(t),null;if(c=(t.flags&128)!==0,y=h.rendering,y===null)if(c)yi(h,!1);else{if(qe!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(y=ua(e),y!==null){for(t.flags|=128,yi(h,!1),e=y.updateQueue,e!==null&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=a,c=t.child;c!==null;)a=c,h=e,a.flags&=14680066,y=a.alternate,y===null?(a.childLanes=0,a.lanes=h,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=y.childLanes,a.lanes=y.lanes,a.child=y.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=y.memoizedProps,a.memoizedState=y.memoizedState,a.updateQueue=y.updateQueue,a.type=y.type,h=y.dependencies,a.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),c=c.sibling;return Re(Be,Be.current&1|2),t.child}e=e.sibling}h.tail!==null&&Xe()>ws&&(t.flags|=128,c=!0,yi(h,!1),t.lanes=4194304)}else{if(!c)if(e=ua(y),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,e!==null&&(t.updateQueue=e,t.flags|=4),yi(h,!0),h.tail===null&&h.tailMode==="hidden"&&!y.alternate&&!ze)return lt(t),null}else 2*Xe()-h.renderingStartTime>ws&&a!==1073741824&&(t.flags|=128,c=!0,yi(h,!1),t.lanes=4194304);h.isBackwards?(y.sibling=t.child,t.child=y):(e=h.last,e!==null?e.sibling=y:t.child=y,h.last=y)}return h.tail!==null?(t=h.tail,h.rendering=t,h.tail=t.sibling,h.renderingStartTime=Xe(),t.sibling=null,e=Be.current,Re(Be,c?e&1|2:e&1),t):(lt(t),null);case 22:case 23:return Ts(),c=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==c&&(t.flags|=8192),c&&t.mode&1?Pt&1073741824&&(lt(t),me&&t.subtreeFlags&6&&(t.flags|=8192)):lt(t),null;case 24:return null;case 25:return null}throw Error(s(156,t.tag))}var hp=u.ReactCurrentOwner,Tt=!1;function pt(e,t,a,c){t.child=e===null?mu(t,null,a,c):xr(t,e.child,a,c)}function Hu(e,t,a,c,h){a=a.render;var y=t.ref;return gr(t,h),c=Jo(e,t,a,c,y,h),a=es(),e!==null&&!Tt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~h,yn(e,t,h)):(ze&&a&&Go(t),t.flags|=1,pt(e,t,c,h),t.child)}function Gu(e,t,a,c,h){if(e===null){var y=a.type;return typeof y=="function"&&!Ms(y)&&y.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(t.tag=15,t.type=y,Vu(e,t,y,c,h)):(e=Da(a.type,null,c,t,t.mode,h),e.ref=t.ref,e.return=t,t.child=e)}if(y=e.child,!(e.lanes&h)){var T=y.memoizedProps;if(a=a.compare,a=a!==null?a:ea,a(T,c)&&e.ref===t.ref)return yn(e,t,h)}return t.flags|=1,e=Nn(y,c),e.ref=t.ref,e.return=t,t.child=e}function Vu(e,t,a,c,h){if(e!==null&&ea(e.memoizedProps,c)&&e.ref===t.ref)if(Tt=!1,(e.lanes&h)!==0)e.flags&131072&&(Tt=!0);else return t.lanes=e.lanes,yn(e,t,h);return os(e,t,a,c,h)}function Ku(e,t,a){var c=t.pendingProps,h=c.children,y=e!==null?e.memoizedState:null;if(c.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null},Re(Er,Pt),Pt|=a;else if(a&1073741824)t.memoizedState={baseLanes:0,cachePool:null},c=y!==null?y.baseLanes:a,Re(Er,Pt),Pt|=c;else return e=y!==null?y.baseLanes|a:a,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,Re(Er,Pt),Pt|=e,null;else y!==null?(c=y.baseLanes|a,t.memoizedState=null):c=a,Re(Er,Pt),Pt|=c;return pt(e,t,h,a),t.child}function Yu(e,t){var a=t.ref;(e===null&&a!==null||e!==null&&e.ref!==a)&&(t.flags|=512,t.flags|=2097152)}function os(e,t,a,c,h){var y=vt(a)?Wn:at.current;return y=hr(t,y),gr(t,h),a=Jo(e,t,a,c,y,h),c=es(),e!==null&&!Tt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~h,yn(e,t,h)):(ze&&c&&Go(t),t.flags|=1,pt(e,t,a,h),t.child)}function Wu(e,t,a,c,h){if(vt(a)){var y=!0;Qi(t)}else y=!1;if(gr(t,h),t.stateNode===null)e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),su(t,a,c),Ho(t,a,c,h),c=!0;else if(e===null){var T=t.stateNode,C=t.memoizedProps;T.props=C;var H=T.context,W=a.contextType;typeof W=="object"&&W!==null?W=Ct(W):(W=vt(a)?Wn:at.current,W=hr(t,W));var J=a.getDerivedStateFromProps,ce=typeof J=="function"||typeof T.getSnapshotBeforeUpdate=="function";ce||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(C!==c||H!==W)&&lu(t,T,c,W),Ln=!1;var oe=t.memoizedState;T.state=oe,ia(t,c,T,h),H=t.memoizedState,C!==c||oe!==H||gt.current||Ln?(typeof J=="function"&&(Fo(t,a,J,c),H=t.memoizedState),(C=Ln||ou(t,a,C,c,oe,H,W))?(ce||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(t.flags|=4194308)):(typeof T.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=c,t.memoizedState=H),T.props=c,T.state=H,T.context=W,c=C):(typeof T.componentDidMount=="function"&&(t.flags|=4194308),c=!1)}else{T=t.stateNode,nu(e,t),C=t.memoizedProps,W=t.type===t.elementType?C:Qt(t.type,C),T.props=W,ce=t.pendingProps,oe=T.context,H=a.contextType,typeof H=="object"&&H!==null?H=Ct(H):(H=vt(a)?Wn:at.current,H=hr(t,H));var Pe=a.getDerivedStateFromProps;(J=typeof Pe=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(C!==ce||oe!==H)&&lu(t,T,c,H),Ln=!1,oe=t.memoizedState,T.state=oe,ia(t,c,T,h);var re=t.memoizedState;C!==ce||oe!==re||gt.current||Ln?(typeof Pe=="function"&&(Fo(t,a,Pe,c),re=t.memoizedState),(W=Ln||ou(t,a,W,c,oe,re,H)||!1)?(J||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(c,re,H),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(c,re,H)),typeof T.componentDidUpdate=="function"&&(t.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof T.componentDidUpdate!="function"||C===e.memoizedProps&&oe===e.memoizedState||(t.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||C===e.memoizedProps&&oe===e.memoizedState||(t.flags|=1024),t.memoizedProps=c,t.memoizedState=re),T.props=c,T.state=re,T.context=H,c=W):(typeof T.componentDidUpdate!="function"||C===e.memoizedProps&&oe===e.memoizedState||(t.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||C===e.memoizedProps&&oe===e.memoizedState||(t.flags|=1024),c=!1)}return ss(e,t,a,c,y,h)}function ss(e,t,a,c,h,y){Yu(e,t);var T=(t.flags&128)!==0;if(!c&&!T)return h&&Zl(t,a,!1),yn(e,t,y);c=t.stateNode,hp.current=t;var C=T&&typeof a.getDerivedStateFromError!="function"?null:c.render();return t.flags|=1,e!==null&&T?(t.child=xr(t,e.child,null,y),t.child=xr(t,null,C,y)):pt(e,t,C,y),t.memoizedState=c.state,h&&Zl(t,a,!0),t.child}function Qu(e){var t=e.stateNode;t.pendingContext?ql(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ql(e,t.context,!1),Qo(e,t.containerInfo)}function qu(e,t,a,c,h){return br(),Wo(h),t.flags|=256,pt(e,t,a,c),t.child}var ba={dehydrated:null,treeContext:null,retryLane:0};function xa(e){return{baseLanes:e,cachePool:null}}function Xu(e,t,a){var c=t.pendingProps,h=Be.current,y=!1,T=(t.flags&128)!==0,C;if((C=T)||(C=e!==null&&e.memoizedState===null?!1:(h&2)!==0),C?(y=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(h|=1),Re(Be,h&1),e===null)return Yo(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?Eo(e)?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(h=c.children,e=c.fallback,y?(c=t.mode,y=t.child,h={mode:"hidden",children:h},!(c&1)&&y!==null?(y.childLanes=0,y.pendingProps=h):y=Ua(h,c,0,null),e=nr(e,c,a,null),y.return=t,e.return=t,y.sibling=e,t.child=y,t.child.memoizedState=xa(a),t.memoizedState=ba,e):ls(t,h));if(h=e.memoizedState,h!==null){if(C=h.dehydrated,C!==null){if(T)return t.flags&256?(t.flags&=-257,wa(e,t,a,Error(s(422)))):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(y=c.fallback,h=t.mode,c=Ua({mode:"visible",children:c.children},h,0,null),y=nr(y,h,a,null),y.flags|=2,c.return=t,y.return=t,c.sibling=y,t.child=c,t.mode&1&&xr(t,e.child,null,a),t.child.memoizedState=xa(a),t.memoizedState=ba,y);if(!(t.mode&1))t=wa(e,t,a,null);else if(Eo(C))t=wa(e,t,a,Error(s(419)));else if(c=(a&e.childLanes)!==0,Tt||c){if(c=Ke,c!==null){switch(a&-a){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}c=y&(c.suspendedLanes|a)?0:y,c!==0&&c!==h.retryLane&&(h.retryLane=c,jt(e,c,-1))}Ps(),t=wa(e,t,a,Error(s(421)))}else Wl(C)?(t.flags|=128,t.child=e.child,t=Pp.bind(null,e),Lf(C,t),t=null):(a=h.treeContext,te&&(At=If(C),Et=t,ze=!0,qt=null,si=!1,a!==null&&(It[kt++]=mn,It[kt++]=gn,It[kt++]=Qn,mn=a.id,gn=a.overflow,Qn=t)),t=ls(t,t.pendingProps.children),t.flags|=4096);return t}return y?(c=$u(e,t,c.children,c.fallback,a),y=t.child,h=e.child.memoizedState,y.memoizedState=h===null?xa(a):{baseLanes:h.baseLanes|a,cachePool:null},y.childLanes=e.childLanes&~a,t.memoizedState=ba,c):(a=Zu(e,t,c.children,a),t.memoizedState=null,a)}return y?(c=$u(e,t,c.children,c.fallback,a),y=t.child,h=e.child.memoizedState,y.memoizedState=h===null?xa(a):{baseLanes:h.baseLanes|a,cachePool:null},y.childLanes=e.childLanes&~a,t.memoizedState=ba,c):(a=Zu(e,t,c.children,a),t.memoizedState=null,a)}function ls(e,t){return t=Ua({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Zu(e,t,a,c){var h=e.child;return e=h.sibling,a=Nn(h,{mode:"visible",children:a}),!(t.mode&1)&&(a.lanes=c),a.return=t,a.sibling=null,e!==null&&(c=t.deletions,c===null?(t.deletions=[e],t.flags|=16):c.push(e)),t.child=a}function $u(e,t,a,c,h){var y=t.mode;e=e.child;var T=e.sibling,C={mode:"hidden",children:a};return!(y&1)&&t.child!==e?(a=t.child,a.childLanes=0,a.pendingProps=C,t.deletions=null):(a=Nn(e,C),a.subtreeFlags=e.subtreeFlags&14680064),T!==null?c=Nn(T,c):(c=nr(c,y,h,null),c.flags|=2),c.return=t,a.return=t,a.sibling=c,t.child=a,c}function wa(e,t,a,c){return c!==null&&Wo(c),xr(t,e.child,null,a),e=ls(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Ju(e,t,a){e.lanes|=t;var c=e.alternate;c!==null&&(c.lanes|=t),Do(e.return,t,a)}function us(e,t,a,c,h){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:h}:(y.isBackwards=t,y.rendering=null,y.renderingStartTime=0,y.last=c,y.tail=a,y.tailMode=h)}function ec(e,t,a){var c=t.pendingProps,h=c.revealOrder,y=c.tail;if(pt(e,t,c.children,a),c=Be.current,c&2)c=c&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ju(e,a,t);else if(e.tag===19)Ju(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}if(Re(Be,c),!(t.mode&1))t.memoizedState=null;else switch(h){case"forwards":for(a=t.child,h=null;a!==null;)e=a.alternate,e!==null&&ua(e)===null&&(h=a),a=a.sibling;a=h,a===null?(h=t.child,t.child=null):(h=a.sibling,a.sibling=null),us(t,!1,h,a,y);break;case"backwards":for(a=null,h=t.child,t.child=null;h!==null;){if(e=h.alternate,e!==null&&ua(e)===null){t.child=h;break}e=h.sibling,h.sibling=a,a=h,h=e}us(t,!0,a,null,y);break;case"together":us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function yn(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Ar|=t.lanes,!(a&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(s(153));if(t.child!==null){for(e=t.child,a=Nn(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Nn(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function mp(e,t,a){switch(t.tag){case 3:Qu(t),br();break;case 5:gu(t);break;case 1:vt(t.type)&&Qi(t);break;case 4:Qo(t,t.stateNode.containerInfo);break;case 10:tu(t,t.type._context,t.memoizedProps.value);break;case 13:var c=t.memoizedState;if(c!==null)return c.dehydrated!==null?(Re(Be,Be.current&1),t.flags|=128,null):a&t.child.childLanes?Xu(e,t,a):(Re(Be,Be.current&1),e=yn(e,t,a),e!==null?e.sibling:null);Re(Be,Be.current&1);break;case 19:if(c=(a&t.childLanes)!==0,e.flags&128){if(c)return ec(e,t,a);t.flags|=128}var h=t.memoizedState;if(h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),Re(Be,Be.current),c)break;return null;case 22:case 23:return t.lanes=0,Ku(e,t,a)}return yn(e,t,a)}function gp(e,t){switch(Vo(t),t.tag){case 1:return vt(t.type)&&Wi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Sr(),Ce(gt),Ce(at),Zo(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return qo(t),null;case 13:if(Ce(Be),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(s(340));br()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ce(Be),null;case 4:return Sr(),null;case 10:return Oo(t.type._context),null;case 22:case 23:return Ts(),null;case 24:return null;default:return null}}var Sa=!1,Zn=!1,vp=typeof WeakSet=="function"?WeakSet:Set,q=null;function _a(e,t){var a=e.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(c){xt(e,t,c)}else a.current=null}function tc(e,t,a){try{a()}catch(c){xt(e,t,c)}}var nc=!1;function yp(e,t){for(V(e.containerInfo),q=t;q!==null;)if(e=q,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,q=t;else for(;q!==null;){e=q;try{var a=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(a!==null){var c=a.memoizedProps,h=a.memoizedState,y=e.stateNode,T=y.getSnapshotBeforeUpdate(e.elementType===e.type?c:Qt(e.type,c),h);y.__reactInternalSnapshotBeforeUpdate=T}break;case 3:me&&fr(e.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(C){xt(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,q=t;break}q=e.return}return a=nc,nc=!1,a}function $n(e,t,a){var c=t.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var h=c=c.next;do{if((h.tag&e)===e){var y=h.destroy;h.destroy=void 0,y!==void 0&&tc(t,a,y)}h=h.next}while(h!==c)}}function bi(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var a=t=t.next;do{if((a.tag&e)===e){var c=a.create;a.destroy=c()}a=a.next}while(a!==t)}}function cs(e){var t=e.ref;if(t!==null){var a=e.stateNode;switch(e.tag){case 5:e=le(a);break;default:e=a}typeof t=="function"?t(e):t.current=e}}function rc(e,t,a){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount($i,t)}catch{}switch(t.tag){case 0:case 11:case 14:case 15:if(e=t.updateQueue,e!==null&&(e=e.lastEffect,e!==null)){var c=e=e.next;do{var h=c,y=h.destroy;h=h.tag,y!==void 0&&(h&2||h&4)&&tc(t,a,y),c=c.next}while(c!==e)}break;case 1:if(_a(t,a),e=t.stateNode,typeof e.componentWillUnmount=="function")try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(T){xt(t,a,T)}break;case 5:_a(t,a);break;case 4:me?uc(e,t,a):K&&K&&(t=t.stateNode.containerInfo,a=Lt(t),An(t,a))}}function ic(e,t,a){for(var c=t;;)if(rc(e,c,a),c.child===null||me&&c.tag===4){if(c===t)break;for(;c.sibling===null;){if(c.return===null||c.return===t)return;c=c.return}c.sibling.return=c.return,c=c.sibling}else c.child.return=c,c=c.child}function ac(e){var t=e.alternate;t!==null&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&we(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return e.tag===5||e.tag===3||e.tag===4}function sc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function lc(e){if(me){e:{for(var t=e.return;t!==null;){if(oc(t))break e;t=t.return}throw Error(s(160))}var a=t;switch(a.tag){case 5:t=a.stateNode,a.flags&32&&(Q(t),a.flags&=-33),a=sc(e),fs(e,a,t);break;case 3:case 4:t=a.stateNode.containerInfo,a=sc(e),ds(e,a,t);break;default:throw Error(s(161))}}}function ds(e,t,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?Ki(a,e,t):wo(a,e);else if(c!==4&&(e=e.child,e!==null))for(ds(e,t,a),e=e.sibling;e!==null;)ds(e,t,a),e=e.sibling}function fs(e,t,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?Vi(a,e,t):ti(a,e);else if(c!==4&&(e=e.child,e!==null))for(fs(e,t,a),e=e.sibling;e!==null;)fs(e,t,a),e=e.sibling}function uc(e,t,a){for(var c=t,h=!1,y,T;;){if(!h){h=c.return;e:for(;;){if(h===null)throw Error(s(160));switch(y=h.stateNode,h.tag){case 5:T=!1;break e;case 3:y=y.containerInfo,T=!0;break e;case 4:y=y.containerInfo,T=!0;break e}h=h.return}h=!0}if(c.tag===5||c.tag===6)ic(e,c,a),T?j(y,c.stateNode):ni(y,c.stateNode);else if(c.tag===18)T?Df(y,c.stateNode):Of(y,c.stateNode);else if(c.tag===4){if(c.child!==null){y=c.stateNode.containerInfo,T=!0,c.child.return=c,c=c.child;continue}}else if(rc(e,c,a),c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break;for(;c.sibling===null;){if(c.return===null||c.return===t)return;c=c.return,c.tag===4&&(h=!1)}c.sibling.return=c.return,c=c.sibling}}function ps(e,t){if(me){switch(t.tag){case 0:case 11:case 14:case 15:$n(3,t,t.return),bi(3,t),$n(5,t,t.return);return;case 1:return;case 5:var a=t.stateNode;if(a!=null){var c=t.memoizedProps;e=e!==null?e.memoizedProps:c;var h=t.type,y=t.updateQueue;t.updateQueue=null,y!==null&&_o(a,y,h,e,c,t)}return;case 6:if(t.stateNode===null)throw Error(s(162));a=t.memoizedProps,So(t.stateNode,e!==null?e.memoizedProps:a,a);return;case 3:te&&e!==null&&e.memoizedState.isDehydrated&&Ql(t.stateNode.containerInfo);return;case 12:return;case 13:Ea(t);return;case 19:Ea(t);return;case 17:return}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:$n(3,t,t.return),bi(3,t),$n(5,t,t.return);return;case 12:return;case 13:Ea(t);return;case 19:Ea(t);return;case 3:te&&e!==null&&e.memoizedState.isDehydrated&&Ql(t.stateNode.containerInfo);break;case 22:case 23:return}e:if(K){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,An(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function Ea(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var a=e.stateNode;a===null&&(a=e.stateNode=new vp),t.forEach(function(c){var h=Mp.bind(null,e,c);a.has(c)||(a.add(c),c.then(h,h))})}}function bp(e,t){for(q=t;q!==null;){t=q;var a=t.deletions;if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];try{var y=e;me?uc(y,h,t):ic(y,h,t);var T=h.alternate;T!==null&&(T.return=null),h.return=null}catch(ie){xt(h,t,ie)}}if(a=t.child,t.subtreeFlags&12854&&a!==null)a.return=t,q=a;else for(;q!==null;){t=q;try{var C=t.flags;if(C&32&&me&&Q(t.stateNode),C&512){var H=t.alternate;if(H!==null){var W=H.ref;W!==null&&(typeof W=="function"?W(null):W.current=null)}}if(C&8192)switch(t.tag){case 13:if(t.memoizedState!==null){var J=t.alternate;(J===null||J.memoizedState===null)&&(xs=Xe())}break;case 22:var ce=t.memoizedState!==null,oe=t.alternate,Pe=oe!==null&&oe.memoizedState!==null;if(a=t,me){e:if(c=a,h=ce,y=null,me)for(var re=c;;){if(re.tag===5){if(y===null){y=re;var ut=re.stateNode;h?se(ut):ft(re.stateNode,re.memoizedProps)}}else if(re.tag===6){if(y===null){var Ot=re.stateNode;h?Se(Ot):_t(Ot,re.memoizedProps)}}else if((re.tag!==22&&re.tag!==23||re.memoizedState===null||re===c)&&re.child!==null){re.child.return=re,re=re.child;continue}if(re===c)break;for(;re.sibling===null;){if(re.return===null||re.return===c)break e;y===re&&(y=null),re=re.return}y===re&&(y=null),re.sibling.return=re.return,re=re.sibling}}if(ce&&!Pe&&a.mode&1){q=a;for(var O=a.child;O!==null;){for(a=q=O;q!==null;){c=q;var k=c.child;switch(c.tag){case 0:case 11:case 14:case 15:$n(4,c,c.return);break;case 1:_a(c,c.return);var U=c.stateNode;if(typeof U.componentWillUnmount=="function"){var X=c.return;try{U.props=c.memoizedProps,U.state=c.memoizedState,U.componentWillUnmount()}catch(ie){xt(c,X,ie)}}break;case 5:_a(c,c.return);break;case 22:if(c.memoizedState!==null){fc(a);continue}}k!==null?(k.return=c,q=k):fc(a)}O=O.sibling}}}switch(C&4102){case 2:lc(t),t.flags&=-3;break;case 6:lc(t),t.flags&=-3,ps(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,ps(t.alternate,t);break;case 4:ps(t.alternate,t)}}catch(ie){xt(t,t.return,ie)}if(a=t.sibling,a!==null){a.return=t.return,q=a;break}q=t.return}}}function xp(e,t,a){q=e,cc(e)}function cc(e,t,a){for(var c=(e.mode&1)!==0;q!==null;){var h=q,y=h.child;if(h.tag===22&&c){var T=h.memoizedState!==null||Sa;if(!T){var C=h.alternate,H=C!==null&&C.memoizedState!==null||Zn;C=Sa;var W=Zn;if(Sa=T,(Zn=H)&&!W)for(q=h;q!==null;)T=q,H=T.child,T.tag===22&&T.memoizedState!==null?pc(h):H!==null?(H.return=T,q=H):pc(h);for(;y!==null;)q=y,cc(y),y=y.sibling;q=h,Sa=C,Zn=W}dc(e)}else h.subtreeFlags&8772&&y!==null?(y.return=h,q=y):dc(e)}}function dc(e){for(;q!==null;){var t=q;if(t.flags&8772){var a=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Zn||bi(5,t);break;case 1:var c=t.stateNode;if(t.flags&4&&!Zn)if(a===null)c.componentDidMount();else{var h=t.elementType===t.type?a.memoizedProps:Qt(t.type,a.memoizedProps);c.componentDidUpdate(h,a.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var y=t.updateQueue;y!==null&&iu(t,y,c);break;case 3:var T=t.updateQueue;if(T!==null){if(a=null,t.child!==null)switch(t.child.tag){case 5:a=le(t.child.stateNode);break;case 1:a=t.child.stateNode}iu(t,T,a)}break;case 5:var C=t.stateNode;a===null&&t.flags&4&&Gi(C,t.type,t.memoizedProps,t);break;case 6:break;case 4:break;case 12:break;case 13:if(te&&t.memoizedState===null){var H=t.alternate;if(H!==null){var W=H.memoizedState;if(W!==null){var J=W.dehydrated;J!==null&&Bf(J)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(s(163))}Zn||t.flags&512&&cs(t)}catch(ce){xt(t,t.return,ce)}}if(t===e){q=null;break}if(a=t.sibling,a!==null){a.return=t.return,q=a;break}q=t.return}}function fc(e){for(;q!==null;){var t=q;if(t===e){q=null;break}var a=t.sibling;if(a!==null){a.return=t.return,q=a;break}q=t.return}}function pc(e){for(;q!==null;){var t=q;try{switch(t.tag){case 0:case 11:case 15:var a=t.return;try{bi(4,t)}catch(H){xt(t,a,H)}break;case 1:var c=t.stateNode;if(typeof c.componentDidMount=="function"){var h=t.return;try{c.componentDidMount()}catch(H){xt(t,h,H)}}var y=t.return;try{cs(t)}catch(H){xt(t,y,H)}break;case 5:var T=t.return;try{cs(t)}catch(H){xt(t,T,H)}}}catch(H){xt(t,t.return,H)}if(t===e){q=null;break}var C=t.sibling;if(C!==null){C.return=t.return,q=C;break}q=t.return}}var Aa=0,Ta=1,Pa=2,Ma=3,La=4;if(typeof Symbol=="function"&&Symbol.for){var xi=Symbol.for;Aa=xi("selector.component"),Ta=xi("selector.has_pseudo_class"),Pa=xi("selector.role"),Ma=xi("selector.test_id"),La=xi("selector.text")}function hs(e){var t=Me(e);if(t!=null){if(typeof t.memoizedProps["data-testname"]!="string")throw Error(s(364));return t}if(e=Fi(e),e===null)throw Error(s(362));return e.stateNode.current}function ms(e,t){switch(t.$$typeof){case Aa:if(e.type===t.value)return!0;break;case Ta:e:{t=t.value,e=[e,0];for(var a=0;a<e.length;){var c=e[a++],h=e[a++],y=t[h];if(c.tag!==5||!En(c)){for(;y!=null&&ms(c,y);)h++,y=t[h];if(h===t.length){t=!0;break e}else for(c=c.child;c!==null;)e.push(c,h),c=c.sibling}}t=!1}return t;case Pa:if(e.tag===5&&bo(e.stateNode,t.value))return!0;break;case La:if((e.tag===5||e.tag===6)&&(e=ei(e),e!==null&&0<=e.indexOf(t.value)))return!0;break;case Ma:if(e.tag===5&&(e=e.memoizedProps["data-testname"],typeof e=="string"&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function gs(e){switch(e.$$typeof){case Aa:return"<"+(L(e.value)||"Unknown")+">";case Ta:return":has("+(gs(e)||"")+")";case Pa:return'[role="'+e.value+'"]';case La:return'"'+e.value+'"';case Ma:return'[data-testname="'+e.value+'"]';default:throw Error(s(365))}}function hc(e,t){var a=[];e=[e,0];for(var c=0;c<e.length;){var h=e[c++],y=e[c++],T=t[y];if(h.tag!==5||!En(h)){for(;T!=null&&ms(h,T);)y++,T=t[y];if(y===t.length)a.push(h);else for(h=h.child;h!==null;)e.push(h,y),h=h.sibling}}return a}function vs(e,t){if(!et)throw Error(s(363));e=hs(e),e=hc(e,t),t=[],e=Array.from(e);for(var a=0;a<e.length;){var c=e[a++];if(c.tag===5)En(c)||t.push(c.stateNode);else for(c=c.child;c!==null;)e.push(c),c=c.sibling}return t}var wp=Math.ceil,Ra=u.ReactCurrentDispatcher,ys=u.ReactCurrentOwner,Ge=u.ReactCurrentBatchConfig,ye=0,Ke=null,Ye=null,tt=0,Pt=0,Er=Pn(0),qe=0,wi=null,Ar=0,Ca=0,bs=0,Si=null,yt=null,xs=0,ws=1/0;function Tr(){ws=Xe()+500}var Ia=!1,Ss=null,Cn=null,ka=!1,In=null,za=0,_i=0,_s=null,Na=-1,ja=0;function ht(){return ye&6?Xe():Na!==-1?Na:Na=Xe()}function kn(e){return e.mode&1?ye&2&&tt!==0?tt&-tt:rp.transition!==null?(ja===0&&(e=qi,qi<<=1,!(qi&4194240)&&(qi=64),ja=e),ja):(e=_e,e!==0?e:Ve()):1}function jt(e,t,a){if(50<_i)throw _i=0,_s=null,Error(s(185));var c=Ba(e,t);return c===null?null:(oi(c,t,a),(!(ye&2)||c!==Ke)&&(c===Ke&&(!(ye&2)&&(Ca|=t),qe===4&&zn(c,tt)),bt(c,a),t===1&&ye===0&&!(e.mode&1)&&(Tr(),Ji&&tn())),c)}function Ba(e,t){e.lanes|=t;var a=e.alternate;for(a!==null&&(a.lanes|=t),a=e,e=e.return;e!==null;)e.childLanes|=t,a=e.alternate,a!==null&&(a.childLanes|=t),a=e,e=e.return;return a.tag===3?a.stateNode:null}function bt(e,t){var a=e.callbackNode;Qf(e,t);var c=Zi(e,e===Ke?tt:0);if(c===0)a!==null&&Jl(a),e.callbackNode=null,e.callbackPriority=0;else if(t=c&-c,e.callbackPriority!==t){if(a!=null&&Jl(a),t===1)e.tag===0?np(gc.bind(null,e)):eu(gc.bind(null,e)),Le?je(function(){ye===0&&tn()}):Io(ko,tn),a=null;else{switch($l(c)){case 1:a=ko;break;case 4:a=$f;break;case 16:a=zo;break;case 536870912:a=Jf;break;default:a=zo}a=Ac(a,mc.bind(null,e))}e.callbackPriority=t,e.callbackNode=a}}function mc(e,t){if(Na=-1,ja=0,ye&6)throw Error(s(327));var a=e.callbackNode;if(tr()&&e.callbackNode!==a)return null;var c=Zi(e,e===Ke?tt:0);if(c===0)return null;if(c&30||c&e.expiredLanes||t)t=Oa(e,c);else{t=c;var h=ye;ye|=2;var y=bc();(Ke!==e||tt!==t)&&(Tr(),Jn(e,t));do try{Ep();break}catch(C){yc(e,C)}while(!0);Bo(),Ra.current=y,ye=h,Ye!==null?t=0:(Ke=null,tt=0,t=qe)}if(t!==0){if(t===2&&(h=Lo(e),h!==0&&(c=h,t=Es(e,h))),t===1)throw a=wi,Jn(e,0),zn(e,c),bt(e,Xe()),a;if(t===6)zn(e,c);else{if(h=e.current.alternate,!(c&30)&&!Sp(h)&&(t=Oa(e,c),t===2&&(y=Lo(e),y!==0&&(c=y,t=Es(e,y))),t===1))throw a=wi,Jn(e,0),zn(e,c),bt(e,Xe()),a;switch(e.finishedWork=h,e.finishedLanes=c,t){case 0:case 1:throw Error(s(345));case 2:er(e,yt);break;case 3:if(zn(e,c),(c&130023424)===c&&(t=xs+500-Xe(),10<t)){if(Zi(e,0)!==0)break;if(h=e.suspendedLanes,(h&c)!==c){ht(),e.pingedLanes|=e.suspendedLanes&h;break}e.timeoutHandle=dt(er.bind(null,e,yt),t);break}er(e,yt);break;case 4:if(zn(e,c),(c&4194240)===c)break;for(t=e.eventTimes,h=-1;0<c;){var T=31-Wt(c);y=1<<T,T=t[T],T>h&&(h=T),c&=~y}if(c=h,c=Xe()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*wp(c/1960))-c,10<c){e.timeoutHandle=dt(er.bind(null,e,yt),c);break}er(e,yt);break;case 5:er(e,yt);break;default:throw Error(s(329))}}}return bt(e,Xe()),e.callbackNode===a?mc.bind(null,e):null}function Es(e,t){var a=Si;return e.current.memoizedState.isDehydrated&&(Jn(e,t).flags|=256),e=Oa(e,t),e!==2&&(t=yt,yt=a,t!==null&&As(t)),e}function As(e){yt===null?yt=e:yt.push.apply(yt,e)}function Sp(e){for(var t=e;;){if(t.flags&16384){var a=t.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var c=0;c<a.length;c++){var h=a[c],y=h.getSnapshot;h=h.value;try{if(!en(y(),h))return!1}catch{return!1}}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function zn(e,t){for(t&=~bs,t&=~Ca,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var a=31-Wt(t),c=1<<a;e[a]=-1,t&=~c}}function gc(e){if(ye&6)throw Error(s(327));tr();var t=Zi(e,0);if(!(t&1))return bt(e,Xe()),null;var a=Oa(e,t);if(e.tag!==0&&a===2){var c=Lo(e);c!==0&&(t=c,a=Es(e,c))}if(a===1)throw a=wi,Jn(e,0),zn(e,t),bt(e,Xe()),a;if(a===6)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,er(e,yt),bt(e,Xe()),null}function vc(e){In!==null&&In.tag===0&&!(ye&6)&&tr();var t=ye;ye|=1;var a=Ge.transition,c=_e;try{if(Ge.transition=null,_e=1,e)return e()}finally{_e=c,Ge.transition=a,ye=t,!(ye&6)&&tn()}}function Ts(){Pt=Er.current,Ce(Er)}function Jn(e,t){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(a!==_n&&(e.timeoutHandle=_n,Yt(a)),Ye!==null)for(a=Ye.return;a!==null;){var c=a;switch(Vo(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&Wi();break;case 3:Sr(),Ce(gt),Ce(at),Zo();break;case 5:qo(c);break;case 4:Sr();break;case 13:Ce(Be);break;case 19:Ce(Be);break;case 10:Oo(c.type._context);break;case 22:case 23:Ts()}a=a.return}if(Ke=e,Ye=e=Nn(e.current,null),tt=Pt=t,qe=0,wi=null,bs=Ca=Ar=0,yt=Si=null,nn!==null){for(t=0;t<nn.length;t++)if(a=nn[t],c=a.interleaved,c!==null){a.interleaved=null;var h=c.next,y=a.pending;if(y!==null){var T=y.next;y.next=h,c.next=T}a.pending=c}nn=null}return e}function yc(e,t){do{var a=Ye;try{if(Bo(),ca.current=ga,da){for(var c=Ue.memoizedState;c!==null;){var h=c.queue;h!==null&&(h.pending=null),c=c.next}da=!1}if(_r=0,Ze=ot=Ue=null,fi=!1,pi=0,ys.current=null,a===null||a.return===null){qe=1,wi=t,Ye=null;break}e:{var y=e,T=a.return,C=a,H=t;if(t=tt,C.flags|=32768,H!==null&&typeof H=="object"&&typeof H.then=="function"){var W=H,J=C,ce=J.tag;if(!(J.mode&1)&&(ce===0||ce===11||ce===15)){var oe=J.alternate;oe?(J.updateQueue=oe.updateQueue,J.memoizedState=oe.memoizedState,J.lanes=oe.lanes):(J.updateQueue=null,J.memoizedState=null)}var Pe=Ou(T);if(Pe!==null){Pe.flags&=-257,Du(Pe,T,C,y,t),Pe.mode&1&&Bu(y,W,t),t=Pe,H=W;var re=t.updateQueue;if(re===null){var ut=new Set;ut.add(H),t.updateQueue=ut}else re.add(H);break e}else{if(!(t&1)){Bu(y,W,t),Ps();break e}H=Error(s(426))}}else if(ze&&C.mode&1){var Ot=Ou(T);if(Ot!==null){!(Ot.flags&65536)&&(Ot.flags|=256),Du(Ot,T,C,y,t),Wo(H);break e}}y=H,qe!==4&&(qe=2),Si===null?Si=[y]:Si.push(y),H=is(H,C),C=T;do{switch(C.tag){case 3:C.flags|=65536,t&=-t,C.lanes|=t;var O=Nu(C,H,t);ru(C,O);break e;case 1:y=H;var k=C.type,U=C.stateNode;if(!(C.flags&128)&&(typeof k.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(Cn===null||!Cn.has(U)))){C.flags|=65536,t&=-t,C.lanes|=t;var X=ju(C,y,t);ru(C,X);break e}}C=C.return}while(C!==null)}wc(a)}catch(ie){t=ie,Ye===a&&a!==null&&(Ye=a=a.return);continue}break}while(!0)}function bc(){var e=Ra.current;return Ra.current=ga,e===null?ga:e}function Ps(){(qe===0||qe===3||qe===2)&&(qe=4),Ke===null||!(Ar&268435455)&&!(Ca&268435455)||zn(Ke,tt)}function Oa(e,t){var a=ye;ye|=2;var c=bc();Ke===e&&tt===t||Jn(e,t);do try{_p();break}catch(h){yc(e,h)}while(!0);if(Bo(),ye=a,Ra.current=c,Ye!==null)throw Error(s(261));return Ke=null,tt=0,qe}function _p(){for(;Ye!==null;)xc(Ye)}function Ep(){for(;Ye!==null&&!Xf();)xc(Ye)}function xc(e){var t=Ec(e.alternate,e,Pt);e.memoizedProps=e.pendingProps,t===null?wc(e):Ye=t,ys.current=null}function wc(e){var t=e;do{var a=t.alternate;if(e=t.return,t.flags&32768){if(a=gp(a,t),a!==null){a.flags&=32767,Ye=a;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{qe=6,Ye=null;return}}else if(a=pp(a,t,Pt),a!==null){Ye=a;return}if(t=t.sibling,t!==null){Ye=t;return}Ye=t=e}while(t!==null);qe===0&&(qe=5)}function er(e,t){var a=_e,c=Ge.transition;try{Ge.transition=null,_e=1,Ap(e,t,a)}finally{Ge.transition=c,_e=a}return null}function Ap(e,t,a){do tr();while(In!==null);if(ye&6)throw Error(s(327));var c=e.finishedWork,h=e.finishedLanes;if(c===null)return null;if(e.finishedWork=null,e.finishedLanes=0,c===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var y=c.lanes|c.childLanes;if(qf(e,y),e===Ke&&(Ye=Ke=null,tt=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||ka||(ka=!0,Ac(zo,function(){return tr(),null})),y=(c.flags&15990)!==0,c.subtreeFlags&15990||y){y=Ge.transition,Ge.transition=null;var T=_e;_e=1;var C=ye;ye|=4,ys.current=null,yp(e,c),bp(e,c),ee(e.containerInfo),e.current=c,xp(c),Zf(),ye=C,_e=T,Ge.transition=y}else e.current=c;if(ka&&(ka=!1,In=e,za=h),y=e.pendingLanes,y===0&&(Cn=null),ep(c.stateNode),bt(e,Xe()),t!==null)for(a=e.onRecoverableError,c=0;c<t.length;c++)a(t[c]);if(Ia)throw Ia=!1,e=Ss,Ss=null,e;return za&1&&e.tag!==0&&tr(),y=e.pendingLanes,y&1?e===_s?_i++:(_i=0,_s=e):_i=0,tn(),null}function tr(){if(In!==null){var e=$l(za),t=Ge.transition,a=_e;try{if(Ge.transition=null,_e=16>e?16:e,In===null)var c=!1;else{if(e=In,In=null,za=0,ye&6)throw Error(s(331));var h=ye;for(ye|=4,q=e.current;q!==null;){var y=q,T=y.child;if(q.flags&16){var C=y.deletions;if(C!==null){for(var H=0;H<C.length;H++){var W=C[H];for(q=W;q!==null;){var J=q;switch(J.tag){case 0:case 11:case 15:$n(8,J,y)}var ce=J.child;if(ce!==null)ce.return=J,q=ce;else for(;q!==null;){J=q;var oe=J.sibling,Pe=J.return;if(ac(J),J===W){q=null;break}if(oe!==null){oe.return=Pe,q=oe;break}q=Pe}}}var re=y.alternate;if(re!==null){var ut=re.child;if(ut!==null){re.child=null;do{var Ot=ut.sibling;ut.sibling=null,ut=Ot}while(ut!==null)}}q=y}}if(y.subtreeFlags&2064&&T!==null)T.return=y,q=T;else e:for(;q!==null;){if(y=q,y.flags&2048)switch(y.tag){case 0:case 11:case 15:$n(9,y,y.return)}var O=y.sibling;if(O!==null){O.return=y.return,q=O;break e}q=y.return}}var k=e.current;for(q=k;q!==null;){T=q;var U=T.child;if(T.subtreeFlags&2064&&U!==null)U.return=T,q=U;else e:for(T=k;q!==null;){if(C=q,C.flags&2048)try{switch(C.tag){case 0:case 11:case 15:bi(9,C)}}catch(ie){xt(C,C.return,ie)}if(C===T){q=null;break e}var X=C.sibling;if(X!==null){X.return=C.return,q=X;break e}q=C.return}}if(ye=h,tn(),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot($i,e)}catch{}c=!0}return c}finally{_e=a,Ge.transition=t}}return!1}function Sc(e,t,a){t=is(a,t),t=Nu(e,t,1),Rn(e,t),t=ht(),e=Ba(e,1),e!==null&&(oi(e,1,t),bt(e,t))}function xt(e,t,a){if(e.tag===3)Sc(e,e,a);else for(;t!==null;){if(t.tag===3){Sc(t,e,a);break}else if(t.tag===1){var c=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Cn===null||!Cn.has(c))){e=is(a,e),e=ju(t,e,1),Rn(t,e),e=ht(),t=Ba(t,1),t!==null&&(oi(t,1,e),bt(t,e));break}}t=t.return}}function Tp(e,t,a){var c=e.pingCache;c!==null&&c.delete(t),t=ht(),e.pingedLanes|=e.suspendedLanes&a,Ke===e&&(tt&a)===a&&(qe===4||qe===3&&(tt&130023424)===tt&&500>Xe()-xs?Jn(e,0):bs|=a),bt(e,t)}function _c(e,t){t===0&&(e.mode&1?(t=Xi,Xi<<=1,!(Xi&130023424)&&(Xi=4194304)):t=1);var a=ht();e=Ba(e,t),e!==null&&(oi(e,t,a),bt(e,a))}function Pp(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),_c(e,a)}function Mp(e,t){var a=0;switch(e.tag){case 13:var c=e.stateNode,h=e.memoizedState;h!==null&&(a=h.retryLane);break;case 19:c=e.stateNode;break;default:throw Error(s(314))}c!==null&&c.delete(t),_c(e,a)}var Ec;Ec=function(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps||gt.current)Tt=!0;else{if(!(e.lanes&a)&&!(t.flags&128))return Tt=!1,mp(e,t,a);Tt=!!(e.flags&131072)}else Tt=!1,ze&&t.flags&1048576&&uu(t,sa,t.index);switch(t.lanes=0,t.tag){case 2:var c=t.type;e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var h=hr(t,at.current);gr(t,a),h=Jo(null,t,c,e,h,a);var y=es();return t.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,vt(c)?(y=!0,Qi(t)):y=!1,t.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,Uo(t),h.updater=aa,t.stateNode=h,h._reactInternals=t,Ho(t,c,e,a),t=ss(null,t,c,!0,y,a)):(t.tag=0,ze&&y&&Go(t),pt(null,t,h,a),t=t.child),t;case 16:c=t.elementType;e:{switch(e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,h=c._init,c=h(c._payload),t.type=c,h=t.tag=Rp(c),e=Qt(c,e),h){case 0:t=os(null,t,c,e,a);break e;case 1:t=Wu(null,t,c,e,a);break e;case 11:t=Hu(null,t,c,e,a);break e;case 14:t=Gu(null,t,c,Qt(c.type,e),a);break e}throw Error(s(306,c,""))}return t;case 0:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),os(e,t,c,h,a);case 1:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),Wu(e,t,c,h,a);case 3:e:{if(Qu(t),e===null)throw Error(s(387));c=t.pendingProps,y=t.memoizedState,h=y.element,nu(e,t),ia(t,c,null,a);var T=t.memoizedState;if(c=T.element,te&&y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:T.cache,transitions:T.transitions},t.updateQueue.baseState=y,t.memoizedState=y,t.flags&256){h=Error(s(423)),t=qu(e,t,c,a,h);break e}else if(c!==h){h=Error(s(424)),t=qu(e,t,c,a,h);break e}else for(te&&(At=Cf(t.stateNode.containerInfo),Et=t,ze=!0,qt=null,si=!1),a=mu(t,null,c,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(br(),c===h){t=yn(e,t,a);break e}pt(e,t,c,a)}t=t.child}return t;case 5:return gu(t),e===null&&Yo(t),c=t.type,h=t.pendingProps,y=e!==null?e.memoizedProps:null,T=h.children,ke(c,h)?T=null:y!==null&&ke(c,y)&&(t.flags|=32),Yu(e,t),pt(e,t,T,a),t.child;case 6:return e===null&&Yo(t),null;case 13:return Xu(e,t,a);case 4:return Qo(t,t.stateNode.containerInfo),c=t.pendingProps,e===null?t.child=xr(t,null,c,a):pt(e,t,c,a),t.child;case 11:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),Hu(e,t,c,h,a);case 7:return pt(e,t,t.pendingProps,a),t.child;case 8:return pt(e,t,t.pendingProps.children,a),t.child;case 12:return pt(e,t,t.pendingProps.children,a),t.child;case 10:e:{if(c=t.type._context,h=t.pendingProps,y=t.memoizedProps,T=h.value,tu(t,c,T),y!==null)if(en(y.value,T)){if(y.children===h.children&&!gt.current){t=yn(e,t,a);break e}}else for(y=t.child,y!==null&&(y.return=t);y!==null;){var C=y.dependencies;if(C!==null){T=y.child;for(var H=C.firstContext;H!==null;){if(H.context===c){if(y.tag===1){H=hn(-1,a&-a),H.tag=2;var W=y.updateQueue;if(W!==null){W=W.shared;var J=W.pending;J===null?H.next=H:(H.next=J.next,J.next=H),W.pending=H}}y.lanes|=a,H=y.alternate,H!==null&&(H.lanes|=a),Do(y.return,a,t),C.lanes|=a;break}H=H.next}}else if(y.tag===10)T=y.type===t.type?null:y.child;else if(y.tag===18){if(T=y.return,T===null)throw Error(s(341));T.lanes|=a,C=T.alternate,C!==null&&(C.lanes|=a),Do(T,a,t),T=y.sibling}else T=y.child;if(T!==null)T.return=y;else for(T=y;T!==null;){if(T===t){T=null;break}if(y=T.sibling,y!==null){y.return=T.return,T=y;break}T=T.return}y=T}pt(e,t,h.children,a),t=t.child}return t;case 9:return h=t.type,c=t.pendingProps.children,gr(t,a),h=Ct(h),c=c(h),t.flags|=1,pt(e,t,c,a),t.child;case 14:return c=t.type,h=Qt(c,t.pendingProps),h=Qt(c.type,h),Gu(e,t,c,h,a);case 15:return Vu(e,t,t.type,t.pendingProps,a);case 17:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,vt(c)?(e=!0,Qi(t)):e=!1,gr(t,a),su(t,c,h),Ho(t,c,h,a),ss(null,t,c,!0,e,a);case 19:return ec(e,t,a);case 22:return Ku(e,t,a)}throw Error(s(156,t.tag))};function Ac(e,t){return Io(e,t)}function Lp(e,t,a,c){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bt(e,t,a,c){return new Lp(e,t,a,c)}function Ms(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Rp(e){if(typeof e=="function")return Ms(e)?1:0;if(e!=null){if(e=e.$$typeof,e===A)return 11;if(e===x)return 14}return 2}function Nn(e,t){var a=e.alternate;return a===null?(a=Bt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&14680064,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function Da(e,t,a,c,h,y){var T=2;if(c=e,typeof e=="function")Ms(e)&&(T=1);else if(typeof e=="string")T=5;else e:switch(e){case p:return nr(a.children,h,y,t);case m:T=8,h|=8;break;case g:return e=Bt(12,a,t,h|2),e.elementType=g,e.lanes=y,e;case S:return e=Bt(13,a,t,h),e.elementType=S,e.lanes=y,e;case w:return e=Bt(19,a,t,h),e.elementType=w,e.lanes=y,e;case E:return Ua(a,h,y,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case v:T=10;break e;case b:T=9;break e;case A:T=11;break e;case x:T=14;break e;case _:T=16,c=null;break e}throw Error(s(130,e==null?e:typeof e,""))}return t=Bt(T,a,t,h),t.elementType=e,t.type=c,t.lanes=y,t}function nr(e,t,a,c){return e=Bt(7,e,c,t),e.lanes=a,e}function Ua(e,t,a,c){return e=Bt(22,e,c,t),e.elementType=E,e.lanes=a,e.stateNode={},e}function Ls(e,t,a){return e=Bt(6,e,null,t),e.lanes=a,e}function Rs(e,t,a){return t=Bt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Cp(e,t,a,c,h){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=_n,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ro(0),this.expirationTimes=Ro(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ro(0),this.identifierPrefix=c,this.onRecoverableError=h,te&&(this.mutableSourceEagerHydrationData=null)}function Tc(e,t,a,c,h,y,T,C,H){return e=new Cp(e,t,a,C,H),t===1?(t=1,y===!0&&(t|=8)):t=0,y=Bt(3,null,null,t),e.current=y,y.stateNode=e,y.memoizedState={element:c,isDehydrated:a,cache:null,transitions:null},Uo(y),e}function Pc(e){if(!e)return Mn;e=e._reactInternals;e:{if(N(e)!==e||e.tag!==1)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(vt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(s(171))}if(e.tag===1){var a=e.type;if(vt(a))return Xl(e,a,t)}return t}function Mc(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=B(t),e===null?null:e.stateNode}function Lc(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Cs(e,t){Lc(e,t),(e=e.alternate)&&Lc(e,t)}function Ip(e){return e=B(e),e===null?null:e.stateNode}function kp(){return null}return r.attemptContinuousHydration=function(e){if(e.tag===13){var t=ht();jt(e,134217728,t),Cs(e,134217728)}},r.attemptHydrationAtCurrentPriority=function(e){if(e.tag===13){var t=ht(),a=kn(e);jt(e,a,t),Cs(e,a)}},r.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var a=ai(t.pendingLanes);a!==0&&(Co(t,a|1),bt(t,Xe()),!(ye&6)&&(Tr(),tn()))}break;case 13:var c=ht();vc(function(){return jt(e,1,c)}),Cs(e,1)}},r.batchedUpdates=function(e,t){var a=ye;ye|=1;try{return e(t)}finally{ye=a,ye===0&&(Tr(),Ji&&tn())}},r.createComponentSelector=function(e){return{$$typeof:Aa,value:e}},r.createContainer=function(e,t,a,c,h,y,T){return Tc(e,t,!1,null,a,c,h,y,T)},r.createHasPseudoClassSelector=function(e){return{$$typeof:Ta,value:e}},r.createHydrationContainer=function(e,t,a,c,h,y,T,C,H){return e=Tc(a,c,!0,e,h,y,T,C,H),e.context=Pc(null),a=e.current,c=ht(),h=kn(a),y=hn(c,h),y.callback=t??null,Rn(a,y),e.current.lanes=h,oi(e,h,c),bt(e,c),e},r.createPortal=function(e,t,a){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:c==null?null:""+c,children:e,containerInfo:t,implementation:a}},r.createRoleSelector=function(e){return{$$typeof:Pa,value:e}},r.createTestNameSelector=function(e){return{$$typeof:Ma,value:e}},r.createTextSelector=function(e){return{$$typeof:La,value:e}},r.deferredUpdates=function(e){var t=_e,a=Ge.transition;try{return Ge.transition=null,_e=16,e()}finally{_e=t,Ge.transition=a}},r.discreteUpdates=function(e,t,a,c,h){var y=_e,T=Ge.transition;try{return Ge.transition=null,_e=1,e(t,a,c,h)}finally{_e=y,Ge.transition=T,ye===0&&Tr()}},r.findAllNodes=vs,r.findBoundingRects=function(e,t){if(!et)throw Error(s(363));t=vs(e,t),e=[];for(var a=0;a<t.length;a++)e.push(Jr(t[a]));for(t=e.length-1;0<t;t--){a=e[t];for(var c=a.x,h=c+a.width,y=a.y,T=y+a.height,C=t-1;0<=C;C--)if(t!==C){var H=e[C],W=H.x,J=W+H.width,ce=H.y,oe=ce+H.height;if(c>=W&&y>=ce&&h<=J&&T<=oe){e.splice(t,1);break}else if(c!==W||a.width!==H.width||oe<y||ce>T){if(!(y!==ce||a.height!==H.height||J<c||W>h)){W>c&&(H.width+=W-c,H.x=c),J<h&&(H.width=h-W),e.splice(t,1);break}}else{ce>y&&(H.height+=ce-y,H.y=y),oe<T&&(H.height=T-ce),e.splice(t,1);break}}}return e},r.findHostInstance=Mc,r.findHostInstanceWithNoPortals=function(e){return e=D(e),e=e!==null?Y(e):null,e===null?null:e.stateNode},r.findHostInstanceWithWarning=function(e){return Mc(e)},r.flushControlled=function(e){var t=ye;ye|=1;var a=Ge.transition,c=_e;try{Ge.transition=null,_e=1,e()}finally{_e=c,Ge.transition=a,ye=t,ye===0&&(Tr(),tn())}},r.flushPassiveEffects=tr,r.flushSync=vc,r.focusWithin=function(e,t){if(!et)throw Error(s(363));for(e=hs(e),t=hc(e,t),t=Array.from(t),e=0;e<t.length;){var a=t[e++];if(!En(a)){if(a.tag===5&&xo(a.stateNode))return!0;for(a=a.child;a!==null;)t.push(a),a=a.sibling}}return!1},r.getCurrentUpdatePriority=function(){return _e},r.getFindAllNodesFailureDescription=function(e,t){if(!et)throw Error(s(363));var a=0,c=[];e=[hs(e),0];for(var h=0;h<e.length;){var y=e[h++],T=e[h++],C=t[T];if((y.tag!==5||!En(y))&&(ms(y,C)&&(c.push(gs(C)),T++,T>a&&(a=T)),T<t.length))for(y=y.child;y!==null;)e.push(y,T),y=y.sibling}if(a<t.length){for(e=[];a<t.length;a++)e.push(gs(t[a]));return`findAllNodes was able to match part of the selector:
  `+(c.join(" > ")+`

No matching component was found for:
  `)+e.join(" > ")}return null},r.getPublicRootInstance=function(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return le(e.child.stateNode);default:return e.child.stateNode}},r.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:u.ReactCurrentDispatcher,findHostInstanceByFiber:Ip,findFiberByHostInstance:e.findFiberByHostInstance||kp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{$i=t.inject(e),Jt=t}catch{}e=!!t.checkDCE}}return e},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(e,t,a,c){if(!et)throw Error(s(363));e=vs(e,t);var h=Hi(e,a,c).disconnect;return{disconnect:function(){h()}}},r.registerMutableSourceForHydration=function(e,t){var a=t._getVersion;a=a(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,a]:e.mutableSourceEagerHydrationData.push(t,a)},r.runWithPriority=function(e,t){var a=_e;try{return _e=e,t()}finally{_e=a}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(e,t,a,c){var h=t.current,y=ht(),T=kn(h);return a=Pc(a),t.context===null?t.context=a:t.pendingContext=a,t=hn(y,T),t.payload={element:e},c=c===void 0?null:c,c!==null&&(t.callback=c),Rn(h,t),e=jt(h,T,y),e!==null&&ra(e,h,T),T},r};Gd.exports=zh;var Nh=Gd.exports;const jh=kd(Nh),Bh=i=>typeof i=="object"&&typeof i.then=="function",Fa=[];function Oh(i,r,n=(l,o)=>l===o){if(i===r)return!0;if(!i||!r)return!1;const l=i.length;if(r.length!==l)return!1;for(let o=0;o<l;o++)if(!n(i[o],r[o]))return!1;return!0}function Dh(i,r=null,n=!1,l={}){r===null&&(r=[i]);for(const s of Fa)if(Oh(r,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return l.lifespan&&l.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,l.lifespan)),s.response;if(!n)throw s.promise}const o={keys:r,equal:l.equal,remove:()=>{const s=Fa.indexOf(o);s!==-1&&Fa.splice(s,1)},promise:(Bh(i)?i:i(...r)).then(s=>{o.response=s,l.lifespan&&l.lifespan>0&&(o.timeout=setTimeout(o.remove,l.lifespan))}).catch(s=>o.error=s)};if(Fa.push(o),!n)throw o.promise}const zc=(i,r,n)=>Dh(i,r,!1,n),jl={},Bl=i=>void Object.assign(jl,i);function Uh(i,r){function n(p,{args:m=[],attach:g,...v},b){let A=`${p[0].toUpperCase()}${p.slice(1)}`,S;if(p==="primitive"){if(v.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const w=v.object;S=Hr(w,{type:p,root:b,attach:g,primitive:!0})}else{const w=jl[A];if(!w)throw new Error(`R3F: ${A} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(m))throw new Error("R3F: The args prop must be an array!");S=Hr(new w(...m),{type:p,root:b,attach:g,memoizedProps:{args:m}})}return S.__r3f.attach===void 0&&(S instanceof kl?S.__r3f.attach="geometry":S instanceof uo&&(S.__r3f.attach="material")),A!=="inject"&&js(S,v),S}function l(p,m){let g=!1;if(m){var v,b;(v=m.__r3f)!=null&&v.attach?Ns(p,m,m.__r3f.attach):m.isObject3D&&p.isObject3D&&(p.add(m),g=!0),g||(b=p.__r3f)==null||b.objects.push(m),m.__r3f||Hr(m,{}),m.__r3f.parent=p,gl(m),Gr(m)}}function o(p,m,g){let v=!1;if(m){var b,A;if((b=m.__r3f)!=null&&b.attach)Ns(p,m,m.__r3f.attach);else if(m.isObject3D&&p.isObject3D){m.parent=p,m.dispatchEvent({type:"added"});const S=p.children.filter(x=>x!==m),w=S.indexOf(g);p.children=[...S.slice(0,w),m,...S.slice(w)],v=!0}v||(A=p.__r3f)==null||A.objects.push(m),m.__r3f||Hr(m,{}),m.__r3f.parent=p,gl(m),Gr(m)}}function s(p,m,g=!1){p&&[...p].forEach(v=>u(m,v,g))}function u(p,m,g){if(m){var v,b,A;if(m.__r3f&&(m.__r3f.parent=null),(v=p.__r3f)!=null&&v.objects&&(p.__r3f.objects=p.__r3f.objects.filter(E=>E!==m)),(b=m.__r3f)!=null&&b.attach)Dc(p,m,m.__r3f.attach);else if(m.isObject3D&&p.isObject3D){var S;p.remove(m),(S=m.__r3f)!=null&&S.root&&Wh(co(m),m)}const x=(A=m.__r3f)==null?void 0:A.primitive,_=!x&&(g===void 0?m.dispose!==null:g);if(!x){var w;s((w=m.__r3f)==null?void 0:w.objects,m,_),s(m.children,m,_)}if(delete m.__r3f,_&&m.dispose&&m.type!=="Scene"){const E=()=>{try{m.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?hl.unstable_scheduleCallback(hl.unstable_IdlePriority,E):E()}Gr(p)}}function d(p,m,g,v){var b;const A=(b=p.__r3f)==null?void 0:b.parent;if(!A)return;const S=n(m,g,p.__r3f.root);if(p.children){for(const w of p.children)w.__r3f&&l(S,w);p.children=p.children.filter(w=>!w.__r3f)}p.__r3f.objects.forEach(w=>l(S,w)),p.__r3f.objects=[],p.__r3f.autoRemovedBeforeAppend||u(A,p),S.parent&&(S.__r3f.autoRemovedBeforeAppend=!0),l(A,S),S.raycast&&S.__r3f.eventCount&&co(S).getState().internal.interaction.push(S),[v,v.alternate].forEach(w=>{w!==null&&(w.stateNode=S,w.ref&&(typeof w.ref=="function"?w.ref(S):w.ref.current=S))})}const f=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:jh({createInstance:n,removeChild:u,appendChild:l,appendInitialChild:l,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(p,m)=>{if(!m)return;const g=p.getState().scene;g.__r3f&&(g.__r3f.root=p,l(g,m))},removeChildFromContainer:(p,m)=>{m&&u(p.getState().scene,m)},insertInContainerBefore:(p,m,g)=>{if(!m||!g)return;const v=p.getState().scene;v.__r3f&&o(v,m,g)},getRootHostContext:()=>null,getChildHostContext:p=>p,finalizeInitialChildren(p){var m;return!!((m=p==null?void 0:p.__r3f)!=null?m:{}).handlers},prepareUpdate(p,m,g,v){var b;if(((b=p==null?void 0:p.__r3f)!=null?b:{}).primitive&&v.object&&v.object!==p)return[!0];{const{args:A=[],children:S,...w}=v,{args:x=[],children:_,...E}=g;if(!Array.isArray(A))throw new Error("R3F: the args prop must be an array!");if(A.some((M,L)=>M!==x[L]))return[!0];const P=$d(p,w,E,!0);return P.changes.length?[!1,P]:null}},commitUpdate(p,[m,g],v,b,A,S){m?d(p,v,A,S):js(p,g)},commitMount(p,m,g,v){var b;const A=(b=p.__r3f)!=null?b:{};p.raycast&&A.handlers&&A.eventCount&&co(p).getState().internal.interaction.push(p)},getPublicInstance:p=>p,prepareForCommit:()=>null,preparePortalMount:p=>Hr(p.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(p){var m;const{attach:g,parent:v}=(m=p.__r3f)!=null?m:{};g&&v&&Dc(v,p,g),p.isObject3D&&(p.visible=!1),Gr(p)},unhideInstance(p,m){var g;const{attach:v,parent:b}=(g=p.__r3f)!=null?g:{};v&&b&&Ns(b,p,v),(p.isObject3D&&m.visible==null||m.visible)&&(p.visible=!0),Gr(p)},createTextInstance:f,hideTextInstance:f,unhideTextInstance:f,getCurrentEventPriority:()=>r?r():Yr.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Ne.fun(performance.now)?performance.now:Ne.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ne.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ne.fun(clearTimeout)?clearTimeout:void 0}),applyProps:js}}var Nc,jc;const zs=i=>"colorSpace"in i||"outputColorSpace"in i,Yd=()=>{var i;return(i=jl.ColorManagement)!=null?i:null},Wd=i=>i&&i.isOrthographicCamera,Fh=i=>i&&i.hasOwnProperty("current"),Ui=typeof window<"u"&&((Nc=window.document)!=null&&Nc.createElement||((jc=window.navigator)==null?void 0:jc.product)==="ReactNative")?I.useLayoutEffect:I.useEffect;function Qd(i){const r=I.useRef(i);return Ui(()=>void(r.current=i),[i]),r}function Hh({set:i}){return Ui(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}class qd extends I.Component{constructor(...r){super(...r),this.state={error:!1}}componentDidCatch(r){this.props.set(r)}render(){return this.state.error?null:this.props.children}}qd.getDerivedStateFromError=()=>({error:!0});const Xd="__default",Bc=new Map,Gh=i=>i&&!!i.memoized&&!!i.changes;function Zd(i){var r;const n=typeof window<"u"?(r=window.devicePixelRatio)!=null?r:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],n),i[1]):i}const Ei=i=>{var r;return(r=i.__r3f)==null?void 0:r.root.getState()};function co(i){let r=i.__r3f.root;for(;r.getState().previousRoot;)r=r.getState().previousRoot;return r}const Ne={obj:i=>i===Object(i)&&!Ne.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,r,{arrays:n="shallow",objects:l="reference",strict:o=!0}={}){if(typeof i!=typeof r||!!i!=!!r)return!1;if(Ne.str(i)||Ne.num(i))return i===r;const s=Ne.obj(i);if(s&&l==="reference")return i===r;const u=Ne.arr(i);if(u&&n==="reference")return i===r;if((u||s)&&i===r)return!0;let d;for(d in i)if(!(d in r))return!1;if(s&&n==="shallow"&&l==="shallow"){for(d in o?r:i)if(!Ne.equ(i[d],r[d],{strict:o,objects:"reference"}))return!1}else for(d in o?r:i)if(i[d]!==r[d])return!1;if(Ne.und(d)){if(u&&i.length===0&&r.length===0||s&&Object.keys(i).length===0&&Object.keys(r).length===0)return!0;if(i!==r)return!1}return!0}};function Vh(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const r in i)r.dispose==null||r.dispose(),delete i[r]}function Hr(i,r){const n=i;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...r},i}function ml(i,r){let n=i;if(r.includes("-")){const l=r.split("-"),o=l.pop();return n=l.reduce((s,u)=>s[u],i),{target:n,key:o}}else return{target:n,key:r}}const Oc=/-\d+$/;function Ns(i,r,n){if(Ne.str(n)){if(Oc.test(n)){const s=n.replace(Oc,""),{target:u,key:d}=ml(i,s);Array.isArray(u[d])||(u[d]=[])}const{target:l,key:o}=ml(i,n);r.__r3f.previousAttach=l[o],l[o]=r}else r.__r3f.previousAttach=n(i,r)}function Dc(i,r,n){var l,o;if(Ne.str(n)){const{target:s,key:u}=ml(i,n),d=r.__r3f.previousAttach;d===void 0?delete s[u]:s[u]=d}else(l=r.__r3f)==null||l.previousAttach==null||l.previousAttach(i,r);(o=r.__r3f)==null||delete o.previousAttach}function $d(i,{children:r,key:n,ref:l,...o},{children:s,key:u,ref:d,...f}={},p=!1){var m;const g=(m=i==null?void 0:i.__r3f)!=null?m:{},v=Object.entries(o),b=[];if(p){const S=Object.keys(f);for(let w=0;w<S.length;w++)o.hasOwnProperty(S[w])||v.unshift([S[w],Xd+"remove"])}v.forEach(([S,w])=>{var x;if((x=i.__r3f)!=null&&x.primitive&&S==="object"||Ne.equ(w,f[S]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(S))return b.push([S,w,!0,[]]);let _=[];S.includes("-")&&(_=S.split("-")),b.push([S,w,!1,_]);for(const E in o){const P=o[E];E.startsWith(`${S}-`)&&b.push([E,P,!1,E.split("-")])}});const A={...o};return g.memoizedProps&&g.memoizedProps.args&&(A.args=g.memoizedProps.args),g.memoizedProps&&g.memoizedProps.attach&&(A.attach=g.memoizedProps.attach),{memoized:A,changes:b}}const Kh=typeof process<"u"&&!1;function js(i,r){var n,l,o;const s=(n=i.__r3f)!=null?n:{},u=s.root,d=(l=u==null||u.getState==null?void 0:u.getState())!=null?l:{},{memoized:f,changes:p}=Gh(r)?r:$d(i,r),m=s.eventCount;i.__r3f&&(i.__r3f.memoizedProps=f);for(let g=0;g<p.length;g++){let[v,b,A,S]=p[g];if(zs(i)){const _="srgb",E="srgb-linear";v==="encoding"?(v="colorSpace",b=b===3001?_:E):v==="outputEncoding"&&(v="outputColorSpace",b=b===3001?_:E)}let w=i,x=w[v];if(S.length&&(x=S.reduce((_,E)=>_[E],i),!(x&&x.set))){const[_,...E]=S.reverse();w=E.reverse().reduce((P,M)=>P[M],i),v=_}if(b===Xd+"remove")if(w.constructor){let _=Bc.get(w.constructor);_||(_=new w.constructor,Bc.set(w.constructor,_)),b=_[v]}else b=0;if(A)b?s.handlers[v]=b:delete s.handlers[v],s.eventCount=Object.keys(s.handlers).length;else if(x&&x.set&&(x.copy||x instanceof Is)){if(Array.isArray(b))x.fromArray?x.fromArray(b):x.set(...b);else if(x.copy&&b&&b.constructor&&(Kh?x.constructor.name===b.constructor.name:x.constructor===b.constructor))x.copy(b);else if(b!==void 0){const _=x instanceof xn;!_&&x.setScalar?x.setScalar(b):x instanceof Is&&b instanceof Is?x.mask=b.mask:x.set(b),!Yd()&&!d.linear&&_&&x.convertSRGBToLinear()}}else if(w[v]=b,w[v]instanceof ll&&w[v].format===Np&&w[v].type===jp){const _=w[v];zs(_)&&zs(d.gl)?_.colorSpace=d.gl.outputColorSpace:_.encoding=d.gl.outputEncoding}Gr(i)}if(s.parent&&i.raycast&&m!==s.eventCount){const g=co(i).getState().internal,v=g.interaction.indexOf(i);v>-1&&g.interaction.splice(v,1),s.eventCount&&g.interaction.push(i)}return!(p.length===1&&p[0][0]==="onUpdate")&&p.length&&(o=i.__r3f)!=null&&o.parent&&gl(i),i}function Gr(i){var r,n;const l=(r=i.__r3f)==null||(n=r.root)==null||n.getState==null?void 0:n.getState();l&&l.internal.frames===0&&l.invalidate()}function gl(i){i.onUpdate==null||i.onUpdate(i)}function Jd(i,r){i.manual||(Wd(i)?(i.left=r.width/-2,i.right=r.width/2,i.top=r.height/2,i.bottom=r.height/-2):i.aspect=r.width/r.height,i.updateProjectionMatrix(),i.updateMatrixWorld())}function Ha(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function Yh(){var i;const r=typeof self<"u"&&self||typeof window<"u"&&window;if(!r)return Yr.DefaultEventPriority;switch((i=r.event)==null?void 0:i.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Yr.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Yr.ContinuousEventPriority;default:return Yr.DefaultEventPriority}}function ef(i,r,n,l){const o=n.get(r);o&&(n.delete(r),n.size===0&&(i.delete(l),o.target.releasePointerCapture(l)))}function Wh(i,r){const{internal:n}=i.getState();n.interaction=n.interaction.filter(l=>l!==r),n.initialHits=n.initialHits.filter(l=>l!==r),n.hovered.forEach((l,o)=>{(l.eventObject===r||l.object===r)&&n.hovered.delete(o)}),n.capturedMap.forEach((l,o)=>{ef(n.capturedMap,r,l,o)})}function Qh(i){function r(f){const{internal:p}=i.getState(),m=f.offsetX-p.initialClick[0],g=f.offsetY-p.initialClick[1];return Math.round(Math.sqrt(m*m+g*g))}function n(f){return f.filter(p=>["Move","Over","Enter","Out","Leave"].some(m=>{var g;return(g=p.__r3f)==null?void 0:g.handlers["onPointer"+m]}))}function l(f,p){const m=i.getState(),g=new Set,v=[],b=p?p(m.internal.interaction):m.internal.interaction;for(let x=0;x<b.length;x++){const _=Ei(b[x]);_&&(_.raycaster.camera=void 0)}m.previousRoot||m.events.compute==null||m.events.compute(f,m);function A(x){const _=Ei(x);if(!_||!_.events.enabled||_.raycaster.camera===null)return[];if(_.raycaster.camera===void 0){var E;_.events.compute==null||_.events.compute(f,_,(E=_.previousRoot)==null?void 0:E.getState()),_.raycaster.camera===void 0&&(_.raycaster.camera=null)}return _.raycaster.camera?_.raycaster.intersectObject(x,!0):[]}let S=b.flatMap(A).sort((x,_)=>{const E=Ei(x.object),P=Ei(_.object);return!E||!P?x.distance-_.distance:P.events.priority-E.events.priority||x.distance-_.distance}).filter(x=>{const _=Ha(x);return g.has(_)?!1:(g.add(_),!0)});m.events.filter&&(S=m.events.filter(S,m));for(const x of S){let _=x.object;for(;_;){var w;(w=_.__r3f)!=null&&w.eventCount&&v.push({...x,eventObject:_}),_=_.parent}}if("pointerId"in f&&m.internal.capturedMap.has(f.pointerId))for(let x of m.internal.capturedMap.get(f.pointerId).values())g.has(Ha(x.intersection))||v.push(x.intersection);return v}function o(f,p,m,g){const v=i.getState();if(f.length){const b={stopped:!1};for(const A of f){const S=Ei(A.object)||v,{raycaster:w,pointer:x,camera:_,internal:E}=S,P=new G(x.x,x.y,0).unproject(_),M=D=>{var B,F;return(B=(F=E.capturedMap.get(D))==null?void 0:F.has(A.eventObject))!=null?B:!1},L=D=>{const B={intersection:A,target:p.target};E.capturedMap.has(D)?E.capturedMap.get(D).set(A.eventObject,B):E.capturedMap.set(D,new Map([[A.eventObject,B]])),p.target.setPointerCapture(D)},R=D=>{const B=E.capturedMap.get(D);B&&ef(E.capturedMap,A.eventObject,B,D)};let N={};for(let D in p){let B=p[D];typeof B!="function"&&(N[D]=B)}let z={...A,...N,pointer:x,intersections:f,stopped:b.stopped,delta:m,unprojectedPoint:P,ray:w.ray,camera:_,stopPropagation(){const D="pointerId"in p&&E.capturedMap.get(p.pointerId);if((!D||D.has(A.eventObject))&&(z.stopped=b.stopped=!0,E.hovered.size&&Array.from(E.hovered.values()).find(B=>B.eventObject===A.eventObject))){const B=f.slice(0,f.indexOf(A));s([...B,A])}},target:{hasPointerCapture:M,setPointerCapture:L,releasePointerCapture:R},currentTarget:{hasPointerCapture:M,setPointerCapture:L,releasePointerCapture:R},nativeEvent:p};if(g(z),b.stopped===!0)break}}return f}function s(f){const{internal:p}=i.getState();for(const m of p.hovered.values())if(!f.length||!f.find(g=>g.object===m.object&&g.index===m.index&&g.instanceId===m.instanceId)){const g=m.eventObject.__r3f,v=g==null?void 0:g.handlers;if(p.hovered.delete(Ha(m)),g!=null&&g.eventCount){const b={...m,intersections:f};v.onPointerOut==null||v.onPointerOut(b),v.onPointerLeave==null||v.onPointerLeave(b)}}}function u(f,p){for(let m=0;m<p.length;m++){const g=p[m].__r3f;g==null||g.handlers.onPointerMissed==null||g.handlers.onPointerMissed(f)}}function d(f){switch(f){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return p=>{const{internal:m}=i.getState();"pointerId"in p&&m.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{m.capturedMap.has(p.pointerId)&&(m.capturedMap.delete(p.pointerId),s([]))})}}return function(p){const{onPointerMissed:m,internal:g}=i.getState();g.lastEvent.current=p;const v=f==="onPointerMove",b=f==="onClick"||f==="onContextMenu"||f==="onDoubleClick",A=l(p,v?n:void 0),S=b?r(p):0;f==="onPointerDown"&&(g.initialClick=[p.offsetX,p.offsetY],g.initialHits=A.map(x=>x.eventObject)),b&&!A.length&&S<=2&&(u(p,g.interaction),m&&m(p)),v&&s(A);function w(x){const _=x.eventObject,E=_.__r3f,P=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(v){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const M=Ha(x),L=g.hovered.get(M);L?L.stopped&&x.stopPropagation():(g.hovered.set(M,x),P.onPointerOver==null||P.onPointerOver(x),P.onPointerEnter==null||P.onPointerEnter(x))}P.onPointerMove==null||P.onPointerMove(x)}else{const M=P[f];M?(!b||g.initialHits.includes(_))&&(u(p,g.interaction.filter(L=>!g.initialHits.includes(L))),M(x)):b&&g.initialHits.includes(_)&&u(p,g.interaction.filter(L=>!g.initialHits.includes(L)))}}o(A,p,S,w)}}return{handlePointer:d}}const qh=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],tf=i=>!!(i!=null&&i.render),Ol=I.createContext(null),Xh=(i,r)=>{const n=go((d,f)=>{const p=new G,m=new G,g=new G;function v(w=f().camera,x=m,_=f().size){const{width:E,height:P,top:M,left:L}=_,R=E/P;x instanceof G?g.copy(x):g.set(...x);const N=w.getWorldPosition(p).distanceTo(g);if(Wd(w))return{width:E/w.zoom,height:P/w.zoom,top:M,left:L,factor:1,distance:N,aspect:R};{const z=w.fov*Math.PI/180,D=2*Math.tan(z/2)*N,B=D*(E/P);return{width:B,height:D,top:M,left:L,factor:E/B,distance:N,aspect:R}}}let b;const A=w=>d(x=>({performance:{...x.performance,current:w}})),S=new be;return{set:d,get:f,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(w=1)=>i(f(),w),advance:(w,x)=>r(w,x,f()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new gh,pointer:S,mouse:S,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const w=f();b&&clearTimeout(b),w.performance.current!==w.performance.min&&A(w.performance.min),b=setTimeout(()=>A(f().performance.max),w.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:w=>d(x=>({...x,events:{...x.events,...w}})),setSize:(w,x,_,E,P)=>{const M=f().camera,L={width:w,height:x,top:E||0,left:P||0,updateStyle:_};d(R=>({size:L,viewport:{...R.viewport,...v(M,m,L)}}))},setDpr:w=>d(x=>{const _=Zd(w);return{viewport:{...x.viewport,dpr:_,initialDpr:x.viewport.initialDpr||_}}}),setFrameloop:(w="always")=>{const x=f().clock;x.stop(),x.elapsedTime=0,w!=="never"&&(x.start(),x.elapsedTime=0),d(()=>({frameloop:w}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:I.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(w,x,_)=>{const E=f().internal;return E.priority=E.priority+(x>0?1:0),E.subscribers.push({ref:w,priority:x,store:_}),E.subscribers=E.subscribers.sort((P,M)=>P.priority-M.priority),()=>{const P=f().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(x>0?1:0),P.subscribers=P.subscribers.filter(M=>M.ref!==w))}}}}}),l=n.getState();let o=l.size,s=l.viewport.dpr,u=l.camera;return n.subscribe(()=>{const{camera:d,size:f,viewport:p,gl:m,set:g}=n.getState();if(f.width!==o.width||f.height!==o.height||p.dpr!==s){var v;o=f,s=p.dpr,Jd(d,f),m.setPixelRatio(p.dpr);const b=(v=f.updateStyle)!=null?v:typeof HTMLCanvasElement<"u"&&m.domElement instanceof HTMLCanvasElement;m.setSize(f.width,f.height,b)}d!==u&&(u=d,g(b=>({viewport:{...b.viewport,...b.viewport.getCurrentViewport(d)}})))}),n.subscribe(d=>i(d)),n};let Ga,Zh=new Set,$h=new Set,Jh=new Set;function Bs(i,r){if(i.size)for(const{callback:n}of i.values())n(r)}function Ai(i,r){switch(i){case"before":return Bs(Zh,r);case"after":return Bs($h,r);case"tail":return Bs(Jh,r)}}let Os,Ds;function Us(i,r,n){let l=r.clock.getDelta();for(r.frameloop==="never"&&typeof i=="number"&&(l=i-r.clock.elapsedTime,r.clock.oldTime=r.clock.elapsedTime,r.clock.elapsedTime=i),Os=r.internal.subscribers,Ga=0;Ga<Os.length;Ga++)Ds=Os[Ga],Ds.ref.current(Ds.store.getState(),l,n);return!r.internal.priority&&r.gl.render&&r.gl.render(r.scene,r.camera),r.internal.frames=Math.max(0,r.internal.frames-1),r.frameloop==="always"?1:r.internal.frames}function em(i){let r=!1,n,l,o;function s(f){l=requestAnimationFrame(s),r=!0,n=0,Ai("before",f);for(const m of i.values()){var p;o=m.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((p=o.gl.xr)!=null&&p.isPresenting)&&(n+=Us(f,o))}if(Ai("after",f),n===0)return Ai("tail",f),r=!1,cancelAnimationFrame(l)}function u(f,p=1){var m;if(!f)return i.forEach(g=>u(g.store.getState(),p));(m=f.gl.xr)!=null&&m.isPresenting||!f.internal.active||f.frameloop==="never"||(f.internal.frames=Math.min(60,f.internal.frames+p),r||(r=!0,requestAnimationFrame(s)))}function d(f,p=!0,m,g){if(p&&Ai("before",f),m)Us(f,m,g);else for(const v of i.values())Us(f,v.store.getState());p&&Ai("after",f)}return{loop:s,invalidate:u,advance:d}}function Dl(){const i=I.useContext(Ol);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function it(i=n=>n,r){return Dl()(i,r)}function dr(i,r=0){const n=Dl(),l=n.getState().internal.subscribe,o=Qd(i);return Ui(()=>l(o,r,n),[r,l,n]),null}const Xr=new Map,{invalidate:Uc,advance:Fc}=em(Xr),{reconciler:Oi,applyProps:Lr}=Uh(Xr,Yh),Rr={objects:"shallow",strict:!1},tm=(i,r)=>{const n=typeof i=="function"?i(r):i;return tf(n)?n:new vh({powerPreference:"high-performance",canvas:r,antialias:!0,alpha:!0,...i})};function nm(i,r){const n=typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement;if(r){const{width:l,height:o,top:s,left:u,updateStyle:d=n}=r;return{width:l,height:o,top:s,left:u,updateStyle:d}}else if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:l,height:o,top:s,left:u}=i.parentElement.getBoundingClientRect();return{width:l,height:o,top:s,left:u,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function rm(i){const r=Xr.get(i),n=r==null?void 0:r.fiber,l=r==null?void 0:r.store;r&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,s=l||Xh(Uc,Fc),u=n||Oi.createContainer(s,Yr.ConcurrentRoot,null,!1,null,"",o,null);r||Xr.set(i,{fiber:u,store:s});let d,f=!1,p;return{configure(m={}){let{gl:g,size:v,scene:b,events:A,onCreated:S,shadows:w=!1,linear:x=!1,flat:_=!1,legacy:E=!1,orthographic:P=!1,frameloop:M="always",dpr:L=[1,2],performance:R,raycaster:N,camera:z,onPointerMissed:D}=m,B=s.getState(),F=B.gl;B.gl||B.set({gl:F=tm(g,i)});let Y=B.raycaster;Y||B.set({raycaster:Y=new Dd});const{params:$,...le}=N||{};if(Ne.equ(le,Y,Rr)||Lr(Y,{...le}),Ne.equ($,Y.params,Rr)||Lr(Y,{params:{...Y.params,...$}}),!B.camera||B.camera===p&&!Ne.equ(p,z,Rr)){p=z;const Z=z instanceof yh,ae=Z?z:P?new Kr(0,0,0,0,.1,1e3):new Vr(75,0,.1,1e3);Z||(ae.position.z=5,z&&Lr(ae,z),!B.camera&&!(z!=null&&z.rotation)&&ae.lookAt(0,0,0)),B.set({camera:ae}),Y.camera=ae}if(!B.scene){let Z;b instanceof ul?Z=b:(Z=new ul,b&&Lr(Z,b)),B.set({scene:Hr(Z)})}if(!B.xr){var fe;const Z=(Te,ke)=>{const St=s.getState();St.frameloop!=="never"&&Fc(Te,!0,St,ke)},ae=()=>{const Te=s.getState();Te.gl.xr.enabled=Te.gl.xr.isPresenting,Te.gl.xr.setAnimationLoop(Te.gl.xr.isPresenting?Z:null),Te.gl.xr.isPresenting||Uc(Te)},pe={connect(){const Te=s.getState().gl;Te.xr.addEventListener("sessionstart",ae),Te.xr.addEventListener("sessionend",ae)},disconnect(){const Te=s.getState().gl;Te.xr.removeEventListener("sessionstart",ae),Te.xr.removeEventListener("sessionend",ae)}};typeof((fe=F.xr)==null?void 0:fe.addEventListener)=="function"&&pe.connect(),B.set({xr:pe})}if(F.shadowMap){const Z=F.shadowMap.enabled,ae=F.shadowMap.type;if(F.shadowMap.enabled=!!w,Ne.boo(w))F.shadowMap.type=ks;else if(Ne.str(w)){var ve;const pe={basic:bh,percentage:xh,soft:ks,variance:wh};F.shadowMap.type=(ve=pe[w])!=null?ve:ks}else Ne.obj(w)&&Object.assign(F.shadowMap,w);(Z!==F.shadowMap.enabled||ae!==F.shadowMap.type)&&(F.shadowMap.needsUpdate=!0)}const V=Yd();V&&("enabled"in V?V.enabled=!E:"legacyMode"in V&&(V.legacyMode=E)),f||Lr(F,{outputEncoding:x?3e3:3001,toneMapping:_?nh:rh}),B.legacy!==E&&B.set(()=>({legacy:E})),B.linear!==x&&B.set(()=>({linear:x})),B.flat!==_&&B.set(()=>({flat:_})),g&&!Ne.fun(g)&&!tf(g)&&!Ne.equ(g,F,Rr)&&Lr(F,g),A&&!B.events.handlers&&B.set({events:A(s)});const ee=nm(i,v);return Ne.equ(ee,B.size,Rr)||B.setSize(ee.width,ee.height,ee.updateStyle,ee.top,ee.left),L&&B.viewport.dpr!==Zd(L)&&B.setDpr(L),B.frameloop!==M&&B.setFrameloop(M),B.onPointerMissed||B.set({onPointerMissed:D}),R&&!Ne.equ(R,B.performance,Rr)&&B.set(Z=>({performance:{...Z.performance,...R}})),d=S,f=!0,this},render(m){return f||this.configure(),Oi.updateContainer(I.createElement(im,{store:s,children:m,onCreated:d,rootElement:i}),u,null,()=>{}),s},unmount(){nf(i)}}}function im({store:i,children:r,onCreated:n,rootElement:l}){return Ui(()=>{const o=i.getState();o.set(s=>({internal:{...s.internal,active:!0}})),n&&n(o),i.getState().events.connected||o.events.connect==null||o.events.connect(l)},[]),I.createElement(Ol.Provider,{value:i},r)}function nf(i,r){const n=Xr.get(i),l=n==null?void 0:n.fiber;if(l){const o=n==null?void 0:n.store.getState();o&&(o.internal.active=!1),Oi.updateContainer(null,l,null,()=>{o&&setTimeout(()=>{try{var s,u,d,f;o.events.disconnect==null||o.events.disconnect(),(s=o.gl)==null||(u=s.renderLists)==null||u.dispose==null||u.dispose(),(d=o.gl)==null||d.forceContextLoss==null||d.forceContextLoss(),(f=o.gl)!=null&&f.xr&&o.xr.disconnect(),Vh(o),Xr.delete(i),r&&r(i)}catch{}},500)})}}function vl(i,r,n){return I.createElement(am,{key:r.uuid,children:i,container:r,state:n})}function am({state:i={},children:r,container:n}){const{events:l,size:o,...s}=i,u=Dl(),[d]=I.useState(()=>new Dd),[f]=I.useState(()=>new be),p=I.useCallback((g,v)=>{const b={...g};Object.keys(g).forEach(S=>{(qh.includes(S)||g[S]!==v[S]&&v[S])&&delete b[S]});let A;if(v&&o){const S=v.camera;A=g.viewport.getCurrentViewport(S,new G,o),S!==g.camera&&Jd(S,o)}return{...b,scene:n,raycaster:d,pointer:f,mouse:f,previousRoot:u,events:{...g.events,...v==null?void 0:v.events,...l},size:{...g.size,...o},viewport:{...g.viewport,...A},...s}},[i]),[m]=I.useState(()=>{const g=u.getState();return go((v,b)=>({...g,scene:n,raycaster:d,pointer:f,mouse:f,previousRoot:u,events:{...g.events,...l},size:{...g.size,...o},...s,set:v,get:b,setEvents:A=>v(S=>({...S,events:{...S.events,...A}}))}))});return I.useEffect(()=>{const g=u.subscribe(v=>m.setState(b=>p(v,b)));return()=>{g(),m.destroy()}},[]),I.useEffect(()=>{m.setState(g=>p(u.getState(),g))},[p]),I.createElement(I.Fragment,null,Oi.createPortal(I.createElement(Ol.Provider,{value:m},r),m,null))}Oi.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:I.version});function yl(i,r,n){var l,o,s,u,d;r==null&&(r=100);function f(){var m=Date.now()-u;m<r&&m>=0?l=setTimeout(f,r-m):(l=null,n||(d=i.apply(s,o),s=o=null))}var p=function(){s=this,o=arguments,u=Date.now();var m=n&&!l;return l||(l=setTimeout(f,r)),m&&(d=i.apply(s,o),s=o=null),d};return p.clear=function(){l&&(clearTimeout(l),l=null)},p.flush=function(){l&&(d=i.apply(s,o),s=o=null,clearTimeout(l),l=null)},p}yl.debounce=yl;var om=yl;const Hc=kd(om);function sm(i){let{debounce:r,scroll:n,polyfill:l,offsetSize:o}=i===void 0?{debounce:0,scroll:!1,offsetSize:!1}:i;const s=l||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[u,d]=I.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),f=I.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:u}),p=r?typeof r=="number"?r:r.scroll:null,m=r?typeof r=="number"?r:r.resize:null,g=I.useRef(!1);I.useEffect(()=>(g.current=!0,()=>void(g.current=!1)));const[v,b,A]=I.useMemo(()=>{const _=()=>{if(!f.current.element)return;const{left:E,top:P,width:M,height:L,bottom:R,right:N,x:z,y:D}=f.current.element.getBoundingClientRect(),B={left:E,top:P,width:M,height:L,bottom:R,right:N,x:z,y:D};f.current.element instanceof HTMLElement&&o&&(B.height=f.current.element.offsetHeight,B.width=f.current.element.offsetWidth),Object.freeze(B),g.current&&!dm(f.current.lastBounds,B)&&d(f.current.lastBounds=B)};return[_,m?Hc(_,m):_,p?Hc(_,p):_]},[d,o,p,m]);function S(){f.current.scrollContainers&&(f.current.scrollContainers.forEach(_=>_.removeEventListener("scroll",A,!0)),f.current.scrollContainers=null),f.current.resizeObserver&&(f.current.resizeObserver.disconnect(),f.current.resizeObserver=null)}function w(){f.current.element&&(f.current.resizeObserver=new s(A),f.current.resizeObserver.observe(f.current.element),n&&f.current.scrollContainers&&f.current.scrollContainers.forEach(_=>_.addEventListener("scroll",A,{capture:!0,passive:!0})))}const x=_=>{!_||_===f.current.element||(S(),f.current.element=_,f.current.scrollContainers=rf(_),w())};return um(A,!!n),lm(b),I.useEffect(()=>{S(),w()},[n,A,b]),I.useEffect(()=>S,[]),[x,u,v]}function lm(i){I.useEffect(()=>{const r=i;return window.addEventListener("resize",r),()=>void window.removeEventListener("resize",r)},[i])}function um(i,r){I.useEffect(()=>{if(r){const n=i;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[i,r])}function rf(i){const r=[];if(!i||i===document.body)return r;const{overflow:n,overflowX:l,overflowY:o}=window.getComputedStyle(i);return[n,l,o].some(s=>s==="auto"||s==="scroll")&&r.push(i),[...r,...rf(i.parentElement)]}const cm=["x","y","top","bottom","left","right","width","height"],dm=(i,r)=>cm.every(n=>i[n]===r[n]);var fm=Object.defineProperty,pm=Object.defineProperties,hm=Object.getOwnPropertyDescriptors,Gc=Object.getOwnPropertySymbols,mm=Object.prototype.hasOwnProperty,gm=Object.prototype.propertyIsEnumerable,Vc=(i,r,n)=>r in i?fm(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n,Kc=(i,r)=>{for(var n in r||(r={}))mm.call(r,n)&&Vc(i,n,r[n]);if(Gc)for(var n of Gc(r))gm.call(r,n)&&Vc(i,n,r[n]);return i},vm=(i,r)=>pm(i,hm(r));function af(i,r,n){if(!i)return;if(n(i)===!0)return i;let l=i.child;for(;l;){const o=af(l,r,n);if(o)return o;l=l.sibling}}function of(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const Ul=of(I.createContext(null));class sf extends I.Component{render(){return I.createElement(Ul.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:Fs,ReactCurrentDispatcher:Hs}=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function ym(){const i=I.useContext(Ul);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const r=I.useId();return I.useMemo(()=>{for(const n of[Fs==null?void 0:Fs.current,i,i==null?void 0:i.alternate]){if(!n)continue;const l=af(n,!1,o=>{let s=o.memoizedState;for(;s;){if(s.memoizedState===r)return!0;s=s.next}});if(l)return l}},[i,r])}function bm(){var i,r;const n=ym(),[l]=I.useState(()=>new Map);l.clear();let o=n;for(;o;){const s=(i=o.type)==null?void 0:i._context;s&&s!==Ul&&!l.has(s)&&l.set(s,(r=Hs==null?void 0:Hs.current)==null?void 0:r.readContext(of(s))),o=o.return}return l}function xm(){const i=bm();return I.useMemo(()=>Array.from(i.keys()).reduce((r,n)=>l=>I.createElement(r,null,I.createElement(n.Provider,vm(Kc({},l),{value:i.get(n)}))),r=>I.createElement(sf,Kc({},r))),[i])}const Gs={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function wm(i){const{handlePointer:r}=Qh(i);return{priority:1,enabled:!0,compute(n,l,o){l.pointer.set(n.offsetX/l.size.width*2-1,-(n.offsetY/l.size.height)*2+1),l.raycaster.setFromCamera(l.pointer,l.camera)},connected:void 0,handlers:Object.keys(Gs).reduce((n,l)=>({...n,[l]:r(l)}),{}),update:()=>{var n;const{events:l,internal:o}=i.getState();(n=o.lastEvent)!=null&&n.current&&l.handlers&&l.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{var l;const{set:o,events:s}=i.getState();s.disconnect==null||s.disconnect(),o(u=>({events:{...u.events,connected:n}})),Object.entries((l=s.handlers)!=null?l:[]).forEach(([u,d])=>{const[f,p]=Gs[u];n.addEventListener(f,d,{passive:p})})},disconnect:()=>{const{set:n,events:l}=i.getState();if(l.connected){var o;Object.entries((o=l.handlers)!=null?o:[]).forEach(([s,u])=>{if(l&&l.connected instanceof HTMLElement){const[d]=Gs[s];l.connected.removeEventListener(d,u)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}const Sm=I.forwardRef(function({children:i,fallback:r,resize:n,style:l,gl:o,events:s=wm,eventSource:u,eventPrefix:d,shadows:f,linear:p,flat:m,legacy:g,orthographic:v,frameloop:b,dpr:A,performance:S,raycaster:w,camera:x,scene:_,onPointerMissed:E,onCreated:P,...M},L){I.useMemo(()=>Bl(ih),[]);const R=xm(),[N,z]=sm({scroll:!0,debounce:{scroll:50,resize:0},...n}),D=I.useRef(null),B=I.useRef(null);I.useImperativeHandle(L,()=>D.current);const F=Qd(E),[Y,$]=I.useState(!1),[le,fe]=I.useState(!1);if(Y)throw Y;if(le)throw le;const ve=I.useRef(null);Ui(()=>{const ee=D.current;z.width>0&&z.height>0&&ee&&(ve.current||(ve.current=rm(ee)),ve.current.configure({gl:o,events:s,shadows:f,linear:p,flat:m,legacy:g,orthographic:v,frameloop:b,dpr:A,performance:S,raycaster:w,camera:x,scene:_,size:z,onPointerMissed:(...Z)=>F.current==null?void 0:F.current(...Z),onCreated:Z=>{Z.events.connect==null||Z.events.connect(u?Fh(u)?u.current:u:B.current),d&&Z.setEvents({compute:(ae,pe)=>{const Te=ae[d+"X"],ke=ae[d+"Y"];pe.pointer.set(Te/pe.size.width*2-1,-(ke/pe.size.height)*2+1),pe.raycaster.setFromCamera(pe.pointer,pe.camera)}}),P==null||P(Z)}}),ve.current.render(I.createElement(R,null,I.createElement(qd,{set:fe},I.createElement(I.Suspense,{fallback:I.createElement(Hh,{set:$})},i)))))}),I.useEffect(()=>{const ee=D.current;if(ee)return()=>nf(ee)},[]);const V=u?"none":"auto";return I.createElement("div",Gn({ref:B,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:V,...l}},M),I.createElement("div",{ref:N,style:{width:"100%",height:"100%"}},I.createElement("canvas",{ref:D,style:{display:"block"}},r)))}),_m=I.forwardRef(function(i,r){return I.createElement(sf,null,I.createElement(Sm,Gn({},i,{ref:r})))});class Em extends or{constructor(r,n){super(),this.inputSource=null,this.xrControllerModel=null,this.index=r,this.controller=n.xr.getController(r),this.grip=n.xr.getControllerGrip(r),this.hand=n.xr.getHand(r),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(r){r.fake||r.data&&(this.visible=!0,this.inputSource=r.data,this.dispatchEvent(r))}_onDisconnected(r){r.fake||(this.visible=!1,this.inputSource=null,this.dispatchEvent(r))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var Yc,Wc;const Am=i=>Array.from(new Set(i)),Ft=typeof window<"u"&&((Yc=window.document)!=null&&Yc.createElement||((Wc=window.navigator)==null?void 0:Wc.product)==="ReactNative")?I.useLayoutEffect:I.useEffect;function cn(i){const r=I.useRef(i);return Ft(()=>void(r.current=i),[i]),r}function Cr(i,r,{handedness:n}={}){const l=cn(r),o=He(s=>s.controllers);Ft(()=>{const s=o.map(u=>{if(n&&u.inputSource&&u.inputSource.handedness!==n)return;const d=f=>l.current({nativeEvent:f,target:u});return u.controller.addEventListener(i,d),()=>u.controller.removeEventListener(i,d)});return()=>s.forEach(u=>u==null?void 0:u())},[o,n,i])}const Qc=new Je;function Tm({children:i}){const r=it(g=>g.events),n=it(g=>g.get),l=it(g=>g.raycaster),o=He(g=>g.controllers),s=He(g=>g.interactions),u=He(g=>g.hoverState),d=He(g=>g.hasInteraction),f=He(g=>g.getInteraction),p=I.useCallback(g=>{const v=Array.from(s.keys());return Qc.identity().extractRotation(g.matrixWorld),l.ray.origin.setFromMatrixPosition(g.matrixWorld),l.ray.direction.set(0,0,-1).applyMatrix4(Qc),l.intersectObjects(v,!0)},[s,l]);dr(()=>{var g;if(s.size!==0)for(const v of o){if(!((g=v.inputSource)!=null&&g.handedness))return;const b=u[v.inputSource.handedness],A=new Set;let S=p(v.controller);if(r.filter)S=r.filter(S,n());else{const w=S.find(x=>x==null?void 0:x.object);w&&(S=[w])}for(const w of S){let x=w.object;for(;x;){if(d(x,"onHover")&&!b.has(x)){const E=f(x,"onHover");for(const P of E)P({target:v,intersection:w,intersections:S})}const _=f(x,"onMove");_==null||_.forEach(E=>E({target:v,intersection:w,intersections:S})),b.set(x,w),A.add(x.id),x=x.parent}}for(const w of b.keys())if(!A.has(w.id)){b.delete(w);const x=f(w,"onBlur");if(!x)continue;for(const _ of x)_({target:v,intersections:S})}}});const m=I.useCallback(g=>v=>{var b;if(!((b=v.target.inputSource)!=null&&b.handedness))return;const A=u[v.target.inputSource.handedness],S=Array.from(new Set(A.values()));s.forEach((w,x)=>{var _,E,P;if(A.has(x)){if(!w[g])return;for(const M of w[g])(_=M.current)==null||_.call(M,{target:v.target,intersection:A.get(x),intersections:S})}else if(g==="onSelect"&&w.onSelectMissed)for(const M of w.onSelectMissed)(E=M.current)==null||E.call(M,{target:v.target,intersections:S});else if(g==="onSqueeze"&&w.onSqueezeMissed)for(const M of w.onSqueezeMissed)(P=M.current)==null||P.call(M,{target:v.target,intersections:S})})},[u,s]);return Cr("select",m("onSelect")),Cr("selectstart",m("onSelectStart")),Cr("selectend",m("onSelectEnd")),Cr("squeeze",m("onSqueeze")),Cr("squeezeend",m("onSqueezeEnd")),Cr("squeezestart",m("onSqueezeStart")),I.createElement(I.Fragment,null,i)}function Xt(i,r,n){const l=He(u=>u.addInteraction),o=He(u=>u.removeInteraction),s=cn(n);Ft(()=>{const u=i.current;if(!(!u||!s.current))return l(u,r,s),()=>o(u,r,s)},[i,r,l,o])}const Pm=I.forwardRef(function({onHover:i,onBlur:r,onSelectStart:n,onSelectEnd:l,onSelectMissed:o,onSelect:s,onSqueezeStart:u,onSqueezeEnd:d,onSqueezeMissed:f,onSqueeze:p,onMove:m,children:g},v){const b=I.useRef(null);return I.useImperativeHandle(v,()=>b.current),Xt(b,"onHover",i),Xt(b,"onBlur",r),Xt(b,"onSelectStart",n),Xt(b,"onSelectEnd",l),Xt(b,"onSelectMissed",o),Xt(b,"onSelect",s),Xt(b,"onSqueezeStart",u),Xt(b,"onSqueezeEnd",d),Xt(b,"onSqueezeMissed",f),Xt(b,"onSqueeze",p),Xt(b,"onMove",m),I.createElement("group",{ref:b},g)}),Mm=I.forwardRef(function({onSelectStart:i,onSelectEnd:r,children:n,...l},o){const s=I.useRef(),u=I.useRef(null),d=I.useMemo(()=>new Je,[]);return I.useImperativeHandle(o,()=>u.current),dr(()=>{const f=s.current,p=u.current;f&&(p.applyMatrix4(d),p.applyMatrix4(f.matrixWorld),p.updateMatrixWorld(),d.copy(f.matrixWorld).invert())}),I.createElement(Pm,{ref:u,onSelectStart:f=>{s.current=f.target.controller,d.copy(f.target.controller.matrixWorld).invert(),i==null||i(f)},onSelectEnd:f=>{f.target.controller===s.current&&(s.current=void 0),r==null||r(f)},...l},n)}),lf=I.createContext(null),lr=go((i,r)=>({set:i,get:r,session:null,referenceSpaceType:null}));function Lm({foveation:i=0,frameRate:r=void 0,referenceSpace:n="local-floor",onSessionStart:l,onSessionEnd:o,onVisibilityChange:s,onInputSourcesChange:u,children:d}){const f=it(E=>E.gl),p=it(E=>E.camera),m=He(E=>E.player),g=He(E=>E.get),v=He(E=>E.set),b=He(E=>E.session),A=He(E=>E.controllers),S=cn(l),w=cn(o),x=cn(s),_=cn(u);return Ft(()=>{const E=[0,1].map(P=>{const M=new Em(P,f),L=()=>v(N=>({controllers:[...N.controllers,M]})),R=()=>v(N=>({controllers:N.controllers.filter(z=>z!==M)}));return M.addEventListener("connected",L),M.addEventListener("disconnected",R),()=>{M.removeEventListener("connected",L),M.removeEventListener("disconnected",R)}});return()=>E.forEach(P=>P())},[f,v]),Ft(()=>lr.subscribe(({session:E})=>v(()=>({session:E}))),[f.xr,v]),Ft(()=>{f.xr.setFoveation(i),v(()=>({foveation:i}))},[f.xr,i,v]),Ft(()=>{var E;try{r&&((E=b==null?void 0:b.updateTargetFrameRate)==null||E.call(b,r))}catch{}v(()=>({frameRate:r}))},[b,r,v]),Ft(()=>{const E=lr.getState();f.xr.setReferenceSpaceType(n),v(()=>({referenceSpace:n})),E.set({referenceSpaceType:n})},[f.xr,n,v]),Ft(()=>{if(!b)return void f.xr.setSession(null);const E=R=>{var N;v(()=>({isPresenting:!0})),(N=S.current)==null||N.call(S,{nativeEvent:{...R,target:b},target:b})},P=R=>{var N;v(()=>({isPresenting:!1,session:null})),lr.setState(()=>({session:null})),(N=w.current)==null||N.call(w,{nativeEvent:{...R,target:b},target:b})},M=R=>{var N;(N=x.current)==null||N.call(x,{nativeEvent:R,target:b})},L=R=>{var N;const z=Object.values(b.inputSources).some(D=>D.hand);v(()=>({isHandTracking:z})),(N=_.current)==null||N.call(_,{nativeEvent:R,target:b})};return f.xr.addEventListener("sessionstart",E),f.xr.addEventListener("sessionend",P),b.addEventListener("visibilitychange",M),b.addEventListener("inputsourceschange",L),f.xr.setSession(b).then(()=>{f.xr.setFoveation(g().foveation)}),()=>{f.xr.removeEventListener("sessionstart",E),f.xr.removeEventListener("sessionend",P),b.removeEventListener("visibilitychange",M),b.removeEventListener("inputsourceschange",L)}},[b,f.xr,v,g]),I.createElement(Tm,null,I.createElement("primitive",{object:m},I.createElement("primitive",{object:p}),A.map(E=>I.createElement("primitive",{key:E.index,object:E}))),d)}function Rm(i){const r=I.useMemo(()=>go((n,l)=>({set:n,get:l,controllers:[],isPresenting:!1,isHandTracking:!1,player:new or,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(o,s){var u;return!!((u=l().interactions.get(o))!=null&&u[s].some(d=>d.current))},getInteraction(o,s){var u;return(u=l().interactions.get(o))==null?void 0:u[s].reduce((d,f)=>(f.current&&d.push(f.current),d),[])},addInteraction(o,s,u){const d=l().interactions;d.has(o)||d.set(o,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]}),d.get(o)[s].push(u)},removeInteraction(o,s,u){const d=l().interactions.get(o);if(d){const f=d[s].indexOf(u);f!==-1&&d[s].splice(f,1)}}})),[]);return I.createElement(lf.Provider,{value:r},I.createElement(Lm,{...i}))}const Cm=(i,r)=>{var n;if(!(!i&&!r))return i&&!r?{optionalFeatures:[i]}:i&&r?{...r,optionalFeatures:Am([...(n=r.optionalFeatures)!=null?n:[],i])}:r},Im=async(i,r)=>{const n=lr.getState();if(n.session){console.warn("@react-three/xr: session already started, please stop it first");return}const l=Cm(n.referenceSpaceType,r),o=await navigator.xr.requestSession(i,l);return n.set(()=>({session:o})),o},km=async()=>{const i=lr.getState();if(!i.session){console.warn("@react-three/xr: no session to stop, please start it first");return}await i.session.end(),i.set({session:null})},zm=async(i,{sessionInit:r,enterOnly:n,exitOnly:l}={})=>{const o=lr.getState();if(!(o.session&&n)&&!(!o.session&&l))return o.session?await km():await Im(i,r)},Nm=(i,r,n)=>{switch(i){case"entered":return`Exit ${r}`;case"exited":return`Enter ${r}`;case"unsupported":default:switch(n){case"https":return"HTTPS needed";case"security":return`${r} blocked`;case"unknown":default:return`${r} unsupported`}}},Fl=I.forwardRef(function({mode:i,sessionInit:r,enterOnly:n=!1,exitOnly:l=!1,onClick:o,onError:s,children:u,...d},f){var p;const[m,g]=I.useState("exited"),[v,b]=I.useState("unknown"),A=Nm(m,i,v),S=i==="inline"?i:`immersive-${i.toLowerCase()}`,w=cn(s);Ft(()=>{if(!(navigator!=null&&navigator.xr))return void g("unsupported");navigator.xr.isSessionSupported(S).then(_=>{if(_)g("exited");else{const E=location.protocol==="https:";g("unsupported"),b(E?"unknown":"https")}}).catch(_=>{g("unsupported"),"name"in _&&_.name==="SecurityError"?b("security"):b("unknown")})},[S]),Ft(()=>lr.subscribe(_=>{_.session?g("entered"):m!=="unsupported"&&g("exited")}),[m]);const x=I.useCallback(async _=>{o==null||o(_);try{zm(S,{sessionInit:r,enterOnly:n,exitOnly:l})}catch(E){const P=w.current;if(P&&E instanceof Error)P(E);else throw E}},[o,S,r,n,l,w]);return I.createElement("button",{...d,ref:f,onClick:m==="unsupported"?o:x},(p=typeof u=="function"?u(m):u)!=null?p:A)}),uf={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"};I.forwardRef(({style:i=uf,sessionInit:r={domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:n,...l},o)=>I.createElement(Fl,{...l,ref:o,mode:"AR",style:i,sessionInit:r},n));I.forwardRef(({style:i=uf,sessionInit:r={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:n,...l},o)=>I.createElement(Fl,{...l,ref:o,mode:"VR",style:i,sessionInit:r},n));function He(i=n=>n,r){const n=I.useContext(lf);if(!n)throw new Error("useXR must be used within an <XR /> component!");return n(i,r)}function qc(i,r){if(r===ah)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(r===dl||r===Ud){let n=i.getIndex();if(n===null){const u=[],d=i.getAttribute("position");if(d!==void 0){for(let f=0;f<d.count;f++)u.push(f);i.setIndex(u),n=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const l=n.count-2,o=[];if(n)if(r===dl)for(let u=1;u<=l;u++)o.push(n.getX(0)),o.push(n.getX(u)),o.push(n.getX(u+1));else for(let u=0;u<l;u++)u%2===0?(o.push(n.getX(u)),o.push(n.getX(u+1)),o.push(n.getX(u+2))):(o.push(n.getX(u+2)),o.push(n.getX(u+1)),o.push(n.getX(u)));o.length/3!==l&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=i.clone();return s.setIndex(o),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",r),i}const jm=parseInt(Fd.replace(/\D+/g,""));var Bm=Object.defineProperty,Om=(i,r,n)=>r in i?Bm(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n,ue=(i,r,n)=>(Om(i,typeof r!="symbol"?r+"":r,n),n);const Va=new Cd,Xc=new Il,Dm=Math.cos(70*(Math.PI/180)),Zc=(i,r)=>(i%r+r)%r;let Um=class extends oh{constructor(i,r){super(),ue(this,"object"),ue(this,"domElement"),ue(this,"enabled",!0),ue(this,"target",new G),ue(this,"minDistance",0),ue(this,"maxDistance",1/0),ue(this,"minZoom",0),ue(this,"maxZoom",1/0),ue(this,"minPolarAngle",0),ue(this,"maxPolarAngle",Math.PI),ue(this,"minAzimuthAngle",-1/0),ue(this,"maxAzimuthAngle",1/0),ue(this,"enableDamping",!1),ue(this,"dampingFactor",.05),ue(this,"enableZoom",!0),ue(this,"zoomSpeed",1),ue(this,"enableRotate",!0),ue(this,"rotateSpeed",1),ue(this,"enablePan",!0),ue(this,"panSpeed",1),ue(this,"screenSpacePanning",!0),ue(this,"keyPanSpeed",7),ue(this,"zoomToCursor",!1),ue(this,"autoRotate",!1),ue(this,"autoRotateSpeed",2),ue(this,"reverseOrbit",!1),ue(this,"reverseHorizontalOrbit",!1),ue(this,"reverseVerticalOrbit",!1),ue(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),ue(this,"mouseButtons",{LEFT:Pr.ROTATE,MIDDLE:Pr.DOLLY,RIGHT:Pr.PAN}),ue(this,"touches",{ONE:Mr.ROTATE,TWO:Mr.DOLLY_PAN}),ue(this,"target0"),ue(this,"position0"),ue(this,"zoom0"),ue(this,"_domElementKeyEvents",null),ue(this,"getPolarAngle"),ue(this,"getAzimuthalAngle"),ue(this,"setPolarAngle"),ue(this,"setAzimuthalAngle"),ue(this,"getDistance"),ue(this,"listenToKeyEvents"),ue(this,"stopListenToKeyEvents"),ue(this,"saveState"),ue(this,"reset"),ue(this,"update"),ue(this,"connect"),ue(this,"dispose"),this.object=i,this.domElement=r,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>p.phi,this.getAzimuthalAngle=()=>p.theta,this.setPolarAngle=j=>{let Q=Zc(j,2*Math.PI),se=p.phi;se<0&&(se+=2*Math.PI),Q<0&&(Q+=2*Math.PI);let Se=Math.abs(Q-se);2*Math.PI-Se<Se&&(Q<se?Q+=2*Math.PI:se+=2*Math.PI),m.phi=Q-se,n.update()},this.setAzimuthalAngle=j=>{let Q=Zc(j,2*Math.PI),se=p.theta;se<0&&(se+=2*Math.PI),Q<0&&(Q+=2*Math.PI);let Se=Math.abs(Q-se);2*Math.PI-Se<Se&&(Q<se?Q+=2*Math.PI:se+=2*Math.PI),m.theta=Q-se,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=j=>{j.addEventListener("keydown",ti),this._domElementKeyEvents=j},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ti),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(l),n.update(),d=u.NONE},this.update=(()=>{const j=new G,Q=new G(0,1,0),se=new ho().setFromUnitVectors(i.up,Q),Se=se.clone().invert(),ft=new G,_t=new ho,fr=2*Math.PI;return function(){const Yi=n.object.position;se.setFromUnitVectors(i.up,Q),Se.copy(se).invert(),j.copy(Yi).sub(n.target),j.applyQuaternion(se),p.setFromVector3(j),n.autoRotate&&d===u.NONE&&Y(B()),n.enableDamping?(p.theta+=m.theta*n.dampingFactor,p.phi+=m.phi*n.dampingFactor):(p.theta+=m.theta,p.phi+=m.phi);let Lt=n.minAzimuthAngle,Rt=n.maxAzimuthAngle;isFinite(Lt)&&isFinite(Rt)&&(Lt<-Math.PI?Lt+=fr:Lt>Math.PI&&(Lt-=fr),Rt<-Math.PI?Rt+=fr:Rt>Math.PI&&(Rt-=fr),Lt<=Rt?p.theta=Math.max(Lt,Math.min(Rt,p.theta)):p.theta=p.theta>(Lt+Rt)/2?Math.max(Lt,p.theta):Math.min(Rt,p.theta)),p.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,p.phi)),p.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(v,n.dampingFactor):n.target.add(v),n.zoomToCursor&&N||n.object.isOrthographicCamera?p.radius=ae(p.radius):p.radius=ae(p.radius*g),j.setFromSpherical(p),j.applyQuaternion(Se),Yi.copy(n.target).add(j),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(m.theta*=1-n.dampingFactor,m.phi*=1-n.dampingFactor,v.multiplyScalar(1-n.dampingFactor)):(m.set(0,0,0),v.set(0,0,0));let Kn=!1;if(n.zoomToCursor&&N){let An=null;if(n.object instanceof Vr&&n.object.isPerspectiveCamera){const Tn=j.length();An=ae(Tn*g);const Yn=Tn-An;n.object.position.addScaledVector(L,Yn),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Tn=new G(R.x,R.y,0);Tn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/g)),n.object.updateProjectionMatrix(),Kn=!0;const Yn=new G(R.x,R.y,0);Yn.unproject(n.object),n.object.position.sub(Yn).add(Tn),n.object.updateMatrixWorld(),An=j.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;An!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(An).add(n.object.position):(Va.origin.copy(n.object.position),Va.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Va.direction))<Dm?i.lookAt(n.target):(Xc.setFromNormalAndCoplanarPoint(n.object.up,n.target),Va.intersectPlane(Xc,n.target))))}else n.object instanceof Kr&&n.object.isOrthographicCamera&&(Kn=g!==1,Kn&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/g)),n.object.updateProjectionMatrix()));return g=1,N=!1,Kn||ft.distanceToSquared(n.object.position)>f||8*(1-_t.dot(n.object.quaternion))>f?(n.dispatchEvent(l),ft.copy(n.object.position),_t.copy(n.object.quaternion),Kn=!1,!0):!1}})(),this.connect=j=>{j===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),n.domElement=j,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Gi),n.domElement.addEventListener("pointerdown",Fi),n.domElement.addEventListener("pointercancel",En),n.domElement.addEventListener("wheel",Hi)},this.dispose=()=>{var j,Q,se,Se,ft,_t;(j=n.domElement)==null||j.removeEventListener("contextmenu",Gi),(Q=n.domElement)==null||Q.removeEventListener("pointerdown",Fi),(se=n.domElement)==null||se.removeEventListener("pointercancel",En),(Se=n.domElement)==null||Se.removeEventListener("wheel",Hi),(ft=n.domElement)==null||ft.ownerDocument.removeEventListener("pointermove",Jr),(_t=n.domElement)==null||_t.ownerDocument.removeEventListener("pointerup",ei),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",ti)};const n=this,l={type:"change"},o={type:"start"},s={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=u.NONE;const f=1e-6,p=new Rc,m=new Rc;let g=1;const v=new G,b=new be,A=new be,S=new be,w=new be,x=new be,_=new be,E=new be,P=new be,M=new be,L=new G,R=new be;let N=!1;const z=[],D={};function B(){return 2*Math.PI/60/60*n.autoRotateSpeed}function F(){return Math.pow(.95,n.zoomSpeed)}function Y(j){n.reverseOrbit||n.reverseHorizontalOrbit?m.theta+=j:m.theta-=j}function $(j){n.reverseOrbit||n.reverseVerticalOrbit?m.phi+=j:m.phi-=j}const le=(()=>{const j=new G;return function(Q,se){j.setFromMatrixColumn(se,0),j.multiplyScalar(-Q),v.add(j)}})(),fe=(()=>{const j=new G;return function(Q,se){n.screenSpacePanning===!0?j.setFromMatrixColumn(se,1):(j.setFromMatrixColumn(se,0),j.crossVectors(n.object.up,j)),j.multiplyScalar(Q),v.add(j)}})(),ve=(()=>{const j=new G;return function(Q,se){const Se=n.domElement;if(Se&&n.object instanceof Vr&&n.object.isPerspectiveCamera){const ft=n.object.position;j.copy(ft).sub(n.target);let _t=j.length();_t*=Math.tan(n.object.fov/2*Math.PI/180),le(2*Q*_t/Se.clientHeight,n.object.matrix),fe(2*se*_t/Se.clientHeight,n.object.matrix)}else Se&&n.object instanceof Kr&&n.object.isOrthographicCamera?(le(Q*(n.object.right-n.object.left)/n.object.zoom/Se.clientWidth,n.object.matrix),fe(se*(n.object.top-n.object.bottom)/n.object.zoom/Se.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function V(j){n.object instanceof Vr&&n.object.isPerspectiveCamera||n.object instanceof Kr&&n.object.isOrthographicCamera?g/=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ee(j){n.object instanceof Vr&&n.object.isPerspectiveCamera||n.object instanceof Kr&&n.object.isOrthographicCamera?g*=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Z(j){if(!n.zoomToCursor||!n.domElement)return;N=!0;const Q=n.domElement.getBoundingClientRect(),se=j.clientX-Q.left,Se=j.clientY-Q.top,ft=Q.width,_t=Q.height;R.x=se/ft*2-1,R.y=-(Se/_t)*2+1,L.set(R.x,R.y,1).unproject(n.object).sub(n.object.position).normalize()}function ae(j){return Math.max(n.minDistance,Math.min(n.maxDistance,j))}function pe(j){b.set(j.clientX,j.clientY)}function Te(j){Z(j),E.set(j.clientX,j.clientY)}function ke(j){w.set(j.clientX,j.clientY)}function St(j){A.set(j.clientX,j.clientY),S.subVectors(A,b).multiplyScalar(n.rotateSpeed);const Q=n.domElement;Q&&(Y(2*Math.PI*S.x/Q.clientHeight),$(2*Math.PI*S.y/Q.clientHeight)),b.copy(A),n.update()}function dt(j){P.set(j.clientX,j.clientY),M.subVectors(P,E),M.y>0?V(F()):M.y<0&&ee(F()),E.copy(P),n.update()}function Yt(j){x.set(j.clientX,j.clientY),_.subVectors(x,w).multiplyScalar(n.panSpeed),ve(_.x,_.y),w.copy(x),n.update()}function _n(j){Z(j),j.deltaY<0?ee(F()):j.deltaY>0&&V(F()),n.update()}function fn(j){let Q=!1;switch(j.code){case n.keys.UP:ve(0,n.keyPanSpeed),Q=!0;break;case n.keys.BOTTOM:ve(0,-n.keyPanSpeed),Q=!0;break;case n.keys.LEFT:ve(n.keyPanSpeed,0),Q=!0;break;case n.keys.RIGHT:ve(-n.keyPanSpeed,0),Q=!0;break}Q&&(j.preventDefault(),n.update())}function me(){if(z.length==1)b.set(z[0].pageX,z[0].pageY);else{const j=.5*(z[0].pageX+z[1].pageX),Q=.5*(z[0].pageY+z[1].pageY);b.set(j,Q)}}function K(){if(z.length==1)w.set(z[0].pageX,z[0].pageY);else{const j=.5*(z[0].pageX+z[1].pageX),Q=.5*(z[0].pageY+z[1].pageY);w.set(j,Q)}}function te(){const j=z[0].pageX-z[1].pageX,Q=z[0].pageY-z[1].pageY,se=Math.sqrt(j*j+Q*Q);E.set(0,se)}function Me(){n.enableZoom&&te(),n.enablePan&&K()}function he(){n.enableZoom&&te(),n.enableRotate&&me()}function Ve(j){if(z.length==1)A.set(j.pageX,j.pageY);else{const se=ni(j),Se=.5*(j.pageX+se.x),ft=.5*(j.pageY+se.y);A.set(Se,ft)}S.subVectors(A,b).multiplyScalar(n.rotateSpeed);const Q=n.domElement;Q&&(Y(2*Math.PI*S.x/Q.clientHeight),$(2*Math.PI*S.y/Q.clientHeight)),b.copy(A)}function we(j){if(z.length==1)x.set(j.pageX,j.pageY);else{const Q=ni(j),se=.5*(j.pageX+Q.x),Se=.5*(j.pageY+Q.y);x.set(se,Se)}_.subVectors(x,w).multiplyScalar(n.panSpeed),ve(_.x,_.y),w.copy(x)}function Le(j){const Q=ni(j),se=j.pageX-Q.x,Se=j.pageY-Q.y,ft=Math.sqrt(se*se+Se*Se);P.set(0,ft),M.set(0,Math.pow(P.y/E.y,n.zoomSpeed)),V(M.y),E.copy(P)}function je(j){n.enableZoom&&Le(j),n.enablePan&&we(j)}function et(j){n.enableZoom&&Le(j),n.enableRotate&&Ve(j)}function Fi(j){var Q,se;n.enabled!==!1&&(z.length===0&&((Q=n.domElement)==null||Q.ownerDocument.addEventListener("pointermove",Jr),(se=n.domElement)==null||se.ownerDocument.addEventListener("pointerup",ei)),_o(j),j.pointerType==="touch"?wo(j):bo(j))}function Jr(j){n.enabled!==!1&&(j.pointerType==="touch"?So(j):xo(j))}function ei(j){var Q,se,Se;Vi(j),z.length===0&&((Q=n.domElement)==null||Q.releasePointerCapture(j.pointerId),(se=n.domElement)==null||se.ownerDocument.removeEventListener("pointermove",Jr),(Se=n.domElement)==null||Se.ownerDocument.removeEventListener("pointerup",ei)),n.dispatchEvent(s),d=u.NONE}function En(j){Vi(j)}function bo(j){let Q;switch(j.button){case 0:Q=n.mouseButtons.LEFT;break;case 1:Q=n.mouseButtons.MIDDLE;break;case 2:Q=n.mouseButtons.RIGHT;break;default:Q=-1}switch(Q){case Pr.DOLLY:if(n.enableZoom===!1)return;Te(j),d=u.DOLLY;break;case Pr.ROTATE:if(j.ctrlKey||j.metaKey||j.shiftKey){if(n.enablePan===!1)return;ke(j),d=u.PAN}else{if(n.enableRotate===!1)return;pe(j),d=u.ROTATE}break;case Pr.PAN:if(j.ctrlKey||j.metaKey||j.shiftKey){if(n.enableRotate===!1)return;pe(j),d=u.ROTATE}else{if(n.enablePan===!1)return;ke(j),d=u.PAN}break;default:d=u.NONE}d!==u.NONE&&n.dispatchEvent(o)}function xo(j){if(n.enabled!==!1)switch(d){case u.ROTATE:if(n.enableRotate===!1)return;St(j);break;case u.DOLLY:if(n.enableZoom===!1)return;dt(j);break;case u.PAN:if(n.enablePan===!1)return;Yt(j);break}}function Hi(j){n.enabled===!1||n.enableZoom===!1||d!==u.NONE&&d!==u.ROTATE||(j.preventDefault(),n.dispatchEvent(o),_n(j),n.dispatchEvent(s))}function ti(j){n.enabled===!1||n.enablePan===!1||fn(j)}function wo(j){switch(Ki(j),z.length){case 1:switch(n.touches.ONE){case Mr.ROTATE:if(n.enableRotate===!1)return;me(),d=u.TOUCH_ROTATE;break;case Mr.PAN:if(n.enablePan===!1)return;K(),d=u.TOUCH_PAN;break;default:d=u.NONE}break;case 2:switch(n.touches.TWO){case Mr.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Me(),d=u.TOUCH_DOLLY_PAN;break;case Mr.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;he(),d=u.TOUCH_DOLLY_ROTATE;break;default:d=u.NONE}break;default:d=u.NONE}d!==u.NONE&&n.dispatchEvent(o)}function So(j){switch(Ki(j),d){case u.TOUCH_ROTATE:if(n.enableRotate===!1)return;Ve(j),n.update();break;case u.TOUCH_PAN:if(n.enablePan===!1)return;we(j),n.update();break;case u.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;je(j),n.update();break;case u.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;et(j),n.update();break;default:d=u.NONE}}function Gi(j){n.enabled!==!1&&j.preventDefault()}function _o(j){z.push(j)}function Vi(j){delete D[j.pointerId];for(let Q=0;Q<z.length;Q++)if(z[Q].pointerId==j.pointerId){z.splice(Q,1);return}}function Ki(j){let Q=D[j.pointerId];Q===void 0&&(Q=new be,D[j.pointerId]=Q),Q.set(j.pageX,j.pageY)}function ni(j){const Q=j.pointerId===z[0].pointerId?z[1]:z[0];return D[Q.pointerId]}r!==void 0&&this.connect(r),this.update()}};class cf extends Bp{constructor(r){super(r),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Km(n)}),this.register(function(n){return new Jm(n)}),this.register(function(n){return new eg(n)}),this.register(function(n){return new tg(n)}),this.register(function(n){return new Wm(n)}),this.register(function(n){return new Qm(n)}),this.register(function(n){return new qm(n)}),this.register(function(n){return new Xm(n)}),this.register(function(n){return new Vm(n)}),this.register(function(n){return new Zm(n)}),this.register(function(n){return new Ym(n)}),this.register(function(n){return new $m(n)}),this.register(function(n){return new Hm(n)}),this.register(function(n){return new ng(n)}),this.register(function(n){return new rg(n)})}load(r,n,l,o){const s=this;let u;this.resourcePath!==""?u=this.resourcePath:this.path!==""?u=this.path:u=sr.extractUrlBase(r),this.manager.itemStart(r);const d=function(p){o?o(p):console.error(p),s.manager.itemError(r),s.manager.itemEnd(r)},f=new zd(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(r,function(p){try{s.parse(p,u,function(m){n(m),s.manager.itemEnd(r)},d)}catch(m){d(m)}},l,d)}setDRACOLoader(r){return this.dracoLoader=r,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(r){return this.ktx2Loader=r,this}setMeshoptDecoder(r){return this.meshoptDecoder=r,this}register(r){return this.pluginCallbacks.indexOf(r)===-1&&this.pluginCallbacks.push(r),this}unregister(r){return this.pluginCallbacks.indexOf(r)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(r),1),this}parse(r,n,l,o){let s;const u={},d={};if(typeof r=="string")s=JSON.parse(r);else if(r instanceof ArrayBuffer)if(sr.decodeText(new Uint8Array(r.slice(0,4)))===df){try{u[xe.KHR_BINARY_GLTF]=new ig(r)}catch(p){o&&o(p);return}s=JSON.parse(u[xe.KHR_BINARY_GLTF].content)}else s=JSON.parse(sr.decodeText(new Uint8Array(r)));else s=r;if(s.asset===void 0||s.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const f=new vg(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){const m=this.pluginCallbacks[p](f);d[m.name]=m,u[m.name]=!0}if(s.extensionsUsed)for(let p=0;p<s.extensionsUsed.length;++p){const m=s.extensionsUsed[p],g=s.extensionsRequired||[];switch(m){case xe.KHR_MATERIALS_UNLIT:u[m]=new Gm;break;case xe.KHR_DRACO_MESH_COMPRESSION:u[m]=new ag(s,this.dracoLoader);break;case xe.KHR_TEXTURE_TRANSFORM:u[m]=new og;break;case xe.KHR_MESH_QUANTIZATION:u[m]=new sg;break;default:g.indexOf(m)>=0&&d[m]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+m+'".')}}f.setExtensions(u),f.setPlugins(d),f.parse(l,o)}parseAsync(r,n){const l=this;return new Promise(function(o,s){l.parse(r,n,o,s)})}}function Fm(){let i={};return{get:function(r){return i[r]},add:function(r,n){i[r]=n},remove:function(r){delete i[r]},removeAll:function(){i={}}}}const xe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Hm{constructor(r){this.parser=r,this.name=xe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const r=this.parser,n=this.parser.json.nodes||[];for(let l=0,o=n.length;l<o;l++){const s=n[l];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&r._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(r){const n=this.parser,l="light:"+r;let o=n.cache.get(l);if(o)return o;const s=n.json,u=((s.extensions&&s.extensions[this.name]||{}).lights||[])[r];let d;const f=new xn(16777215);u.color!==void 0&&f.fromArray(u.color);const p=u.range!==void 0?u.range:0;switch(u.type){case"directional":d=new Up(f),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new Dp(f),d.distance=p;break;case"spot":d=new Op(f),d.distance=p,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,d.angle=u.spot.outerConeAngle,d.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return d.position.set(0,0,0),d.decay=2,Dn(d,u),u.intensity!==void 0&&(d.intensity=u.intensity),d.name=n.createUniqueName(u.name||"light_"+r),o=Promise.resolve(d),n.cache.add(l,o),o}getDependency(r,n){if(r==="light")return this._loadLight(n)}createNodeAttachment(r){const n=this,l=this.parser,o=l.json.nodes[r],s=(o.extensions&&o.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(u){return l._getNodeRef(n.cache,s,u)})}}class Gm{constructor(){this.name=xe.KHR_MATERIALS_UNLIT}getMaterialType(){return ir}extendParams(r,n,l){const o=[];r.color=new xn(1,1,1),r.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const u=s.baseColorFactor;r.color.fromArray(u),r.opacity=u[3]}s.baseColorTexture!==void 0&&o.push(l.assignTexture(r,"map",s.baseColorTexture,3001))}return Promise.all(o)}}class Vm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(r,n){const l=this.parser.json.materials[r];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const o=l.extensions[this.name].emissiveStrength;return o!==void 0&&(n.emissiveIntensity=o),Promise.resolve()}}class Km{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_CLEARCOAT}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];if(u.clearcoatFactor!==void 0&&(n.clearcoat=u.clearcoatFactor),u.clearcoatTexture!==void 0&&s.push(l.assignTexture(n,"clearcoatMap",u.clearcoatTexture)),u.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=u.clearcoatRoughnessFactor),u.clearcoatRoughnessTexture!==void 0&&s.push(l.assignTexture(n,"clearcoatRoughnessMap",u.clearcoatRoughnessTexture)),u.clearcoatNormalTexture!==void 0&&(s.push(l.assignTexture(n,"clearcoatNormalMap",u.clearcoatNormalTexture)),u.clearcoatNormalTexture.scale!==void 0)){const d=u.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new be(d,d)}return Promise.all(s)}}class Ym{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_IRIDESCENCE}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];return u.iridescenceFactor!==void 0&&(n.iridescence=u.iridescenceFactor),u.iridescenceTexture!==void 0&&s.push(l.assignTexture(n,"iridescenceMap",u.iridescenceTexture)),u.iridescenceIor!==void 0&&(n.iridescenceIOR=u.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),u.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=u.iridescenceThicknessMaximum),u.iridescenceThicknessTexture!==void 0&&s.push(l.assignTexture(n,"iridescenceThicknessMap",u.iridescenceThicknessTexture)),Promise.all(s)}}class Wm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_SHEEN}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new xn(0,0,0),n.sheenRoughness=0,n.sheen=1;const u=o.extensions[this.name];return u.sheenColorFactor!==void 0&&n.sheenColor.fromArray(u.sheenColorFactor),u.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=u.sheenRoughnessFactor),u.sheenColorTexture!==void 0&&s.push(l.assignTexture(n,"sheenColorMap",u.sheenColorTexture,3001)),u.sheenRoughnessTexture!==void 0&&s.push(l.assignTexture(n,"sheenRoughnessMap",u.sheenRoughnessTexture)),Promise.all(s)}}class Qm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_TRANSMISSION}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];return u.transmissionFactor!==void 0&&(n.transmission=u.transmissionFactor),u.transmissionTexture!==void 0&&s.push(l.assignTexture(n,"transmissionMap",u.transmissionTexture)),Promise.all(s)}}class qm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_VOLUME}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];n.thickness=u.thicknessFactor!==void 0?u.thicknessFactor:0,u.thicknessTexture!==void 0&&s.push(l.assignTexture(n,"thicknessMap",u.thicknessTexture)),n.attenuationDistance=u.attenuationDistance||1/0;const d=u.attenuationColor||[1,1,1];return n.attenuationColor=new xn(d[0],d[1],d[2]),Promise.all(s)}}class Xm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_IOR}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser.json.materials[r];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const o=l.extensions[this.name];return n.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class Zm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_SPECULAR}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];n.specularIntensity=u.specularFactor!==void 0?u.specularFactor:1,u.specularTexture!==void 0&&s.push(l.assignTexture(n,"specularIntensityMap",u.specularTexture));const d=u.specularColorFactor||[1,1,1];return n.specularColor=new xn(d[0],d[1],d[2]),u.specularColorTexture!==void 0&&s.push(l.assignTexture(n,"specularColorMap",u.specularColorTexture,3001)),Promise.all(s)}}class $m{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_ANISOTROPY}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];return u.anisotropyStrength!==void 0&&(n.anisotropy=u.anisotropyStrength),u.anisotropyRotation!==void 0&&(n.anisotropyRotation=u.anisotropyRotation),u.anisotropyTexture!==void 0&&s.push(l.assignTexture(n,"anisotropyMap",u.anisotropyTexture)),Promise.all(s)}}class Jm{constructor(r){this.parser=r,this.name=xe.KHR_TEXTURE_BASISU}loadTexture(r){const n=this.parser,l=n.json,o=l.textures[r];if(!o.extensions||!o.extensions[this.name])return null;const s=o.extensions[this.name],u=n.options.ktx2Loader;if(!u){if(l.extensionsRequired&&l.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(r,s.source,u)}}class eg{constructor(r){this.parser=r,this.name=xe.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(r){const n=this.name,l=this.parser,o=l.json,s=o.textures[r];if(!s.extensions||!s.extensions[n])return null;const u=s.extensions[n],d=o.images[u.source];let f=l.textureLoader;if(d.uri){const p=l.options.manager.getHandler(d.uri);p!==null&&(f=p)}return this.detectSupport().then(function(p){if(p)return l.loadTextureImage(r,u.source,f);if(o.extensionsRequired&&o.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return l.loadTexture(r)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(r){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){r(n.height===1)}})),this.isSupported}}class tg{constructor(r){this.parser=r,this.name=xe.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(r){const n=this.name,l=this.parser,o=l.json,s=o.textures[r];if(!s.extensions||!s.extensions[n])return null;const u=s.extensions[n],d=o.images[u.source];let f=l.textureLoader;if(d.uri){const p=l.options.manager.getHandler(d.uri);p!==null&&(f=p)}return this.detectSupport().then(function(p){if(p)return l.loadTextureImage(r,u.source,f);if(o.extensionsRequired&&o.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return l.loadTexture(r)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(r){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){r(n.height===1)}})),this.isSupported}}class ng{constructor(r){this.name=xe.EXT_MESHOPT_COMPRESSION,this.parser=r}loadBufferView(r){const n=this.parser.json,l=n.bufferViews[r];if(l.extensions&&l.extensions[this.name]){const o=l.extensions[this.name],s=this.parser.getDependency("buffer",o.buffer),u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(d){const f=o.byteOffset||0,p=o.byteLength||0,m=o.count,g=o.byteStride,v=new Uint8Array(d,f,p);return u.decodeGltfBufferAsync?u.decodeGltfBufferAsync(m,g,v,o.mode,o.filter).then(function(b){return b.buffer}):u.ready.then(function(){const b=new ArrayBuffer(m*g);return u.decodeGltfBuffer(new Uint8Array(b),m,g,v,o.mode,o.filter),b})})}else return null}}class rg{constructor(r){this.name=xe.EXT_MESH_GPU_INSTANCING,this.parser=r}createNodeMesh(r){const n=this.parser.json,l=n.nodes[r];if(!l.extensions||!l.extensions[this.name]||l.mesh===void 0)return null;const o=n.meshes[l.mesh];for(const f of o.primitives)if(f.mode!==Ut.TRIANGLES&&f.mode!==Ut.TRIANGLE_STRIP&&f.mode!==Ut.TRIANGLE_FAN&&f.mode!==void 0)return null;const s=l.extensions[this.name].attributes,u=[],d={};for(const f in s)u.push(this.parser.getDependency("accessor",s[f]).then(p=>(d[f]=p,d[f])));return u.length<1?null:(u.push(this.parser.createNodeMesh(r)),Promise.all(u).then(f=>{const p=f.pop(),m=p.isGroup?p.children:[p],g=f[0].count,v=[];for(const b of m){const A=new Je,S=new G,w=new ho,x=new G(1,1,1),_=new Fp(b.geometry,b.material,g);for(let E=0;E<g;E++)d.TRANSLATION&&S.fromBufferAttribute(d.TRANSLATION,E),d.ROTATION&&w.fromBufferAttribute(d.ROTATION,E),d.SCALE&&x.fromBufferAttribute(d.SCALE,E),_.setMatrixAt(E,A.compose(S,w,x));for(const E in d)E!=="TRANSLATION"&&E!=="ROTATION"&&E!=="SCALE"&&b.geometry.setAttribute(E,d[E]);Nl.prototype.copy.call(_,b),this.parser.assignFinalMaterial(_),v.push(_)}return p.isGroup?(p.clear(),p.add(...v),p):v[0]}))}}const df="glTF",Ti=12,$c={JSON:1313821514,BIN:5130562};class ig{constructor(r){this.name=xe.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(r,0,Ti);if(this.header={magic:sr.decodeText(new Uint8Array(r.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==df)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const l=this.header.length-Ti,o=new DataView(r,Ti);let s=0;for(;s<l;){const u=o.getUint32(s,!0);s+=4;const d=o.getUint32(s,!0);if(s+=4,d===$c.JSON){const f=new Uint8Array(r,Ti+s,u);this.content=sr.decodeText(f)}else if(d===$c.BIN){const f=Ti+s;this.body=r.slice(f,f+u)}s+=u}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ag{constructor(r,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=xe.KHR_DRACO_MESH_COMPRESSION,this.json=r,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(r,n){const l=this.json,o=this.dracoLoader,s=r.extensions[this.name].bufferView,u=r.extensions[this.name].attributes,d={},f={},p={};for(const m in u){const g=bl[m]||m.toLowerCase();d[g]=u[m]}for(const m in r.attributes){const g=bl[m]||m.toLowerCase();if(u[m]!==void 0){const v=l.accessors[r.attributes[m]],b=Qr[v.componentType];p[g]=b.name,f[g]=v.normalized===!0}}return n.getDependency("bufferView",s).then(function(m){return new Promise(function(g){o.decodeDracoFile(m,function(v){for(const b in v.attributes){const A=v.attributes[b],S=f[b];S!==void 0&&(A.normalized=S)}g(v)},d,p)})})}}class og{constructor(){this.name=xe.KHR_TEXTURE_TRANSFORM}extendTexture(r,n){return(n.texCoord===void 0||n.texCoord===r.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(r=r.clone(),n.texCoord!==void 0&&(r.channel=n.texCoord),n.offset!==void 0&&r.offset.fromArray(n.offset),n.rotation!==void 0&&(r.rotation=n.rotation),n.scale!==void 0&&r.repeat.fromArray(n.scale),r.needsUpdate=!0),r}}class sg{constructor(){this.name=xe.KHR_MESH_QUANTIZATION}}class ff extends Sh{constructor(r,n,l,o){super(r,n,l,o)}copySampleValue_(r){const n=this.resultBuffer,l=this.sampleValues,o=this.valueSize,s=r*o*3+o;for(let u=0;u!==o;u++)n[u]=l[s+u];return n}interpolate_(r,n,l,o){const s=this.resultBuffer,u=this.sampleValues,d=this.valueSize,f=d*2,p=d*3,m=o-n,g=(l-n)/m,v=g*g,b=v*g,A=r*p,S=A-p,w=-2*b+3*v,x=b-v,_=1-w,E=x-v+g;for(let P=0;P!==d;P++){const M=u[S+P+d],L=u[S+P+f]*m,R=u[A+P+d],N=u[A+P]*m;s[P]=_*M+E*L+w*R+x*N}return s}}const lg=new ho;class ug extends ff{interpolate_(r,n,l,o){const s=super.interpolate_(r,n,l,o);return lg.fromArray(s).normalize().toArray(s),s}}const Ut={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Qr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jc={9728:sh,9729:po,9984:lh,9985:uh,9986:ch,9987:Nd},ed={33071:dh,33648:fh,10497:cl},Vs={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bl={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...jm>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Bn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},cg={CUBICSPLINE:void 0,LINEAR:Od,STEP:ph},Ks={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function dg(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new zl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:qr})),i.DefaultMaterial}function rr(i,r,n){for(const l in n.extensions)i[l]===void 0&&(r.userData.gltfExtensions=r.userData.gltfExtensions||{},r.userData.gltfExtensions[l]=n.extensions[l])}function Dn(i,r){r.extras!==void 0&&(typeof r.extras=="object"?Object.assign(i.userData,r.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras))}function fg(i,r,n){let l=!1,o=!1,s=!1;for(let p=0,m=r.length;p<m;p++){const g=r[p];if(g.POSITION!==void 0&&(l=!0),g.NORMAL!==void 0&&(o=!0),g.COLOR_0!==void 0&&(s=!0),l&&o&&s)break}if(!l&&!o&&!s)return Promise.resolve(i);const u=[],d=[],f=[];for(let p=0,m=r.length;p<m;p++){const g=r[p];if(l){const v=g.POSITION!==void 0?n.getDependency("accessor",g.POSITION):i.attributes.position;u.push(v)}if(o){const v=g.NORMAL!==void 0?n.getDependency("accessor",g.NORMAL):i.attributes.normal;d.push(v)}if(s){const v=g.COLOR_0!==void 0?n.getDependency("accessor",g.COLOR_0):i.attributes.color;f.push(v)}}return Promise.all([Promise.all(u),Promise.all(d),Promise.all(f)]).then(function(p){const m=p[0],g=p[1],v=p[2];return l&&(i.morphAttributes.position=m),o&&(i.morphAttributes.normal=g),s&&(i.morphAttributes.color=v),i.morphTargetsRelative=!0,i})}function pg(i,r){if(i.updateMorphTargets(),r.weights!==void 0)for(let n=0,l=r.weights.length;n<l;n++)i.morphTargetInfluences[n]=r.weights[n];if(r.extras&&Array.isArray(r.extras.targetNames)){const n=r.extras.targetNames;if(i.morphTargetInfluences.length===n.length){i.morphTargetDictionary={};for(let l=0,o=n.length;l<o;l++)i.morphTargetDictionary[n[l]]=l}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function hg(i){let r;const n=i.extensions&&i.extensions[xe.KHR_DRACO_MESH_COMPRESSION];if(n?r="draco:"+n.bufferView+":"+n.indices+":"+Ys(n.attributes):r=i.indices+":"+Ys(i.attributes)+":"+i.mode,i.targets!==void 0)for(let l=0,o=i.targets.length;l<o;l++)r+=":"+Ys(i.targets[l]);return r}function Ys(i){let r="";const n=Object.keys(i).sort();for(let l=0,o=n.length;l<o;l++)r+=n[l]+":"+i[n[l]]+";";return r}function xl(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function mg(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const gg=new Je;class vg{constructor(r={},n={}){this.json=r,this.extensions={},this.plugins={},this.options=n,this.cache=new Fm,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let l=!1,o=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=navigator.userAgent.indexOf("Firefox")>-1,s=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||l||o&&s<98?this.textureLoader=new Hp(this.options.manager):this.textureLoader=new Gp(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new zd(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(r){this.extensions=r}setPlugins(r){this.plugins=r}parse(r,n){const l=this,o=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(u){return u._markDefs&&u._markDefs()}),Promise.all(this._invokeAll(function(u){return u.beforeRoot&&u.beforeRoot()})).then(function(){return Promise.all([l.getDependencies("scene"),l.getDependencies("animation"),l.getDependencies("camera")])}).then(function(u){const d={scene:u[0][o.scene||0],scenes:u[0],animations:u[1],cameras:u[2],asset:o.asset,parser:l,userData:{}};rr(s,d,o),Dn(d,o),Promise.all(l._invokeAll(function(f){return f.afterRoot&&f.afterRoot(d)})).then(function(){r(d)})}).catch(n)}_markDefs(){const r=this.json.nodes||[],n=this.json.skins||[],l=this.json.meshes||[];for(let o=0,s=n.length;o<s;o++){const u=n[o].joints;for(let d=0,f=u.length;d<f;d++)r[u[d]].isBone=!0}for(let o=0,s=r.length;o<s;o++){const u=r[o];u.mesh!==void 0&&(this._addNodeRef(this.meshCache,u.mesh),u.skin!==void 0&&(l[u.mesh].isSkinnedMesh=!0)),u.camera!==void 0&&this._addNodeRef(this.cameraCache,u.camera)}}_addNodeRef(r,n){n!==void 0&&(r.refs[n]===void 0&&(r.refs[n]=r.uses[n]=0),r.refs[n]++)}_getNodeRef(r,n,l){if(r.refs[n]<=1)return l;const o=l.clone(),s=(u,d)=>{const f=this.associations.get(u);f!=null&&this.associations.set(d,f);for(const[p,m]of u.children.entries())s(m,d.children[p])};return s(l,o),o.name+="_instance_"+r.uses[n]++,o}_invokeOne(r){const n=Object.values(this.plugins);n.push(this);for(let l=0;l<n.length;l++){const o=r(n[l]);if(o)return o}return null}_invokeAll(r){const n=Object.values(this.plugins);n.unshift(this);const l=[];for(let o=0;o<n.length;o++){const s=r(n[o]);s&&l.push(s)}return l}getDependency(r,n){const l=r+":"+n;let o=this.cache.get(l);if(!o){switch(r){case"scene":o=this.loadScene(n);break;case"node":o=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":o=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":o=this.loadAccessor(n);break;case"bufferView":o=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":o=this.loadBuffer(n);break;case"material":o=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":o=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":o=this.loadSkin(n);break;case"animation":o=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":o=this.loadCamera(n);break;default:if(o=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(r,n)}),!o)throw new Error("Unknown type: "+r);break}this.cache.add(l,o)}return o}getDependencies(r){let n=this.cache.get(r);if(!n){const l=this,o=this.json[r+(r==="mesh"?"es":"s")]||[];n=Promise.all(o.map(function(s,u){return l.getDependency(r,u)})),this.cache.add(r,n)}return n}loadBuffer(r){const n=this.json.buffers[r],l=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&r===0)return Promise.resolve(this.extensions[xe.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(s,u){l.load(sr.resolveURL(n.uri,o.path),s,void 0,function(){u(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(r){const n=this.json.bufferViews[r];return this.getDependency("buffer",n.buffer).then(function(l){const o=n.byteLength||0,s=n.byteOffset||0;return l.slice(s,s+o)})}loadAccessor(r){const n=this,l=this.json,o=this.json.accessors[r];if(o.bufferView===void 0&&o.sparse===void 0){const u=Vs[o.type],d=Qr[o.componentType],f=o.normalized===!0,p=new d(o.count*u);return Promise.resolve(new Ni(p,u,f))}const s=[];return o.bufferView!==void 0?s.push(this.getDependency("bufferView",o.bufferView)):s.push(null),o.sparse!==void 0&&(s.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(s).then(function(u){const d=u[0],f=Vs[o.type],p=Qr[o.componentType],m=p.BYTES_PER_ELEMENT,g=m*f,v=o.byteOffset||0,b=o.bufferView!==void 0?l.bufferViews[o.bufferView].byteStride:void 0,A=o.normalized===!0;let S,w;if(b&&b!==g){const x=Math.floor(v/b),_="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+x+":"+o.count;let E=n.cache.get(_);E||(S=new p(d,x*b,o.count*b/m),E=new Vp(S,b/m),n.cache.add(_,E)),w=new ar(E,f,v%b/m,A)}else d===null?S=new p(o.count*f):S=new p(d,v,o.count*f),w=new Ni(S,f,A);if(o.sparse!==void 0){const x=Vs.SCALAR,_=Qr[o.sparse.indices.componentType],E=o.sparse.indices.byteOffset||0,P=o.sparse.values.byteOffset||0,M=new _(u[1],E,o.sparse.count*x),L=new p(u[2],P,o.sparse.count*f);d!==null&&(w=new Ni(w.array.slice(),w.itemSize,w.normalized));for(let R=0,N=M.length;R<N;R++){const z=M[R];if(w.setX(z,L[R*f]),f>=2&&w.setY(z,L[R*f+1]),f>=3&&w.setZ(z,L[R*f+2]),f>=4&&w.setW(z,L[R*f+3]),f>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return w})}loadTexture(r){const n=this.json,l=this.options,o=n.textures[r].source,s=n.images[o];let u=this.textureLoader;if(s.uri){const d=l.manager.getHandler(s.uri);d!==null&&(u=d)}return this.loadTextureImage(r,o,u)}loadTextureImage(r,n,l){const o=this,s=this.json,u=s.textures[r],d=s.images[n],f=(d.uri||d.bufferView)+":"+u.sampler;if(this.textureCache[f])return this.textureCache[f];const p=this.loadImageSource(n,l).then(function(m){m.flipY=!1,m.name=u.name||d.name||"",m.name===""&&typeof d.uri=="string"&&d.uri.startsWith("data:image/")===!1&&(m.name=d.uri);const g=(s.samplers||{})[u.sampler]||{};return m.magFilter=Jc[g.magFilter]||po,m.minFilter=Jc[g.minFilter]||Nd,m.wrapS=ed[g.wrapS]||cl,m.wrapT=ed[g.wrapT]||cl,o.associations.set(m,{textures:r}),m}).catch(function(){return null});return this.textureCache[f]=p,p}loadImageSource(r,n){const l=this,o=this.json,s=this.options;if(this.sourceCache[r]!==void 0)return this.sourceCache[r].then(g=>g.clone());const u=o.images[r],d=self.URL||self.webkitURL;let f=u.uri||"",p=!1;if(u.bufferView!==void 0)f=l.getDependency("bufferView",u.bufferView).then(function(g){p=!0;const v=new Blob([g],{type:u.mimeType});return f=d.createObjectURL(v),f});else if(u.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+r+" is missing URI and bufferView");const m=Promise.resolve(f).then(function(g){return new Promise(function(v,b){let A=v;n.isImageBitmapLoader===!0&&(A=function(S){const w=new ll(S);w.needsUpdate=!0,v(w)}),n.load(sr.resolveURL(g,s.path),A,void 0,b)})}).then(function(g){return p===!0&&d.revokeObjectURL(f),g.userData.mimeType=u.mimeType||mg(u.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",f),g});return this.sourceCache[r]=m,m}assignTexture(r,n,l,o){const s=this;return this.getDependency("texture",l.index).then(function(u){if(!u)return null;if(l.texCoord!==void 0&&l.texCoord>0&&(u=u.clone(),u.channel=l.texCoord),s.extensions[xe.KHR_TEXTURE_TRANSFORM]){const d=l.extensions!==void 0?l.extensions[xe.KHR_TEXTURE_TRANSFORM]:void 0;if(d){const f=s.associations.get(u);u=s.extensions[xe.KHR_TEXTURE_TRANSFORM].extendTexture(u,d),s.associations.set(u,f)}}return o!==void 0&&("colorSpace"in u?u.colorSpace=o===3001?"srgb":"srgb-linear":u.encoding=o),r[n]=u,u})}assignFinalMaterial(r){const n=r.geometry;let l=r.material;const o=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,u=n.attributes.normal===void 0;if(r.isPoints){const d="PointsMaterial:"+l.uuid;let f=this.cache.get(d);f||(f=new Kp,uo.prototype.copy.call(f,l),f.color.copy(l.color),f.map=l.map,f.sizeAttenuation=!1,this.cache.add(d,f)),l=f}else if(r.isLine){const d="LineBasicMaterial:"+l.uuid;let f=this.cache.get(d);f||(f=new Yp,uo.prototype.copy.call(f,l),f.color.copy(l.color),f.map=l.map,this.cache.add(d,f)),l=f}if(o||s||u){let d="ClonedMaterial:"+l.uuid+":";o&&(d+="derivative-tangents:"),s&&(d+="vertex-colors:"),u&&(d+="flat-shading:");let f=this.cache.get(d);f||(f=l.clone(),s&&(f.vertexColors=!0),u&&(f.flatShading=!0),o&&(f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(d,f),this.associations.set(f,this.associations.get(l))),l=f}r.material=l}getMaterialType(){return zl}loadMaterial(r){const n=this,l=this.json,o=this.extensions,s=l.materials[r];let u;const d={},f=s.extensions||{},p=[];if(f[xe.KHR_MATERIALS_UNLIT]){const g=o[xe.KHR_MATERIALS_UNLIT];u=g.getMaterialType(),p.push(g.extendParams(d,s,n))}else{const g=s.pbrMetallicRoughness||{};if(d.color=new xn(1,1,1),d.opacity=1,Array.isArray(g.baseColorFactor)){const v=g.baseColorFactor;d.color.fromArray(v),d.opacity=v[3]}g.baseColorTexture!==void 0&&p.push(n.assignTexture(d,"map",g.baseColorTexture,3001)),d.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,d.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(p.push(n.assignTexture(d,"metalnessMap",g.metallicRoughnessTexture)),p.push(n.assignTexture(d,"roughnessMap",g.metallicRoughnessTexture))),u=this._invokeOne(function(v){return v.getMaterialType&&v.getMaterialType(r)}),p.push(Promise.all(this._invokeAll(function(v){return v.extendMaterialParams&&v.extendMaterialParams(r,d)})))}s.doubleSided===!0&&(d.side=jd);const m=s.alphaMode||Ks.OPAQUE;if(m===Ks.BLEND?(d.transparent=!0,d.depthWrite=!1):(d.transparent=!1,m===Ks.MASK&&(d.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&u!==ir&&(p.push(n.assignTexture(d,"normalMap",s.normalTexture)),d.normalScale=new be(1,1),s.normalTexture.scale!==void 0)){const g=s.normalTexture.scale;d.normalScale.set(g,g)}return s.occlusionTexture!==void 0&&u!==ir&&(p.push(n.assignTexture(d,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(d.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&u!==ir&&(d.emissive=new xn().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&u!==ir&&p.push(n.assignTexture(d,"emissiveMap",s.emissiveTexture,3001)),Promise.all(p).then(function(){const g=new u(d);return s.name&&(g.name=s.name),Dn(g,s),n.associations.set(g,{materials:r}),s.extensions&&rr(o,g,s),g})}createUniqueName(r){const n=Wp.sanitizeNodeName(r||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(r){const n=this,l=this.extensions,o=this.primitiveCache;function s(d){return l[xe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(d,n).then(function(f){return td(f,d,n)})}const u=[];for(let d=0,f=r.length;d<f;d++){const p=r[d],m=hg(p),g=o[m];if(g)u.push(g.promise);else{let v;p.extensions&&p.extensions[xe.KHR_DRACO_MESH_COMPRESSION]?v=s(p):v=td(new kl,p,n),o[m]={primitive:p,promise:v},u.push(v)}}return Promise.all(u)}loadMesh(r){const n=this,l=this.json,o=this.extensions,s=l.meshes[r],u=s.primitives,d=[];for(let f=0,p=u.length;f<p;f++){const m=u[f].material===void 0?dg(this.cache):this.getDependency("material",u[f].material);d.push(m)}return d.push(n.loadGeometries(u)),Promise.all(d).then(function(f){const p=f.slice(0,f.length-1),m=f[f.length-1],g=[];for(let b=0,A=m.length;b<A;b++){const S=m[b],w=u[b];let x;const _=p[b];if(w.mode===Ut.TRIANGLES||w.mode===Ut.TRIANGLE_STRIP||w.mode===Ut.TRIANGLE_FAN||w.mode===void 0)x=s.isSkinnedMesh===!0?new Qp(S,_):new Hn(S,_),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),w.mode===Ut.TRIANGLE_STRIP?x.geometry=qc(x.geometry,Ud):w.mode===Ut.TRIANGLE_FAN&&(x.geometry=qc(x.geometry,dl));else if(w.mode===Ut.LINES)x=new qp(S,_);else if(w.mode===Ut.LINE_STRIP)x=new Xp(S,_);else if(w.mode===Ut.LINE_LOOP)x=new Zp(S,_);else if(w.mode===Ut.POINTS)x=new $p(S,_);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+w.mode);Object.keys(x.geometry.morphAttributes).length>0&&pg(x,s),x.name=n.createUniqueName(s.name||"mesh_"+r),Dn(x,s),w.extensions&&rr(o,x,w),n.assignFinalMaterial(x),g.push(x)}for(let b=0,A=g.length;b<A;b++)n.associations.set(g[b],{meshes:r,primitives:b});if(g.length===1)return s.extensions&&rr(o,g[0],s),g[0];const v=new or;s.extensions&&rr(o,v,s),n.associations.set(v,{meshes:r});for(let b=0,A=g.length;b<A;b++)v.add(g[b]);return v})}loadCamera(r){let n;const l=this.json.cameras[r],o=l[l.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return l.type==="perspective"?n=new Vr(Bd.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):l.type==="orthographic"&&(n=new Kr(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),l.name&&(n.name=this.createUniqueName(l.name)),Dn(n,l),Promise.resolve(n)}loadSkin(r){const n=this.json.skins[r],l=[];for(let o=0,s=n.joints.length;o<s;o++)l.push(this._loadNodeShallow(n.joints[o]));return n.inverseBindMatrices!==void 0?l.push(this.getDependency("accessor",n.inverseBindMatrices)):l.push(null),Promise.all(l).then(function(o){const s=o.pop(),u=o,d=[],f=[];for(let p=0,m=u.length;p<m;p++){const g=u[p];if(g){d.push(g);const v=new Je;s!==null&&v.fromArray(s.array,p*16),f.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[p])}return new Jp(d,f)})}loadAnimation(r){const n=this.json.animations[r],l=n.name?n.name:"animation_"+r,o=[],s=[],u=[],d=[],f=[];for(let p=0,m=n.channels.length;p<m;p++){const g=n.channels[p],v=n.samplers[g.sampler],b=g.target,A=b.node,S=n.parameters!==void 0?n.parameters[v.input]:v.input,w=n.parameters!==void 0?n.parameters[v.output]:v.output;b.node!==void 0&&(o.push(this.getDependency("node",A)),s.push(this.getDependency("accessor",S)),u.push(this.getDependency("accessor",w)),d.push(v),f.push(b))}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(u),Promise.all(d),Promise.all(f)]).then(function(p){const m=p[0],g=p[1],v=p[2],b=p[3],A=p[4],S=[];for(let w=0,x=m.length;w<x;w++){const _=m[w],E=g[w],P=v[w],M=b[w],L=A[w];if(_===void 0)continue;_.updateMatrix();let R;switch(Bn[L.path]){case Bn.weights:R=mh;break;case Bn.rotation:R=Cc;break;case Bn.position:case Bn.scale:default:R=hh;break}const N=_.name?_.name:_.uuid,z=M.interpolation!==void 0?cg[M.interpolation]:Od,D=[];Bn[L.path]===Bn.weights?_.traverse(function(F){F.morphTargetInfluences&&D.push(F.name?F.name:F.uuid)}):D.push(N);let B=P.array;if(P.normalized){const F=xl(B.constructor),Y=new Float32Array(B.length);for(let $=0,le=B.length;$<le;$++)Y[$]=B[$]*F;B=Y}for(let F=0,Y=D.length;F<Y;F++){const $=new R(D[F]+"."+Bn[L.path],E.array,B,z);M.interpolation==="CUBICSPLINE"&&($.createInterpolant=function(le){const fe=this instanceof Cc?ug:ff;return new fe(this.times,this.values,this.getValueSize()/3,le)},$.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),S.push($)}}return new eh(l,void 0,S)})}createNodeMesh(r){const n=this.json,l=this,o=n.nodes[r];return o.mesh===void 0?null:l.getDependency("mesh",o.mesh).then(function(s){const u=l._getNodeRef(l.meshCache,o.mesh,s);return o.weights!==void 0&&u.traverse(function(d){if(d.isMesh)for(let f=0,p=o.weights.length;f<p;f++)d.morphTargetInfluences[f]=o.weights[f]}),u})}loadNode(r){const n=this.json,l=this,o=n.nodes[r],s=l._loadNodeShallow(r),u=[],d=o.children||[];for(let p=0,m=d.length;p<m;p++)u.push(l.getDependency("node",d[p]));const f=o.skin===void 0?Promise.resolve(null):l.getDependency("skin",o.skin);return Promise.all([s,Promise.all(u),f]).then(function(p){const m=p[0],g=p[1],v=p[2];v!==null&&m.traverse(function(b){b.isSkinnedMesh&&b.bind(v,gg)});for(let b=0,A=g.length;b<A;b++)m.add(g[b]);return m})}_loadNodeShallow(r){const n=this.json,l=this.extensions,o=this;if(this.nodeCache[r]!==void 0)return this.nodeCache[r];const s=n.nodes[r],u=s.name?o.createUniqueName(s.name):"",d=[],f=o._invokeOne(function(p){return p.createNodeMesh&&p.createNodeMesh(r)});return f&&d.push(f),s.camera!==void 0&&d.push(o.getDependency("camera",s.camera).then(function(p){return o._getNodeRef(o.cameraCache,s.camera,p)})),o._invokeAll(function(p){return p.createNodeAttachment&&p.createNodeAttachment(r)}).forEach(function(p){d.push(p)}),this.nodeCache[r]=Promise.all(d).then(function(p){let m;if(s.isBone===!0?m=new th:p.length>1?m=new or:p.length===1?m=p[0]:m=new Nl,m!==p[0])for(let g=0,v=p.length;g<v;g++)m.add(p[g]);if(s.name&&(m.userData.name=s.name,m.name=u),Dn(m,s),s.extensions&&rr(l,m,s),s.matrix!==void 0){const g=new Je;g.fromArray(s.matrix),m.applyMatrix4(g)}else s.translation!==void 0&&m.position.fromArray(s.translation),s.rotation!==void 0&&m.quaternion.fromArray(s.rotation),s.scale!==void 0&&m.scale.fromArray(s.scale);return o.associations.has(m)||o.associations.set(m,{}),o.associations.get(m).nodes=r,m}),this.nodeCache[r]}loadScene(r){const n=this.extensions,l=this.json.scenes[r],o=this,s=new or;l.name&&(s.name=o.createUniqueName(l.name)),Dn(s,l),l.extensions&&rr(n,s,l);const u=l.nodes||[],d=[];for(let f=0,p=u.length;f<p;f++)d.push(o.getDependency("node",u[f]));return Promise.all(d).then(function(f){for(let m=0,g=f.length;m<g;m++)s.add(f[m]);const p=m=>{const g=new Map;for(const[v,b]of o.associations)(v instanceof uo||v instanceof ll)&&g.set(v,b);return m.traverse(v=>{const b=o.associations.get(v);b!=null&&g.set(v,b)}),g};return o.associations=p(s),s})}}function yg(i,r,n){const l=r.attributes,o=new Qe;if(l.POSITION!==void 0){const d=n.json.accessors[l.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(o.set(new G(f[0],f[1],f[2]),new G(p[0],p[1],p[2])),d.normalized){const m=xl(Qr[d.componentType]);o.min.multiplyScalar(m),o.max.multiplyScalar(m)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=r.targets;if(s!==void 0){const d=new G,f=new G;for(let p=0,m=s.length;p<m;p++){const g=s[p];if(g.POSITION!==void 0){const v=n.json.accessors[g.POSITION],b=v.min,A=v.max;if(b!==void 0&&A!==void 0){if(f.setX(Math.max(Math.abs(b[0]),Math.abs(A[0]))),f.setY(Math.max(Math.abs(b[1]),Math.abs(A[1]))),f.setZ(Math.max(Math.abs(b[2]),Math.abs(A[2]))),v.normalized){const S=xl(Qr[v.componentType]);f.multiplyScalar(S)}d.max(f)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(d)}i.boundingBox=o;const u=new Zr;o.getCenter(u.center),u.radius=o.min.distanceTo(o.max)/2,i.boundingSphere=u}function td(i,r,n){const l=r.attributes,o=[];function s(u,d){return n.getDependency("accessor",u).then(function(f){i.setAttribute(d,f)})}for(const u in l){const d=bl[u]||u.toLowerCase();d in i.attributes||o.push(s(l[u],d))}if(r.indices!==void 0&&!i.index){const u=n.getDependency("accessor",r.indices).then(function(d){i.setIndex(d)});o.push(u)}return Dn(i,r),yg(i,r,n),Promise.all(o).then(function(){return r.targets!==void 0?fg(i,r.targets,n):i})}var bg=Object.defineProperty,xg=(i,r,n)=>r in i?bg(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n,Oe=(i,r,n)=>(xg(i,typeof r!="symbol"?r+"":r,n),n);const Fe={Handedness:{NONE:"none",LEFT:"left",RIGHT:"right"},ComponentState:{DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"},ComponentProperty:{BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"},ComponentType:{TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"},ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:{TRANSFORM:"transform",VISIBILITY:"visibility"}};async function pf(i){const r=await fetch(i);if(r.ok)return r.json();throw new Error(r.statusText)}async function wg(i){if(!i)throw new Error("No basePath supplied");return await pf(`${i}/profilesList.json`)}async function Sg(i,r,n=null,l=!0){if(!i)throw new Error("No xrInputSource supplied");if(!r)throw new Error("No basePath supplied");const o=await wg(r);let s;if(i.profiles.some(f=>{const p=o[f];return p&&(s={profileId:f,profilePath:`${r}/${p.path}`,deprecated:!!p.deprecated}),!!s}),!s){if(!n)throw new Error("No matching profile name found");const f=o[n];if(!f)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${r}/${f.path}`,deprecated:!!f.deprecated}}const u=await pf(s.profilePath);let d;if(l){let f;if(i.handedness==="any"?f=u.layouts[Object.keys(u.layouts)[0]]:f=u.layouts[i.handedness],!f)throw new Error(`No matching handedness, ${i.handedness}, in profile ${s.profileId}`);f.assetPath&&(d=s.profilePath.replace("profile.json",f.assetPath))}return{profile:u,assetPath:d}}const _g={xAxis:0,yAxis:0,button:0,state:Fe.ComponentState.DEFAULT};function Eg(i=0,r=0){let n=i,l=r;if(Math.sqrt(i*i+r*r)>1){const o=Math.atan2(r,i);n=Math.cos(o),l=Math.sin(o)}return{normalizedXAxis:n*.5+.5,normalizedYAxis:l*.5+.5}}class Ag{constructor(r){Oe(this,"value"),Oe(this,"componentProperty"),Oe(this,"states"),Oe(this,"valueNodeName"),Oe(this,"valueNodeProperty"),Oe(this,"minNodeName"),Oe(this,"maxNodeName"),Oe(this,"valueNode"),Oe(this,"minNode"),Oe(this,"maxNode"),this.componentProperty=r.componentProperty,this.states=r.states,this.valueNodeName=r.valueNodeName,this.valueNodeProperty=r.valueNodeProperty,this.valueNodeProperty===Fe.VisualResponseProperty.TRANSFORM&&(this.minNodeName=r.minNodeName,this.maxNodeName=r.maxNodeName),this.value=0,this.updateFromComponent(_g)}updateFromComponent({xAxis:r,yAxis:n,button:l,state:o}){const{normalizedXAxis:s,normalizedYAxis:u}=Eg(r,n);switch(this.componentProperty){case Fe.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?s:.5;break;case Fe.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?u:.5;break;case Fe.ComponentProperty.BUTTON:this.value=this.states.includes(o)&&l?l:0;break;case Fe.ComponentProperty.STATE:this.valueNodeProperty===Fe.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Tg{constructor(r,n){if(Oe(this,"id"),Oe(this,"values"),Oe(this,"type"),Oe(this,"gamepadIndices"),Oe(this,"rootNodeName"),Oe(this,"visualResponses"),Oe(this,"touchPointNodeName"),Oe(this,"touchPointNode"),!r||!n||!n.visualResponses||!n.gamepadIndices||Object.keys(n.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=r,this.type=n.type,this.rootNodeName=n.rootNodeName,this.touchPointNodeName=n.touchPointNodeName,this.visualResponses={},Object.keys(n.visualResponses).forEach(l=>{const o=new Ag(n.visualResponses[l]);this.visualResponses[l]=o}),this.gamepadIndices=Object.assign({},n.gamepadIndices),this.values={state:Fe.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(r){if(this.values.state=Fe.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&r.buttons.length>this.gamepadIndices.button){const n=r.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||this.values.button===1?this.values.state=Fe.ComponentState.PRESSED:(n.touched||this.values.button>Fe.ButtonTouchThreshold)&&(this.values.state=Fe.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&r.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=r.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Fe.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Fe.AxisTouchThreshold&&(this.values.state=Fe.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&r.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=r.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Fe.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Fe.AxisTouchThreshold&&(this.values.state=Fe.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(n=>{n.updateFromComponent(this.values)})}}class Pg{constructor(r,n,l){if(Oe(this,"xrInputSource"),Oe(this,"assetUrl"),Oe(this,"layoutDescription"),Oe(this,"id"),Oe(this,"components"),!r)throw new Error("No xrInputSource supplied");if(!n)throw new Error("No profile supplied");if(!n.layouts[r.handedness])throw new Error("No layout for "+r.handedness+" handedness");this.xrInputSource=r,this.assetUrl=l,this.id=n.profileId,this.layoutDescription=n.layouts[r.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(o=>{const s=this.layoutDescription.components[o];this.components[o]=new Tg(o,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const r=[];return Object.values(this.components).forEach(n=>{r.push(n.data)}),r}updateFromGamepad(){Object.values(this.components).forEach(r=>{r.updateFromGamepad(this.xrInputSource.gamepad)})}}const nd=new Qe,Ka=new G;class Hl extends Ph{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const r=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],l=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(l),this.setAttribute("position",new Ic(r,3)),this.setAttribute("uv",new Ic(n,2))}applyMatrix4(r){const n=this.attributes.instanceStart,l=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(r),l.applyMatrix4(r),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(r){let n;r instanceof Float32Array?n=r:Array.isArray(r)&&(n=new Float32Array(r));const l=new pl(n,6,1);return this.setAttribute("instanceStart",new ar(l,3,0)),this.setAttribute("instanceEnd",new ar(l,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(r,n=3){let l;r instanceof Float32Array?l=r:Array.isArray(r)&&(l=new Float32Array(r));const o=new pl(l,n*2,1);return this.setAttribute("instanceColorStart",new ar(o,n,0)),this.setAttribute("instanceColorEnd",new ar(o,n,n)),this}fromWireframeGeometry(r){return this.setPositions(r.attributes.position.array),this}fromEdgesGeometry(r){return this.setPositions(r.attributes.position.array),this}fromMesh(r){return this.fromWireframeGeometry(new Mh(r.geometry)),this}fromLineSegments(r){const n=r.geometry;return this.setPositions(n.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qe);const r=this.attributes.instanceStart,n=this.attributes.instanceEnd;r!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(r),nd.setFromBufferAttribute(n),this.boundingBox.union(nd))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zr),this.boundingBox===null&&this.computeBoundingBox();const r=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(r!==void 0&&n!==void 0){const l=this.boundingSphere.center;this.boundingBox.getCenter(l);let o=0;for(let s=0,u=r.count;s<u;s++)Ka.fromBufferAttribute(r,s),o=Math.max(o,l.distanceToSquared(Ka)),Ka.fromBufferAttribute(n,s),o=Math.max(o,l.distanceToSquared(Ka));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(r){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(r)}}class hf extends Hl{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(r){const n=r.length-3,l=new Float32Array(2*n);for(let o=0;o<n;o+=3)l[2*o]=r[o],l[2*o+1]=r[o+1],l[2*o+2]=r[o+2],l[2*o+3]=r[o+3],l[2*o+4]=r[o+4],l[2*o+5]=r[o+5];return super.setPositions(l),this}setColors(r,n=3){const l=r.length-n,o=new Float32Array(2*l);if(n===3)for(let s=0;s<l;s+=n)o[2*s]=r[s],o[2*s+1]=r[s+1],o[2*s+2]=r[s+2],o[2*s+3]=r[s+3],o[2*s+4]=r[s+4],o[2*s+5]=r[s+5];else for(let s=0;s<l;s+=n)o[2*s]=r[s],o[2*s+1]=r[s+1],o[2*s+2]=r[s+2],o[2*s+3]=r[s+3],o[2*s+4]=r[s+4],o[2*s+5]=r[s+5],o[2*s+6]=r[s+6],o[2*s+7]=r[s+7];return super.setColors(o,n),this}fromLine(r){const n=r.geometry;return this.setPositions(n.attributes.position.array),this}}class Gl extends Lh{constructor(r){super({type:"LineMaterial",uniforms:fl.clone(fl.merge([kc.common,kc.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new be(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${parseInt(Fd.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(n){this.uniforms.diffuse.value=n}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(n){this.uniforms.linewidth.value=n}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(n){!!n!="USE_DASH"in this.defines&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(n){this.uniforms.dashScale.value=n}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(n){this.uniforms.dashSize.value=n}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(n){this.uniforms.dashOffset.value=n}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(n){this.uniforms.gapSize.value=n}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(n){this.uniforms.resolution.value.copy(n)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(n){!!n!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(r)}}const rd=new G,id=new G,nt=new Di,rt=new Di,sn=new Di,Ws=new G,Qs=new Je,ct=new dn,ad=new G,Ya=new Qe,Wa=new Zr,ln=new Di;let un,wl,mf,ur;function od(i,r,n){return ln.set(0,0,-r,1).applyMatrix4(i.projectionMatrix),ln.multiplyScalar(1/ln.w),ln.x=ur/n.width,ln.y=ur/n.height,ln.applyMatrix4(i.projectionMatrixInverse),ln.multiplyScalar(1/ln.w),Math.abs(Math.max(ln.x,ln.y))}function Mg(i,r){for(let n=0,l=wl.count;n<l;n++){ct.start.fromBufferAttribute(wl,n),ct.end.fromBufferAttribute(mf,n);const o=new G,s=new G;un.distanceSqToSegment(ct.start,ct.end,s,o),s.distanceTo(o)<ur*.5&&r.push({point:s,pointOnLine:o,distance:un.origin.distanceTo(s),object:i,face:null,faceIndex:n,uv:null,uv2:null})}}function Lg(i,r,n){const l=r.projectionMatrix,o=i.material.resolution,s=i.matrixWorld,u=i.geometry,d=u.attributes.instanceStart,f=u.attributes.instanceEnd,p=-r.near;un.at(1,sn),sn.w=1,sn.applyMatrix4(r.matrixWorldInverse),sn.applyMatrix4(l),sn.multiplyScalar(1/sn.w),sn.x*=o.x/2,sn.y*=o.y/2,sn.z=0,Ws.copy(sn),Qs.multiplyMatrices(r.matrixWorldInverse,s);for(let m=0,g=d.count;m<g;m++){if(nt.fromBufferAttribute(d,m),rt.fromBufferAttribute(f,m),nt.w=1,rt.w=1,nt.applyMatrix4(Qs),rt.applyMatrix4(Qs),nt.z>p&&rt.z>p)continue;if(nt.z>p){const w=nt.z-rt.z,x=(nt.z-p)/w;nt.lerp(rt,x)}else if(rt.z>p){const w=rt.z-nt.z,x=(rt.z-p)/w;rt.lerp(nt,x)}nt.applyMatrix4(l),rt.applyMatrix4(l),nt.multiplyScalar(1/nt.w),rt.multiplyScalar(1/rt.w),nt.x*=o.x/2,nt.y*=o.y/2,rt.x*=o.x/2,rt.y*=o.y/2,ct.start.copy(nt),ct.start.z=0,ct.end.copy(rt),ct.end.z=0;const v=ct.closestPointToPointParameter(Ws,!0);ct.at(v,ad);const b=Bd.lerp(nt.z,rt.z,v),A=b>=-1&&b<=1,S=Ws.distanceTo(ad)<ur*.5;if(A&&S){ct.start.fromBufferAttribute(d,m),ct.end.fromBufferAttribute(f,m),ct.start.applyMatrix4(s),ct.end.applyMatrix4(s);const w=new G,x=new G;un.distanceSqToSegment(ct.start,ct.end,x,w),n.push({point:x,pointOnLine:w,distance:un.origin.distanceTo(x),object:i,face:null,faceIndex:m,uv:null,uv2:null})}}}class gf extends Hn{constructor(r=new Hl,n=new Gl({color:Math.random()*16777215})){super(r,n),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const r=this.geometry,n=r.attributes.instanceStart,l=r.attributes.instanceEnd,o=new Float32Array(2*n.count);for(let u=0,d=0,f=n.count;u<f;u++,d+=2)rd.fromBufferAttribute(n,u),id.fromBufferAttribute(l,u),o[d]=d===0?0:o[d-1],o[d+1]=o[d]+rd.distanceTo(id);const s=new pl(o,2,1);return r.setAttribute("instanceDistanceStart",new ar(s,1,0)),r.setAttribute("instanceDistanceEnd",new ar(s,1,1)),this}raycast(r,n){const l=this.material.worldUnits,o=r.camera;o===null&&!l&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=r.params.Line2!==void 0&&r.params.Line2.threshold||0;un=r.ray;const u=this.matrixWorld,d=this.geometry,f=this.material;ur=f.linewidth+s,wl=d.attributes.instanceStart,mf=d.attributes.instanceEnd,d.boundingSphere===null&&d.computeBoundingSphere(),Wa.copy(d.boundingSphere).applyMatrix4(u);let p;if(l)p=ur*.5;else{const g=Math.max(o.near,Wa.distanceToPoint(un.origin));p=od(o,g,f.resolution)}if(Wa.radius+=p,un.intersectsSphere(Wa)===!1)return;d.boundingBox===null&&d.computeBoundingBox(),Ya.copy(d.boundingBox).applyMatrix4(u);let m;if(l)m=ur*.5;else{const g=Math.max(o.near,Ya.distanceToPoint(un.origin));m=od(o,g,f.resolution)}Ya.expandByScalar(m),un.intersectsBox(Ya)!==!1&&(l?Mg(this,n):Lg(this,o,n))}}class Rg extends gf{constructor(r=new hf,n=new Gl({color:Math.random()*16777215})){super(r,n),this.isLine2=!0,this.type="Line2"}}const Cg="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Ig="generic-trigger";class kg{constructor(r=null,n=Cg){this.gltfLoader=r??new cf,this.path=n,this._assetCache={}}initializeControllerModel(r,n){return n.targetRayMode!=="tracked-pointer"||!n.gamepad?Promise.resolve():Sg(n,this.path,Ig).then(({profile:l,assetPath:o})=>{if(!o)throw new Error("no asset path");const s=new Pg(n,l,o);r.connectMotionController(s);const u=s.assetUrl,d=this._assetCache[u];if(d){const f=d.scene.clone();r.connectModel(f)}else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(u,f=>{if(!r.motionController){console.warn("motionController gone while gltf load, bailing...");return}this._assetCache[u]=f;const p=f.scene.clone();r.connectModel(p)},void 0,()=>{throw new Error(`Asset ${u} missing or malformed.`)})}}).catch(l=>{console.warn(l)})}}const sd=i=>"envMap"in i,ld=(i,r)=>{i.envMap=r,i.needsUpdate=!0},vf=(i,r)=>{r instanceof Hn&&(Array.isArray(r.material)?r.material.forEach(n=>sd(n)?ld(n,i):void 0):sd(r.material)&&ld(r.material,i))},ud=i=>"envMapIntensity"in i,cd=(i,r)=>{i.envMapIntensity=r,i.needsUpdate=!0},Sl=(i,r)=>{r instanceof Hn&&(Array.isArray(r.material)?r.material.forEach(n=>ud(n)?cd(n,i):void 0):ud(r.material)&&cd(r.material,i))};function zg(i,r){Object.values(i.components).forEach(n=>{const{type:l,touchPointNodeName:o,visualResponses:s}=n;if(l===Fe.ComponentType.TOUCHPAD&&o)if(n.touchPointNode=r.getObjectByName(o),n.touchPointNode){const u=new kh(.001),d=new ir({color:255}),f=new Hn(u,d);n.touchPointNode.add(f)}else console.warn(`Could not find touch dot, ${n.touchPointNodeName}, in touchpad component ${n.id}`);Object.values(s).forEach(u=>{const{valueNodeName:d,minNodeName:f,maxNodeName:p,valueNodeProperty:m}=u;if(m===Fe.VisualResponseProperty.TRANSFORM&&f&&p){if(u.minNode=r.getObjectByName(f),u.maxNode=r.getObjectByName(p),!u.minNode){console.warn(`Could not find ${f} in the model`);return}if(!u.maxNode){console.warn(`Could not find ${p} in the model`);return}}u.valueNode=r.getObjectByName(d),u.valueNode||console.warn(`Could not find ${d} in the model`)})})}function Ng(i,r){zg(i.motionController,r),(i.envMap||i.envMapIntensity!=null)&&r.traverse(n=>{i.envMap&&vf(i.envMap,n),i.envMapIntensity!=null&&Sl(i.envMapIntensity,n)}),i.add(r)}class jg extends or{constructor(){super(),this.motionController=null,this.envMap=null,this.envMapIntensity=1,this.scene=null}setEnvironmentMap(r,n=1){var l;return this.envMap===r&&this.envMapIntensity===n?this:(this.envMap=r,this.envMapIntensity=n,(l=this.scene)==null||l.traverse(o=>{vf(r,o),Sl(n,o)}),this)}setEnvironmentMapIntensity(r){var n;return this.envMapIntensity===r?this:(this.envMapIntensity=r,(n=this.scene)==null||n.traverse(l=>Sl(r,l)),this)}connectModel(r){if(!this.motionController){console.warn("scene tried to add, but no motion controller");return}this.scene=r,Ng(this,r),this.dispatchEvent({type:"modelconnected",data:r})}connectMotionController(r){this.motionController=r,this.dispatchEvent({type:"motionconnected",data:r})}updateMatrixWorld(r){super.updateMatrixWorld(r),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(n=>{Object.values(n.visualResponses).forEach(l=>{const{valueNode:o,minNode:s,maxNode:u,value:d,valueNodeProperty:f}=l;o&&(f===Fe.VisualResponseProperty.VISIBILITY&&typeof d=="boolean"?o.visible=d:f===Fe.VisualResponseProperty.TRANSFORM&&s&&u&&typeof d=="number"&&(o.quaternion.slerpQuaternions(s.quaternion,u.quaternion,d),o.position.lerpVectors(s.position,u.position,d)))})}))}disconnect(){this.dispatchEvent({type:"motiondisconnected",data:this.motionController}),this.dispatchEvent({type:"modeldisconnected",data:this.scene}),this.motionController=null,this.scene&&this.remove(this.scene),this.scene=null}dispose(){this.disconnect()}}const Bg=I.forwardRef(function({target:i,hideOnBlur:r=!1,...n},l){const o=He(d=>d.hoverState),s=I.useRef(null),u=I.useMemo(()=>new kl().setFromPoints([new G(0,0,0),new G(0,0,-1)]),[]);return I.useImperativeHandle(l,()=>s.current),dr(()=>{if(!i.inputSource)return;let d=1;const f=o[i.inputSource.handedness].values().next().value;f&&i.inputSource.handedness!=="none"?(d=f.distance,r&&(s.current.visible=!1)):r&&(s.current.visible=!0);const p=-.01;s.current.scale.z=d+p}),I.createElement("line",{ref:s,geometry:u,"material-opacity":.8,"material-transparent":!0,...n})}),Og=new kg,Dg=({target:i,envMap:r,envMapIntensity:n})=>{const l=I.useRef(null),o=cn(f=>{r!=null&&f.setEnvironmentMap(r)}),s=cn(f=>f.setEnvironmentMap(null)),u=cn(f=>{n!=null&&f.setEnvironmentMapIntensity(n)}),d=I.useCallback(f=>{var p,m,g;if(l.current=f,f){if(i.xrControllerModel=f,(p=i.inputSource)!=null&&p.hand)return;o.current(f),u.current(f),i.inputSource?Og.initializeControllerModel(f,i.inputSource):console.warn("no input source on XRController when handleControllerModel")}else{if((m=i.inputSource)!=null&&m.hand)return;(g=i.xrControllerModel)==null||g.disconnect(),i.xrControllerModel=null}},[i,u,o]);return I.useLayoutEffect(()=>{l.current&&(r?o.current(l.current):s.current(l.current))},[r,o,s]),I.useLayoutEffect(()=>{l.current&&u.current(l.current)},[n,u]),I.createElement("xRControllerModel",{ref:d})};function Ug({rayMaterial:i={},hideRaysOnBlur:r=!1,envMap:n,envMapIntensity:l}){const o=He(d=>d.controllers),s=He(d=>d.isHandTracking),u=I.useMemo(()=>Object.entries(i).reduce((d,[f,p])=>({...d,[`material-${f}`]:p}),{}),[JSON.stringify(i)]);return I.useMemo(()=>Bl({XRControllerModel:jg}),[]),I.createElement(I.Fragment,null,o.map((d,f)=>I.createElement(I.Fragment,{key:f},vl(I.createElement(Dg,{target:d,envMap:n,envMapIntensity:l}),d.grip),vl(I.createElement(Bg,{visible:!s,hideOnBlur:r,target:d,...u}),d.controller))))}const Fg="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class Hg{constructor(r,n,l=Fg,o,s){this.controller=n,this.handModel=r,this.bones=[];const u=new cf;s||u.setPath(l),u.load(s??`${o}.glb`,d=>{const f=d.scene.children[0];this.handModel.add(f),this.scene=f;const p=f.getObjectByProperty("type","SkinnedMesh");p.frustumCulled=!1,p.castShadow=!0,p.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(m=>{const g=f.getObjectByName(m);g!==void 0?g.jointName=m:console.warn(`Couldn't find ${m} in ${o} hand mesh`),this.bones.push(g)})})}updateMesh(){const r=this.controller.joints;let n=!0;for(let l=0;l<this.bones.length;l++){const o=this.bones[l];if(o){const s=r[o.jointName];if(s.visible){const u=s.position;o.position.copy(u),o.quaternion.copy(s.quaternion),n=!1}}}n&&this.scene?this.scene.visible=!1:this.scene&&(this.scene.visible=!0)}dispose(){this.scene&&this.handModel.remove(this.scene)}}const Gg=.01,Vg="index-finger-tip";class Kg extends Nl{constructor(r,n,l){super(),this._onConnected=o=>{const s=o.data;s.hand&&!this.motionController&&(this.xrInputSource=s,this.motionController=new Hg(this,this.controller,void 0,s.handedness,s.handedness==="left"?this.leftModelPath:this.rightModelPath))},this._onDisconnected=()=>{var o;(o=this.xrInputSource)!=null&&o.hand&&this.motionControllerCleanup()},this.controller=r,this.motionController=null,this.envMap=null,this.leftModelPath=n,this.rightModelPath=l,this.mesh=null,this.xrInputSource=null,r.addEventListener("connected",this._onConnected),r.addEventListener("disconnected",this._onDisconnected)}motionControllerCleanup(){var r;this.clear(),(r=this.motionController)==null||r.dispose(),this.motionController=null}updateMatrixWorld(r){super.updateMatrixWorld(r),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const r=this.controller.joints[Vg];return r?r.position:null}intersectBoxObject(r){const n=this.getPointerPosition();if(n){const l=new Zr(n,Gg),o=new Qe().setFromObject(r);return l.intersectsBox(o)}else return!1}checkButton(r){this.intersectBoxObject(r)?r.onPress():r.onClear(),r.isPressed()&&r.whilePressed()}dispose(){this.motionControllerCleanup(),this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}function Yg({modelLeft:i,modelRight:r}){const n=He(l=>l.controllers);return I.useMemo(()=>Bl({OculusHandModel:Kg}),[]),Ft(()=>{for(const l of n)l.hand.dispatchEvent({type:"connected",data:l.inputSource,fake:!0})},[n,i,r]),I.createElement(I.Fragment,null,n.map(({hand:l})=>vl(I.createElement("oculusHandModel",{args:[l,i,r]}),l)))}const Wg=I.forwardRef(function({points:i,color:r=16777215,vertexColors:n,linewidth:l,lineWidth:o,segments:s,dashed:u,...d},f){var p;const m=it(S=>S.size),g=I.useMemo(()=>s?new gf:new Rg,[s]),[v]=I.useState(()=>new Gl),b=(n==null||(p=n[0])==null?void 0:p.length)===4?4:3,A=I.useMemo(()=>{const S=s?new Hl:new hf,w=i.map(x=>{const _=Array.isArray(x);return x instanceof G||x instanceof Di?[x.x,x.y,x.z]:x instanceof be?[x.x,x.y,0]:_&&x.length===3?[x[0],x[1],x[2]]:_&&x.length===2?[x[0],x[1],0]:x});if(S.setPositions(w.flat()),n){r=16777215;const x=n.map(_=>_ instanceof xn?_.toArray():_);S.setColors(x.flat(),b)}return S},[i,s,n,b]);return I.useLayoutEffect(()=>{g.computeLineDistances()},[i,g]),I.useLayoutEffect(()=>{u?v.defines.USE_DASH="":delete v.defines.USE_DASH,v.needsUpdate=!0},[u,v]),I.useEffect(()=>()=>A.dispose(),[A]),I.createElement("primitive",Gn({object:g,ref:f},d),I.createElement("primitive",{object:A,attach:"geometry"}),I.createElement("primitive",Gn({object:v,attach:"material",color:r,vertexColors:!!n,resolution:[m.width,m.height],linewidth:l??o,dashed:u,transparent:b===4},d)))}),yf=I.forwardRef(({sdfGlyphSize:i=64,anchorX:r="center",anchorY:n="middle",font:l,fontSize:o=1,children:s,characters:u,onSync:d,...f},p)=>{const{Text:m,preloadFont:g}=zc(async()=>_h(()=>import("./troika-three-text.esm-dffc428b-CxAbcxt8.js"),__vite__mapDeps([0,1,2]),import.meta.url),[]),v=it(({invalidate:w})=>w),[b]=I.useState(()=>new m),[A,S]=I.useMemo(()=>{const w=[];let x="";return I.Children.forEach(s,_=>{typeof _=="string"||typeof _=="number"?x+=_:w.push(_)}),[w,x]},[s]);return zc(()=>new Promise(w=>g({font:l,characters:u},w)),["troika-text",l,u]),I.useLayoutEffect(()=>void b.sync(()=>{v(),d&&d(b)})),I.useEffect(()=>()=>b.dispose(),[b]),I.createElement("primitive",Gn({object:b,ref:p,font:l,text:S,anchorX:r,anchorY:n,fontSize:o,sdfGlyphSize:i},f),A)}),Qg=I.forwardRef(({makeDefault:i,camera:r,regress:n,domElement:l,enableDamping:o=!0,keyEvents:s=!1,onChange:u,onStart:d,onEnd:f,...p},m)=>{const g=it(L=>L.invalidate),v=it(L=>L.camera),b=it(L=>L.gl),A=it(L=>L.events),S=it(L=>L.setEvents),w=it(L=>L.set),x=it(L=>L.get),_=it(L=>L.performance),E=r||v,P=l||A.connected||b.domElement,M=I.useMemo(()=>new Um(E),[E]);return dr(()=>{M.enabled&&M.update()},-1),I.useEffect(()=>(s&&M.connect(s===!0?P:s),M.connect(P),()=>void M.dispose()),[s,P,n,M,g]),I.useEffect(()=>{const L=z=>{g(),n&&_.regress(),u&&u(z)},R=z=>{d&&d(z)},N=z=>{f&&f(z)};return M.addEventListener("change",L),M.addEventListener("start",R),M.addEventListener("end",N),()=>{M.removeEventListener("start",R),M.removeEventListener("end",N),M.removeEventListener("change",L)}},[u,d,f,M,g,S]),I.useEffect(()=>{if(i){const L=x().controls;return w({controls:M}),()=>w({controls:L})}},[i,M]),I.createElement("primitive",Gn({ref:m,object:M,enableDamping:o},p))}),bf=0,qg=1,xf=2,dd=2,qs=1.25,fd=1,ji=6*4+4+4,vo=65535,Xg=Math.pow(2,-24),Xs=Symbol("SKIP_GENERATION");function Zg(i){return i.index?i.index.count:i.attributes.position.count}function $r(i){return Zg(i)/3}function $g(i,r=ArrayBuffer){return i>65535?new Uint32Array(new r(4*i)):new Uint16Array(new r(2*i))}function Jg(i,r){if(!i.index){const n=i.attributes.position.count,l=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,o=$g(n,l);i.setIndex(new Ni(o,1));for(let s=0;s<n;s++)o[s]=s}}function wf(i){const r=$r(i),n=i.drawRange,l=n.start/3,o=(n.start+n.count)/3,s=Math.max(0,l),u=Math.min(r,o)-s;return[{offset:Math.floor(s),count:Math.floor(u)}]}function Sf(i){if(!i.groups||!i.groups.length)return wf(i);const r=[],n=new Set,l=i.drawRange,o=l.start/3,s=(l.start+l.count)/3;for(const d of i.groups){const f=d.start/3,p=(d.start+d.count)/3;n.add(Math.max(o,f)),n.add(Math.min(s,p))}const u=Array.from(n.values()).sort((d,f)=>d-f);for(let d=0;d<u.length-1;d++){const f=u[d],p=u[d+1];r.push({offset:Math.floor(f),count:Math.floor(p-f)})}return r}function e0(i){if(i.groups.length===0)return!1;const r=$r(i),n=Sf(i).sort((s,u)=>s.offset-u.offset),l=n[n.length-1];l.count=Math.min(r-l.offset,l.count);let o=0;return n.forEach(({count:s})=>o+=s),r!==o}function Zs(i,r,n,l,o){let s=1/0,u=1/0,d=1/0,f=-1/0,p=-1/0,m=-1/0,g=1/0,v=1/0,b=1/0,A=-1/0,S=-1/0,w=-1/0;for(let x=r*6,_=(r+n)*6;x<_;x+=6){const E=i[x+0],P=i[x+1],M=E-P,L=E+P;M<s&&(s=M),L>f&&(f=L),E<g&&(g=E),E>A&&(A=E);const R=i[x+2],N=i[x+3],z=R-N,D=R+N;z<u&&(u=z),D>p&&(p=D),R<v&&(v=R),R>S&&(S=R);const B=i[x+4],F=i[x+5],Y=B-F,$=B+F;Y<d&&(d=Y),$>m&&(m=$),B<b&&(b=B),B>w&&(w=B)}l[0]=s,l[1]=u,l[2]=d,l[3]=f,l[4]=p,l[5]=m,o[0]=g,o[1]=v,o[2]=b,o[3]=A,o[4]=S,o[5]=w}function t0(i,r=null,n=null,l=null){const o=i.attributes.position,s=i.index?i.index.array:null,u=$r(i),d=o.normalized;let f;r===null?(f=new Float32Array(u*6*4),n=0,l=u):(f=r,n=n||0,l=l||u);const p=o.array,m=o.offset||0;let g=3;o.isInterleavedBufferAttribute&&(g=o.data.stride);const v=["getX","getY","getZ"];for(let b=n;b<n+l;b++){const A=b*3,S=b*6;let w=A+0,x=A+1,_=A+2;s&&(w=s[w],x=s[x],_=s[_]),d||(w=w*g+m,x=x*g+m,_=_*g+m);for(let E=0;E<3;E++){let P,M,L;d?(P=o[v[E]](w),M=o[v[E]](x),L=o[v[E]](_)):(P=p[w+E],M=p[x+E],L=p[_+E]);let R=P;M<R&&(R=M),L<R&&(R=L);let N=P;M>N&&(N=M),L>N&&(N=L);const z=(N-R)/2,D=E*2;f[S+D+0]=R+z,f[S+D+1]=z+(Math.abs(R)+z)*Xg}}return f}function De(i,r,n){return n.min.x=r[i],n.min.y=r[i+1],n.min.z=r[i+2],n.max.x=r[i+3],n.max.y=r[i+4],n.max.z=r[i+5],n}function pd(i){let r=-1,n=-1/0;for(let l=0;l<3;l++){const o=i[l+3]-i[l];o>n&&(n=o,r=l)}return r}function hd(i,r){r.set(i)}function md(i,r,n){let l,o;for(let s=0;s<3;s++){const u=s+3;l=i[s],o=r[s],n[s]=l<o?l:o,l=i[u],o=r[u],n[u]=l>o?l:o}}function Qa(i,r,n){for(let l=0;l<3;l++){const o=r[i+2*l],s=r[i+2*l+1],u=o-s,d=o+s;u<n[l]&&(n[l]=u),d>n[l+3]&&(n[l+3]=d)}}function Pi(i){const r=i[3]-i[0],n=i[4]-i[1],l=i[5]-i[2];return 2*(r*n+n*l+l*r)}const bn=32,n0=(i,r)=>i.candidate-r.candidate,On=new Array(bn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),qa=new Float32Array(6);function r0(i,r,n,l,o,s){let u=-1,d=0;if(s===bf)u=pd(r),u!==-1&&(d=(r[u]+r[u+3])/2);else if(s===qg)u=pd(i),u!==-1&&(d=i0(n,l,o,u));else if(s===xf){const f=Pi(i);let p=qs*o;const m=l*6,g=(l+o)*6;for(let v=0;v<3;v++){const b=r[v],A=(r[v+3]-b)/bn;if(o<bn/4){const S=[...On];S.length=o;let w=0;for(let _=m;_<g;_+=6,w++){const E=S[w];E.candidate=n[_+2*v],E.count=0;const{bounds:P,leftCacheBounds:M,rightCacheBounds:L}=E;for(let R=0;R<3;R++)L[R]=1/0,L[R+3]=-1/0,M[R]=1/0,M[R+3]=-1/0,P[R]=1/0,P[R+3]=-1/0;Qa(_,n,P)}S.sort(n0);let x=o;for(let _=0;_<x;_++){const E=S[_];for(;_+1<x&&S[_+1].candidate===E.candidate;)S.splice(_+1,1),x--}for(let _=m;_<g;_+=6){const E=n[_+2*v];for(let P=0;P<x;P++){const M=S[P];E>=M.candidate?Qa(_,n,M.rightCacheBounds):(Qa(_,n,M.leftCacheBounds),M.count++)}}for(let _=0;_<x;_++){const E=S[_],P=E.count,M=o-E.count,L=E.leftCacheBounds,R=E.rightCacheBounds;let N=0;P!==0&&(N=Pi(L)/f);let z=0;M!==0&&(z=Pi(R)/f);const D=fd+qs*(N*P+z*M);D<p&&(u=v,p=D,d=E.candidate)}}else{for(let x=0;x<bn;x++){const _=On[x];_.count=0,_.candidate=b+A+x*A;const E=_.bounds;for(let P=0;P<3;P++)E[P]=1/0,E[P+3]=-1/0}for(let x=m;x<g;x+=6){let _=~~((n[x+2*v]-b)/A);_>=bn&&(_=bn-1);const E=On[_];E.count++,Qa(x,n,E.bounds)}const S=On[bn-1];hd(S.bounds,S.rightCacheBounds);for(let x=bn-2;x>=0;x--){const _=On[x],E=On[x+1];md(_.bounds,E.rightCacheBounds,_.rightCacheBounds)}let w=0;for(let x=0;x<bn-1;x++){const _=On[x],E=_.count,P=_.bounds,M=On[x+1].rightCacheBounds;E!==0&&(w===0?hd(P,qa):md(P,qa,qa)),w+=E;let L=0,R=0;w!==0&&(L=Pi(qa)/f);const N=o-w;N!==0&&(R=Pi(M)/f);const z=fd+qs*(L*w+R*N);z<p&&(u=v,p=z,d=_.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:u,pos:d}}function i0(i,r,n,l){let o=0;for(let s=r,u=r+n;s<u;s++)o+=i[s*6+l*2];return o/n}class $s{constructor(){this.boundingData=new Float32Array(6)}}function a0(i,r,n,l,o,s){let u=l,d=l+o-1;const f=s.pos,p=s.axis*2;for(;;){for(;u<=d&&n[u*6+p]<f;)u++;for(;u<=d&&n[d*6+p]>=f;)d--;if(u<d){for(let m=0;m<3;m++){let g=r[u*3+m];r[u*3+m]=r[d*3+m],r[d*3+m]=g}for(let m=0;m<6;m++){let g=n[u*6+m];n[u*6+m]=n[d*6+m],n[d*6+m]=g}u++,d--}else return u}}function o0(i,r,n,l,o,s){let u=l,d=l+o-1;const f=s.pos,p=s.axis*2;for(;;){for(;u<=d&&n[u*6+p]<f;)u++;for(;u<=d&&n[d*6+p]>=f;)d--;if(u<d){let m=i[u];i[u]=i[d],i[d]=m;for(let g=0;g<6;g++){let v=n[u*6+g];n[u*6+g]=n[d*6+g],n[d*6+g]=v}u++,d--}else return u}}function wt(i,r){return r[i+15]===65535}function Mt(i,r){return r[i+6]}function Ht(i,r){return r[i+14]}function Gt(i){return i+8}function Vt(i,r){return r[i+6]}function _f(i,r){return r[i+7]}let Ef,zi,fo,Af;const s0=Math.pow(2,32);function _l(i){return"count"in i?1:1+_l(i.left)+_l(i.right)}function l0(i,r,n){return Ef=new Float32Array(n),zi=new Uint32Array(n),fo=new Uint16Array(n),Af=new Uint8Array(n),El(i,r)}function El(i,r){const n=i/4,l=i/2,o="count"in r,s=r.boundingData;for(let u=0;u<6;u++)Ef[n+u]=s[u];if(o)if(r.buffer){const u=r.buffer;Af.set(new Uint8Array(u),i);for(let d=i,f=i+u.byteLength;d<f;d+=ji){const p=d/2;wt(p,fo)||(zi[d/4+6]+=n)}return i+u.byteLength}else{const u=r.offset,d=r.count;return zi[n+6]=u,fo[l+14]=d,fo[l+15]=vo,i+ji}else{const u=r.left,d=r.right,f=r.splitAxis;let p;if(p=El(i+ji,u),p/4>s0)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return zi[n+6]=p/4,p=El(p,d),zi[n+7]=f,p}}function u0(i,r){const n=(i.index?i.index.count:i.attributes.position.count)/3,l=n>2**16,o=l?4:2,s=r?new SharedArrayBuffer(n*o):new ArrayBuffer(n*o),u=l?new Uint32Array(s):new Uint16Array(s);for(let d=0,f=u.length;d<f;d++)u[d]=d;return u}function c0(i,r,n,l,o){const{maxDepth:s,verbose:u,maxLeafTris:d,strategy:f,onProgress:p,indirect:m}=o,g=i._indirectBuffer,v=i.geometry,b=v.index?v.index.array:null,A=m?o0:a0,S=$r(v),w=new Float32Array(6);let x=!1;const _=new $s;return Zs(r,n,l,_.boundingData,w),P(_,n,l,w),_;function E(M){p&&p(M/S)}function P(M,L,R,N=null,z=0){if(!x&&z>=s&&(x=!0,u&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(v))),R<=d||z>=s)return E(L+R),M.offset=L,M.count=R,M;const D=r0(M.boundingData,N,r,L,R,f);if(D.axis===-1)return E(L+R),M.offset=L,M.count=R,M;const B=A(g,b,r,L,R,D);if(B===L||B===L+R)E(L+R),M.offset=L,M.count=R;else{M.splitAxis=D.axis;const F=new $s,Y=L,$=B-L;M.left=F,Zs(r,Y,$,F.boundingData,w),P(F,Y,$,w,z+1);const le=new $s,fe=B,ve=R-$;M.right=le,Zs(r,fe,ve,le.boundingData,w),P(le,fe,ve,w,z+1)}return M}}function d0(i,r){const n=i.geometry;r.indirect&&(i._indirectBuffer=u0(n,r.useSharedArrayBuffer),e0(n)&&!r.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),i._indirectBuffer||Jg(n,r);const l=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,o=t0(n),s=r.indirect?wf(n):Sf(n);i._roots=s.map(u=>{const d=c0(i,o,u.offset,u.count,r),f=_l(d),p=new l(ji*f);return l0(0,d,p),p})}class wn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(r,n){let l=1/0,o=-1/0;for(let s=0,u=r.length;s<u;s++){const d=r[s][n];l=d<l?d:l,o=d>o?d:o}this.min=l,this.max=o}setFromPoints(r,n){let l=1/0,o=-1/0;for(let s=0,u=n.length;s<u;s++){const d=n[s],f=r.dot(d);l=f<l?f:l,o=f>o?f:o}this.min=l,this.max=o}isSeparated(r){return this.min>r.max||r.min>this.max}}wn.prototype.setFromBox=function(){const i=new G;return function(r,n){const l=n.min,o=n.max;let s=1/0,u=-1/0;for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)for(let p=0;p<=1;p++){i.x=l.x*d+o.x*(1-d),i.y=l.y*f+o.y*(1-f),i.z=l.z*p+o.z*(1-p);const m=r.dot(i);s=Math.min(m,s),u=Math.max(m,u)}this.min=s,this.max=u}}();const f0=function(){const i=new G,r=new G,n=new G;return function(l,o,s){const u=l.start,d=i,f=o.start,p=r;n.subVectors(u,f),i.subVectors(l.end,l.start),r.subVectors(o.end,o.start);const m=n.dot(p),g=p.dot(d),v=p.dot(p),b=n.dot(d),A=d.dot(d)*v-g*g;let S,w;A!==0?S=(m*g-b*v)/A:S=0,w=(m+S*g)/v,s.x=S,s.y=w}}(),Vl=function(){const i=new be,r=new G,n=new G;return function(l,o,s,u){f0(l,o,i);let d=i.x,f=i.y;if(d>=0&&d<=1&&f>=0&&f<=1){l.at(d,s),o.at(f,u);return}else if(d>=0&&d<=1){f<0?o.at(0,u):o.at(1,u),l.closestPointToPoint(u,!0,s);return}else if(f>=0&&f<=1){d<0?l.at(0,s):l.at(1,s),o.closestPointToPoint(s,!0,u);return}else{let p;d<0?p=l.start:p=l.end;let m;f<0?m=o.start:m=o.end;const g=r,v=n;if(l.closestPointToPoint(m,!0,r),o.closestPointToPoint(p,!0,n),g.distanceToSquared(m)<=v.distanceToSquared(p)){s.copy(g),u.copy(m);return}else{s.copy(p),u.copy(v);return}}}}(),p0=function(){const i=new G,r=new G,n=new Il,l=new dn;return function(o,s){const{radius:u,center:d}=o,{a:f,b:p,c:m}=s;if(l.start=f,l.end=p,l.closestPointToPoint(d,!0,i).distanceTo(d)<=u||(l.start=f,l.end=m,l.closestPointToPoint(d,!0,i).distanceTo(d)<=u)||(l.start=p,l.end=m,l.closestPointToPoint(d,!0,i).distanceTo(d)<=u))return!0;const g=s.getPlane(n);if(Math.abs(g.distanceToPoint(d))<=u){const v=g.projectPoint(d,r);if(s.containsPoint(v))return!0}return!1}}(),h0=1e-15;function Js(i){return Math.abs(i)<h0}class $t extends ki{constructor(...r){super(...r),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new G),this.satBounds=new Array(4).fill().map(()=>new wn),this.points=[this.a,this.b,this.c],this.sphere=new Zr,this.plane=new Il,this.needsUpdate=!0}intersectsSphere(r){return p0(r,this)}update(){const r=this.a,n=this.b,l=this.c,o=this.points,s=this.satAxes,u=this.satBounds,d=s[0],f=u[0];this.getNormal(d),f.setFromPoints(d,o);const p=s[1],m=u[1];p.subVectors(r,n),m.setFromPoints(p,o);const g=s[2],v=u[2];g.subVectors(n,l),v.setFromPoints(g,o);const b=s[3],A=u[3];b.subVectors(l,r),A.setFromPoints(b,o),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(d,r),this.needsUpdate=!1}}$t.prototype.closestPointToSegment=function(){const i=new G,r=new G,n=new dn;return function(l,o=null,s=null){const{start:u,end:d}=l,f=this.points;let p,m=1/0;for(let g=0;g<3;g++){const v=(g+1)%3;n.start.copy(f[g]),n.end.copy(f[v]),Vl(n,l,i,r),p=i.distanceToSquared(r),p<m&&(m=p,o&&o.copy(i),s&&s.copy(r))}return this.closestPointToPoint(u,i),p=u.distanceToSquared(i),p<m&&(m=p,o&&o.copy(i),s&&s.copy(u)),this.closestPointToPoint(d,i),p=d.distanceToSquared(i),p<m&&(m=p,o&&o.copy(i),s&&s.copy(d)),Math.sqrt(m)}}();$t.prototype.intersectsTriangle=function(){const i=new $t,r=new Array(3),n=new Array(3),l=new wn,o=new wn,s=new G,u=new G,d=new G,f=new G,p=new G,m=new dn,g=new dn,v=new dn,b=new G;function A(S,w,x){const _=S.points;let E=0,P=-1;for(let M=0;M<3;M++){const{start:L,end:R}=m;L.copy(_[M]),R.copy(_[(M+1)%3]),m.delta(u);const N=Js(w.distanceToPoint(L));if(Js(w.normal.dot(u))&&N){x.copy(m),E=2;break}const z=w.intersectLine(m,b);if(!z&&N&&b.copy(L),(z||N)&&!Js(b.distanceTo(R))){if(E<=1)(E===1?x.start:x.end).copy(b),N&&(P=E);else if(E>=2){(P===1?x.start:x.end).copy(b),E=2;break}if(E++,E===2&&P===-1)break}}return E}return function(S,w=null,x=!1){this.needsUpdate&&this.update(),S.isExtendedTriangle?S.needsUpdate&&S.update():(i.copy(S),i.update(),S=i);const _=this.plane,E=S.plane;if(Math.abs(_.normal.dot(E.normal))>1-1e-10){const P=this.satBounds,M=this.satAxes;n[0]=S.a,n[1]=S.b,n[2]=S.c;for(let N=0;N<4;N++){const z=P[N],D=M[N];if(l.setFromPoints(D,n),z.isSeparated(l))return!1}const L=S.satBounds,R=S.satAxes;r[0]=this.a,r[1]=this.b,r[2]=this.c;for(let N=0;N<4;N++){const z=L[N],D=R[N];if(l.setFromPoints(D,r),z.isSeparated(l))return!1}for(let N=0;N<4;N++){const z=M[N];for(let D=0;D<4;D++){const B=R[D];if(s.crossVectors(z,B),l.setFromPoints(s,r),o.setFromPoints(s,n),l.isSeparated(o))return!1}}return w&&(x||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),w.start.set(0,0,0),w.end.set(0,0,0)),!0}else{const P=A(this,E,g);if(P===1&&S.containsPoint(g.end))return w&&(w.start.copy(g.end),w.end.copy(g.end)),!0;if(P!==2)return!1;const M=A(S,_,v);if(M===1&&this.containsPoint(v.end))return w&&(w.start.copy(v.end),w.end.copy(v.end)),!0;if(M!==2)return!1;if(g.delta(d),v.delta(f),d.dot(f)<0){let F=v.start;v.start=v.end,v.end=F}const L=g.start.dot(d),R=g.end.dot(d),N=v.start.dot(d),z=v.end.dot(d),D=R<N,B=L<z;return L!==z&&N!==R&&D===B?!1:(w&&(p.subVectors(g.start,v.start),p.dot(d)>0?w.start.copy(g.start):w.start.copy(v.start),p.subVectors(g.end,v.end),p.dot(d)<0?w.end.copy(g.end):w.end.copy(v.end)),!0)}}}();$t.prototype.distanceToPoint=function(){const i=new G;return function(r){return this.closestPointToPoint(r,i),r.distanceTo(i)}}();$t.prototype.distanceToTriangle=function(){const i=new G,r=new G,n=["a","b","c"],l=new dn,o=new dn;return function(s,u=null,d=null){const f=u||d?l:null;if(this.intersectsTriangle(s,f))return(u||d)&&(u&&f.getCenter(u),d&&f.getCenter(d)),0;let p=1/0;for(let m=0;m<3;m++){let g;const v=n[m],b=s[v];this.closestPointToPoint(b,i),g=b.distanceToSquared(i),g<p&&(p=g,u&&u.copy(i),d&&d.copy(b));const A=this[v];s.closestPointToPoint(A,i),g=A.distanceToSquared(i),g<p&&(p=g,u&&u.copy(A),d&&d.copy(i))}for(let m=0;m<3;m++){const g=n[m],v=n[(m+1)%3];l.set(this[g],this[v]);for(let b=0;b<3;b++){const A=n[b],S=n[(b+1)%3];o.set(s[A],s[S]),Vl(l,o,i,r);const w=i.distanceToSquared(r);w<p&&(p=w,u&&u.copy(i),d&&d.copy(r))}}return Math.sqrt(p)}}();class mt{constructor(r,n,l){this.isOrientedBox=!0,this.min=new G,this.max=new G,this.matrix=new Je,this.invMatrix=new Je,this.points=new Array(8).fill().map(()=>new G),this.satAxes=new Array(3).fill().map(()=>new G),this.satBounds=new Array(3).fill().map(()=>new wn),this.alignedSatBounds=new Array(3).fill().map(()=>new wn),this.needsUpdate=!1,r&&this.min.copy(r),n&&this.max.copy(n),l&&this.matrix.copy(l)}set(r,n,l){this.min.copy(r),this.max.copy(n),this.matrix.copy(l),this.needsUpdate=!0}copy(r){this.min.copy(r.min),this.max.copy(r.max),this.matrix.copy(r.matrix),this.needsUpdate=!0}}mt.prototype.update=function(){return function(){const i=this.matrix,r=this.min,n=this.max,l=this.points;for(let f=0;f<=1;f++)for(let p=0;p<=1;p++)for(let m=0;m<=1;m++){const g=1*f|2*p|4*m,v=l[g];v.x=f?n.x:r.x,v.y=p?n.y:r.y,v.z=m?n.z:r.z,v.applyMatrix4(i)}const o=this.satBounds,s=this.satAxes,u=l[0];for(let f=0;f<3;f++){const p=s[f],m=o[f],g=1<<f,v=l[g];p.subVectors(u,v),m.setFromPoints(p,l)}const d=this.alignedSatBounds;d[0].setFromPointsField(l,"x"),d[1].setFromPointsField(l,"y"),d[2].setFromPointsField(l,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();mt.prototype.intersectsBox=function(){const i=new wn;return function(r){this.needsUpdate&&this.update();const n=r.min,l=r.max,o=this.satBounds,s=this.satAxes,u=this.alignedSatBounds;if(i.min=n.x,i.max=l.x,u[0].isSeparated(i)||(i.min=n.y,i.max=l.y,u[1].isSeparated(i))||(i.min=n.z,i.max=l.z,u[2].isSeparated(i)))return!1;for(let d=0;d<3;d++){const f=s[d],p=o[d];if(i.setFromBox(f,r),p.isSeparated(i))return!1}return!0}}();mt.prototype.intersectsTriangle=function(){const i=new $t,r=new Array(3),n=new wn,l=new wn,o=new G;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(i.copy(s),i.update(),s=i);const u=this.satBounds,d=this.satAxes;r[0]=s.a,r[1]=s.b,r[2]=s.c;for(let g=0;g<3;g++){const v=u[g],b=d[g];if(n.setFromPoints(b,r),v.isSeparated(n))return!1}const f=s.satBounds,p=s.satAxes,m=this.points;for(let g=0;g<3;g++){const v=f[g],b=p[g];if(n.setFromPoints(b,m),v.isSeparated(n))return!1}for(let g=0;g<3;g++){const v=d[g];for(let b=0;b<4;b++){const A=p[b];if(o.crossVectors(v,A),n.setFromPoints(o,r),l.setFromPoints(o,m),n.isSeparated(l))return!1}}return!0}}();mt.prototype.closestPointToPoint=function(){return function(i,r){return this.needsUpdate&&this.update(),r.copy(i).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),r}}();mt.prototype.distanceToPoint=function(){const i=new G;return function(r){return this.closestPointToPoint(r,i),r.distanceTo(i)}}();mt.prototype.distanceToBox=function(){const i=["x","y","z"],r=new Array(12).fill().map(()=>new dn),n=new Array(12).fill().map(()=>new dn),l=new G,o=new G;return function(s,u=0,d=null,f=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(d||f)&&(s.getCenter(o),this.closestPointToPoint(o,l),s.closestPointToPoint(l,o),d&&d.copy(l),f&&f.copy(o)),0;const p=u*u,m=s.min,g=s.max,v=this.points;let b=1/0;for(let S=0;S<8;S++){const w=v[S];o.copy(w).clamp(m,g);const x=w.distanceToSquared(o);if(x<b&&(b=x,d&&d.copy(w),f&&f.copy(o),x<p))return Math.sqrt(x)}let A=0;for(let S=0;S<3;S++)for(let w=0;w<=1;w++)for(let x=0;x<=1;x++){const _=(S+1)%3,E=(S+2)%3,P=w<<_|x<<E,M=1<<S|w<<_|x<<E,L=v[P],R=v[M];r[A].set(L,R);const N=i[S],z=i[_],D=i[E],B=n[A],F=B.start,Y=B.end;F[N]=m[N],F[z]=w?m[z]:g[z],F[D]=x?m[D]:g[z],Y[N]=g[N],Y[z]=w?m[z]:g[z],Y[D]=x?m[D]:g[z],A++}for(let S=0;S<=1;S++)for(let w=0;w<=1;w++)for(let x=0;x<=1;x++){o.x=S?g.x:m.x,o.y=w?g.y:m.y,o.z=x?g.z:m.z,this.closestPointToPoint(o,l);const _=o.distanceToSquared(l);if(_<b&&(b=_,d&&d.copy(l),f&&f.copy(o),_<p))return Math.sqrt(_)}for(let S=0;S<12;S++){const w=r[S];for(let x=0;x<12;x++){const _=n[x];Vl(w,_,l,o);const E=l.distanceToSquared(o);if(E<b&&(b=E,d&&d.copy(l),f&&f.copy(o),E<p))return Math.sqrt(E)}}return Math.sqrt(b)}}();class Kl{constructor(r){this._getNewPrimitive=r,this._primitives=[]}getPrimitive(){const r=this._primitives;return r.length===0?this._getNewPrimitive():r.pop()}releasePrimitive(r){this._primitives.push(r)}}class m0 extends Kl{constructor(){super(()=>new $t)}}const Kt=new m0;class g0{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const r=[];let n=null;this.setBuffer=l=>{n&&r.push(n),n=l,this.float32Array=new Float32Array(l),this.uint16Array=new Uint16Array(l),this.uint32Array=new Uint32Array(l)},this.clearBuffer=()=>{n=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,r.length!==0&&this.setBuffer(r.pop())}}}const Ie=new g0;let Fn,Wr;const Ir=[],Xa=new Kl(()=>new Qe);function v0(i,r,n,l,o,s){Fn=Xa.getPrimitive(),Wr=Xa.getPrimitive(),Ir.push(Fn,Wr),Ie.setBuffer(i._roots[r]);const u=Al(0,i.geometry,n,l,o,s);Ie.clearBuffer(),Xa.releasePrimitive(Fn),Xa.releasePrimitive(Wr),Ir.pop(),Ir.pop();const d=Ir.length;return d>0&&(Wr=Ir[d-1],Fn=Ir[d-2]),u}function Al(i,r,n,l,o=null,s=0,u=0){const{float32Array:d,uint16Array:f,uint32Array:p}=Ie;let m=i*2;if(wt(m,f)){const g=Mt(i,p),v=Ht(m,f);return De(i,d,Fn),l(g,v,!1,u,s+i,Fn)}else{let g=function(B){const{uint16Array:F,uint32Array:Y}=Ie;let $=B*2;for(;!wt($,F);)B=Gt(B),$=B*2;return Mt(B,Y)},v=function(B){const{uint16Array:F,uint32Array:Y}=Ie;let $=B*2;for(;!wt($,F);)B=Vt(B,Y),$=B*2;return Mt(B,Y)+Ht($,F)};const b=Gt(i),A=Vt(i,p);let S=b,w=A,x,_,E,P;if(o&&(E=Fn,P=Wr,De(S,d,E),De(w,d,P),x=o(E),_=o(P),_<x)){S=A,w=b;const B=x;x=_,_=B,E=P}E||(E=Fn,De(S,d,E));const M=wt(S*2,f),L=n(E,M,x,u+1,s+S);let R;if(L===dd){const B=g(S),F=v(S)-B;R=l(B,F,!0,u+1,s+S,E)}else R=L&&Al(S,r,n,l,o,s,u+1);if(R)return!0;P=Wr,De(w,d,P);const N=wt(w*2,f),z=n(P,N,_,u+1,s+w);let D;if(z===dd){const B=g(w),F=v(w)-B;D=l(B,F,!0,u+1,s+w,P)}else D=z&&Al(w,r,n,l,o,s,u+1);return!!D}}const Mi=new G,el=new G;function y0(i,r,n={},l=0,o=1/0){const s=l*l,u=o*o;let d=1/0,f=null;if(i.shapecast({boundsTraverseOrder:m=>(Mi.copy(r).clamp(m.min,m.max),Mi.distanceToSquared(r)),intersectsBounds:(m,g,v)=>v<d&&v<u,intersectsTriangle:(m,g)=>{m.closestPointToPoint(r,Mi);const v=r.distanceToSquared(Mi);return v<d&&(el.copy(Mi),d=v,f=g),v<s}}),d===1/0)return null;const p=Math.sqrt(d);return n.point?n.point.copy(el):n.point=el.clone(),n.distance=p,n.faceIndex=f,n}const kr=new G,zr=new G,Nr=new G,Za=new be,$a=new be,Ja=new be,gd=new G,vd=new G,yd=new G,eo=new G;function b0(i,r,n,l,o,s){let u;return s===Id?u=i.intersectTriangle(l,n,r,!0,o):u=i.intersectTriangle(r,n,l,s!==jd,o),u===null?null:{distance:i.origin.distanceTo(o),point:o.clone()}}function x0(i,r,n,l,o,s,u,d,f){kr.fromBufferAttribute(r,s),zr.fromBufferAttribute(r,u),Nr.fromBufferAttribute(r,d);const p=b0(i,kr,zr,Nr,eo,f);if(p){l&&(Za.fromBufferAttribute(l,s),$a.fromBufferAttribute(l,u),Ja.fromBufferAttribute(l,d),p.uv=ki.getInterpolation(eo,kr,zr,Nr,Za,$a,Ja,new be)),o&&(Za.fromBufferAttribute(o,s),$a.fromBufferAttribute(o,u),Ja.fromBufferAttribute(o,d),p.uv1=ki.getInterpolation(eo,kr,zr,Nr,Za,$a,Ja,new be)),n&&(gd.fromBufferAttribute(n,s),vd.fromBufferAttribute(n,u),yd.fromBufferAttribute(n,d),p.normal=ki.getInterpolation(eo,kr,zr,Nr,gd,vd,yd,new G),p.normal.dot(i.direction)>0&&p.normal.multiplyScalar(-1));const m={a:s,b:u,c:d,normal:new G,materialIndex:0};ki.getNormal(kr,zr,Nr,m.normal),p.face=m,p.faceIndex=s}return p}function yo(i,r,n,l,o){const s=l*3;let u=s+0,d=s+1,f=s+2;const p=i.index;i.index&&(u=p.getX(u),d=p.getX(d),f=p.getX(f));const{position:m,normal:g,uv:v,uv1:b}=i.attributes,A=x0(n,m,g,v,b,u,d,f,r);return A?(A.faceIndex=l,o&&o.push(A),A):null}function We(i,r,n,l){const o=i.a,s=i.b,u=i.c;let d=r,f=r+1,p=r+2;n&&(d=n.getX(d),f=n.getX(f),p=n.getX(p)),o.x=l.getX(d),o.y=l.getY(d),o.z=l.getZ(d),s.x=l.getX(f),s.y=l.getY(f),s.z=l.getZ(f),u.x=l.getX(p),u.y=l.getY(p),u.z=l.getZ(p)}function w0(i,r,n,l,o,s){const{geometry:u,_indirectBuffer:d}=i;for(let f=l,p=l+o;f<p;f++)yo(u,r,n,f,s)}function S0(i,r,n,l,o){const{geometry:s,_indirectBuffer:u}=i;let d=1/0,f=null;for(let p=l,m=l+o;p<m;p++){let g;g=yo(s,r,n,p),g&&g.distance<d&&(f=g,d=g.distance)}return f}function _0(i,r,n,l,o,s,u){const{geometry:d}=n,{index:f}=d,p=d.attributes.position;for(let m=i,g=r+i;m<g;m++){let v;if(v=m,We(u,v*3,f,p),u.needsUpdate=!0,l(u,v,o,s))return!0}return!1}function E0(i,r=null){r&&Array.isArray(r)&&(r=new Set(r));const n=i.geometry,l=n.index?n.index.array:null,o=n.attributes.position;let s,u,d,f,p=0;const m=i._roots;for(let v=0,b=m.length;v<b;v++)s=m[v],u=new Uint32Array(s),d=new Uint16Array(s),f=new Float32Array(s),g(0,p),p+=s.byteLength;function g(v,b,A=!1){const S=v*2;if(d[S+15]===vo){const w=u[v+6],x=d[S+14];let _=1/0,E=1/0,P=1/0,M=-1/0,L=-1/0,R=-1/0;for(let N=3*w,z=3*(w+x);N<z;N++){let D=l[N];const B=o.getX(D),F=o.getY(D),Y=o.getZ(D);B<_&&(_=B),B>M&&(M=B),F<E&&(E=F),F>L&&(L=F),Y<P&&(P=Y),Y>R&&(R=Y)}return f[v+0]!==_||f[v+1]!==E||f[v+2]!==P||f[v+3]!==M||f[v+4]!==L||f[v+5]!==R?(f[v+0]=_,f[v+1]=E,f[v+2]=P,f[v+3]=M,f[v+4]=L,f[v+5]=R,!0):!1}else{const w=v+8,x=u[v+6],_=w+b,E=x+b;let P=A,M=!1,L=!1;r?P||(M=r.has(_),L=r.has(E),P=!M&&!L):(M=!0,L=!0);const R=P||M,N=P||L;let z=!1;R&&(z=g(w,b,P));let D=!1;N&&(D=g(x,b,P));const B=z||D;if(B)for(let F=0;F<3;F++){const Y=w+F,$=x+F,le=f[Y],fe=f[Y+3],ve=f[$],V=f[$+3];f[v+F]=le<ve?le:ve,f[v+F+3]=fe>V?fe:V}return B}}}const bd=new Qe;function Vn(i,r,n,l){return De(i,r,bd),n.intersectBox(bd,l)}function A0(i,r,n,l,o,s){const{geometry:u,_indirectBuffer:d}=i;for(let f=l,p=l+o;f<p;f++){let m=d?d[f]:f;yo(u,r,n,m,s)}}function T0(i,r,n,l,o){const{geometry:s,_indirectBuffer:u}=i;let d=1/0,f=null;for(let p=l,m=l+o;p<m;p++){let g;g=yo(s,r,n,u?u[p]:p),g&&g.distance<d&&(f=g,d=g.distance)}return f}function P0(i,r,n,l,o,s,u){const{geometry:d}=n,{index:f}=d,p=d.attributes.position;for(let m=i,g=r+i;m<g;m++){let v;if(v=n.resolveTriangleIndex(m),We(u,v*3,f,p),u.needsUpdate=!0,l(u,v,o,s))return!0}return!1}const xd=new G;function M0(i,r,n,l,o){Ie.setBuffer(i._roots[r]),Tl(0,i,n,l,o),Ie.clearBuffer()}function Tl(i,r,n,l,o){const{float32Array:s,uint16Array:u,uint32Array:d}=Ie,f=i*2;if(wt(f,u)){const p=Mt(i,d),m=Ht(f,u);w0(r,n,l,p,m,o)}else{const p=Gt(i);Vn(p,s,l,xd)&&Tl(p,r,n,l,o);const m=Vt(i,d);Vn(m,s,l,xd)&&Tl(m,r,n,l,o)}}const wd=new G,L0=["x","y","z"];function R0(i,r,n,l){Ie.setBuffer(i._roots[r]);const o=Pl(0,i,n,l);return Ie.clearBuffer(),o}function Pl(i,r,n,l){const{float32Array:o,uint16Array:s,uint32Array:u}=Ie;let d=i*2;if(wt(d,s)){const f=Mt(i,u),p=Ht(d,s);return S0(r,n,l,f,p)}else{const f=_f(i,u),p=L0[f],m=l.direction[p]>=0;let g,v;m?(g=Gt(i),v=Vt(i,u)):(g=Vt(i,u),v=Gt(i));const b=Vn(g,o,l,wd)?Pl(g,r,n,l):null;if(b){const S=b.point[p];if(m?S<=o[v+f]:S>=o[v+f+3])return b}const A=Vn(v,o,l,wd)?Pl(v,r,n,l):null;return b&&A?b.distance<=A.distance?b:A:b||A||null}}const to=new Qe,jr=new $t,Br=new $t,Li=new Je,Sd=new mt,no=new mt;function C0(i,r,n,l){Ie.setBuffer(i._roots[r]);const o=Ml(0,i,n,l);return Ie.clearBuffer(),o}function Ml(i,r,n,l,o=null){const{float32Array:s,uint16Array:u,uint32Array:d}=Ie;let f=i*2;if(o===null&&(n.boundingBox||n.computeBoundingBox(),Sd.set(n.boundingBox.min,n.boundingBox.max,l),o=Sd),wt(f,u)){const p=r.geometry,m=p.index,g=p.attributes.position,v=n.index,b=n.attributes.position,A=Mt(i,d),S=Ht(f,u);if(Li.copy(l).invert(),n.boundsTree)return De(i,s,no),no.matrix.copy(Li),no.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:w=>no.intersectsBox(w),intersectsTriangle:w=>{w.a.applyMatrix4(l),w.b.applyMatrix4(l),w.c.applyMatrix4(l),w.needsUpdate=!0;for(let x=A*3,_=(S+A)*3;x<_;x+=3)if(We(Br,x,m,g),Br.needsUpdate=!0,w.intersectsTriangle(Br))return!0;return!1}});for(let w=A*3,x=(S+A)*3;w<x;w+=3){We(jr,w,m,g),jr.a.applyMatrix4(Li),jr.b.applyMatrix4(Li),jr.c.applyMatrix4(Li),jr.needsUpdate=!0;for(let _=0,E=v.count;_<E;_+=3)if(We(Br,_,v,b),Br.needsUpdate=!0,jr.intersectsTriangle(Br))return!0}}else{const p=i+8,m=d[i+6];return De(p,s,to),!!(o.intersectsBox(to)&&Ml(p,r,n,l,o)||(De(m,s,to),o.intersectsBox(to)&&Ml(m,r,n,l,o)))}}const ro=new Je,tl=new mt,Ri=new mt,I0=new G,k0=new G,z0=new G,N0=new G;function j0(i,r,n,l={},o={},s=0,u=1/0){r.boundingBox||r.computeBoundingBox(),tl.set(r.boundingBox.min,r.boundingBox.max,n),tl.needsUpdate=!0;const d=i.geometry,f=d.attributes.position,p=d.index,m=r.attributes.position,g=r.index,v=Kt.getPrimitive(),b=Kt.getPrimitive();let A=I0,S=k0,w=null,x=null;o&&(w=z0,x=N0);let _=1/0,E=null,P=null;return ro.copy(n).invert(),Ri.matrix.copy(ro),i.shapecast({boundsTraverseOrder:M=>tl.distanceToBox(M),intersectsBounds:(M,L,R)=>R<_&&R<u?(L&&(Ri.min.copy(M.min),Ri.max.copy(M.max),Ri.needsUpdate=!0),!0):!1,intersectsRange:(M,L)=>{if(r.boundsTree)return r.boundsTree.shapecast({boundsTraverseOrder:R=>Ri.distanceToBox(R),intersectsBounds:(R,N,z)=>z<_&&z<u,intersectsRange:(R,N)=>{for(let z=R,D=R+N;z<D;z++){We(b,3*z,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let B=M,F=M+L;B<F;B++){We(v,3*B,p,f),v.needsUpdate=!0;const Y=v.distanceToTriangle(b,A,w);if(Y<_&&(S.copy(A),x&&x.copy(w),_=Y,E=B,P=z),Y<s)return!0}}}});{const R=$r(r);for(let N=0,z=R;N<z;N++){We(b,3*N,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let D=M,B=M+L;D<B;D++){We(v,3*D,p,f),v.needsUpdate=!0;const F=v.distanceToTriangle(b,A,w);if(F<_&&(S.copy(A),x&&x.copy(w),_=F,E=D,P=N),F<s)return!0}}}}}),Kt.releasePrimitive(v),Kt.releasePrimitive(b),_===1/0?null:(l.point?l.point.copy(S):l.point=S.clone(),l.distance=_,l.faceIndex=E,o&&(o.point?o.point.copy(x):o.point=x.clone(),o.point.applyMatrix4(ro),S.applyMatrix4(ro),o.distance=S.sub(o.point).length(),o.faceIndex=P),l)}function B0(i,r=null){r&&Array.isArray(r)&&(r=new Set(r));const n=i.geometry,l=n.index?n.index.array:null,o=n.attributes.position;let s,u,d,f,p=0;const m=i._roots;for(let v=0,b=m.length;v<b;v++)s=m[v],u=new Uint32Array(s),d=new Uint16Array(s),f=new Float32Array(s),g(0,p),p+=s.byteLength;function g(v,b,A=!1){const S=v*2;if(d[S+15]===vo){const w=u[v+6],x=d[S+14];let _=1/0,E=1/0,P=1/0,M=-1/0,L=-1/0,R=-1/0;for(let N=w,z=w+x;N<z;N++){const D=3*i.resolveTriangleIndex(N);for(let B=0;B<3;B++){let F=D+B;F=l?l[F]:F;const Y=o.getX(F),$=o.getY(F),le=o.getZ(F);Y<_&&(_=Y),Y>M&&(M=Y),$<E&&(E=$),$>L&&(L=$),le<P&&(P=le),le>R&&(R=le)}}return f[v+0]!==_||f[v+1]!==E||f[v+2]!==P||f[v+3]!==M||f[v+4]!==L||f[v+5]!==R?(f[v+0]=_,f[v+1]=E,f[v+2]=P,f[v+3]=M,f[v+4]=L,f[v+5]=R,!0):!1}else{const w=v+8,x=u[v+6],_=w+b,E=x+b;let P=A,M=!1,L=!1;r?P||(M=r.has(_),L=r.has(E),P=!M&&!L):(M=!0,L=!0);const R=P||M,N=P||L;let z=!1;R&&(z=g(w,b,P));let D=!1;N&&(D=g(x,b,P));const B=z||D;if(B)for(let F=0;F<3;F++){const Y=w+F,$=x+F,le=f[Y],fe=f[Y+3],ve=f[$],V=f[$+3];f[v+F]=le<ve?le:ve,f[v+F+3]=fe>V?fe:V}return B}}}const _d=new G;function O0(i,r,n,l,o){Ie.setBuffer(i._roots[r]),Ll(0,i,n,l,o),Ie.clearBuffer()}function Ll(i,r,n,l,o){const{float32Array:s,uint16Array:u,uint32Array:d}=Ie,f=i*2;if(wt(f,u)){const p=Mt(i,d),m=Ht(f,u);A0(r,n,l,p,m,o)}else{const p=Gt(i);Vn(p,s,l,_d)&&Ll(p,r,n,l,o);const m=Vt(i,d);Vn(m,s,l,_d)&&Ll(m,r,n,l,o)}}const Ed=new G,D0=["x","y","z"];function U0(i,r,n,l){Ie.setBuffer(i._roots[r]);const o=Rl(0,i,n,l);return Ie.clearBuffer(),o}function Rl(i,r,n,l){const{float32Array:o,uint16Array:s,uint32Array:u}=Ie;let d=i*2;if(wt(d,s)){const f=Mt(i,u),p=Ht(d,s);return T0(r,n,l,f,p)}else{const f=_f(i,u),p=D0[f],m=l.direction[p]>=0;let g,v;m?(g=Gt(i),v=Vt(i,u)):(g=Vt(i,u),v=Gt(i));const b=Vn(g,o,l,Ed)?Rl(g,r,n,l):null;if(b){const S=b.point[p];if(m?S<=o[v+f]:S>=o[v+f+3])return b}const A=Vn(v,o,l,Ed)?Rl(v,r,n,l):null;return b&&A?b.distance<=A.distance?b:A:b||A||null}}const io=new Qe,Or=new $t,Dr=new $t,Ci=new Je,Ad=new mt,ao=new mt;function F0(i,r,n,l){Ie.setBuffer(i._roots[r]);const o=Cl(0,i,n,l);return Ie.clearBuffer(),o}function Cl(i,r,n,l,o=null){const{float32Array:s,uint16Array:u,uint32Array:d}=Ie;let f=i*2;if(o===null&&(n.boundingBox||n.computeBoundingBox(),Ad.set(n.boundingBox.min,n.boundingBox.max,l),o=Ad),wt(f,u)){const p=r.geometry,m=p.index,g=p.attributes.position,v=n.index,b=n.attributes.position,A=Mt(i,d),S=Ht(f,u);if(Ci.copy(l).invert(),n.boundsTree)return De(i,s,ao),ao.matrix.copy(Ci),ao.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:w=>ao.intersectsBox(w),intersectsTriangle:w=>{w.a.applyMatrix4(l),w.b.applyMatrix4(l),w.c.applyMatrix4(l),w.needsUpdate=!0;for(let x=A,_=S+A;x<_;x++)if(We(Dr,3*r.resolveTriangleIndex(x),m,g),Dr.needsUpdate=!0,w.intersectsTriangle(Dr))return!0;return!1}});for(let w=A,x=S+A;w<x;w++){const _=r.resolveTriangleIndex(w);We(Or,3*_,m,g),Or.a.applyMatrix4(Ci),Or.b.applyMatrix4(Ci),Or.c.applyMatrix4(Ci),Or.needsUpdate=!0;for(let E=0,P=v.count;E<P;E+=3)if(We(Dr,E,v,b),Dr.needsUpdate=!0,Or.intersectsTriangle(Dr))return!0}}else{const p=i+8,m=d[i+6];return De(p,s,io),!!(o.intersectsBox(io)&&Cl(p,r,n,l,o)||(De(m,s,io),o.intersectsBox(io)&&Cl(m,r,n,l,o)))}}const oo=new Je,nl=new mt,Ii=new mt,H0=new G,G0=new G,V0=new G,K0=new G;function Y0(i,r,n,l={},o={},s=0,u=1/0){r.boundingBox||r.computeBoundingBox(),nl.set(r.boundingBox.min,r.boundingBox.max,n),nl.needsUpdate=!0;const d=i.geometry,f=d.attributes.position,p=d.index,m=r.attributes.position,g=r.index,v=Kt.getPrimitive(),b=Kt.getPrimitive();let A=H0,S=G0,w=null,x=null;o&&(w=V0,x=K0);let _=1/0,E=null,P=null;return oo.copy(n).invert(),Ii.matrix.copy(oo),i.shapecast({boundsTraverseOrder:M=>nl.distanceToBox(M),intersectsBounds:(M,L,R)=>R<_&&R<u?(L&&(Ii.min.copy(M.min),Ii.max.copy(M.max),Ii.needsUpdate=!0),!0):!1,intersectsRange:(M,L)=>{if(r.boundsTree){const R=r.boundsTree;return R.shapecast({boundsTraverseOrder:N=>Ii.distanceToBox(N),intersectsBounds:(N,z,D)=>D<_&&D<u,intersectsRange:(N,z)=>{for(let D=N,B=N+z;D<B;D++){const F=R.resolveTriangleIndex(D);We(b,3*F,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let Y=M,$=M+L;Y<$;Y++){const le=i.resolveTriangleIndex(Y);We(v,3*le,p,f),v.needsUpdate=!0;const fe=v.distanceToTriangle(b,A,w);if(fe<_&&(S.copy(A),x&&x.copy(w),_=fe,E=Y,P=D),fe<s)return!0}}}})}else{const R=$r(r);for(let N=0,z=R;N<z;N++){We(b,3*N,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let D=M,B=M+L;D<B;D++){const F=i.resolveTriangleIndex(D);We(v,3*F,p,f),v.needsUpdate=!0;const Y=v.distanceToTriangle(b,A,w);if(Y<_&&(S.copy(A),x&&x.copy(w),_=Y,E=D,P=N),Y<s)return!0}}}}}),Kt.releasePrimitive(v),Kt.releasePrimitive(b),_===1/0?null:(l.point?l.point.copy(S):l.point=S.clone(),l.distance=_,l.faceIndex=E,o&&(o.point?o.point.copy(x):o.point=x.clone(),o.point.applyMatrix4(oo),S.applyMatrix4(oo),o.distance=S.sub(o.point).length(),o.faceIndex=P),l)}function W0(){return typeof SharedArrayBuffer<"u"}const Bi=new Ie.constructor,mo=new Ie.constructor,Un=new Kl(()=>new Qe),Ur=new Qe,Fr=new Qe,rl=new Qe,il=new Qe;let al=!1;function Q0(i,r,n,l){if(al)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");al=!0;const o=i._roots,s=r._roots;let u,d=0,f=0;const p=new Je().copy(n).invert();for(let m=0,g=o.length;m<g;m++){Bi.setBuffer(o[m]),f=0;const v=Un.getPrimitive();De(0,Bi.float32Array,v),v.applyMatrix4(p);for(let b=0,A=s.length;b<A&&(mo.setBuffer(s[m]),u=Zt(0,0,n,p,l,d,f,0,0,v),mo.clearBuffer(),f+=s[b].length,!u);b++);if(Un.releasePrimitive(v),Bi.clearBuffer(),d+=o[m].length,u)break}return al=!1,u}function Zt(i,r,n,l,o,s=0,u=0,d=0,f=0,p=null,m=!1){let g,v;m?(g=mo,v=Bi):(g=Bi,v=mo);const b=g.float32Array,A=g.uint32Array,S=g.uint16Array,w=v.float32Array,x=v.uint32Array,_=v.uint16Array,E=i*2,P=r*2,M=wt(E,S),L=wt(P,_);let R=!1;if(L&&M)m?R=o(Mt(r,x),Ht(r*2,_),Mt(i,A),Ht(i*2,S),f,u+r,d,s+i):R=o(Mt(i,A),Ht(i*2,S),Mt(r,x),Ht(r*2,_),d,s+i,f,u+r);else if(L){const N=Un.getPrimitive();De(r,w,N),N.applyMatrix4(n);const z=Gt(i),D=Vt(i,A);De(z,b,Ur),De(D,b,Fr);const B=N.intersectsBox(Ur),F=N.intersectsBox(Fr);R=B&&Zt(r,z,l,n,o,u,s,f,d+1,N,!m)||F&&Zt(r,D,l,n,o,u,s,f,d+1,N,!m),Un.releasePrimitive(N)}else{const N=Gt(r),z=Vt(r,x);De(N,w,rl),De(z,w,il);const D=p.intersectsBox(rl),B=p.intersectsBox(il);if(D&&B)R=Zt(i,N,n,l,o,s,u,d,f+1,p,m)||Zt(i,z,n,l,o,s,u,d,f+1,p,m);else if(D)if(M)R=Zt(i,N,n,l,o,s,u,d,f+1,p,m);else{const F=Un.getPrimitive();F.copy(rl).applyMatrix4(n);const Y=Gt(i),$=Vt(i,A);De(Y,b,Ur),De($,b,Fr);const le=F.intersectsBox(Ur),fe=F.intersectsBox(Fr);R=le&&Zt(N,Y,l,n,o,u,s,f,d+1,F,!m)||fe&&Zt(N,$,l,n,o,u,s,f,d+1,F,!m),Un.releasePrimitive(F)}else if(B)if(M)R=Zt(i,z,n,l,o,s,u,d,f+1,p,m);else{const F=Un.getPrimitive();F.copy(il).applyMatrix4(n);const Y=Gt(i),$=Vt(i,A);De(Y,b,Ur),De($,b,Fr);const le=F.intersectsBox(Ur),fe=F.intersectsBox(Fr);R=le&&Zt(z,Y,l,n,o,u,s,f,d+1,F,!m)||fe&&Zt(z,$,l,n,o,u,s,f,d+1,F,!m),Un.releasePrimitive(F)}}return R}const so=new mt,Td=new Qe,q0={strategy:bf,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class Yl{static serialize(r,n={}){n={cloneBuffers:!0,...n};const l=r.geometry,o=r._roots,s=r._indirectBuffer,u=l.getIndex();let d;return n.cloneBuffers?d={roots:o.map(f=>f.slice()),index:u.array.slice(),indirectBuffer:s?s.slice():null}:d={roots:o,index:u.array,indirectBuffer:s},d}static deserialize(r,n,l={}){l={setIndex:!0,indirect:!!r.indirectBuffer,...l};const{index:o,roots:s,indirectBuffer:u}=r,d=new Yl(n,{...l,[Xs]:!0});if(d._roots=s,d._indirectBuffer=u||null,l.setIndex){const f=n.getIndex();if(f===null){const p=new Ni(r.index,1,!1);n.setIndex(p)}else f.array!==o&&(f.array.set(o),f.needsUpdate=!0)}return d}get indirect(){return!!this._indirectBuffer}constructor(r,n={}){if(r.isBufferGeometry){if(r.index&&r.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(n=Object.assign({...q0,[Xs]:!1},n),n.useSharedArrayBuffer&&!W0())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=r,this._roots=null,this._indirectBuffer=null,n[Xs]||(d0(this,n),!r.boundingBox&&n.setBoundingBox&&(r.boundingBox=this.getBoundingBox(new Qe)));const{_indirectBuffer:l}=this;this.resolveTriangleIndex=n.indirect?o=>l[o]:o=>o}refit(r=null){return(this.indirect?B0:E0)(this,r)}traverse(r,n=0){const l=this._roots[n],o=new Uint32Array(l),s=new Uint16Array(l);u(0);function u(d,f=0){const p=d*2,m=s[p+15]===vo;if(m){const g=o[d+6],v=s[p+14];r(f,m,new Float32Array(l,d*4,6),g,v)}else{const g=d+ji/4,v=o[d+6],b=o[d+7];r(f,m,new Float32Array(l,d*4,6),b)||(u(g,f+1),u(v,f+1))}}}raycast(r,n=qr){const l=this._roots,o=this.geometry,s=[],u=n.isMaterial,d=Array.isArray(n),f=o.groups,p=u?n.side:n,m=this.indirect?O0:M0;for(let g=0,v=l.length;g<v;g++){const b=d?n[f[g].materialIndex].side:p,A=s.length;if(m(this,g,b,r,s),d){const S=f[g].materialIndex;for(let w=A,x=s.length;w<x;w++)s[w].face.materialIndex=S}}return s}raycastFirst(r,n=qr){const l=this._roots,o=this.geometry,s=n.isMaterial,u=Array.isArray(n);let d=null;const f=o.groups,p=s?n.side:n,m=this.indirect?U0:R0;for(let g=0,v=l.length;g<v;g++){const b=u?n[f[g].materialIndex].side:p,A=m(this,g,b,r);A!=null&&(d==null||A.distance<d.distance)&&(d=A,u&&(A.face.materialIndex=f[g].materialIndex))}return d}intersectsGeometry(r,n){let l=!1;const o=this._roots,s=this.indirect?F0:C0;for(let u=0,d=o.length;u<d&&(l=s(this,u,r,n),!l);u++);return l}shapecast(r){const n=Kt.getPrimitive(),l=this.indirect?P0:_0;let{boundsTraverseOrder:o,intersectsBounds:s,intersectsRange:u,intersectsTriangle:d}=r;if(u&&d){const g=u;u=(v,b,A,S,w)=>g(v,b,A,S,w)?!0:l(v,b,this,d,A,S,n)}else u||(d?u=(g,v,b,A)=>l(g,v,this,d,b,A,n):u=(g,v,b)=>b);let f=!1,p=0;const m=this._roots;for(let g=0,v=m.length;g<v;g++){const b=m[g];if(f=v0(this,g,s,u,o,p),f)break;p+=b.byteLength}return Kt.releasePrimitive(n),f}bvhcast(r,n,l){let{intersectsRanges:o,intersectsTriangles:s}=l;const u=Kt.getPrimitive(),d=this.geometry.index,f=this.geometry.attributes.position,p=this.indirect?A=>{const S=this.resolveTriangleIndex(A);We(u,S*3,d,f)}:A=>{We(u,A*3,d,f)},m=Kt.getPrimitive(),g=r.geometry.index,v=r.geometry.attributes.position,b=r.indirect?A=>{const S=r.resolveTriangleIndex(A);We(m,S*3,g,v)}:A=>{We(m,A*3,g,v)};if(s){const A=(S,w,x,_,E,P,M,L)=>{for(let R=x,N=x+_;R<N;R++){b(R),m.a.applyMatrix4(n),m.b.applyMatrix4(n),m.c.applyMatrix4(n),m.needsUpdate=!0;for(let z=S,D=S+w;z<D;z++)if(p(z),u.needsUpdate=!0,s(u,m,z,R,E,P,M,L))return!0}return!1};if(o){const S=o;o=function(w,x,_,E,P,M,L,R){return S(w,x,_,E,P,M,L,R)?!0:A(w,x,_,E,P,M,L,R)}}else o=A}return Q0(this,r,n,o)}intersectsBox(r,n){return so.set(r.min,r.max,n),so.needsUpdate=!0,this.shapecast({intersectsBounds:l=>so.intersectsBox(l),intersectsTriangle:l=>so.intersectsTriangle(l)})}intersectsSphere(r){return this.shapecast({intersectsBounds:n=>r.intersectsBox(n),intersectsTriangle:n=>n.intersectsSphere(r)})}closestPointToGeometry(r,n,l={},o={},s=0,u=1/0){return(this.indirect?Y0:j0)(this,r,n,l,o,s,u)}closestPointToPoint(r,n={},l=0,o=1/0){return y0(this,r,n,l,o)}getBoundingBox(r){return r.makeEmpty(),this._roots.forEach(n=>{De(0,new Float32Array(n),Td),r.union(Td)}),r}}function Pd(i,r,n){return i===null||(i.point.applyMatrix4(r.matrixWorld),i.distance=i.point.distanceTo(n.ray.origin),i.object=r,i.distance<n.near||i.distance>n.far)?null:i}const ol=new Cd,Md=new Je,X0=Hn.prototype.raycast;function Z0(i,r){if(this.geometry.boundsTree){if(this.material===void 0)return;Md.copy(this.matrixWorld).invert(),ol.copy(i.ray).applyMatrix4(Md);const n=this.geometry.boundsTree;if(i.firstHitOnly===!0){const l=Pd(n.raycastFirst(ol,this.material),this,i);l&&r.push(l)}else{const l=n.raycast(ol,this.material);for(let o=0,s=l.length;o<s;o++){const u=Pd(l[o],this,i);u&&r.push(u)}}}else X0.call(this,i,r)}function $0(i){return this.boundsTree=new Yl(this,i),this.boundsTree}function J0(){this.boundsTree=null}const Ld=i=>i.isMesh,ev=I.forwardRef(({enabled:i=!0,firstHitOnly:r=!1,children:n,strategy:l=xf,verbose:o=!1,setBoundingBox:s=!0,maxDepth:u=40,maxLeafTris:d=10,indirect:f=!1,...p},m)=>{const g=I.useRef(null),v=it(b=>b.raycaster);return I.useImperativeHandle(m,()=>g.current,[]),I.useEffect(()=>{if(i){const b={strategy:l,verbose:o,setBoundingBox:s,maxDepth:u,maxLeafTris:d,indirect:f},A=g.current;return v.firstHitOnly=r,A.traverse(S=>{Ld(S)&&!S.geometry.boundsTree&&S.raycast===Hn.prototype.raycast&&(S.raycast=Z0,S.geometry.computeBoundsTree=$0,S.geometry.disposeBoundsTree=J0,S.geometry.computeBoundsTree(b))}),()=>{delete v.firstHitOnly,A.traverse(S=>{Ld(S)&&S.geometry.boundsTree&&(S.geometry.disposeBoundsTree(),S.raycast=Hn.prototype.raycast)})}}},[]),I.createElement("group",Gn({ref:g},p),n)}),tv=I.forwardRef(function({children:i,disable:r,disableX:n,disableY:l,disableZ:o,left:s,right:u,top:d,bottom:f,front:p,back:m,onCentered:g,precise:v=!0,cacheKey:b=0,...A},S){const w=I.useRef(null),x=I.useRef(null),_=I.useRef(null);return I.useLayoutEffect(()=>{x.current.matrixWorld.identity();const E=new Qe().setFromObject(_.current,v),P=new G,M=new Zr,L=E.max.x-E.min.x,R=E.max.y-E.min.y,N=E.max.z-E.min.z;E.getCenter(P),E.getBoundingSphere(M);const z=d?R/2:f?-R/2:0,D=s?-L/2:u?L/2:0,B=p?N/2:m?-N/2:0;x.current.position.set(r||n?0:-P.x+D,r||l?0:-P.y+z,r||o?0:-P.z+B),typeof g<"u"&&g({parent:w.current.parent,container:w.current,width:L,height:R,depth:N,boundingBox:E,boundingSphere:M,center:P,verticalAlignment:z,horizontalAlignment:D,depthAlignment:B})},[b,g,d,s,p,r,n,l,o,v,u,f,m]),I.useImperativeHandle(S,()=>w.current,[]),I.createElement("group",Gn({ref:w},A),I.createElement("group",{ref:x},I.createElement("group",{ref:_},i)))});function nv(){const{controllers:i}=He(),r=I.useRef(),n=I.useRef();return dr(()=>{if(i&&i[0]&&i[1]){if(i[0].controller){const l=i[0].hand.joints["index-finger-tip"].position;r.current.position.copy(l)}if(i[1].controller){const l=i[1].hand.joints["index-finger-tip"].position;n.current.position.copy(l)}}}),ne.jsxs(ne.Fragment,{children:[ne.jsxs("mesh",{name:"leftTipBbox",ref:n,children:[ne.jsx("boxGeometry",{args:[.02,.02,.02]}),ne.jsx("meshStandardMaterial",{color:"blue",transparent:!0,opacity:0})]}),ne.jsxs("mesh",{name:"rightTipBbox",ref:r,children:[ne.jsx("boxGeometry",{args:[.02,.02,.02]}),ne.jsx("meshStandardMaterial",{color:"orange",transparent:!0,opacity:0})]})]})}function sl(i){const{currentLine:r,scale:n}=i,l=I.useRef();return ne.jsxs("group",{children:[ne.jsx(tv,{bottom:!0,right:!0,position:[r.midPoint.x,r.midPoint.y,r.midPoint.z],rotation:[0,0,0],children:ne.jsx(yf,{color:"gray",scale:.05,ref:l,children:`${(r.startPoint.distanceTo(r.endPoint)*n).toFixed(2)} m`})}),ne.jsx(Wg,{points:[r.startPoint,r.endPoint],color:"white",lineWidth:2,dashed:!1,segments:!0})]})}function rv(i){const{segmentationGroup:r,segmentationSettings:n,segmentationSceneScale:l,renderingSettings:o,materialRef:s,highlightEntity:u,setObsHighlight:d}=i,f=I.useRef(),p=I.useRef(),m=I.useRef(),{isPresenting:g}=He();I.useEffect(()=>{g&&(f!=null&&f.current)?s!==null&&(s.current.material.uniforms.u_physical_Pixel.value=.2):g||s!==null&&(s.current.material.uniforms.u_physical_Pixel.value=2.5)},[g]);const{scene:v}=it(),{controllers:b}=He(),[A,S]=I.useState(!1),[w,x]=I.useState(!1),[_,E]=I.useState(!1),[P,M]=I.useState({startPoint:new G,midPoint:new G,endPoint:new G,setStartPoint:!1,setEndPoint:!1}),[L,R]=I.useState([]),[N,z]=I.useState(0);return dr(()=>{if(g){const D=v.getObjectByName("rightTipBbox"),B=v.getObjectByName("leftTipBbox"),F=new Qe().setFromObject(B),Y=new Qe().setFromObject(D);let $=!1;if(z(N-1),F.intersectsBox(Y)&&F.max.x!==-Y.min.x&&(S(!0),E(!0),M({startPoint:new G,midPoint:new G,endPoint:new G,setStartPoint:!1,setEndPoint:!1})),A){let le=b[1].hand.joints["index-finger-tip"].position.clone(),fe=b[0].hand.joints["index-finger-tip"].position.clone();le=le.applyMatrix4(m.current.matrixWorld.clone().invert()),fe=fe.applyMatrix4(m.current.matrixWorld.clone().invert());let ve=le.clone(),V=fe.clone();P.setStartPoint&&(ve=P.startPoint),P.setEndPoint&&(V=P.endPoint),M({startPoint:ve,midPoint:new G().addVectors(ve,V).multiplyScalar(.5),endPoint:V,setStartPoint:P.setStartPoint,setEndPoint:P.setEndPoint}),b[0].hand.inputState.pinching===!0&&M({startPoint:P.startPoint,midPoint:P.midPoint,endPoint:P.endPoint,setStartPoint:P.setStartPoint,setEndPoint:!0}),b[1].hand.inputState.pinching===!0&&M({startPoint:P.startPoint,midPoint:P.midPoint,endPoint:P.endPoint,setStartPoint:!0,setEndPoint:P.setEndPoint}),P.setStartPoint&&P.setEndPoint&&(L.push(P),R(L),E(!1),S(!1),z(8))}else N<=0&&(f!=null&&f.current)&&g&&(f.current.children[0].children.forEach((le,fe)=>{const ve=f.current.children[0].children[fe],V=new Qe().setFromObject(ve),ee=F.intersectsBox(V),Z=Y.intersectsBox(V);(ee||Z)&&($=!0,d(ve.name),x(!0),b[1]!==void 0&&ee&&b[1].hand.inputState.pinching===!0&&(z(10),$=!1,b[1].hand.inputState.pinching=!1),b[0]!==void 0&&Z&&b[0].hand.inputState.pinching===!0&&(z(10),$=!1,b[0].hand.inputState.pinching=!1))}),!$&&w&&(d(null),x(!1)))}},[A,w,P,L,_,N,g]),ne.jsx("group",{children:He().isPresenting?ne.jsxs(Mm,{children:[ne.jsxs("group",{ref:m,children:[r!=null&&r.visible?ne.jsxs("group",{children:[ne.jsx("hemisphereLight",{skyColor:8421504,groundColor:6316128}),ne.jsx("directionalLight",{color:16777215,position:[0,-800,0]}),ne.jsx("primitive",{ref:f,object:r,position:[-.18,1.13,-1],scale:[.002*l[0],.002*l[1],.002*l[2]]})]}):null,o.uniforms&&o.shader?ne.jsx("group",{children:ne.jsxs("mesh",{name:"cube",position:[-.18,1.13,-1],rotation:[0,0,0],scale:[.002*o.meshScale[0],.002*o.meshScale[1],.002*o.meshScale[2]],ref:s,children:[ne.jsx("boxGeometry",{args:o.geometrySize}),ne.jsx("shaderMaterial",{customProgramCacheKey:()=>"1",side:qr,uniforms:o.uniforms,needsUpdate:!0,transparent:!0,vertexShader:o.shader.vertexShader,fragmentShader:o.shader.fragmentShader})]})}):null]}),ne.jsx("group",{name:"currentLine",ref:p,children:_?ne.jsx(sl,{currentLine:P,scale:1/.002*.4}):null}),ne.jsx("group",{name:"lines",children:L.map(D=>ne.jsx(sl,{currentLine:D,scale:1/.002*.4}))})]}):ne.jsxs("group",{children:[ne.jsxs("group",{children:[r!=null&&r.visible?ne.jsxs("group",{children:[ne.jsx("hemisphereLight",{skyColor:8421504,groundColor:6316128}),ne.jsx("directionalLight",{color:16777215,position:[0,-800,0]}),ne.jsx("directionalLight",{color:16777215,position:[0,800,0]}),ne.jsx(ev,{firstHitOnly:!0,children:ne.jsx("primitive",{ref:f,object:r,position:[0,0,0],onClick:D=>{D.object.parent.userData.name==="finalPass"&&u(D.object.name,D.object.userData.layerScope,D.object.userData.channelScope)},onPointerOver:D=>{d(D.object.name)},onPointerOut:D=>d(null)})})]}):null,o.uniforms&&o.shader?ne.jsx("group",{children:ne.jsxs("mesh",{scale:o.meshScale,ref:s,children:[ne.jsx("boxGeometry",{args:o.geometrySize}),ne.jsx("shaderMaterial",{customProgramCacheKey:()=>"1",side:qr,uniforms:o.uniforms,needsUpdate:!0,transparent:!0,vertexShader:o.shader.vertexShader,fragmentShader:o.shader.fragmentShader})]})}):null]}),ne.jsx("group",{name:"lines",children:L.map(D=>ne.jsx(sl,{currentLine:D,scale:1}))})]})})}function iv(){const{controllers:i}=He();return dr(()=>{var r,n,l,o,s,u,d,f,p,m,g,v,b,A;i!=null&&i[0]&&(i!=null&&i[1])&&((d=(u=(s=(o=(l=(n=(r=i[0])==null?void 0:r.hand)==null?void 0:n.children)==null?void 0:l[25])==null?void 0:o.children)==null?void 0:s[0])==null?void 0:u.children)!=null&&d[0]&&(i[0].hand.children[25].children[0].children[0].material.transparent=!0,i[0].hand.children[25].children[0].children[0].material.opacity=.5),(A=(b=(v=(g=(m=(p=(f=i[1])==null?void 0:f.hand)==null?void 0:p.children)==null?void 0:m[25])==null?void 0:g.children)==null?void 0:v[0])==null?void 0:b.children)!=null&&A[0]&&(i[1].hand.children[25].children[0].children[0].material.transparent=!0,i[1].hand.children[25].children[0].children[0].material.opacity=.5))}),null}class av{constructor(r,n,l,o,s){if(this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new Rh,this.matrix.identity(),this.sliceList=[],this.lowerThresholdValue=-1/0,this.upperThresholdValue=1/0,arguments.length>0){switch(this.xLength=Number(r)||1,this.yLength=Number(n)||1,this.zLength=Number(l)||1,o){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(s);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(s);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(s);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(s);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(s);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(s);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw new Error("uint64_t type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(s);break;case"Float64":case"float64":case"double":this.data=new Float64Array(s);break;default:this.data=new Uint8Array(s)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw new Error("lengths are not matching arrayBuffer size")}}get lowerThreshold(){return this.lowerThresholdValue}set lowerThreshold(r){this.lowerThresholdValue=r,this.sliceList.forEach(n=>{n.geometryNeedsUpdate=!0})}get upperThreshold(){return this.upperThresholdValue}set upperThreshold(r){this.upperThresholdValue=r,this.sliceList.forEach(n=>{n.geometryNeedsUpdate=!0})}getData(r,n,l){return this.data[l*this.xLength*this.yLength+n*this.xLength+r]}access(r,n,l){return l*this.xLength*this.yLength+n*this.xLength+r}reverseAccess(r){const n=Math.floor(r/(this.yLength*this.xLength)),l=Math.floor((r-n*this.yLength*this.xLength)/this.xLength);return[r-n*this.yLength*this.xLength-l*this.xLength,l,n]}map(r,n){const{length:l}=this.data,o=n||this;for(let s=0;s<l;s++)this.data[s]=r.call(o,this.data[s],s,this.data);return this}extractPerpendicularPlane(r,n){const l=new Je().identity(),o=this;let s,u,d,f;const p=new G,m=new G,g=new G,v=new G(this.xLength,this.yLength,this.zLength);switch(r){case"x":p.set(1,0,0),m.set(0,0,-1),g.set(0,-1,0),s=this.spacing[2],u=this.spacing[1],f=new G(n,0,0),l.multiply(new Je().makeRotationY(Math.PI/2)),d=(o.RASDimensions[0]-1)/2,l.setPosition(new G(n-d,0,0));break;case"y":p.set(0,1,0),m.set(1,0,0),g.set(0,0,1),s=this.spacing[0],u=this.spacing[2],f=new G(0,n,0),l.multiply(new Je().makeRotationX(-Math.PI/2)),d=(o.RASDimensions[1]-1)/2,l.setPosition(new G(0,n-d,0));break;case"z":default:p.set(0,0,1),m.set(1,0,0),g.set(0,-1,0),s=this.spacing[0],u=this.spacing[1],f=new G(0,0,n),d=(o.RASDimensions[2]-1)/2,l.setPosition(new G(0,0,n-d));break}m.applyMatrix4(o.inverseMatrix).normalize(),m.argVar="i",g.applyMatrix4(o.inverseMatrix).normalize(),g.argVar="j",p.applyMatrix4(o.inverseMatrix).normalize();const b=Math.floor(Math.abs(m.dot(v))),A=Math.floor(Math.abs(g.dot(v))),S=Math.abs(b*s),w=Math.abs(A*u);f=Math.abs(Math.round(f.applyMatrix4(o.inverseMatrix).dot(p)));const x=[new G(1,0,0),new G(0,1,0),new G(0,0,1)],_=[m,g,p].find(L=>Math.abs(L.dot(x[0]))>.9),E=[m,g,p].find(L=>Math.abs(L.dot(x[1]))>.9),P=[m,g,p].find(L=>Math.abs(L.dot(x[2]))>.9);function M(L,R){const N=_===p?f:_.arglet==="i"?L:R,z=E===p?f:E.arglet==="i"?L:R,D=P===p?f:P.arglet==="i"?L:R,B=_.dot(x[0])>0?N:o.xLength-1-N,F=E.dot(x[1])>0?z:o.yLength-1-z,Y=P.dot(x[2])>0?D:o.zLength-1-D;return o.access(B,F,Y)}return{iLength:b,jLength:A,sliceAccess:M,matrix:l,planeWidth:S,planeHeight:w}}computeMinMax(){let r=1/0,n=-1/0;const l=this.data.length;let o=0;for(o=0;o<l;o++)if(!Number.isNaN(this.data[o])){const s=this.data[o];r=Math.min(r,s),n=Math.max(n,s)}return this.min=r,this.max=n,[r,n]}}const ov={uniforms:{u_size:{value:new G(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_opacity:{value:.5},u_clim:{value:new be(.2,.8)},u_clim2:{value:new be(.2,.8)},u_clim3:{value:new be(.2,.8)},u_clim4:{value:new be(.2,.8)},u_clim5:{value:new be(.2,.8)},u_clim6:{value:new be(.2,.8)},u_xClip:{value:new be(-1,1e6)},u_yClip:{value:new be(-1,1e6)},u_zClip:{value:new be(-1,1e6)},u_data:{value:null},u_stop_geom:{value:null},u_geo_color:{value:null},u_window_size:{value:new be(1,1)},u_vol_scale:{value:new be(1,1,1)},u_physical_Pixel:{value:.5},volumeTex:{value:null},volumeTex2:{value:null},volumeTex3:{value:null},volumeTex4:{value:null},volumeTex5:{value:null},volumeTex6:{value:null},u_color:{value:new G(0,0,0)},u_color2:{value:new G(0,0,0)},u_color3:{value:new G(0,0,0)},u_color4:{value:new G(0,0,0)},u_color5:{value:new G(0,0,0)},u_color6:{value:new G(0,0,0)},u_cmdata:{value:null},near:{value:.1},far:{value:1e4},alphaScale:{value:0},dtScale:{value:1},volumeCount:{value:0},finalGamma:{value:0},boxSize:{value:new G(1,1,1)}},vertexShader:["out vec3 rayDirUnnorm;","out vec3 cameraCorrected;","uniform vec3 u_vol_scale;","uniform vec3 u_size;","varying vec3 worldSpaceCoords;","varying vec2 vUv;","varying vec4 glPosition;","uniform highp vec3 boxSize;","void main()","{","   worldSpaceCoords = position / boxSize + vec3(0.5, 0.5, 0.5); //move it from [-0.5;0.5] to [0,1]","   cameraCorrected = (inverse(modelMatrix) * vec4(cameraPosition, 1.)).xyz;","   rayDirUnnorm = position - cameraCorrected;","   gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","   glPosition = gl_Position;","   vUv = uv;","}"].join(`
`),fragmentShader:["#include <packing>","precision highp float;"," precision mediump sampler3D;","in vec3 rayDirUnnorm;","in vec3 cameraCorrected;","uniform sampler3D volumeTex;","uniform sampler3D volumeTex2;","uniform sampler3D volumeTex3;","uniform sampler3D volumeTex4;","uniform sampler3D volumeTex5;","uniform sampler3D volumeTex6;","uniform vec2 u_clim;","uniform vec2 u_clim2;","uniform vec2 u_clim3;","uniform vec2 u_clim4;","uniform vec2 u_clim5;","uniform vec2 u_clim6;","uniform vec2 u_window_size;","uniform vec2 u_xClip;","uniform vec2 u_yClip;","uniform vec2 u_zClip;","uniform sampler2D u_cmdata;","uniform sampler2D u_stop_geom;","uniform sampler2D u_geo_color;","uniform vec3 u_color;","uniform vec3 u_color2;","uniform vec3 u_color3;","uniform vec3 u_color4;","uniform vec3 u_color5;","uniform vec3 u_color6;","uniform float alphaScale;","uniform float dtScale;","uniform float finalGamma;","uniform float volumeCount;","uniform highp vec3 boxSize;","uniform vec3 u_size;","uniform int u_renderstyle;","uniform float u_opacity;","uniform vec3 u_vol_scale;","uniform float near;","uniform float u_physical_Pixel;","varying vec2 vUv;","varying vec4 glPosition;","uniform float far;","varying vec3 worldSpaceCoords;","float linearize_z(float z) {","        return near * far / (far + z * (near - far));","}","vec2 intersect_hit(vec3 orig, vec3 dir) {","  vec3 boxMin = vec3(-0.5) * boxSize;","  vec3 boxMax = vec3( 0.5) * boxSize;","  if(u_xClip.x > -1.0){   boxMin.x = u_xClip.x-(boxSize.x/2.0);","   if(u_xClip.y < boxSize.x)","       boxMax.x = u_xClip.y-(boxSize.x/2.0);","  }","  if(u_yClip.x > -1.0){   boxMin.y = u_yClip.x-(boxSize.y/2.0);","   if(u_yClip.y < boxSize.y)","      boxMax.y = u_yClip.y-(boxSize.y/2.0);","  }","  if(u_zClip.x > -1.0){   boxMin.z = u_zClip.x-(boxSize.z/2.0);","   if(u_zClip.y < boxSize.z)       boxMax.z = u_zClip.y-(boxSize.z/2.0);","  }","  vec3 invDir = 1.0 / dir;","  vec3 tmin0 = (boxMin - orig) * invDir;","  vec3 tmax0 = (boxMax - orig) * invDir;","  vec3 tmin = min(tmin0, tmax0);","  vec3 tmax = max(tmin0, tmax0);","  float t0 = max(tmin.x, max(tmin.y, tmin.z));","  float t1 = min(tmax.x, min(tmax.y, tmax.z));","  return vec2(t0, t1);","}","   // Pseudo-random number gen from","   // http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/","   // with some tweaks for the range of values","       float wang_hash(int seed) {","     seed = (seed ^ 61) ^ (seed >> 16);","     seed *= 9;","     seed = seed ^ (seed >> 4);","     seed *= 0x27d4eb2d;","     seed = seed ^ (seed >> 15);","     return float(seed % 2147483647) / float(2147483647);","     }","float linear_to_srgb(float x) {","   if (x <= 0.0031308f) {","     return 12.92f * x;","   }","   return 1.055f * pow(x, 1.f / 2.4f) - 0.055f;","}","void main(void) {","  //STEP 1: Normalize the view Ray","  vec3 rayDir = normalize(rayDirUnnorm);","  //STEP 2: Intersect the ray with the volume bounds to find the interval along the ray overlapped by the volume","  vec2 t_hit = intersect_hit(cameraCorrected, rayDir);","  if (t_hit.x >= t_hit.y) {","    discard;","  }","  //No sample behind the eye","  t_hit.x = max(t_hit.x, 0.0);","  //STEP 3: Compute the step size to march through the volume grid","  ivec3 volumeTexSize = textureSize(volumeTex, 0);","  vec3 dt_vec = 1.0 / (vec3(volumeTexSize) * abs(rayDir));","  float dt = min(dt_vec.x, min(dt_vec.y, dt_vec.z));","  dt = max(1.0, dt);","  // Ray starting point, in the real space where the box may not be a cube.","  // Prevents a lost WebGL context."," float offset = wang_hash(int(gl_FragCoord.x + 640.0 * gl_FragCoord.y));"," vec3 p = cameraCorrected + (t_hit.x + offset + dt) * rayDir;","  // Most browsers do not need this initialization, but add it to be safe.","  gl_FragColor = vec4(0.0);","  p = p / boxSize + vec3(0.5);","  vec3 step = (rayDir * dt) / boxSize;","  // ","  // Initialization of some variables.","  float max_val = 0.0;","  float max_val2 = 0.0;","  float max_val3 = 0.0;","  float max_val4 = 0.0;","  float max_val5 = 0.0;","  float max_val6 = 0.0;","  vec3 rgbCombo = vec3(0.0);","  float total = 0.0;","  int max_i = 30000;","  int i = 0;","  float x = gl_FragCoord.x/u_window_size.x;","  float y = gl_FragCoord.y/u_window_size.y;","  vec3 meshPos = texture2D(u_stop_geom, vec2(x,y)).xyz;","  float dist = 1000.0;","  for (float t = t_hit.x; t < t_hit.y; t += dt) {","       if(meshPos != vec3(0.0))           dist = distance(p,meshPos);","      float val = texture(volumeTex, p.xyz).r;","      val = max(0.0, (val - u_clim[0]) / (u_clim[1] - u_clim[0]));","      rgbCombo += max(0.0, min(1.0, val)) * u_color;","      total += val;","      if(volumeCount > 1.0){           float val2 = texture(volumeTex2, p.xyz).r;","           val2 = max(0.0,(val2 - u_clim2[0]) / (u_clim2[1] - u_clim2[0]));","           rgbCombo += max(0.0, min(1.0, val2)) * u_color2;","           total += val2;","       }","       if(volumeCount > 2.0){           float val3 = texture(volumeTex3, p.xyz).r;","           val3 = max(0.0,(val3 - u_clim3[0]) / (u_clim3[1] - u_clim3[0]));","           rgbCombo += max(0.0, min(1.0, val3)) * u_color3;","           total += val3;","       }","       if(volumeCount > 3.0){           float val4 = texture(volumeTex4, p.xyz).r;","           val4 = max(0.0,(val4 - u_clim4[0]) / (u_clim4[1] - u_clim4[0]));","           rgbCombo += max(0.0, min(1.0, val4)) * u_color4;","           total += val4;","       }","       if(volumeCount > 4.0){           float val5 = texture(volumeTex5, p.xyz).r;","           val5 = max(0.0,(val5 - u_clim5[0]) / (u_clim5[1] - u_clim5[0]));","           rgbCombo += max(0.0, min(1.0, val5)) * u_color5;","           total += val5;","        }","        if(volumeCount > 5.0){           float val6 = texture(volumeTex6, p.xyz).r;","           val6 = max(0.0,(val6 - u_clim6[0]) / (u_clim6[1] - u_clim6[0]));","           rgbCombo += max(0.0, min(1.0, val6)) * u_color6;","           total += val6;","       }","       if(total > 0.0 && dist < 0.1){","           break;","       }else if(dist < 0.1){           gl_FragColor = vec4(0.0,0.0,0.0,0.0);","           break;","       }","       if(u_renderstyle == 0 && (max_val > u_clim[1] && max_val2 >= u_clim2[1] && max_val3 >= u_clim3[1] && max_val4 >= u_clim4[1] && max_val5 >= u_clim5[1] &&  max_val6 >= u_clim6[1])) break;","       if(u_renderstyle == 2){           total = min(total, 1.0);","           vec4 val_color = vec4(rgbCombo, total);","           val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);","           gl_FragColor.rgb += (1.0 - gl_FragColor.a) * val_color.a * val_color.rgb;","           gl_FragColor.a += (1.0 - gl_FragColor.a) * val_color.a * dtScale;","           if (gl_FragColor.a >= 0.95) {","               break;","           }","       }","       p += step;","  }","   gl_FragDepth = distance(worldSpaceCoords,p)*u_physical_Pixel;","   if(u_renderstyle == 0 && (max_val <  u_clim[0] && max_val2 < u_clim2[0] && max_val3 < u_clim3[0] &&   max_val4 <  u_clim4[0] && max_val5 <  u_clim5[0] && max_val6 <  u_clim6[0])){","        gl_FragColor = vec4(0,0,0,0);","   }else if(u_renderstyle == 0){","       max_val = (max_val - u_clim[0]) / (u_clim[1] - u_clim[0]);","       max_val2 = (max_val2 - u_clim2[0]) / (u_clim2[1] - u_clim2[0]);","       max_val3 = (max_val3 - u_clim3[0]) / (u_clim3[1] - u_clim3[0]);","       max_val4 = (max_val4 - u_clim4[0]) / (u_clim4[1] - u_clim4[0]);","       max_val5 = (max_val5 - u_clim5[0]) / (u_clim5[1] - u_clim5[0]);","       max_val6 = (max_val6 - u_clim6[0]) / (u_clim6[1] - u_clim6[0]);","       vec3 color = u_color * max_val;","       if(volumeCount > 1.0) color = color +  u_color2 * max_val2;","       if(volumeCount > 3.0) color = color +  u_color4 * max_val4;","       if(volumeCount > 2.0) color = color +  u_color3 * max_val3;","       if(volumeCount > 4.0) color = color +  u_color5 * max_val5;","       if(volumeCount > 5.0) color = color +  u_color6 * max_val6;","       vec3 colorCorrected = vec3(min(color[0], 1.0), min(color[1],1.0), min(color[2],1.0));","        gl_FragColor = vec4(color,1.0);","    }","    gl_FragColor.r = linear_to_srgb(gl_FragColor.r);","    gl_FragColor.g = linear_to_srgb(gl_FragColor.g);","    gl_FragColor.b = linear_to_srgb(gl_FragColor.b);","}"].join(`
`)},sv={maximumIntensityProjection:0,minimumIntensityProjection:1,additive:2};function lv(i,r,n,l,o,s){var D,B;const{spatialRenderingMode:u}=s,d=(B=(D=o==null?void 0:o.image)==null?void 0:D.instance)==null?void 0:B.getData();if(!d)return{channelsVisible:null,resolution:null,data:null,colors:null,contrastLimits:null,allChannels:null,channelTargetC:null};const f=o.image.instance,p=u==="3D",m=r[Dt.PHOTOMETRIC_INTERPRETATION]==="RGB",g=r[Dt.VOLUMETRIC_RENDERING_ALGORITHM],v=sv[g],b=r[Dt.SPATIAL_LAYER_VISIBLE],A=r[Dt.SPATIAL_LAYER_OPACITY];f.isInterleaved();const S=m?[[255,0,0],[0,255,0],[0,0,255]]:n.map(F=>l[F][Dt.SPATIAL_CHANNEL_COLOR]),w=m?[[0,255],[0,255],[0,255]]:n.map(F=>l[F][Dt.SPATIAL_CHANNEL_WINDOW]||[0,255]),x=m?[b&&!0,b&&!0,b&&!0]:n.map(F=>b&&l[F][Dt.SPATIAL_CHANNEL_VISIBLE]),_=m?[b&&!0,b&&!0,b&&!0]:n.map(F=>b&&l[F][Dt.SPATIAL_TARGET_C]),E=f.getAutoTargetResolution(),P=r[Dt.SPATIAL_TARGET_RESOLUTION],M=P===null||Number.isNaN(P)?E:P,L=o.image.loaders[0].channels;let R=r[Dt.SPATIAL_SLICE_X],N=r[Dt.SPATIAL_SLICE_Y],z=r[Dt.SPATIAL_SLICE_Z];return R=R!==null?R:new be(-1,1e5),N=N!==null?N:new be(-1,1e5),z=z!==null?z:new be(-1,1e5),{channelsVisible:x,allChannels:L,channelTargetC:_,resolution:M,data:d,colors:S,contrastLimits:w,is3dMode:p,renderingMode:v,layerTransparency:A,xSlice:R,ySlice:N,zSlice:z}}function uv(i,r,n,l,o){const{images:s={},imageLayerScopes:u,imageLayerCoordination:d,imageChannelScopesByLayer:f,imageChannelCoordination:p}=i,m=u[0],g=f[m],v=d[0][m],b=p[0][m],{channelsVisible:A,allChannels:S,channelTargetC:w,resolution:x,data:_,colors:E,contrastLimits:P,is3dMode:M,renderingMode:L,layerTransparency:R,xSlice:N,ySlice:z,zSlice:D}=lv(m,v,g,b,s[m],i);return w!==null&&(r.channelTargetC.length!==0&&(r.channelTargetC.toString()!==w.toString()||r.resolution.toString()!==x.toString())?l||o(!0):(r.channelsVisible.toString()!==A.toString()||r.colors.toString()!==E.toString()||r.is3dMode!==M||r.contrastLimits.toString()!==P.toString()||r.renderingMode.toString()!==L.toString()||r.layerTransparency.toString()!==R.toString()||r.xSlice.toString()!==N.toString()||r.ySlice.toString()!==z.toString()||r.zSlice.toString()!==D.toString())&&(n({channelsVisible:A,allChannels:S,channelTargetC:w,resolution:x,data:_,colors:E,contrastLimits:P,is3dMode:M,renderingMode:L,layerTransparency:R,xSlice:N,ySlice:z,zSlice:D}),o(!1))),{images:s,layerScope:m,imageLayerScopes:u,imageLayerCoordination:d,imageChannelScopesByLayer:f,imageChannelCoordination:p,channelsVisible:A,allChannels:S,channelTargetC:w,resolution:x,data:_,colors:E,contrastLimits:P,is3dMode:M,renderingMode:L,layerTransparency:R,xSlice:N,ySlice:z,zSlice:D}}function lo(i,r){const[n,l]=r;return(i-n)/Math.sqrt(l**2-n**2)}function cv(i,r,n,l,o,s,u,d,f,p,m,g,v){i.boxSize.value.set(n.xLength,n.yLength,n.zLength),i.volumeTex.value=r.length>0?r[0]:null,i.volumeTex2.value=r.length>1?r[1]:null,i.volumeTex3.value=r.length>2?r[2]:null,i.volumeTex4.value=r.length>3?r[3]:null,i.volumeTex5.value=r.length>4?r[4]:null,i.volumeTex6.value=r.length>5?r[5]:null,i.near.value=.1,i.far.value=3e3,i.alphaScale.value=1,i.dtScale.value=d,i.finalGamma.value=4.5,i.volumeCount.value=r.length,i.u_size.value.set(n.xLength,n.yLength,n.zLength),i.u_stop_geom.value=null,i.u_window_size.value.set(0,0),i.u_vol_scale.value.set(1/n.xLength,1/n.yLength,1/n.zLength*2),i.u_renderstyle.value=o,i.u_clim.value.set(s.length>0?s[0][0]:null,s.length>0?s[0][1]:null),i.u_clim2.value.set(s.length>1?s[1][0]:null,s.length>1?s[1][1]:null),i.u_clim3.value.set(s.length>2?s[2][0]:null,s.length>2?s[2][1]:null),i.u_clim4.value.set(s.length>3?s[3][0]:null,s.length>3?s[3][1]:null),i.u_clim5.value.set(s.length>4?s[4][0]:null,s.length>4?s[4][1]:null),i.u_clim6.value.set(s.length>5?s[5][0]:null,s.length>5?s[5][1]:null),i.u_xClip.value.set(f[0]*(1/g[0])/v[0]*n.xLength,f[1]*(1/g[0])/v[0]*n.xLength),i.u_yClip.value.set(p[0]*(1/g[1])/v[1]*n.yLength,p[1]*(1/g[1])/v[1]*n.yLength),i.u_zClip.value.set(m[0]*(1/g[2])/v[2]*n.zLength,m[1]*(1/g[1])/v[2]*n.zLength),i.u_color.value.set(u.length>0?u[0][0]:null,u.length>0?u[0][1]:null,u.length>0?u[0][2]:null),i.u_color2.value.set(u.length>1?u[1][0]:null,u.length>1?u[1][1]:null,u.length>1?u[1][2]:null),i.u_color3.value.set(u.length>2?u[2][0]:null,u.length>2?u[2][1]:null,u.length>2?u[2][2]:null),i.u_color4.value.set(u.length>3?u[3][0]:null,u.length>3?u[3][1]:null,u.length>3?u[3][2]:null),i.u_color5.value.set(u.length>4?u[4][0]:null,u.length>4?u[4][1]:null,u.length>4?u[4][2]:null),i.u_color6.value.set(u.length>5?u[5][0]:null,u.length>5?u[5][1]:null,u.length>5?u[5][2]:null)}function Rd(i,r,n,l,o,s,u,d,f,p,m,g,v,b){const A=[],S=[],w=[];let x=null;if(r.forEach((M,L)=>{n[L]&&(x=i.get(M),A.push(o.get(M)),S.push([l[L][0]/255,l[L][1]/255,l[L][2]/255]),s[L][0]===0&&s[L][1]===255?w.push([lo(u.get(M)[0],u.get(M)),lo(u.get(M)[1],u.get(M))]):w.push([lo(s[L][0],u.get(M)),lo(s[L][1],u.get(M))]))}),x===null)return null;const _={clim1:.01,clim2:.7,isothreshold:.15,opacity:1,colormap:"gray"},E=ov,P=fl.clone(E.uniforms);return cv(P,A,x,_,f,w,S,p,m,g,v,[d[0].size,d[1].size,d[2]?d[2].size:1],b),[P,E,[1,d[1].size/d[0].size,d[2]?d[2].size/d[0].size:1],[x.xLength,x.yLength,x.zLength],[1,x.yLength/x.xLength,x.zLength/x.xLength]]}const dv={Uint8:Uint8Array,Uint16:Uint16Array,Uint32:Uint32Array,Int8:Int8Array,Int16:Int16Array,Int32:Int32Array,Float32:Float32Array,Float64:Float64Array};async function fv({source:i,selection:r,onUpdate:n=()=>{},downsampleDepth:l=1,signal:o}){const{shape:s,labels:u,dtype:d}=i,{height:f,width:p}=Ch(i),m=s[u.indexOf("z")],g=Math.max(1,Math.floor(m/l)),v=f*p,b=dv[d],A=new b(v*g);return await Promise.all(new Array(g).fill(0).map(async(S,w)=>{const x={...r,z:w*l},{data:_}=await i.getRaster({selection:x,signal:o});let E=0;for(n({z:w,total:g,progress:.5});E<v;){const P=w*v+(v-E-1),M=(p-E-1)%p+p*Math.floor(E/p);A[P]=_[M],E+=1}n({z:w,total:g,progress:1})})),{data:A,height:f,width:p,depth:g}}function pv(i,r,n){return fv({source:n[r],selection:{t:0,c:i},downsampleDepth:2**r})}function hv(i){const r=new av;return r.xLength=i.width,r.yLength=i.height,r.zLength=i.depth,r.data=i.data,r}function mv(i){const r=new Eh(i.data,i.xLength,i.yLength,i.zLength);return r.format=Ah,r.type=Th,r.generateMipmaps=!1,r.minFilter=po,r.magFilter=po,r.needsUpdate=!0,r}function gv(i){var o;const{x:r,y:n,z:l}=((o=i==null?void 0:i.meta)==null?void 0:o.physicalSizes)??{};return[r,n,l]}function vv(i){const[r,n]=i.computeMinMax(),l=new Float32Array(i.data.length);for(let o=0;o<i.data.length;o++)l[o]=(i.data[o]-r)/Math.sqrt(n**2-r**2);return l}async function yv(i,r,n,l,o,s,u){let d=null,f=null;const{shape:p,labels:m}=n[0],g=i.filter(b=>!l.has(b)||r!==u),v=await Promise.all(g.map(b=>pv(b,r,n)));return g.forEach((b,A)=>{const S=v[A];d=hv(S);const w=d.computeMinMax();d.data=vv(d),l.set(b,d),o.set(b,mv(d)),s.set(b,w),f=gv(n[r])}),[l,o,s,f,[p[m.indexOf("x")],p[m.indexOf("y")],p[m.indexOf("z")]]]}function bv(i){var dt,Yt,_n,fn;const r=I.useRef(null),n=I.useRef(null),[l,o]=I.useState(!1),[s,u]=I.useState(!1),[d,f]=I.useState(null),[p,m]=I.useState([1,1,1]),[g,v]=I.useState({uniforms:null,shader:null,meshScale:null,geometrySize:null,boxSize:null}),[b,A]=I.useState({volumes:new Map,textures:new Map,volumeMinMax:new Map,scale:null,resolution:null,originalScale:null}),[S,w]=I.useState({channelsVisible:[],allChannels:[],channelTargetC:[],resolution:null,data:null,colors:[],contrastLimits:[],is3dMode:!1,renderingMode:null,layerTransparency:1}),[x,_]=I.useState({visible:!0,color:[1,1,1],opacity:1,multiVisible:"",multiOpacity:"",multiColor:"",data:null,obsSets:[]}),{images:E,layerScope:P,channelsVisible:M,allChannels:L,channelTargetC:R,resolution:N,data:z,colors:D,contrastLimits:B,is3dMode:F,renderingMode:Y,layerTransparency:$,xSlice:le,ySlice:fe,zSlice:ve}=uv(i,S,w,s,u),{obsSegmentations:V,onEntitySelected:ee,segmentationLayerCoordination:Z,segmentationChannelCoordination:ae,segmentationChannelScopesByLayer:pe}=i;let Te=()=>{};const ke=[];if(ae[0][P]!==void 0){const me=ae[0][P][P],{setObsHighlight:K}=ae[1][P][P];Te=K;const te=ae[0][P][P].additionalObsSets;te!==null&&me.obsSetSelection.forEach(Me=>{const he=Me[1];te.tree[0].children.forEach(Ve=>{Ve.name===he&&Ve.set.forEach(([we])=>{const Le={name:"",id:"",color:[255,255,255]};Le.name=he,Le.id=we,me.obsSetColor.forEach(je=>{je.path[1]===he&&(Le.color=je.color)}),ke.push(Le)})})}),me.obsHighlight!==null&&ke.push({name:"",id:me.obsHighlight,color:[255,34,0]})}if((dt=V==null?void 0:V[P])!=null&&dt.obsSegmentations&&d==null){const{scene:me,sceneOptions:K}=V[P].obsSegmentations;if(me!=null&&me.children){const te=new ul,Me=new or;Me.userData.name="finalPass",me.children.forEach(Ve=>{let we=Ve;we.material===void 0&&(we=Ve.children[0]),(we.material instanceof Sn||we.material instanceof ir)&&(we.material=new zl);let Le=we.name.replace("mesh_","").replace("mesh","").replace("glb","").replace("_dec","").replace("_Decobj","").replace("obj","").replace("_DEc","").replace(".","").replace("_Dec","");Le.includes("_")&&(Le=Le.split("_")[0]),we.name=Le,we.userData.name=Le,we.userData.layerScope=P,we.material.transparent=!0,we.material.writeDepthTexture=!0,we.material.depthTest=!0,we.material.depthWrite=!0,we.material.needsUpdate=!0,we.material.side=(K==null?void 0:K.materialSide)==="back"?Id:qr;const je=we.clone();je.geometry=we.geometry.clone(),je.geometry.translate((K==null?void 0:K.targetX)??0,(K==null?void 0:K.targetY)??0,(K==null?void 0:K.targetZ)??0),je.geometry.scale((K==null?void 0:K.scaleX)??1,(K==null?void 0:K.scaleY)??1,(K==null?void 0:K.scaleZ)??1),je.geometry.rotateX((K==null?void 0:K.rotationX)??0),je.geometry.rotateY((K==null?void 0:K.rotationY)??0),je.geometry.rotateZ((K==null?void 0:K.rotationZ)??0);const et=we.clone();et.material=we.material.clone(),et.geometry=je.geometry.clone(),Me.add(et)}),te.add(Me),te.scale.set((K==null?void 0:K.sceneScaleX)??1,(K==null?void 0:K.sceneScaleY)??1,(K==null?void 0:K.sceneScaleZ)??1);const he=[(K==null?void 0:K.sceneScaleX)??1,(K==null?void 0:K.sceneScaleY)??1,(K==null?void 0:K.sceneScaleZ)??1];m(he),te.rotateX((K==null?void 0:K.sceneRotationX)??0),te.rotateY((K==null?void 0:K.sceneRotationY)??0),te.rotateZ((K==null?void 0:K.sceneRotationZ)??0),f(te)}}if(ae[0]!==void 0&&ae[0][P]!==void 0){const me=ae[0][P][P];let K="";ke.forEach(Me=>{K+=`${Me.id};${Me.color.toString()};${Me.name}`});let te="";if(x.obsSets.forEach(Me=>{te+=`${Me.id};${Me.color.toString()};${Me.name}`}),pe[P].length>1){let Me="",he="",Ve="",we=!1,Le=0;pe[P].forEach(je=>{const et=ae[0][P][je];Me+=`${et.spatialChannelColor.toString()};`,he+=`${et.spatialChannelOpacity};`,Ve+=`${et.spatialChannelVisible};`,we|=et.spatialChannelVisible,Le+=et.spatialChannelOpacity}),(Me!==x.multiColor||he!==x.multiOpacity||Ve!==x.multiVisible)&&_({color:me.spatialChannelColor,opacity:Le,visible:we,multiColor:Me,multiVisible:Ve,multiOpacity:he,data:V,obsSets:ke})}else(me.spatialChannelColor.toString()!==x.color.toString()||me.spatialChannelVisible!==x.visible||me.spatialChannelOpacity!==x.opacity||K!==te)&&_({color:me.spatialChannelColor,opacity:me.spatialChannelOpacity,visible:me.spatialChannelVisible,multiColor:"",multiVisible:"",multiOpacity:"",data:V,obsSets:ke})}if(I.useEffect(()=>{if(d!==null){let me=0,K=0;for(let te=0;te<d.children.length;te++)d.children[te].userData.name==="finalPass"?K=te:me=te;d.children[K].children.forEach((te,Me)=>{var we;let{color:he}=x;const Ve=te.userData.name;if(x.obsSets.forEach(Le=>{Le.id===Ve&&(he=Le.color)}),pe[P].length>1)pe[P].forEach(Le=>{const je=ae[0][P][Le];je.spatialTargetC===Ve&&(te.material.color.r=je.spatialChannelColor[0]/255,te.material.color.g=je.spatialChannelColor[1]/255,te.material.color.b=je.spatialChannelColor[2]/255,te.material.opacity=je.spatialChannelOpacity,te.visible=je.spatialChannelVisible,te.material.needsUpdate=!0,te.userData.layerScope=P,te.userData.channelScope=Le,d.children[me].children[Me].material.needsUpdate=!0)});else{te.material.color.r=he[0]/255,te.material.color.g=he[1]/255,te.material.color.b=he[2]/255,te.material.opacity=x.opacity,te.material.visible=x.visible,te.material.needsUpdate=!0,te.userData.layerScope=P;const Le=(we=Object.keys(ae[0][P]))==null?void 0:we[0];te.userData.channelScope=Le}})}},[x,d]),((fn=(_n=(Yt=E[P])==null?void 0:Yt.image)==null?void 0:_n.instance)==null?void 0:fn.getData())!==void 0&&!s&&!l&&B!==null&&B[0][1]!==255&&F&&(u(!0),o(!0)),I.useEffect(()=>{const me=async()=>{const K=await yv(R,N,z,b.volumes,b.textures,b.volumeMinMax,b.resolution);if(K[0]!==null)if(A({resolution:N,volumes:K[0],textures:K[1],volumeMinMax:K[2],scale:K[3]!==null?K[3]:b.scale,originalScale:K[4]}),!g.uniforms||!g.shader){const te=Rd(K[0],R,M,D,K[1],B,K[2],K[3],Y,$,le,fe,ve,K[4]);te!==null&&v({uniforms:te[0],shader:te[1],meshScale:te[2],geometrySize:te[3],boxSize:te[4]})}else w({channelsVisible:M,allChannels:L,channelTargetC:R,resolution:N,data:z,colors:D,contrastLimits:B,is3dMode:F,renderingMode:Y,layerTransparency:$,xSlice:le,ySlice:fe,zSlice:ve})};s&&(N!==S.resolution&&r.current&&(r.current.material.uniforms.volumeCount.value=0,r.current.material.uniforms.volumeTex.value=null),me(),u(!1))},[s]),I.useEffect(()=>{var me,K,te,Me;if(g.uniforms&&g.shader){const he=Rd(b.volumes,S.channelTargetC,S.channelsVisible,S.colors,b.textures,S.contrastLimits,b.volumeMinMax,b.scale,S.renderingMode,S.layerTransparency,S.xSlice,S.ySlice,S.zSlice,b.originalScale);if(he!==null){let Ve=0;S.channelsVisible.forEach(we=>{we&&Ve++}),u(!1),(K=(me=r==null?void 0:r.current)==null?void 0:me.material)!=null&&K.uniforms&&(r.current.material.uniforms.u_clim.value=he[0].u_clim.value,r.current.material.uniforms.u_clim2.value=he[0].u_clim2.value,r.current.material.uniforms.u_clim3.value=he[0].u_clim3.value,r.current.material.uniforms.u_clim4.value=he[0].u_clim4.value,r.current.material.uniforms.u_clim5.value=he[0].u_clim5.value,r.current.material.uniforms.u_clim6.value=he[0].u_clim6.value,r.current.material.uniforms.u_xClip.value=he[0].u_xClip.value,r.current.material.uniforms.u_yClip.value=he[0].u_yClip.value,r.current.material.uniforms.u_zClip.value=he[0].u_zClip.value,r.current.material.uniforms.u_color.value=he[0].u_color.value,r.current.material.uniforms.u_color2.value=he[0].u_color2.value,r.current.material.uniforms.u_color3.value=he[0].u_color3.value,r.current.material.uniforms.u_color4.value=he[0].u_color4.value,r.current.material.uniforms.u_color5.value=he[0].u_color5.value,r.current.material.uniforms.u_color6.value=he[0].u_color6.value,r.current.material.uniforms.volumeTex.value=he[0].volumeTex.value,r.current.material.uniforms.volumeTex2.value=he[0].volumeTex2.value,r.current.material.uniforms.volumeTex3.value=he[0].volumeTex3.value,r.current.material.uniforms.volumeTex4.value=he[0].volumeTex4.value,r.current.material.uniforms.volumeTex5.value=he[0].volumeTex5.value,r.current.material.uniforms.volumeTex6.value=he[0].volumeTex6.value,r.current.material.uniforms.volumeCount.value=Ve,r.current.material.uniforms.u_renderstyle.value=S.renderingMode,r.current.material.uniforms.dtScale.value=S.layerTransparency)}else(Me=(te=r==null?void 0:r.current)==null?void 0:te.material)!=null&&Me.uniforms&&(r.current.material.uniforms.volumeCount.value=0,r.current.material.uniforms.volumeTex.value=null)}},[S]),!S.is3dMode)return null;if(S.is3dMode&&(!g.uniforms||!g.shader))return ne.jsxs("group",{children:[ne.jsx("ambientLight",{}),ne.jsx("pointLight",{position:[10,10,10]}),ne.jsx(yf,{color:"white",scale:20,fontWeight:1e3,children:"Loading ..."})]});const St={segmentationGroup:d,segmentationSettings:x,segmentationSceneScale:p,renderingSettings:g,materialRef:r,highlightEntity:ee,setObsHighlight:Te};return ne.jsxs("group",{children:[ne.jsx(Ug,{}),ne.jsx(Yg,{}),ne.jsx(nv,{}),ne.jsx(iv,{}),ne.jsx(rv,{...St}),ne.jsx(Qg,{ref:n,enableDamping:!1,dampingFactor:0,zoomDampingFactor:0,smoothZoom:!1})]})}const wv=I.forwardRef((i,r)=>ne.jsxs("div",{style:{width:"100%",height:"100%"},children:[ne.jsx(Fl,{mode:"AR",sessionInit:{optionalFeatures:["hand-tracking"]},style:{border:"none",background:"rgba(0, 0, 0, 0.0)",zIndex:1,position:"absolute"},children:n=>n!=="unsupported"?ne.jsx("div",{style:{border:"1px solid white",padding:"12px 24px",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",cursor:"pointer"},children:n==="entered"?"Exit AR":"Enter AR"}):null}),ne.jsx(_m,{style:{position:"absolute",top:0,left:0},camera:{fov:50,up:[0,1,0],position:[0,0,800],near:.1,far:3e3},gl:{antialias:!0,logarithmicDepthBuffer:!1},ref:r,children:ne.jsx(Rm,{children:ne.jsx(bv,{...i})})})]}));export{wv as SpatialWrapper};
