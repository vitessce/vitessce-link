import{j as wn,F as zt,aM as Tn,S as Cn,y as Fn,Z as Rn,U as on,a_ as Dn,e as Oe,b as Vt,N as vt,aS as In,g as pt,V as Mn,a$ as gt,d as An,aN as En,H as Gn,J as On,t as mt,aA as Pn,b0 as Bn,b1 as Ln,b2 as Wn,b3 as zn}from"./index-C5HvPDkI.js";function Vn(){var d=Object.create(null);function t(e,r){var a=e.id,o=e.name,n=e.dependencies;n===void 0&&(n=[]);var i=e.init;i===void 0&&(i=function(){});var s=e.getTransferables;if(s===void 0&&(s=null),!d[a])try{n=n.map(function(u){return u&&u.isWorkerModule&&(t(u,function(f){if(f instanceof Error)throw f}),u=d[u.id].value),u}),i=h("<"+o+">.init",i),s&&(s=h("<"+o+">.getTransferables",s));var l=null;typeof i=="function"?l=i.apply(void 0,n):console.error("worker module init function failed to rehydrate"),d[a]={id:a,value:l,getTransferables:s},r(l)}catch(u){u&&u.noLog||console.error(u),r(u)}}function c(e,r){var a,o=e.id,n=e.args;(!d[o]||typeof d[o].value!="function")&&r(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(a=d[o]).value.apply(a,n);i&&typeof i.then=="function"?i.then(s,function(l){return r(l instanceof Error?l:new Error(""+l))}):s(i)}catch(l){r(l)}function s(l){try{var u=d[o].getTransferables&&d[o].getTransferables(l);(!u||!Array.isArray(u)||!u.length)&&(u=void 0),r(l,u)}catch(f){console.error(f),r(f)}}}function h(e,r){var a=void 0;self.troikaDefine=function(n){return a=n};var o=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+` **/

troikaDefine(
`+r+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(n){console.error(n)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(e){var r=e.data,a=r.messageId,o=r.action,n=r.data;try{o==="registerModule"&&t(n,function(i){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof i=="function"}})}),o==="callModule"&&c(n,function(i,s){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:i},s||void 0)})}catch(i){postMessage({messageId:a,success:!1,error:i.stack})}})}function jn(d){var t=function(){for(var c=[],h=arguments.length;h--;)c[h]=arguments[h];return t._getInitResult().then(function(e){if(typeof e=="function")return e.apply(void 0,c);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var c=d.dependencies,h=d.init;c=Array.isArray(c)?c.map(function(r){return r&&r._getInitResult?r._getInitResult():r}):[];var e=Promise.all(c).then(function(r){return h.apply(null,r)});return t._getInitResult=function(){return e},e},t}var sn=function(){var d=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),d=!0}catch(c){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+c.message+"]")}return sn=function(){return d},d},Nn=0,$n=0,it=!1,me=Object.create(null),ye=Object.create(null),ft=Object.create(null);function oe(d){if((!d||typeof d.init!="function")&&!it)throw new Error("requires `options.init` function");var t=d.dependencies,c=d.init,h=d.getTransferables,e=d.workerId;if(!sn())return jn(d);e==null&&(e="#default");var r="workerModule"+ ++Nn,a=d.name||r,o=null;t=t&&t.map(function(i){return typeof i=="function"&&!i.workerModuleData&&(it=!0,i=oe({workerId:e,name:"<"+a+"> function dependency: "+i.name,init:`function(){return (
`+Ee(i)+`
)}`}),it=!1),i&&i.workerModuleData&&(i=i.workerModuleData),i});function n(){for(var i=[],s=arguments.length;s--;)i[s]=arguments[s];if(!o){o=jt(e,"registerModule",n.workerModuleData);var l=function(){o=null,ye[e].delete(l)};(ye[e]||(ye[e]=new Set)).add(l)}return o.then(function(u){var f=u.isCallable;if(f)return jt(e,"callModule",{id:r,args:i});throw new Error("Worker module function was called but `init` did not return a callable function")})}return n.workerModuleData={isWorkerModule:!0,id:r,name:a,dependencies:t,init:Ee(c),getTransferables:h&&Ee(h)},n}function Hn(d){ye[d]&&ye[d].forEach(function(t){t()}),me[d]&&(me[d].terminate(),delete me[d])}function Ee(d){var t=d.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function qn(d){var t=me[d];if(!t){var c=Ee(Vn);t=me[d]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+d.replace(/\*/g,"")+` **/

;(`+c+")()"],{type:"application/javascript"}))),t.onmessage=function(h){var e=h.data,r=e.messageId,a=ft[r];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete ft[r],a(e)}}return t}function jt(d,t,c){return new Promise(function(h,e){var r=++$n;ft[r]=function(a){a.success?h(a.result):e(new Error("Error in worker "+t+" call: "+a.error))},qn(d).postMessage({messageId:r,action:t,data:c})})}function ln(){var d=function(t){function c(G,E,v,b,w,T,S,L){var I=1-S;L.x=I*I*G+2*I*S*v+S*S*w,L.y=I*I*E+2*I*S*b+S*S*T}function h(G,E,v,b,w,T,S,L,I,B){var q=1-I;B.x=q*q*q*G+3*q*q*I*v+3*q*I*I*w+I*I*I*S,B.y=q*q*q*E+3*q*q*I*b+3*q*I*I*T+I*I*I*L}function e(G,E){for(var v=/([MLQCZ])([^MLQCZ]*)/g,b,w,T,S,L;b=v.exec(G);){var I=b[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(B){return parseFloat(B)});switch(b[1]){case"M":S=w=I[0],L=T=I[1];break;case"L":(I[0]!==S||I[1]!==L)&&E("L",S,L,S=I[0],L=I[1]);break;case"Q":{E("Q",S,L,S=I[2],L=I[3],I[0],I[1]);break}case"C":{E("C",S,L,S=I[4],L=I[5],I[0],I[1],I[2],I[3]);break}case"Z":(S!==w||L!==T)&&E("L",S,L,w,T);break}}}function r(G,E,v){v===void 0&&(v=16);var b={x:0,y:0};e(G,function(w,T,S,L,I,B,q,Z,N){switch(w){case"L":E(T,S,L,I);break;case"Q":{for(var z=T,fr=S,hr=1;hr<v;hr++)c(T,S,B,q,L,I,hr/(v-1),b),E(z,fr,b.x,b.y),z=b.x,fr=b.y;break}case"C":{for(var tr=T,Q=S,lr=1;lr<v;lr++)h(T,S,B,q,Z,N,L,I,lr/(v-1),b),E(tr,Q,b.x,b.y),tr=b.x,Q=b.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(G,E){var v=G.getContext?G.getContext("webgl",i):G,b=n.get(v);if(!b){let q=function(tr){var Q=T[tr];if(!Q&&(Q=T[tr]=v.getExtension(tr),!Q))throw new Error(tr+" not supported");return Q},Z=function(tr,Q){var lr=v.createShader(Q);return v.shaderSource(lr,tr),v.compileShader(lr),lr},N=function(tr,Q,lr,W){if(!S[tr]){var or={},X={},P=v.createProgram();v.attachShader(P,Z(Q,v.VERTEX_SHADER)),v.attachShader(P,Z(lr,v.FRAGMENT_SHADER)),v.linkProgram(P),S[tr]={program:P,transaction:function(pr){v.useProgram(P),pr({setUniform:function(J,rr){for(var K=[],er=arguments.length-2;er-- >0;)K[er]=arguments[er+2];var gr=X[rr]||(X[rr]=v.getUniformLocation(P,rr));v["uniform"+J].apply(v,[gr].concat(K))},setAttribute:function(J,rr,K,er,gr){var Y=or[J];Y||(Y=or[J]={buf:v.createBuffer(),loc:v.getAttribLocation(P,J),data:null}),v.bindBuffer(v.ARRAY_BUFFER,Y.buf),v.vertexAttribPointer(Y.loc,rr,v.FLOAT,!1,0,0),v.enableVertexAttribArray(Y.loc),w?v.vertexAttribDivisor(Y.loc,er):q("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Y.loc,er),gr!==Y.data&&(v.bufferData(v.ARRAY_BUFFER,gr,K),Y.data=gr)}})}}}S[tr].transaction(W)},z=function(tr,Q){I++;try{v.activeTexture(v.TEXTURE0+I);var lr=L[tr];lr||(lr=L[tr]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,lr),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,lr),Q(lr,I)}finally{I--}},fr=function(tr,Q,lr){var W=v.createFramebuffer();B.push(W),v.bindFramebuffer(v.FRAMEBUFFER,W),v.activeTexture(v.TEXTURE0+Q),v.bindTexture(v.TEXTURE_2D,tr),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,tr,0);try{lr(W)}finally{v.deleteFramebuffer(W),v.bindFramebuffer(v.FRAMEBUFFER,B[--B.length-1]||null)}},hr=function(){T={},S={},L={},I=-1,B.length=0};var w=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,T={},S={},L={},I=-1,B=[];v.canvas.addEventListener("webglcontextlost",function(tr){hr(),tr.preventDefault()},!1),n.set(v,b={gl:v,isWebGL2:w,getExtension:q,withProgram:N,withTexture:z,withTextureFramebuffer:fr,handleContextLoss:hr})}E(b)}function l(G,E,v,b,w,T,S,L){S===void 0&&(S=15),L===void 0&&(L=null),s(G,function(I){var B=I.gl,q=I.withProgram,Z=I.withTexture;Z("copy",function(N,z){B.texImage2D(B.TEXTURE_2D,0,B.RGBA,w,T,0,B.RGBA,B.UNSIGNED_BYTE,E),q("copy",a,o,function(fr){var hr=fr.setUniform,tr=fr.setAttribute;tr("aUV",2,B.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),hr("1i","image",z),B.bindFramebuffer(B.FRAMEBUFFER,L||null),B.disable(B.BLEND),B.colorMask(S&8,S&4,S&2,S&1),B.viewport(v,b,w,T),B.scissor(v,b,w,T),B.drawArrays(B.TRIANGLES,0,3)})})})}function u(G,E,v){var b=G.width,w=G.height;s(G,function(T){var S=T.gl,L=new Uint8Array(b*w*4);S.readPixels(0,0,b,w,S.RGBA,S.UNSIGNED_BYTE,L),G.width=E,G.height=v,l(S,L,0,0,b,w)})}var f=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:l,resizeWebGLCanvasWithoutClearing:u});function p(G,E,v,b,w,T){T===void 0&&(T=1);var S=new Uint8Array(G*E),L=b[2]-b[0],I=b[3]-b[1],B=[];r(v,function(tr,Q,lr,W){B.push({x1:tr,y1:Q,x2:lr,y2:W,minX:Math.min(tr,lr),minY:Math.min(Q,W),maxX:Math.max(tr,lr),maxY:Math.max(Q,W)})}),B.sort(function(tr,Q){return tr.maxX-Q.maxX});for(var q=0;q<G;q++)for(var Z=0;Z<E;Z++){var N=fr(b[0]+L*(q+.5)/G,b[1]+I*(Z+.5)/E),z=Math.pow(1-Math.abs(N)/w,T)/2;N<0&&(z=1-z),z=Math.max(0,Math.min(255,Math.round(z*255))),S[Z*G+q]=z}return S;function fr(tr,Q){for(var lr=1/0,W=1/0,or=B.length;or--;){var X=B[or];if(X.maxX+W<=tr)break;if(tr+W>X.minX&&Q-W<X.maxY&&Q+W>X.minY){var P=M(tr,Q,X.x1,X.y1,X.x2,X.y2);P<lr&&(lr=P,W=Math.sqrt(lr))}}return hr(tr,Q)&&(W=-W),W}function hr(tr,Q){for(var lr=0,W=B.length;W--;){var or=B[W];if(or.maxX<=tr)break;var X=or.y1>Q!=or.y2>Q&&tr<(or.x2-or.x1)*(Q-or.y1)/(or.y2-or.y1)+or.x1;X&&(lr+=or.y1<or.y2?1:-1)}return lr!==0}}function m(G,E,v,b,w,T,S,L,I,B){T===void 0&&(T=1),L===void 0&&(L=0),I===void 0&&(I=0),B===void 0&&(B=0),y(G,E,v,b,w,T,S,null,L,I,B)}function y(G,E,v,b,w,T,S,L,I,B,q){T===void 0&&(T=1),I===void 0&&(I=0),B===void 0&&(B=0),q===void 0&&(q=0);for(var Z=p(G,E,v,b,w,T),N=new Uint8Array(Z.length*4),z=0;z<Z.length;z++)N[z*4+q]=Z[z];l(S,N,I,B,G,E,1<<3-q,L)}function M(G,E,v,b,w,T){var S=w-v,L=T-b,I=S*S+L*L,B=I?Math.max(0,Math.min(1,((G-v)*S+(E-b)*L)/I)):0,q=G-(v+B*S),Z=E-(b+B*L);return q*q+Z*Z}var F=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:m,generateIntoFramebuffer:y}),C="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",x="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",k="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",A=new Float32Array([0,0,2,0,0,2]),U=null,_=!1,O={},V=new WeakMap;function H(G){if(!_&&!$(G))throw new Error("WebGL generation not supported")}function g(G,E,v,b,w,T,S){if(T===void 0&&(T=1),S===void 0&&(S=null),!S&&(S=U,!S)){var L=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!L)throw new Error("OffscreenCanvas or DOM canvas not supported");S=U=L.getContext("webgl",{depth:!1})}H(S);var I=new Uint8Array(G*E*4);s(S,function(N){var z=N.gl,fr=N.withTexture,hr=N.withTextureFramebuffer;fr("readable",function(tr,Q){z.texImage2D(z.TEXTURE_2D,0,z.RGBA,G,E,0,z.RGBA,z.UNSIGNED_BYTE,null),hr(tr,Q,function(lr){R(G,E,v,b,w,T,z,lr,0,0,0),z.readPixels(0,0,G,E,z.RGBA,z.UNSIGNED_BYTE,I)})})});for(var B=new Uint8Array(G*E),q=0,Z=0;q<I.length;q+=4)B[Z++]=I[q];return B}function D(G,E,v,b,w,T,S,L,I,B){T===void 0&&(T=1),L===void 0&&(L=0),I===void 0&&(I=0),B===void 0&&(B=0),R(G,E,v,b,w,T,S,null,L,I,B)}function R(G,E,v,b,w,T,S,L,I,B,q){T===void 0&&(T=1),I===void 0&&(I=0),B===void 0&&(B=0),q===void 0&&(q=0),H(S);var Z=[];r(v,function(N,z,fr,hr){Z.push(N,z,fr,hr)}),Z=new Float32Array(Z),s(S,function(N){var z=N.gl,fr=N.isWebGL2,hr=N.getExtension,tr=N.withProgram,Q=N.withTexture,lr=N.withTextureFramebuffer,W=N.handleContextLoss;if(Q("rawDistances",function(or,X){(G!==or._lastWidth||E!==or._lastHeight)&&z.texImage2D(z.TEXTURE_2D,0,z.RGBA,or._lastWidth=G,or._lastHeight=E,0,z.RGBA,z.UNSIGNED_BYTE,null),tr("main",C,x,function(P){var pr=P.setAttribute,J=P.setUniform,rr=!fr&&hr("ANGLE_instanced_arrays"),K=!fr&&hr("EXT_blend_minmax");pr("aUV",2,z.STATIC_DRAW,0,A),pr("aLineSegment",4,z.DYNAMIC_DRAW,1,Z),J.apply(void 0,["4f","uGlyphBounds"].concat(b)),J("1f","uMaxDistance",w),J("1f","uExponent",T),lr(or,X,function(er){z.enable(z.BLEND),z.colorMask(!0,!0,!0,!0),z.viewport(0,0,G,E),z.scissor(0,0,G,E),z.blendFunc(z.ONE,z.ONE),z.blendEquationSeparate(z.FUNC_ADD,fr?z.MAX:K.MAX_EXT),z.clear(z.COLOR_BUFFER_BIT),fr?z.drawArraysInstanced(z.TRIANGLES,0,3,Z.length/4):rr.drawArraysInstancedANGLE(z.TRIANGLES,0,3,Z.length/4)})}),tr("post",a,k,function(P){P.setAttribute("aUV",2,z.STATIC_DRAW,0,A),P.setUniform("1i","tex",X),z.bindFramebuffer(z.FRAMEBUFFER,L),z.disable(z.BLEND),z.colorMask(q===0,q===1,q===2,q===3),z.viewport(I,B,G,E),z.scissor(I,B,G,E),z.drawArrays(z.TRIANGLES,0,3)})}),z.isContextLost())throw W(),new Error("webgl context lost")})}function $(G){var E=!G||G===U?O:G.canvas||G,v=V.get(E);if(v===void 0){_=!0;var b=null;try{var w=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],T=g(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,G);v=T&&w.length===T.length&&T.every(function(S,L){return S===w[L]}),v||(b="bad trial run results",console.info(w,T))}catch(S){v=!1,b=S.message}b&&console.warn("WebGL SDF generation not supported:",b),_=!1,V.set(E,v)}return v}var j=Object.freeze({__proto__:null,generate:g,generateIntoCanvas:D,generateIntoFramebuffer:R,isSupported:$});function nr(G,E,v,b,w,T){w===void 0&&(w=Math.max(b[2]-b[0],b[3]-b[1])/2),T===void 0&&(T=1);try{return g.apply(j,arguments)}catch(S){return console.info("WebGL SDF generation failed, falling back to JS",S),p.apply(F,arguments)}}function sr(G,E,v,b,w,T,S,L,I,B){w===void 0&&(w=Math.max(b[2]-b[0],b[3]-b[1])/2),T===void 0&&(T=1),L===void 0&&(L=0),I===void 0&&(I=0),B===void 0&&(B=0);try{return D.apply(j,arguments)}catch(q){return console.info("WebGL SDF generation failed, falling back to JS",q),m.apply(F,arguments)}}return t.forEachPathCommand=e,t.generate=nr,t.generateIntoCanvas=sr,t.javascript=F,t.pathToLineSegments=r,t.webgl=j,t.webglUtils=f,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return d}function Xn(){var d=function(t){var c={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},h={},e={};h.L=1,e[1]="L",Object.keys(c).forEach(function(W,or){h[W]=1<<or+1,e[h[W]]=W}),Object.freeze(h);var r=h.LRI|h.RLI|h.FSI,a=h.L|h.R|h.AL,o=h.B|h.S|h.WS|h.ON|h.FSI|h.LRI|h.RLI|h.PDI,n=h.BN|h.RLE|h.LRE|h.RLO|h.LRO|h.PDF,i=h.S|h.WS|h.B|r|h.PDI|n,s=null;function l(){if(!s){s=new Map;var W=function(X){if(c.hasOwnProperty(X)){var P=0;c[X].split(",").forEach(function(pr){var J=pr.split("+"),rr=J[0],K=J[1];rr=parseInt(rr,36),K=K?parseInt(K,36):0,s.set(P+=rr,h[X]);for(var er=0;er<K;er++)s.set(++P,h[X])})}};for(var or in c)W(or)}}function u(W){return l(),s.get(W.codePointAt(0))||h.L}function f(W){return e[u(W)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(W,or){var X=36,P=0,pr=new Map,J=or&&new Map,rr;return W.split(",").forEach(function K(er){if(er.indexOf("+")!==-1)for(var gr=+er;gr--;)K(rr);else{rr=er;var Y=er.split(">"),dr=Y[0],Sr=Y[1];dr=String.fromCodePoint(P+=parseInt(dr,X)),Sr=String.fromCodePoint(P+=parseInt(Sr,X)),pr.set(dr,Sr),or&&J.set(Sr,dr)}}),{map:pr,reverseMap:J}}var y,M,F;function C(){if(!y){var W=m(p.pairs,!0),or=W.map,X=W.reverseMap;y=or,M=X,F=m(p.canonical,!1).map}}function x(W){return C(),y.get(W)||null}function k(W){return C(),M.get(W)||null}function A(W){return C(),F.get(W)||null}var U=h.L,_=h.R,O=h.EN,V=h.ES,H=h.ET,g=h.AN,D=h.CS,R=h.B,$=h.S,j=h.ON,nr=h.BN,sr=h.NSM,G=h.AL,E=h.LRO,v=h.RLO,b=h.LRE,w=h.RLE,T=h.PDF,S=h.LRI,L=h.RLI,I=h.FSI,B=h.PDI;function q(W,or){for(var X=125,P=new Uint32Array(W.length),pr=0;pr<W.length;pr++)P[pr]=u(W[pr]);var J=new Map;function rr(Er,Lr){var Gr=P[Er];P[Er]=Lr,J.set(Gr,J.get(Gr)-1),Gr&o&&J.set(o,J.get(o)-1),J.set(Lr,(J.get(Lr)||0)+1),Lr&o&&J.set(o,(J.get(o)||0)+1)}for(var K=new Uint8Array(W.length),er=new Map,gr=[],Y=null,dr=0;dr<W.length;dr++)Y||gr.push(Y={start:dr,end:W.length-1,level:or==="rtl"?1:or==="ltr"?0:Lt(dr,!1)}),P[dr]&R&&(Y.end=dr,Y=null);for(var Sr=w|b|v|E|r|B|T|R,_r=function(Er){return Er+(Er&1?1:2)},yr=function(Er){return Er+(Er&1?2:1)},Fr=0;Fr<gr.length;Fr++){Y=gr[Fr];var ir=[{_level:Y.level,_override:0,_isolate:0}],mr=void 0,wr=0,kr=0,Ar=0;J.clear();for(var ur=Y.start;ur<=Y.end;ur++){var cr=P[ur];if(mr=ir[ir.length-1],J.set(cr,(J.get(cr)||0)+1),cr&o&&J.set(o,(J.get(o)||0)+1),cr&Sr)if(cr&(w|b)){K[ur]=mr._level;var $r=(cr===w?yr:_r)(mr._level);$r<=X&&!wr&&!kr?ir.push({_level:$r,_override:0,_isolate:0}):wr||kr++}else if(cr&(v|E)){K[ur]=mr._level;var xr=(cr===v?yr:_r)(mr._level);xr<=X&&!wr&&!kr?ir.push({_level:xr,_override:cr&v?_:U,_isolate:0}):wr||kr++}else if(cr&r){cr&I&&(cr=Lt(ur+1,!0)===1?L:S),K[ur]=mr._level,mr._override&&rr(ur,mr._override);var br=(cr===L?yr:_r)(mr._level);br<=X&&wr===0&&kr===0?(Ar++,ir.push({_level:br,_override:0,_isolate:1,_isolInitIndex:ur})):wr++}else if(cr&B){if(wr>0)wr--;else if(Ar>0){for(kr=0;!ir[ir.length-1]._isolate;)ir.pop();var Rr=ir[ir.length-1]._isolInitIndex;Rr!=null&&(er.set(Rr,ur),er.set(ur,Rr)),ir.pop(),Ar--}mr=ir[ir.length-1],K[ur]=mr._level,mr._override&&rr(ur,mr._override)}else cr&T?(wr===0&&(kr>0?kr--:!mr._isolate&&ir.length>1&&(ir.pop(),mr=ir[ir.length-1])),K[ur]=mr._level):cr&R&&(K[ur]=Y.level);else K[ur]=mr._level,mr._override&&cr!==nr&&rr(ur,mr._override)}for(var Tr=[],vr=null,Ur=Y.start;Ur<=Y.end;Ur++){var Ir=P[Ur];if(!(Ir&n)){var Mr=K[Ur],Cr=Ir&r,Vr=Ir===B;vr&&Mr===vr._level?(vr._end=Ur,vr._endsWithIsolInit=Cr):Tr.push(vr={_start:Ur,_end:Ur,_level:Mr,_startsWithPDI:Vr,_endsWithIsolInit:Cr})}}for(var Jr=[],jr=0;jr<Tr.length;jr++){var Nr=Tr[jr];if(!Nr._startsWithPDI||Nr._startsWithPDI&&!er.has(Nr._start)){for(var Hr=[vr=Nr],Yr=void 0;vr&&vr._endsWithIsolInit&&(Yr=er.get(vr._end))!=null;)for(var Or=jr+1;Or<Tr.length;Or++)if(Tr[Or]._start===Yr){Hr.push(vr=Tr[Or]);break}for(var Wr=[],Le=0;Le<Hr.length;Le++)for(var bt=Hr[Le],We=bt._start;We<=bt._end;We++)Wr.push(We);for(var bn=K[Wr[0]],xt=Y.level,be=Wr[0]-1;be>=0;be--)if(!(P[be]&n)){xt=K[be];break}var ze=Wr[Wr.length-1],xn=K[ze],Ut=Y.level;if(!(P[ze]&r)){for(var xe=ze+1;xe<=Y.end;xe++)if(!(P[xe]&n)){Ut=K[xe];break}}Jr.push({_seqIndices:Wr,_sosType:Math.max(xt,bn)%2?_:U,_eosType:Math.max(Ut,xn)%2?_:U})}}for(var Ve=0;Ve<Jr.length;Ve++){var je=Jr[Ve],ar=je._seqIndices,ie=je._sosType,Un=je._eosType,re=K[ar[0]]&1?_:U;if(J.get(sr))for(var Ue=0;Ue<ar.length;Ue++){var St=ar[Ue];if(P[St]&sr){for(var Ne=ie,Se=Ue-1;Se>=0;Se--)if(!(P[ar[Se]]&n)){Ne=P[ar[Se]];break}rr(St,Ne&(r|B)?j:Ne)}}if(J.get(O))for(var ke=0;ke<ar.length;ke++){var kt=ar[ke];if(P[kt]&O)for(var _e=ke-1;_e>=-1;_e--){var _t=_e===-1?ie:P[ar[_e]];if(_t&a){_t===G&&rr(kt,g);break}}}if(J.get(G))for(var $e=0;$e<ar.length;$e++){var wt=ar[$e];P[wt]&G&&rr(wt,_)}if(J.get(V)||J.get(D))for(var se=1;se<ar.length-1;se++){var He=ar[se];if(P[He]&(V|D)){for(var ee=0,qe=0,Xe=se-1;Xe>=0&&(ee=P[ar[Xe]],!!(ee&n));Xe--);for(var Je=se+1;Je<ar.length&&(qe=P[ar[Je]],!!(qe&n));Je++);ee===qe&&(P[He]===V?ee===O:ee&(O|g))&&rr(He,ee)}}if(J.get(O))for(var zr=0;zr<ar.length;zr++){var Sn=ar[zr];if(P[Sn]&O){for(var we=zr-1;we>=0&&P[ar[we]]&(H|n);we--)rr(ar[we],O);for(zr++;zr<ar.length&&P[ar[zr]]&(H|n|O);zr++)P[ar[zr]]!==O&&rr(ar[zr],O)}}if(J.get(H)||J.get(V)||J.get(D))for(var le=0;le<ar.length;le++){var Tt=ar[le];if(P[Tt]&(H|V|D)){rr(Tt,j);for(var Te=le-1;Te>=0&&P[ar[Te]]&n;Te--)rr(ar[Te],j);for(var Ce=le+1;Ce<ar.length&&P[ar[Ce]]&n;Ce++)rr(ar[Ce],j)}}if(J.get(O))for(var Ye=0,Ct=ie;Ye<ar.length;Ye++){var Ft=ar[Ye],Ze=P[Ft];Ze&O?Ct===U&&rr(Ft,U):Ze&a&&(Ct=Ze)}if(J.get(o)){var ue=_|O|g,Rt=ue|U,Fe=[];{for(var te=[],ne=0;ne<ar.length;ne++)if(P[ar[ne]]&o){var fe=W[ar[ne]],Dt=void 0;if(x(fe)!==null)if(te.length<63)te.push({char:fe,seqIndex:ne});else break;else if((Dt=k(fe))!==null)for(var he=te.length-1;he>=0;he--){var Ke=te[he].char;if(Ke===Dt||Ke===k(A(fe))||x(A(Ke))===fe){Fe.push([te[he].seqIndex,ne]),te.length=he;break}}}Fe.sort(function(Er,Lr){return Er[0]-Lr[0]})}for(var Qe=0;Qe<Fe.length;Qe++){for(var It=Fe[Qe],Re=It[0],rt=It[1],Mt=!1,Br=0,et=Re+1;et<rt;et++){var At=ar[et];if(P[At]&Rt){Mt=!0;var Et=P[At]&ue?_:U;if(Et===re){Br=Et;break}}}if(Mt&&!Br){Br=ie;for(var tt=Re-1;tt>=0;tt--){var Gt=ar[tt];if(P[Gt]&Rt){var Ot=P[Gt]&ue?_:U;Ot!==re?Br=Ot:Br=re;break}}}if(Br){if(P[ar[Re]]=P[ar[rt]]=Br,Br!==re){for(var de=Re+1;de<ar.length;de++)if(!(P[ar[de]]&n)){u(W[ar[de]])&sr&&(P[ar[de]]=Br);break}}if(Br!==re){for(var ce=rt+1;ce<ar.length;ce++)if(!(P[ar[ce]]&n)){u(W[ar[ce]])&sr&&(P[ar[ce]]=Br);break}}}}for(var qr=0;qr<ar.length;qr++)if(P[ar[qr]]&o){for(var Pt=qr,nt=qr,at=ie,ve=qr-1;ve>=0;ve--)if(P[ar[ve]]&n)Pt=ve;else{at=P[ar[ve]]&ue?_:U;break}for(var Bt=Un,pe=qr+1;pe<ar.length;pe++)if(P[ar[pe]]&(o|n))nt=pe;else{Bt=P[ar[pe]]&ue?_:U;break}for(var ot=Pt;ot<=nt;ot++)P[ar[ot]]=at===Bt?at:re;qr=nt}}}for(var Pr=Y.start;Pr<=Y.end;Pr++){var kn=K[Pr],De=P[Pr];if(kn&1?De&(U|O|g)&&K[Pr]++:De&_?K[Pr]++:De&(g|O)&&(K[Pr]+=2),De&n&&(K[Pr]=Pr===0?Y.level:K[Pr-1]),Pr===Y.end||u(W[Pr])&($|R))for(var Ie=Pr;Ie>=0&&u(W[Ie])&i;Ie--)K[Ie]=Y.level}}return{levels:K,paragraphs:gr};function Lt(Er,Lr){for(var Gr=Er;Gr<W.length;Gr++){var Xr=P[Gr];if(Xr&(_|G))return 1;if(Xr&(R|U)||Lr&&Xr===B)return 0;if(Xr&r){var Wt=_n(Gr);Gr=Wt===-1?W.length:Wt}}return 0}function _n(Er){for(var Lr=1,Gr=Er+1;Gr<W.length;Gr++){var Xr=P[Gr];if(Xr&R)break;if(Xr&B){if(--Lr===0)return Gr}else Xr&r&&Lr++}return-1}}var Z="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",N;function z(){if(!N){var W=m(Z,!0),or=W.map,X=W.reverseMap;X.forEach(function(P,pr){or.set(pr,P)}),N=or}}function fr(W){return z(),N.get(W)||null}function hr(W,or,X,P){var pr=W.length;X=Math.max(0,X==null?0:+X),P=Math.min(pr-1,P==null?pr-1:+P);for(var J=new Map,rr=X;rr<=P;rr++)if(or[rr]&1){var K=fr(W[rr]);K!==null&&J.set(rr,K)}return J}function tr(W,or,X,P){var pr=W.length;X=Math.max(0,X==null?0:+X),P=Math.min(pr-1,P==null?pr-1:+P);var J=[];return or.paragraphs.forEach(function(rr){var K=Math.max(X,rr.start),er=Math.min(P,rr.end);if(K<er){for(var gr=or.levels.slice(K,er+1),Y=er;Y>=K&&u(W[Y])&i;Y--)gr[Y]=rr.level;for(var dr=rr.level,Sr=1/0,_r=0;_r<gr.length;_r++){var yr=gr[_r];yr>dr&&(dr=yr),yr<Sr&&(Sr=yr|1)}for(var Fr=dr;Fr>=Sr;Fr--)for(var ir=0;ir<gr.length;ir++)if(gr[ir]>=Fr){for(var mr=ir;ir+1<gr.length&&gr[ir+1]>=Fr;)ir++;ir>mr&&J.push([mr+K,ir+K])}}}),J}function Q(W,or,X,P){var pr=lr(W,or,X,P),J=[].concat(W);return pr.forEach(function(rr,K){J[K]=(or.levels[rr]&1?fr(W[rr]):null)||W[rr]}),J.join("")}function lr(W,or,X,P){for(var pr=tr(W,or,X,P),J=[],rr=0;rr<W.length;rr++)J[rr]=rr;return pr.forEach(function(K){for(var er=K[0],gr=K[1],Y=J.slice(er,gr+1),dr=Y.length;dr--;)J[gr-dr]=Y[dr]}),J}return t.closingToOpeningBracket=k,t.getBidiCharType=u,t.getBidiCharTypeName=f,t.getCanonicalBracket=A,t.getEmbeddingLevels=q,t.getMirroredCharacter=fr,t.getMirroredCharactersMap=hr,t.getReorderSegments=tr,t.getReorderedIndices=lr,t.getReorderedString=Q,t.openingToClosingBracket=x,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return d}const un=/\bvoid\s+main\s*\(\s*\)\s*{/g;function ht(d){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function c(h,e){let r=zn[e];return r?ht(r):h}return d.replace(t,c)}const Dr=[];for(let d=0;d<256;d++)Dr[d]=(d<16?"0":"")+d.toString(16);function Jn(){const d=Math.random()*4294967295|0,t=Math.random()*4294967295|0,c=Math.random()*4294967295|0,h=Math.random()*4294967295|0;return(Dr[d&255]+Dr[d>>8&255]+Dr[d>>16&255]+Dr[d>>24&255]+"-"+Dr[t&255]+Dr[t>>8&255]+"-"+Dr[t>>16&15|64]+Dr[t>>24&255]+"-"+Dr[c&63|128]+Dr[c>>8&255]+"-"+Dr[c>>16&255]+Dr[c>>24&255]+Dr[h&255]+Dr[h>>8&255]+Dr[h>>16&255]+Dr[h>>24&255]).toUpperCase()}const Zr=Object.assign||function(){let d=arguments[0];for(let t=1,c=arguments.length;t<c;t++){let h=arguments[t];if(h)for(let e in h)Object.prototype.hasOwnProperty.call(h,e)&&(d[e]=h[e])}return d},Yn=Date.now(),Nt=new WeakMap,$t=new Map;let Zn=1e10;function dt(d,t){const c=ea(t);let h=Nt.get(d);if(h||Nt.set(d,h=Object.create(null)),h[c])return new h[c];const e=`_onBeforeCompile${c}`,r=function(i,s){d.onBeforeCompile.call(this,i,s);const l=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let u=$t[l];if(!u){const f=Kn(this,i,t,c);u=$t[l]=f}i.vertexShader=u.vertexShader,i.fragmentShader=u.fragmentShader,Zr(i.uniforms,this.uniforms),t.timeUniform&&(i.uniforms[t.timeUniform]={get value(){return Date.now()-Yn}}),this[e]&&this[e](i)},a=function(){return o(t.chained?d:d.clone())},o=function(i){const s=Object.create(i,n);return Object.defineProperty(s,"baseMaterial",{value:d}),Object.defineProperty(s,"id",{value:Zn++}),s.uuid=Jn(),s.uniforms=Zr({},i.uniforms,t.uniforms),s.defines=Zr({},i.defines,t.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${c}`]="",s.extensions=Zr({},i.extensions,t.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return d.customProgramCacheKey()+"|"+c}},onBeforeCompile:{get(){return r},set(i){this[e]=i}},copy:{writable:!0,configurable:!0,value:function(i){return d.copy.call(this,i),!d.isShaderMaterial&&!d.isDerivedMaterial&&(Zr(this.extensions,i.extensions),Zr(this.defines,i.defines),Zr(this.uniforms,Pn.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const i=new d.constructor;return o(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=dt(d.isDerivedMaterial?d.getDepthMaterial():new Bn({depthPacking:Ln}),t),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=dt(d.isDerivedMaterial?d.getDistanceMaterial():new Wn,t),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:i,_distanceMaterial:s}=this;i&&i.dispose(),s&&s.dispose(),d.dispose.call(this)}}};return h[c]=a,new a}function Kn(d,{vertexShader:t,fragmentShader:c},h,e){let{vertexDefs:r,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:n,fragmentDefs:i,fragmentMainIntro:s,fragmentMainOutro:l,fragmentColorTransform:u,customRewriter:f,timeUniform:p}=h;if(r=r||"",a=a||"",o=o||"",i=i||"",s=s||"",l=l||"",(n||f)&&(t=ht(t)),(u||f)&&(c=c.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),c=ht(c)),f){let m=f({vertexShader:t,fragmentShader:c});t=m.vertexShader,c=m.fragmentShader}if(u){let m=[];c=c.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,y=>(m.push(y),"")),l=`${u}
${m.join(`
`)}
${l}`}if(p){const m=`
uniform float ${p};
`;r=m+r,i=m+i}return n&&(t=`vec3 troika_position_${e};
vec3 troika_normal_${e};
vec2 troika_uv_${e};
${t}
`,r=`${r}
void troikaVertexTransform${e}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${e} = vec3(position);
troika_normal_${e} = vec3(normal);
troika_uv_${e} = vec2(uv);
troikaVertexTransform${e}(troika_position_${e}, troika_normal_${e}, troika_uv_${e});
${a}
`,t=t.replace(/\b(position|normal|uv)\b/g,(m,y,M,F)=>/\battribute\s+vec[23]\s+$/.test(F.substr(0,M))?y:`troika_${y}_${e}`),d.map&&d.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${e}`))),t=Ht(t,e,r,a,o),c=Ht(c,e,i,s,l),{vertexShader:t,fragmentShader:c}}function Ht(d,t,c,h,e){return(h||e||c)&&(d=d.replace(un,`
${c}
void troikaOrigMain${t}() {`),d+=`
void main() {
  ${h}
  troikaOrigMain${t}();
  ${e}
}`),d}function Qn(d,t){return d==="uniforms"?void 0:typeof t=="function"?t.toString():t}let ra=0;const qt=new Map;function ea(d){const t=JSON.stringify(d,Qn);let c=qt.get(t);return c==null&&qt.set(t,c=++ra),c}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function ta(){return typeof window>"u"&&(self.window=self),function(d){var t={parse:function(e){var r=t._bin,a=new Uint8Array(e);if(r.readASCII(a,0,4)=="ttcf"){var o=4;r.readUshort(a,o),o+=2,r.readUshort(a,o),o+=2;var n=r.readUint(a,o);o+=4;for(var i=[],s=0;s<n;s++){var l=r.readUint(a,o);o+=4,i.push(t._readFont(a,l))}return i}return[t._readFont(a,0)]},_readFont:function(e,r){var a=t._bin,o=r;a.readFixed(e,r),r+=4;var n=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:e,_offset:o},l={},u=0;u<n;u++){var f=a.readASCII(e,r,4);r+=4,a.readUint(e,r),r+=4;var p=a.readUint(e,r);r+=4;var m=a.readUint(e,r);r+=4,l[f]={offset:p,length:m}}for(u=0;u<i.length;u++){var y=i[u];l[y]&&(s[y.trim()]=t[y.trim()].parse(e,l[y].offset,l[y].length,s))}return s},_tabOffset:function(e,r,a){for(var o=t._bin,n=o.readUshort(e,a+4),i=a+12,s=0;s<n;s++){var l=o.readASCII(e,i,4);i+=4,o.readUint(e,i),i+=4;var u=o.readUint(e,i);if(i+=4,o.readUint(e,i),i+=4,l==r)return u}return 0}};t._bin={readFixed:function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<8|e[r+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,a){for(var o=[],n=0;n<a;n++)o.push(t._bin.readUshort(e,r+2*n));return o},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,r,a){for(var o="",n=0;n<a;n++)o+=String.fromCharCode(e[r+n]);return o},readUnicode:function(e,r,a){for(var o="",n=0;n<a;n++){var i=e[r++]<<8|e[r++];o+=String.fromCharCode(i)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,a){var o=t._bin._tdec;return o&&r==0&&a==e.length?o.decode(e):t._bin.readASCII(e,r,a)},readBytes:function(e,r,a){for(var o=[],n=0;n<a;n++)o.push(e[r+n]);return o},readASCIIArray:function(e,r,a){for(var o=[],n=0;n<a;n++)o.push(String.fromCharCode(e[r+n]));return o},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,a,o,n){var i=t._bin,s={},l=r;i.readFixed(e,r),r+=4;var u=i.readUshort(e,r);r+=2;var f=i.readUshort(e,r);r+=2;var p=i.readUshort(e,r);return r+=2,s.scriptList=t._lctf.readScriptList(e,l+u),s.featureList=t._lctf.readFeatureList(e,l+f),s.lookupList=t._lctf.readLookupList(e,l+p,n),s},t._lctf.readLookupList=function(e,r,a){var o=t._bin,n=r,i=[],s=o.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var u=o.readUshort(e,r);r+=2;var f=t._lctf.readLookupTable(e,n+u,a);i.push(f)}return i},t._lctf.readLookupTable=function(e,r,a){var o=t._bin,n=r,i={tabs:[]};i.ltype=o.readUshort(e,r),r+=2,i.flag=o.readUshort(e,r),r+=2;var s=o.readUshort(e,r);r+=2;for(var l=i.ltype,u=0;u<s;u++){var f=o.readUshort(e,r);r+=2;var p=a(e,l,n+f,i);i.tabs.push(p)}return i},t._lctf.numOfOnes=function(e){for(var r=0,a=0;a<32;a++)e>>>a&1&&r++;return r},t._lctf.readClassDef=function(e,r){var a=t._bin,o=[],n=a.readUshort(e,r);if(r+=2,n==1){var i=a.readUshort(e,r);r+=2;var s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++)o.push(i+l),o.push(i+l),o.push(a.readUshort(e,r)),r+=2}if(n==2){var u=a.readUshort(e,r);for(r+=2,l=0;l<u;l++)o.push(a.readUshort(e,r)),r+=2,o.push(a.readUshort(e,r)),r+=2,o.push(a.readUshort(e,r)),r+=2}return o},t._lctf.getInterval=function(e,r){for(var a=0;a<e.length;a+=3){var o=e[a],n=e[a+1];if(e[a+2],o<=r&&r<=n)return a}return-1},t._lctf.readCoverage=function(e,r){var a=t._bin,o={};o.fmt=a.readUshort(e,r),r+=2;var n=a.readUshort(e,r);return r+=2,o.fmt==1&&(o.tab=a.readUshorts(e,r,n)),o.fmt==2&&(o.tab=a.readUshorts(e,r,3*n)),o},t._lctf.coverageIndex=function(e,r){var a=e.tab;if(e.fmt==1)return a.indexOf(r);if(e.fmt==2){var o=t._lctf.getInterval(a,r);if(o!=-1)return a[o+2]+(r-a[o])}return-1},t._lctf.readFeatureList=function(e,r){var a=t._bin,o=r,n=[],i=a.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var l=a.readASCII(e,r,4);r+=4;var u=a.readUshort(e,r);r+=2;var f=t._lctf.readFeatureTable(e,o+u);f.tag=l.trim(),n.push(f)}return n},t._lctf.readFeatureTable=function(e,r){var a=t._bin,o=r,n={},i=a.readUshort(e,r);r+=2,i>0&&(n.featureParams=o+i);var s=a.readUshort(e,r);r+=2,n.tab=[];for(var l=0;l<s;l++)n.tab.push(a.readUshort(e,r+2*l));return n},t._lctf.readScriptList=function(e,r){var a=t._bin,o=r,n={},i=a.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var l=a.readASCII(e,r,4);r+=4;var u=a.readUshort(e,r);r+=2,n[l.trim()]=t._lctf.readScriptTable(e,o+u)}return n},t._lctf.readScriptTable=function(e,r){var a=t._bin,o=r,n={},i=a.readUshort(e,r);r+=2,i>0&&(n.default=t._lctf.readLangSysTable(e,o+i));var s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var u=a.readASCII(e,r,4);r+=4;var f=a.readUshort(e,r);r+=2,n[u.trim()]=t._lctf.readLangSysTable(e,o+f)}return n},t._lctf.readLangSysTable=function(e,r){var a=t._bin,o={};a.readUshort(e,r),r+=2,o.reqFeature=a.readUshort(e,r),r+=2;var n=a.readUshort(e,r);return r+=2,o.features=a.readUshorts(e,r,n),o},t.CFF={},t.CFF.parse=function(e,r,a){var o=t._bin;(e=new Uint8Array(e.buffer,r,a))[r=0],e[++r],e[++r],e[++r],r++;var n=[];r=t.CFF.readIndex(e,r,n);for(var i=[],s=0;s<n.length-1;s++)i.push(o.readASCII(e,r+n[s],n[s+1]-n[s]));r+=n[n.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var u=[];for(s=0;s<l.length-1;s++)u.push(t.CFF.readDict(e,r+l[s],r+l[s+1]));r+=l[l.length-1];var f=u[0],p=[];r=t.CFF.readIndex(e,r,p);var m=[];for(s=0;s<p.length-1;s++)m.push(o.readASCII(e,r+p[s],p[s+1]-p[s]));if(r+=p[p.length-1],t.CFF.readSubrs(e,r,f),f.CharStrings){r=f.CharStrings,p=[],r=t.CFF.readIndex(e,r,p);var y=[];for(s=0;s<p.length-1;s++)y.push(o.readBytes(e,r+p[s],p[s+1]-p[s]));f.CharStrings=y}if(f.ROS){r=f.FDArray;var M=[];for(r=t.CFF.readIndex(e,r,M),f.FDArray=[],s=0;s<M.length-1;s++){var F=t.CFF.readDict(e,r+M[s],r+M[s+1]);t.CFF._readFDict(e,F,m),f.FDArray.push(F)}r+=M[M.length-1],r=f.FDSelect,f.FDSelect=[];var C=e[r];if(r++,C!=3)throw C;var x=o.readUshort(e,r);for(r+=2,s=0;s<x+1;s++)f.FDSelect.push(o.readUshort(e,r),e[r+2]),r+=3}return f.Encoding&&(f.Encoding=t.CFF.readEncoding(e,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=t.CFF.readCharset(e,f.charset,f.CharStrings.length)),t.CFF._readFDict(e,f,m),f},t.CFF._readFDict=function(e,r,a){var o;for(var n in r.Private&&(o=r.Private[1],r.Private=t.CFF.readDict(e,o,o+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,o+r.Private.Subrs,r.Private)),r)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(r[n]=a[r[n]-426+35])},t.CFF.readSubrs=function(e,r,a){var o=t._bin,n=[];r=t.CFF.readIndex(e,r,n);var i,s=n.length;i=s<1240?107:s<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var l=0;l<n.length-1;l++)a.Subrs.push(o.readBytes(e,r+n[l],n[l+1]-n[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,r){for(var a=0;a<e.charset.length;a++)if(e.charset[a]==r)return a;return-1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,a){t._bin;var o=[".notdef"],n=e[r];if(r++,n!=0)throw"error: unknown encoding format: "+n;var i=e[r];r++;for(var s=0;s<i;s++)o.push(e[r+s]);return o},t.CFF.readCharset=function(e,r,a){var o=t._bin,n=[".notdef"],i=e[r];if(r++,i==0)for(var s=0;s<a;s++){var l=o.readUshort(e,r);r+=2,n.push(l)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;n.length<a;){l=o.readUshort(e,r),r+=2;var u=0;for(i==1?(u=e[r],r++):(u=o.readUshort(e,r),r+=2),s=0;s<=u;s++)n.push(l),l++}}return n},t.CFF.readIndex=function(e,r,a){var o=t._bin,n=o.readUshort(e,r)+1,i=e[r+=2];if(r++,i==1)for(var s=0;s<n;s++)a.push(e[r+s]);else if(i==2)for(s=0;s<n;s++)a.push(o.readUshort(e,r+2*s));else if(i==3)for(s=0;s<n;s++)a.push(16777215&o.readUint(e,r+3*s-1));else if(n!=1)throw"unsupported offset size: "+i+", count: "+n;return(r+=n*i)-1},t.CFF.getCharString=function(e,r,a){var o=t._bin,n=e[r],i=e[r+1];e[r+2],e[r+3],e[r+4];var s=1,l=null,u=null;n<=20&&(l=n,s=1),n==12&&(l=100*n+i,s=2),21<=n&&n<=27&&(l=n,s=1),n==28&&(u=o.readShort(e,r+1),s=3),29<=n&&n<=31&&(l=n,s=1),32<=n&&n<=246&&(u=n-139,s=1),247<=n&&n<=250&&(u=256*(n-247)+i+108,s=2),251<=n&&n<=254&&(u=256*-(n-251)-i-108,s=2),n==255&&(u=o.readInt(e,r+1)/65535,s=5),a.val=u??"o"+l,a.size=s},t.CFF.readCharString=function(e,r,a){for(var o=r+a,n=t._bin,i=[];r<o;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,f=null,p=null;s<=20&&(f=s,u=1),s==12&&(f=100*s+l,u=2),s!=19&&s!=20||(f=s,u=2),21<=s&&s<=27&&(f=s,u=1),s==28&&(p=n.readShort(e,r+1),u=3),29<=s&&s<=31&&(f=s,u=1),32<=s&&s<=246&&(p=s-139,u=1),247<=s&&s<=250&&(p=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(p=256*-(s-251)-l-108,u=2),s==255&&(p=n.readInt(e,r+1)/65535,u=5),i.push(p??"o"+f),r+=u}return i},t.CFF.readDict=function(e,r,a){for(var o=t._bin,n={},i=[];r<a;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,f=null,p=null;if(s==28&&(p=o.readShort(e,r+1),u=3),s==29&&(p=o.readInt(e,r+1),u=5),32<=s&&s<=246&&(p=s-139,u=1),247<=s&&s<=250&&(p=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(p=256*-(s-251)-l-108,u=2),s==255)throw p=o.readInt(e,r+1)/65535,u=5,"unknown number";if(s==30){var m=[];for(u=1;;){var y=e[r+u];u++;var M=y>>4,F=15&y;if(M!=15&&m.push(M),F!=15&&m.push(F),F==15)break}for(var C="",x=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],k=0;k<m.length;k++)C+=x[m[k]];p=parseFloat(C)}s<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,s==12&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),f!=null?(n[f]=i.length==1?i[0]:i,i=[]):i.push(p),r+=u}return n},t.cmap={},t.cmap.parse=function(e,r,a){e=new Uint8Array(e.buffer,r,a),r=0;var o=t._bin,n={};o.readUshort(e,r),r+=2;var i=o.readUshort(e,r);r+=2;var s=[];n.tables=[];for(var l=0;l<i;l++){var u=o.readUshort(e,r);r+=2;var f=o.readUshort(e,r);r+=2;var p=o.readUint(e,r);r+=4;var m="p"+u+"e"+f,y=s.indexOf(p);if(y==-1){var M;y=n.tables.length,s.push(p);var F=o.readUshort(e,p);F==0?M=t.cmap.parse0(e,p):F==4?M=t.cmap.parse4(e,p):F==6?M=t.cmap.parse6(e,p):F==12?M=t.cmap.parse12(e,p):console.debug("unknown format: "+F,u,f,p),n.tables.push(M)}if(n[m]!=null)throw"multiple tables for one platform+encoding";n[m]=y}return n},t.cmap.parse0=function(e,r){var a=t._bin,o={};o.format=a.readUshort(e,r),r+=2;var n=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2,o.map=[];for(var i=0;i<n-6;i++)o.map.push(e[r+i]);return o},t.cmap.parse4=function(e,r){var a=t._bin,o=r,n={};n.format=a.readUshort(e,r),r+=2;var i=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2;var s=a.readUshort(e,r);r+=2;var l=s/2;n.searchRange=a.readUshort(e,r),r+=2,n.entrySelector=a.readUshort(e,r),r+=2,n.rangeShift=a.readUshort(e,r),r+=2,n.endCount=a.readUshorts(e,r,l),r+=2*l,r+=2,n.startCount=a.readUshorts(e,r,l),r+=2*l,n.idDelta=[];for(var u=0;u<l;u++)n.idDelta.push(a.readShort(e,r)),r+=2;for(n.idRangeOffset=a.readUshorts(e,r,l),r+=2*l,n.glyphIdArray=[];r<o+i;)n.glyphIdArray.push(a.readUshort(e,r)),r+=2;return n},t.cmap.parse6=function(e,r){var a=t._bin,o={};o.format=a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,o.firstCode=a.readUshort(e,r),r+=2;var n=a.readUshort(e,r);r+=2,o.glyphIdArray=[];for(var i=0;i<n;i++)o.glyphIdArray.push(a.readUshort(e,r)),r+=2;return o},t.cmap.parse12=function(e,r){var a=t._bin,o={};o.format=a.readUshort(e,r),r+=2,r+=2,a.readUint(e,r),r+=4,a.readUint(e,r),r+=4;var n=a.readUint(e,r);r+=4,o.groups=[];for(var i=0;i<n;i++){var s=r+12*i,l=a.readUint(e,s+0),u=a.readUint(e,s+4),f=a.readUint(e,s+8);o.groups.push([l,u,f])}return o},t.glyf={},t.glyf.parse=function(e,r,a,o){for(var n=[],i=0;i<o.maxp.numGlyphs;i++)n.push(null);return n},t.glyf._parseGlyf=function(e,r){var a=t._bin,o=e._data,n=t._tabOffset(o,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var i={};if(i.noc=a.readShort(o,n),n+=2,i.xMin=a.readShort(o,n),n+=2,i.yMin=a.readShort(o,n),n+=2,i.xMax=a.readShort(o,n),n+=2,i.yMax=a.readShort(o,n),n+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(a.readUshort(o,n)),n+=2;var l=a.readUshort(o,n);if(n+=2,o.length-n<l)return null;i.instructions=a.readBytes(o,n,l),n+=l;var u=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<u;s++){var f=o[n];if(n++,i.flags.push(f),(8&f)!=0){var p=o[n];n++;for(var m=0;m<p;m++)i.flags.push(f),s++}}for(i.xs=[],s=0;s<u;s++){var y=(2&i.flags[s])!=0,M=(16&i.flags[s])!=0;y?(i.xs.push(M?o[n]:-o[n]),n++):M?i.xs.push(0):(i.xs.push(a.readShort(o,n)),n+=2)}for(i.ys=[],s=0;s<u;s++)y=(4&i.flags[s])!=0,M=(32&i.flags[s])!=0,y?(i.ys.push(M?o[n]:-o[n]),n++):M?i.ys.push(0):(i.ys.push(a.readShort(o,n)),n+=2);var F=0,C=0;for(s=0;s<u;s++)F+=i.xs[s],C+=i.ys[s],i.xs[s]=F,i.ys[s]=C}else{var x;i.parts=[];do{x=a.readUshort(o,n),n+=2;var k={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(k),k.glyphIndex=a.readUshort(o,n),n+=2,1&x){var A=a.readShort(o,n);n+=2;var U=a.readShort(o,n);n+=2}else A=a.readInt8(o,n),n++,U=a.readInt8(o,n),n++;2&x?(k.m.tx=A,k.m.ty=U):(k.p1=A,k.p2=U),8&x?(k.m.a=k.m.d=a.readF2dot14(o,n),n+=2):64&x?(k.m.a=a.readF2dot14(o,n),n+=2,k.m.d=a.readF2dot14(o,n),n+=2):128&x&&(k.m.a=a.readF2dot14(o,n),n+=2,k.m.b=a.readF2dot14(o,n),n+=2,k.m.c=a.readF2dot14(o,n),n+=2,k.m.d=a.readF2dot14(o,n),n+=2)}while(32&x);if(256&x){var _=a.readUshort(o,n);for(n+=2,i.instr=[],s=0;s<_;s++)i.instr.push(o[n]),n++}}return i},t.GDEF={},t.GDEF.parse=function(e,r,a,o){var n=r;r+=4;var i=t._bin.readUshort(e,r);return{glyphClassDef:i===0?null:t._lctf.readClassDef(e,n+i)}},t.GPOS={},t.GPOS.parse=function(e,r,a,o){return t._lctf.parse(e,r,a,o,t.GPOS.subt)},t.GPOS.subt=function(e,r,a,o){var n=t._bin,i=a,s={};if(s.fmt=n.readUshort(e,a),a+=2,r==1||r==2||r==3||r==7||r==8&&s.fmt<=2){var l=n.readUshort(e,a);a+=2,s.coverage=t._lctf.readCoverage(e,l+i)}if(r==1&&s.fmt==1){var u=n.readUshort(e,a);a+=2,u!=0&&(s.pos=t.GPOS.readValueRecord(e,a,u))}else if(r==2&&s.fmt>=1&&s.fmt<=2){u=n.readUshort(e,a),a+=2;var f=n.readUshort(e,a);a+=2;var p=t._lctf.numOfOnes(u),m=t._lctf.numOfOnes(f);if(s.fmt==1){s.pairsets=[];var y=n.readUshort(e,a);a+=2;for(var M=0;M<y;M++){var F=i+n.readUshort(e,a);a+=2;var C=n.readUshort(e,F);F+=2;for(var x=[],k=0;k<C;k++){var A=n.readUshort(e,F);F+=2,u!=0&&(g=t.GPOS.readValueRecord(e,F,u),F+=2*p),f!=0&&(D=t.GPOS.readValueRecord(e,F,f),F+=2*m),x.push({gid2:A,val1:g,val2:D})}s.pairsets.push(x)}}if(s.fmt==2){var U=n.readUshort(e,a);a+=2;var _=n.readUshort(e,a);a+=2;var O=n.readUshort(e,a);a+=2;var V=n.readUshort(e,a);for(a+=2,s.classDef1=t._lctf.readClassDef(e,i+U),s.classDef2=t._lctf.readClassDef(e,i+_),s.matrix=[],M=0;M<O;M++){var H=[];for(k=0;k<V;k++){var g=null,D=null;u!=0&&(g=t.GPOS.readValueRecord(e,a,u),a+=2*p),f!=0&&(D=t.GPOS.readValueRecord(e,a,f),a+=2*m),H.push({val1:g,val2:D})}s.matrix.push(H)}}}else if(r==4&&s.fmt==1)s.markCoverage=t._lctf.readCoverage(e,n.readUshort(e,a)+i),s.baseCoverage=t._lctf.readCoverage(e,n.readUshort(e,a+2)+i),s.markClassCount=n.readUshort(e,a+4),s.markArray=t.GPOS.readMarkArray(e,n.readUshort(e,a+6)+i),s.baseArray=t.GPOS.readBaseArray(e,n.readUshort(e,a+8)+i,s.markClassCount);else if(r==6&&s.fmt==1)s.mark1Coverage=t._lctf.readCoverage(e,n.readUshort(e,a)+i),s.mark2Coverage=t._lctf.readCoverage(e,n.readUshort(e,a+2)+i),s.markClassCount=n.readUshort(e,a+4),s.mark1Array=t.GPOS.readMarkArray(e,n.readUshort(e,a+6)+i),s.mark2Array=t.GPOS.readBaseArray(e,n.readUshort(e,a+8)+i,s.markClassCount);else{if(r==9&&s.fmt==1){var R=n.readUshort(e,a);a+=2;var $=n.readUint(e,a);if(a+=4,o.ltype==9)o.ltype=R;else if(o.ltype!=R)throw"invalid extension substitution";return t.GPOS.subt(e,o.ltype,i+$)}console.debug("unsupported GPOS table LookupType",r,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(e,r,a){var o=t._bin,n=[];return n.push(1&a?o.readShort(e,r):0),r+=1&a?2:0,n.push(2&a?o.readShort(e,r):0),r+=2&a?2:0,n.push(4&a?o.readShort(e,r):0),r+=4&a?2:0,n.push(8&a?o.readShort(e,r):0),r+=8&a?2:0,n},t.GPOS.readBaseArray=function(e,r,a){var o=t._bin,n=[],i=r,s=o.readUshort(e,r);r+=2;for(var l=0;l<s;l++){for(var u=[],f=0;f<a;f++)u.push(t.GPOS.readAnchorRecord(e,i+o.readUshort(e,r))),r+=2;n.push(u)}return n},t.GPOS.readMarkArray=function(e,r){var a=t._bin,o=[],n=r,i=a.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var l=t.GPOS.readAnchorRecord(e,a.readUshort(e,r+2)+n);l.markClass=a.readUshort(e,r),o.push(l),r+=4}return o},t.GPOS.readAnchorRecord=function(e,r){var a=t._bin,o={};return o.fmt=a.readUshort(e,r),o.x=a.readShort(e,r+2),o.y=a.readShort(e,r+4),o},t.GSUB={},t.GSUB.parse=function(e,r,a,o){return t._lctf.parse(e,r,a,o,t.GSUB.subt)},t.GSUB.subt=function(e,r,a,o){var n=t._bin,i=a,s={};if(s.fmt=n.readUshort(e,a),a+=2,r!=1&&r!=2&&r!=4&&r!=5&&r!=6)return null;if(r==1||r==2||r==4||r==5&&s.fmt<=2||r==6&&s.fmt<=2){var l=n.readUshort(e,a);a+=2,s.coverage=t._lctf.readCoverage(e,i+l)}if(r==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(e,a),a+=2;else if(s.fmt==2){var u=n.readUshort(e,a);a+=2,s.newg=n.readUshorts(e,a,u),a+=2*s.newg.length}}else if(r==2&&s.fmt==1){u=n.readUshort(e,a),a+=2,s.seqs=[];for(var f=0;f<u;f++){var p=n.readUshort(e,a)+i;a+=2;var m=n.readUshort(e,p);s.seqs.push(n.readUshorts(e,p+2,m))}}else if(r==4)for(s.vals=[],u=n.readUshort(e,a),a+=2,f=0;f<u;f++){var y=n.readUshort(e,a);a+=2,s.vals.push(t.GSUB.readLigatureSet(e,i+y))}else if(r==5&&s.fmt==2){if(s.fmt==2){var M=n.readUshort(e,a);a+=2,s.cDef=t._lctf.readClassDef(e,i+M),s.scset=[];var F=n.readUshort(e,a);for(a+=2,f=0;f<F;f++){var C=n.readUshort(e,a);a+=2,s.scset.push(C==0?null:t.GSUB.readSubClassSet(e,i+C))}}}else if(r==6&&s.fmt==3){if(s.fmt==3){for(f=0;f<3;f++){u=n.readUshort(e,a),a+=2;for(var x=[],k=0;k<u;k++)x.push(t._lctf.readCoverage(e,i+n.readUshort(e,a+2*k)));a+=2*u,f==0&&(s.backCvg=x),f==1&&(s.inptCvg=x),f==2&&(s.ahedCvg=x)}u=n.readUshort(e,a),a+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,a,u)}}else{if(r==7&&s.fmt==1){var A=n.readUshort(e,a);a+=2;var U=n.readUint(e,a);if(a+=4,o.ltype==9)o.ltype=A;else if(o.ltype!=A)throw"invalid extension substitution";return t.GSUB.subt(e,o.ltype,i+U)}console.debug("unsupported GSUB table LookupType",r,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(e,r){var a=t._bin.readUshort,o=r,n=[],i=a(e,r);r+=2;for(var s=0;s<i;s++){var l=a(e,r);r+=2,n.push(t.GSUB.readSubClassRule(e,o+l))}return n},t.GSUB.readSubClassRule=function(e,r){var a=t._bin.readUshort,o={},n=a(e,r),i=a(e,r+=2);r+=2,o.input=[];for(var s=0;s<n-1;s++)o.input.push(a(e,r)),r+=2;return o.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,i),o},t.GSUB.readSubstLookupRecords=function(e,r,a){for(var o=t._bin.readUshort,n=[],i=0;i<a;i++)n.push(o(e,r),o(e,r+2)),r+=4;return n},t.GSUB.readChainSubClassSet=function(e,r){var a=t._bin,o=r,n=[],i=a.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var l=a.readUshort(e,r);r+=2,n.push(t.GSUB.readChainSubClassRule(e,o+l))}return n},t.GSUB.readChainSubClassRule=function(e,r){for(var a=t._bin,o={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var s=a.readUshort(e,r);r+=2,i==1&&s--,o[n[i]]=a.readUshorts(e,r,s),r+=2*o[n[i]].length}return s=a.readUshort(e,r),r+=2,o.subst=a.readUshorts(e,r,2*s),r+=2*o.subst.length,o},t.GSUB.readLigatureSet=function(e,r){var a=t._bin,o=r,n=[],i=a.readUshort(e,r);r+=2;for(var s=0;s<i;s++){var l=a.readUshort(e,r);r+=2,n.push(t.GSUB.readLigature(e,o+l))}return n},t.GSUB.readLigature=function(e,r){var a=t._bin,o={chain:[]};o.nglyph=a.readUshort(e,r),r+=2;var n=a.readUshort(e,r);r+=2;for(var i=0;i<n-1;i++)o.chain.push(a.readUshort(e,r)),r+=2;return o},t.head={},t.head.parse=function(e,r,a){var o=t._bin,n={};return o.readFixed(e,r),r+=4,n.fontRevision=o.readFixed(e,r),r+=4,o.readUint(e,r),r+=4,o.readUint(e,r),r+=4,n.flags=o.readUshort(e,r),r+=2,n.unitsPerEm=o.readUshort(e,r),r+=2,n.created=o.readUint64(e,r),r+=8,n.modified=o.readUint64(e,r),r+=8,n.xMin=o.readShort(e,r),r+=2,n.yMin=o.readShort(e,r),r+=2,n.xMax=o.readShort(e,r),r+=2,n.yMax=o.readShort(e,r),r+=2,n.macStyle=o.readUshort(e,r),r+=2,n.lowestRecPPEM=o.readUshort(e,r),r+=2,n.fontDirectionHint=o.readShort(e,r),r+=2,n.indexToLocFormat=o.readShort(e,r),r+=2,n.glyphDataFormat=o.readShort(e,r),r+=2,n},t.hhea={},t.hhea.parse=function(e,r,a){var o=t._bin,n={};return o.readFixed(e,r),r+=4,n.ascender=o.readShort(e,r),r+=2,n.descender=o.readShort(e,r),r+=2,n.lineGap=o.readShort(e,r),r+=2,n.advanceWidthMax=o.readUshort(e,r),r+=2,n.minLeftSideBearing=o.readShort(e,r),r+=2,n.minRightSideBearing=o.readShort(e,r),r+=2,n.xMaxExtent=o.readShort(e,r),r+=2,n.caretSlopeRise=o.readShort(e,r),r+=2,n.caretSlopeRun=o.readShort(e,r),r+=2,n.caretOffset=o.readShort(e,r),r+=2,r+=8,n.metricDataFormat=o.readShort(e,r),r+=2,n.numberOfHMetrics=o.readUshort(e,r),r+=2,n},t.hmtx={},t.hmtx.parse=function(e,r,a,o){for(var n=t._bin,i={aWidth:[],lsBearing:[]},s=0,l=0,u=0;u<o.maxp.numGlyphs;u++)u<o.hhea.numberOfHMetrics&&(s=n.readUshort(e,r),r+=2,l=n.readShort(e,r),r+=2),i.aWidth.push(s),i.lsBearing.push(l);return i},t.kern={},t.kern.parse=function(e,r,a,o){var n=t._bin,i=n.readUshort(e,r);if(r+=2,i==1)return t.kern.parseV1(e,r-2,a,o);var s=n.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},u=0;u<s;u++){r+=2,a=n.readUshort(e,r),r+=2;var f=n.readUshort(e,r);r+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,a,o){var n=t._bin;n.readFixed(e,r),r+=4;var i=n.readUint(e,r);r+=4;for(var s={glyph1:[],rval:[]},l=0;l<i;l++){n.readUint(e,r),r+=4;var u=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2;var f=u>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;r=t.kern.readFormat0(e,r,s)}return s},t.kern.readFormat0=function(e,r,a){var o=t._bin,n=-1,i=o.readUshort(e,r);r+=2,o.readUshort(e,r),r+=2,o.readUshort(e,r),r+=2,o.readUshort(e,r),r+=2;for(var s=0;s<i;s++){var l=o.readUshort(e,r);r+=2;var u=o.readUshort(e,r);r+=2;var f=o.readShort(e,r);r+=2,l!=n&&(a.glyph1.push(l),a.rval.push({glyph2:[],vals:[]}));var p=a.rval[a.rval.length-1];p.glyph2.push(u),p.vals.push(f),n=l}return r},t.loca={},t.loca.parse=function(e,r,a,o){var n=t._bin,i=[],s=o.head.indexToLocFormat,l=o.maxp.numGlyphs+1;if(s==0)for(var u=0;u<l;u++)i.push(n.readUshort(e,r+(u<<1))<<1);if(s==1)for(u=0;u<l;u++)i.push(n.readUint(e,r+(u<<2)));return i},t.maxp={},t.maxp.parse=function(e,r,a){var o=t._bin,n={},i=o.readUint(e,r);return r+=4,n.numGlyphs=o.readUshort(e,r),r+=2,i==65536&&(n.maxPoints=o.readUshort(e,r),r+=2,n.maxContours=o.readUshort(e,r),r+=2,n.maxCompositePoints=o.readUshort(e,r),r+=2,n.maxCompositeContours=o.readUshort(e,r),r+=2,n.maxZones=o.readUshort(e,r),r+=2,n.maxTwilightPoints=o.readUshort(e,r),r+=2,n.maxStorage=o.readUshort(e,r),r+=2,n.maxFunctionDefs=o.readUshort(e,r),r+=2,n.maxInstructionDefs=o.readUshort(e,r),r+=2,n.maxStackElements=o.readUshort(e,r),r+=2,n.maxSizeOfInstructions=o.readUshort(e,r),r+=2,n.maxComponentElements=o.readUshort(e,r),r+=2,n.maxComponentDepth=o.readUshort(e,r),r+=2),n},t.name={},t.name.parse=function(e,r,a){var o=t._bin,n={};o.readUshort(e,r),r+=2;var i=o.readUshort(e,r);r+=2,o.readUshort(e,r);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=r+=2,f=0;f<i;f++){var p=o.readUshort(e,r);r+=2;var m=o.readUshort(e,r);r+=2;var y=o.readUshort(e,r);r+=2;var M=o.readUshort(e,r);r+=2;var F=o.readUshort(e,r);r+=2;var C=o.readUshort(e,r);r+=2;var x,k=l[M],A=u+12*i+C;if(p==0)x=o.readUnicode(e,A,F/2);else if(p==3&&m==0)x=o.readUnicode(e,A,F/2);else if(m==0)x=o.readASCII(e,A,F);else if(m==1)x=o.readUnicode(e,A,F/2);else if(m==3)x=o.readUnicode(e,A,F/2);else{if(p!=1)throw"unknown encoding "+m+", platformID: "+p;x=o.readASCII(e,A,F),console.debug("reading unknown MAC encoding "+m+" as ASCII")}var U="p"+p+","+y.toString(16);n[U]==null&&(n[U]={}),n[U][k!==void 0?k:M]=x,n[U]._lang=y}for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==1033)return n[_];for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==0)return n[_];for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==3084)return n[_];for(var _ in n)if(n[_].postScriptName!=null)return n[_];for(var _ in n){s=_;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},t["OS/2"]={},t["OS/2"].parse=function(e,r,a){var o=t._bin.readUshort(e,r);r+=2;var n={};if(o==0)t["OS/2"].version0(e,r,n);else if(o==1)t["OS/2"].version1(e,r,n);else if(o==2||o==3||o==4)t["OS/2"].version2(e,r,n);else{if(o!=5)throw"unknown OS/2 table version: "+o;t["OS/2"].version5(e,r,n)}return n},t["OS/2"].version0=function(e,r,a){var o=t._bin;return a.xAvgCharWidth=o.readShort(e,r),r+=2,a.usWeightClass=o.readUshort(e,r),r+=2,a.usWidthClass=o.readUshort(e,r),r+=2,a.fsType=o.readUshort(e,r),r+=2,a.ySubscriptXSize=o.readShort(e,r),r+=2,a.ySubscriptYSize=o.readShort(e,r),r+=2,a.ySubscriptXOffset=o.readShort(e,r),r+=2,a.ySubscriptYOffset=o.readShort(e,r),r+=2,a.ySuperscriptXSize=o.readShort(e,r),r+=2,a.ySuperscriptYSize=o.readShort(e,r),r+=2,a.ySuperscriptXOffset=o.readShort(e,r),r+=2,a.ySuperscriptYOffset=o.readShort(e,r),r+=2,a.yStrikeoutSize=o.readShort(e,r),r+=2,a.yStrikeoutPosition=o.readShort(e,r),r+=2,a.sFamilyClass=o.readShort(e,r),r+=2,a.panose=o.readBytes(e,r,10),r+=10,a.ulUnicodeRange1=o.readUint(e,r),r+=4,a.ulUnicodeRange2=o.readUint(e,r),r+=4,a.ulUnicodeRange3=o.readUint(e,r),r+=4,a.ulUnicodeRange4=o.readUint(e,r),r+=4,a.achVendID=[o.readInt8(e,r),o.readInt8(e,r+1),o.readInt8(e,r+2),o.readInt8(e,r+3)],r+=4,a.fsSelection=o.readUshort(e,r),r+=2,a.usFirstCharIndex=o.readUshort(e,r),r+=2,a.usLastCharIndex=o.readUshort(e,r),r+=2,a.sTypoAscender=o.readShort(e,r),r+=2,a.sTypoDescender=o.readShort(e,r),r+=2,a.sTypoLineGap=o.readShort(e,r),r+=2,a.usWinAscent=o.readUshort(e,r),r+=2,a.usWinDescent=o.readUshort(e,r),r+=2},t["OS/2"].version1=function(e,r,a){var o=t._bin;return r=t["OS/2"].version0(e,r,a),a.ulCodePageRange1=o.readUint(e,r),r+=4,a.ulCodePageRange2=o.readUint(e,r),r+=4},t["OS/2"].version2=function(e,r,a){var o=t._bin;return r=t["OS/2"].version1(e,r,a),a.sxHeight=o.readShort(e,r),r+=2,a.sCapHeight=o.readShort(e,r),r+=2,a.usDefault=o.readUshort(e,r),r+=2,a.usBreak=o.readUshort(e,r),r+=2,a.usMaxContext=o.readUshort(e,r),r+=2},t["OS/2"].version5=function(e,r,a){var o=t._bin;return r=t["OS/2"].version2(e,r,a),a.usLowerOpticalPointSize=o.readUshort(e,r),r+=2,a.usUpperOpticalPointSize=o.readUshort(e,r),r+=2},t.post={},t.post.parse=function(e,r,a){var o=t._bin,n={};return n.version=o.readFixed(e,r),r+=4,n.italicAngle=o.readFixed(e,r),r+=4,n.underlinePosition=o.readShort(e,r),r+=2,n.underlineThickness=o.readShort(e,r),r+=2,n},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(e,r){var a=e.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var n=a.tables[o];if(n.format==0)return r>=n.map.length?0:n.map[r];if(n.format==4){for(var i=-1,s=0;s<n.endCount.length;s++)if(r<=n.endCount[s]){i=s;break}return i==-1||n.startCount[i]>r?0:65535&(n.idRangeOffset[i]!=0?n.glyphIdArray[r-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:r+n.idDelta[i])}if(n.format==12){if(r>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var l=n.groups[s];if(l[0]<=r&&r<=l[1])return l[2]+(r-l[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(e,r){var a={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var o=e.SVG.entries[r];return o==null?a:(typeof o=="string"&&(o=t.SVG.toPath(o),e.SVG.entries[r]=o),o)}if(e.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},i=e.CFF,s=e.CFF.Private;if(i.ROS){for(var l=0;i.FDSelect[l+2]<=r;)l+=2;s=i.FDArray[i.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],n,i,s,a)}else e.glyf&&t.U._drawGlyf(r,e,a);return a},t.U._drawGlyf=function(e,r,a){var o=r.glyf[e];o==null&&(o=r.glyf[e]=t.glyf._parseGlyf(r,e)),o!=null&&(o.noc>-1?t.U._simpleGlyph(o,a):t.U._compoGlyph(o,r,a))},t.U._simpleGlyph=function(e,r){for(var a=0;a<e.noc;a++){for(var o=a==0?0:e.endPts[a-1]+1,n=e.endPts[a],i=o;i<=n;i++){var s=i==o?n:i-1,l=i==n?o:i+1,u=1&e.flags[i],f=1&e.flags[s],p=1&e.flags[l],m=e.xs[i],y=e.ys[i];if(i==o)if(u){if(!f){t.U.P.moveTo(r,m,y);continue}t.U.P.moveTo(r,e.xs[s],e.ys[s])}else f?t.U.P.moveTo(r,e.xs[s],e.ys[s]):t.U.P.moveTo(r,(e.xs[s]+m)/2,(e.ys[s]+y)/2);u?f&&t.U.P.lineTo(r,m,y):p?t.U.P.qcurveTo(r,m,y,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,m,y,(m+e.xs[l])/2,(y+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,a){for(var o=0;o<e.parts.length;o++){var n={cmds:[],crds:[]},i=e.parts[o];t.U._drawGlyf(i.glyphIndex,r,n);for(var s=i.m,l=0;l<n.crds.length;l+=2){var u=n.crds[l],f=n.crds[l+1];a.crds.push(u*s.a+f*s.b+s.tx),a.crds.push(u*s.c+f*s.d+s.ty)}for(l=0;l<n.cmds.length;l++)a.cmds.push(n.cmds[l])}},t.U._getGlyphClass=function(e,r){var a=t._lctf.getInterval(r,e);return a==-1?0:r[a+2]},t.U._applySubs=function(e,r,a,o){for(var n=e.length-r-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var s,l=a.tabs[i];if(!l.coverage||(s=t._lctf.coverageIndex(l.coverage,e[r]))!=-1){if(a.ltype==1)e[r],l.fmt==1?e[r]=e[r]+l.delta:e[r]=l.newg[s];else if(a.ltype==4)for(var u=l.vals[s],f=0;f<u.length;f++){var p=u[f],m=p.chain.length;if(!(m>n)){for(var y=!0,M=0,F=0;F<m;F++){for(;e[r+M+(1+F)]==-1;)M++;p.chain[F]!=e[r+M+(1+F)]&&(y=!1)}if(y){for(e[r]=p.nglyph,F=0;F<m+M;F++)e[r+F+1]=-1;break}}}else if(a.ltype==5&&l.fmt==2)for(var C=t._lctf.getInterval(l.cDef,e[r]),x=l.cDef[C+2],k=l.scset[x],A=0;A<k.length;A++){var U=k[A],_=U.input;if(!(_.length>n)){for(y=!0,F=0;F<_.length;F++){var O=t._lctf.getInterval(l.cDef,e[r+1+F]);if(C==-1&&l.cDef[O+2]!=_[F]){y=!1;break}}if(y){var V=U.substLookupRecords;for(f=0;f<V.length;f+=2)V[f],V[f+1]}}}else if(a.ltype==6&&l.fmt==3){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length)||!t.U._glsCovered(e,l.inptCvg,r)||!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var H=l.lookupRec;for(A=0;A<H.length;A+=2){C=H[A];var g=o[H[A+1]];t.U._applySubs(e,r+C,g,o)}}}}},t.U._glsCovered=function(e,r,a){for(var o=0;o<r.length;o++)if(t._lctf.coverageIndex(r[o],e[a+o])==-1)return!1;return!0},t.U.glyphsToPath=function(e,r,a){for(var o={cmds:[],crds:[]},n=0,i=0;i<r.length;i++){var s=r[i];if(s!=-1){for(var l=i<r.length-1&&r[i+1]!=-1?r[i+1]:0,u=t.U.glyphToPath(e,s),f=0;f<u.crds.length;f+=2)o.crds.push(u.crds[f]+n),o.crds.push(u.crds[f+1]);for(a&&o.cmds.push(a),f=0;f<u.cmds.length;f++)o.cmds.push(u.cmds[f]);a&&o.cmds.push("X"),n+=e.hmtx.aWidth[s],i<r.length-1&&(n+=t.U.getPairAdjustment(e,s,l))}}return o},t.U.P={},t.U.P.moveTo=function(e,r,a){e.cmds.push("M"),e.crds.push(r,a)},t.U.P.lineTo=function(e,r,a){e.cmds.push("L"),e.crds.push(r,a)},t.U.P.curveTo=function(e,r,a,o,n,i,s){e.cmds.push("C"),e.crds.push(r,a,o,n,i,s)},t.U.P.qcurveTo=function(e,r,a,o,n){e.cmds.push("Q"),e.crds.push(r,a,o,n)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,a,o,n){for(var i=r.stack,s=r.nStems,l=r.haveWidth,u=r.width,f=r.open,p=0,m=r.x,y=r.y,M=0,F=0,C=0,x=0,k=0,A=0,U=0,_=0,O=0,V=0,H={val:0,size:0};p<e.length;){t.CFF.getCharString(e,p,H);var g=H.val;if(p+=H.size,g=="o1"||g=="o18")i.length%2!=0&&!l&&(u=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(g=="o3"||g=="o23")i.length%2!=0&&!l&&(u=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(g=="o4")i.length>1&&!l&&(u=i.shift()+o.nominalWidthX,l=!0),f&&t.U.P.closePath(n),y+=i.pop(),t.U.P.moveTo(n,m,y),f=!0;else if(g=="o5")for(;i.length>0;)m+=i.shift(),y+=i.shift(),t.U.P.lineTo(n,m,y);else if(g=="o6"||g=="o7")for(var D=i.length,R=g=="o6",$=0;$<D;$++){var j=i.shift();R?m+=j:y+=j,R=!R,t.U.P.lineTo(n,m,y)}else if(g=="o8"||g=="o24"){D=i.length;for(var nr=0;nr+6<=D;)M=m+i.shift(),F=y+i.shift(),C=M+i.shift(),x=F+i.shift(),m=C+i.shift(),y=x+i.shift(),t.U.P.curveTo(n,M,F,C,x,m,y),nr+=6;g=="o24"&&(m+=i.shift(),y+=i.shift(),t.U.P.lineTo(n,m,y))}else{if(g=="o11")break;if(g=="o1234"||g=="o1235"||g=="o1236"||g=="o1237")g=="o1234"&&(F=y,C=(M=m+i.shift())+i.shift(),V=x=F+i.shift(),A=x,_=y,m=(U=(k=(O=C+i.shift())+i.shift())+i.shift())+i.shift(),t.U.P.curveTo(n,M,F,C,x,O,V),t.U.P.curveTo(n,k,A,U,_,m,y)),g=="o1235"&&(M=m+i.shift(),F=y+i.shift(),C=M+i.shift(),x=F+i.shift(),O=C+i.shift(),V=x+i.shift(),k=O+i.shift(),A=V+i.shift(),U=k+i.shift(),_=A+i.shift(),m=U+i.shift(),y=_+i.shift(),i.shift(),t.U.P.curveTo(n,M,F,C,x,O,V),t.U.P.curveTo(n,k,A,U,_,m,y)),g=="o1236"&&(M=m+i.shift(),F=y+i.shift(),C=M+i.shift(),V=x=F+i.shift(),A=x,U=(k=(O=C+i.shift())+i.shift())+i.shift(),_=A+i.shift(),m=U+i.shift(),t.U.P.curveTo(n,M,F,C,x,O,V),t.U.P.curveTo(n,k,A,U,_,m,y)),g=="o1237"&&(M=m+i.shift(),F=y+i.shift(),C=M+i.shift(),x=F+i.shift(),O=C+i.shift(),V=x+i.shift(),k=O+i.shift(),A=V+i.shift(),U=k+i.shift(),_=A+i.shift(),Math.abs(U-m)>Math.abs(_-y)?m=U+i.shift():y=_+i.shift(),t.U.P.curveTo(n,M,F,C,x,O,V),t.U.P.curveTo(n,k,A,U,_,m,y));else if(g=="o14"){if(i.length>0&&!l&&(u=i.shift()+a.nominalWidthX,l=!0),i.length==4){var sr=i.shift(),G=i.shift(),E=i.shift(),v=i.shift(),b=t.CFF.glyphBySE(a,E),w=t.CFF.glyphBySE(a,v);t.U._drawCFF(a.CharStrings[b],r,a,o,n),r.x=sr,r.y=G,t.U._drawCFF(a.CharStrings[w],r,a,o,n)}f&&(t.U.P.closePath(n),f=!1)}else if(g=="o19"||g=="o20")i.length%2!=0&&!l&&(u=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,l=!0,p+=s+7>>3;else if(g=="o21")i.length>2&&!l&&(u=i.shift()+o.nominalWidthX,l=!0),y+=i.pop(),m+=i.pop(),f&&t.U.P.closePath(n),t.U.P.moveTo(n,m,y),f=!0;else if(g=="o22")i.length>1&&!l&&(u=i.shift()+o.nominalWidthX,l=!0),m+=i.pop(),f&&t.U.P.closePath(n),t.U.P.moveTo(n,m,y),f=!0;else if(g=="o25"){for(;i.length>6;)m+=i.shift(),y+=i.shift(),t.U.P.lineTo(n,m,y);M=m+i.shift(),F=y+i.shift(),C=M+i.shift(),x=F+i.shift(),m=C+i.shift(),y=x+i.shift(),t.U.P.curveTo(n,M,F,C,x,m,y)}else if(g=="o26")for(i.length%2&&(m+=i.shift());i.length>0;)M=m,F=y+i.shift(),m=C=M+i.shift(),y=(x=F+i.shift())+i.shift(),t.U.P.curveTo(n,M,F,C,x,m,y);else if(g=="o27")for(i.length%2&&(y+=i.shift());i.length>0;)F=y,C=(M=m+i.shift())+i.shift(),x=F+i.shift(),m=C+i.shift(),y=x,t.U.P.curveTo(n,M,F,C,x,m,y);else if(g=="o10"||g=="o29"){var T=g=="o10"?o:a;if(i.length==0)console.debug("error: empty stack");else{var S=i.pop(),L=T.Subrs[S+T.Bias];r.x=m,r.y=y,r.nStems=s,r.haveWidth=l,r.width=u,r.open=f,t.U._drawCFF(L,r,a,o,n),m=r.x,y=r.y,s=r.nStems,l=r.haveWidth,u=r.width,f=r.open}}else if(g=="o30"||g=="o31"){var I=i.length,B=(nr=0,g=="o31");for(nr+=I-(D=-3&I);nr<D;)B?(F=y,C=(M=m+i.shift())+i.shift(),y=(x=F+i.shift())+i.shift(),D-nr==5?(m=C+i.shift(),nr++):m=C,B=!1):(M=m,F=y+i.shift(),C=M+i.shift(),x=F+i.shift(),m=C+i.shift(),D-nr==5?(y=x+i.shift(),nr++):y=x,B=!0),t.U.P.curveTo(n,M,F,C,x,m,y),nr+=4}else{if((g+"").charAt(0)=="o")throw console.debug("Unknown operation: "+g,e),g;i.push(g)}}}r.x=m,r.y=y,r.nStems=s,r.haveWidth=l,r.width=u,r.open=f};var c=t,h={Typr:c};return d.Typr=c,d.default=h,Object.defineProperty(d,"__esModule",{value:!0}),d}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function na(){return function(d){var t=Uint8Array,c=Uint16Array,h=Uint32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),r=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(g,D){for(var R=new c(31),$=0;$<31;++$)R[$]=D+=1<<g[$-1];var j=new h(R[30]);for($=1;$<30;++$)for(var nr=R[$];nr<R[$+1];++nr)j[nr]=nr-R[$]<<5|$;return[R,j]},n=o(e,2),i=n[0],s=n[1];i[28]=258,s[258]=28;for(var l=o(r,0)[0],u=new c(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,u[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var m=function(g,D,R){for(var $=g.length,j=0,nr=new c(D);j<$;++j)++nr[g[j]-1];var sr,G=new c(D);for(j=0;j<D;++j)G[j]=G[j-1]+nr[j-1]<<1;{sr=new c(1<<D);var E=15-D;for(j=0;j<$;++j)if(g[j])for(var v=j<<4|g[j],b=D-g[j],w=G[g[j]-1]++<<b,T=w|(1<<b)-1;w<=T;++w)sr[u[w]>>>E]=v}return sr},y=new t(288);for(f=0;f<144;++f)y[f]=8;for(f=144;f<256;++f)y[f]=9;for(f=256;f<280;++f)y[f]=7;for(f=280;f<288;++f)y[f]=8;var M=new t(32);for(f=0;f<32;++f)M[f]=5;var F=m(y,9),C=m(M,5),x=function(g){for(var D=g[0],R=1;R<g.length;++R)g[R]>D&&(D=g[R]);return D},k=function(g,D,R){var $=D/8|0;return(g[$]|g[$+1]<<8)>>(7&D)&R},A=function(g,D){var R=D/8|0;return(g[R]|g[R+1]<<8|g[R+2]<<16)>>(7&D)},U=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_=function(g,D,R){var $=new Error(D||U[g]);if($.code=g,Error.captureStackTrace&&Error.captureStackTrace($,_),!R)throw $;return $},O=function(g,D,R){var $=g.length;if(!$||R&&!R.l&&$<5)return D||new t(0);var j=!D||R,nr=!R||R.i;R||(R={}),D||(D=new t(3*$));var sr,G=function(mr){var wr=D.length;if(mr>wr){var kr=new t(Math.max(2*wr,mr));kr.set(D),D=kr}},E=R.f||0,v=R.p||0,b=R.b||0,w=R.l,T=R.d,S=R.m,L=R.n,I=8*$;do{if(!w){R.f=E=k(g,v,1);var B=k(g,v+1,3);if(v+=3,!B){var q=g[(X=((sr=v)/8|0)+(7&sr&&1)+4)-4]|g[X-3]<<8,Z=X+q;if(Z>$){nr&&_(0);break}j&&G(b+q),D.set(g.subarray(X,Z),b),R.b=b+=q,R.p=v=8*Z;continue}if(B==1)w=F,T=C,S=9,L=5;else if(B==2){var N=k(g,v,31)+257,z=k(g,v+10,15)+4,fr=N+k(g,v+5,31)+1;v+=14;for(var hr=new t(fr),tr=new t(19),Q=0;Q<z;++Q)tr[a[Q]]=k(g,v+3*Q,7);v+=3*z;var lr=x(tr),W=(1<<lr)-1,or=m(tr,lr);for(Q=0;Q<fr;){var X,P=or[k(g,v,W)];if(v+=15&P,(X=P>>>4)<16)hr[Q++]=X;else{var pr=0,J=0;for(X==16?(J=3+k(g,v,3),v+=2,pr=hr[Q-1]):X==17?(J=3+k(g,v,7),v+=3):X==18&&(J=11+k(g,v,127),v+=7);J--;)hr[Q++]=pr}}var rr=hr.subarray(0,N),K=hr.subarray(N);S=x(rr),L=x(K),w=m(rr,S),T=m(K,L)}else _(1);if(v>I){nr&&_(0);break}}j&&G(b+131072);for(var er=(1<<S)-1,gr=(1<<L)-1,Y=v;;Y=v){var dr=(pr=w[A(g,v)&er])>>>4;if((v+=15&pr)>I){nr&&_(0);break}if(pr||_(2),dr<256)D[b++]=dr;else{if(dr==256){Y=v,w=null;break}var Sr=dr-254;if(dr>264){var _r=e[Q=dr-257];Sr=k(g,v,(1<<_r)-1)+i[Q],v+=_r}var yr=T[A(g,v)&gr],Fr=yr>>>4;if(yr||_(3),v+=15&yr,K=l[Fr],Fr>3&&(_r=r[Fr],K+=A(g,v)&(1<<_r)-1,v+=_r),v>I){nr&&_(0);break}j&&G(b+131072);for(var ir=b+Sr;b<ir;b+=4)D[b]=D[b-K],D[b+1]=D[b+1-K],D[b+2]=D[b+2-K],D[b+3]=D[b+3-K];b=ir}}R.l=w,R.p=Y,R.b=b,w&&(E=1,R.m=S,R.d=T,R.n=L)}while(!E);return b==D.length?D:function(mr,wr,kr){(kr==null||kr>mr.length)&&(kr=mr.length);var Ar=new(mr instanceof c?c:mr instanceof h?h:t)(kr-wr);return Ar.set(mr.subarray(wr,kr)),Ar}(D,0,b)},V=new t(0),H=typeof TextDecoder<"u"&&new TextDecoder;try{H.decode(V,{stream:!0})}catch{}return d.convert_streams=function(g){var D=new DataView(g),R=0;function $(){var N=D.getUint16(R);return R+=2,N}function j(){var N=D.getUint32(R);return R+=4,N}function nr(N){q.setUint16(Z,N),Z+=2}function sr(N){q.setUint32(Z,N),Z+=4}for(var G={signature:j(),flavor:j(),length:j(),numTables:$(),reserved:$(),totalSfntSize:j(),majorVersion:$(),minorVersion:$(),metaOffset:j(),metaLength:j(),metaOrigLength:j(),privOffset:j(),privLength:j()},E=0;Math.pow(2,E)<=G.numTables;)E++;E--;for(var v=16*Math.pow(2,E),b=16*G.numTables-v,w=12,T=[],S=0;S<G.numTables;S++)T.push({tag:j(),offset:j(),compLength:j(),origLength:j(),origChecksum:j()}),w+=16;var L,I=new Uint8Array(12+16*T.length+T.reduce(function(N,z){return N+z.origLength+4},0)),B=I.buffer,q=new DataView(B),Z=0;return sr(G.flavor),nr(G.numTables),nr(v),nr(E),nr(b),T.forEach(function(N){sr(N.tag),sr(N.origChecksum),sr(w),sr(N.origLength),N.outOffset=w,(w+=N.origLength)%4!=0&&(w+=4-w%4)}),T.forEach(function(N){var z,fr=g.slice(N.offset,N.offset+N.compLength);if(N.compLength!=N.origLength){var hr=new Uint8Array(N.origLength);z=new Uint8Array(fr,2),O(z,hr)}else hr=new Uint8Array(fr);I.set(hr,N.outOffset);var tr=0;(w=N.outOffset+N.origLength)%4!=0&&(tr=4-w%4),I.set(new Uint8Array(tr).buffer,N.outOffset+N.origLength),L=w+tr}),B.slice(0,L)},Object.defineProperty(d,"__esModule",{value:!0}),d}({}).convert_streams}function aa(d,t){const c={M:2,L:2,Q:4,C:6,Z:0},h={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},e=1,r=2,a=4,o=8,n=16,i=32;let s;function l(U){if(!s){const _={R:r,L:e,D:a,C:n,U:i,T:o};s=new Map;for(let O in h){let V=0;h[O].split(",").forEach(H=>{let[g,D]=H.split("+");g=parseInt(g,36),D=D?parseInt(D,36):0,s.set(V+=g,_[O]);for(let R=D;R--;)s.set(++V,_[O])})}}return s.get(U)||i}const u=1,f=2,p=3,m=4,y=[null,"isol","init","fina","medi"];function M(U){const _=new Uint8Array(U.length);let O=i,V=u,H=-1;for(let g=0;g<U.length;g++){const D=U.codePointAt(g);let R=l(D)|0,$=u;R&o||(O&(e|a|n)?R&(r|a|n)?($=p,(V===u||V===p)&&_[H]++):R&(e|i)&&(V===f||V===m)&&_[H]--:O&(r|i)&&(V===f||V===m)&&_[H]--,V=_[g]=$,O=R,H=g,D>65535&&g++)}return _}function F(U,_){const O=[];for(let H=0;H<_.length;H++){const g=_.codePointAt(H);g>65535&&H++,O.push(d.U.codeToGlyph(U,g))}const V=U.GSUB;if(V){const{lookupList:H,featureList:g}=V;let D;const R=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,$=[];g.forEach(j=>{if(R.test(j.tag))for(let nr=0;nr<j.tab.length;nr++){if($[j.tab[nr]])continue;$[j.tab[nr]]=!0;const sr=H[j.tab[nr]],G=/^(isol|init|fina|medi)$/.test(j.tag);G&&!D&&(D=M(_));for(let E=0;E<O.length;E++)(!D||!G||y[D[E]]===j.tag)&&d.U._applySubs(O,E,sr,H)}})}return O}function C(U,_){const O=new Int16Array(_.length*3);let V=0;for(;V<_.length;V++){const R=_[V];if(R===-1)continue;O[V*3+2]=U.hmtx.aWidth[R];const $=U.GPOS;if($){const j=$.lookupList;for(let nr=0;nr<j.length;nr++){const sr=j[nr];for(let G=0;G<sr.tabs.length;G++){const E=sr.tabs[G];if(sr.ltype===1){if(d._lctf.coverageIndex(E.coverage,R)!==-1&&E.pos){D(E.pos,V);break}}else if(sr.ltype===2){let v=null,b=H();if(b!==-1){const w=d._lctf.coverageIndex(E.coverage,_[b]);if(w!==-1){if(E.fmt===1){const T=E.pairsets[w];for(let S=0;S<T.length;S++)T[S].gid2===R&&(v=T[S])}else if(E.fmt===2){const T=d.U._getGlyphClass(_[b],E.classDef1),S=d.U._getGlyphClass(R,E.classDef2);v=E.matrix[T][S]}if(v){v.val1&&D(v.val1,b),v.val2&&D(v.val2,V);break}}}}else if(sr.ltype===4){const v=d._lctf.coverageIndex(E.markCoverage,R);if(v!==-1){const b=H(g),w=b===-1?-1:d._lctf.coverageIndex(E.baseCoverage,_[b]);if(w!==-1){const T=E.markArray[v],S=E.baseArray[w][T.markClass];O[V*3]=S.x-T.x+O[b*3]-O[b*3+2],O[V*3+1]=S.y-T.y+O[b*3+1];break}}}else if(sr.ltype===6){const v=d._lctf.coverageIndex(E.mark1Coverage,R);if(v!==-1){const b=H();if(b!==-1){const w=_[b];if(x(U,w)===3){const T=d._lctf.coverageIndex(E.mark2Coverage,w);if(T!==-1){const S=E.mark1Array[v],L=E.mark2Array[T][S.markClass];O[V*3]=L.x-S.x+O[b*3]-O[b*3+2],O[V*3+1]=L.y-S.y+O[b*3+1];break}}}}}}}}else if(U.kern&&!U.cff){const j=H();if(j!==-1){const nr=U.kern.glyph1.indexOf(_[j]);if(nr!==-1){const sr=U.kern.rval[nr].glyph2.indexOf(R);sr!==-1&&(O[j*3+2]+=U.kern.rval[nr].vals[sr])}}}}return O;function H(R){for(let $=V-1;$>=0;$--)if(_[$]!==-1&&(!R||R(_[$])))return $;return-1}function g(R){return x(U,R)===1}function D(R,$){for(let j=0;j<3;j++)O[$*3+j]+=R[j]||0}}function x(U,_){const O=U.GDEF&&U.GDEF.glyphClassDef;return O?d.U._getGlyphClass(_,O):0}function k(...U){for(let _=0;_<U.length;_++)if(typeof U[_]=="number")return U[_]}function A(U){const _=Object.create(null),O=U["OS/2"],V=U.hhea,H=U.head.unitsPerEm,g=k(O&&O.sTypoAscender,V&&V.ascender,H),D={unitsPerEm:H,ascender:g,descender:k(O&&O.sTypoDescender,V&&V.descender,0),capHeight:k(O&&O.sCapHeight,g),xHeight:k(O&&O.sxHeight,g),lineGap:k(O&&O.sTypoLineGap,V&&V.lineGap),supportsCodePoint(R){return d.U.codeToGlyph(U,R)>0},forEachGlyph(R,$,j,nr){let sr=0;const G=1/D.unitsPerEm*$,E=F(U,R);let v=0;const b=C(U,E);return E.forEach((w,T)=>{if(w!==-1){let S=_[w];if(!S){const{cmds:L,crds:I}=d.U.glyphToPath(U,w);let B="",q=0;for(let hr=0,tr=L.length;hr<tr;hr++){const Q=c[L[hr]];B+=L[hr];for(let lr=1;lr<=Q;lr++)B+=(lr>1?",":"")+I[q++]}let Z,N,z,fr;if(I.length){Z=N=1/0,z=fr=-1/0;for(let hr=0,tr=I.length;hr<tr;hr+=2){let Q=I[hr],lr=I[hr+1];Q<Z&&(Z=Q),lr<N&&(N=lr),Q>z&&(z=Q),lr>fr&&(fr=lr)}}else Z=z=N=fr=0;S=_[w]={index:w,advanceWidth:U.hmtx.aWidth[w],xMin:Z,yMin:N,xMax:z,yMax:fr,path:B}}nr.call(null,S,sr+b[T*3]*G,b[T*3+1]*G,v),sr+=b[T*3+2]*G,j&&(sr+=j*$)}v+=R.codePointAt(v)>65535?2:1}),sr}};return D}return function(U){const _=new Uint8Array(U,0,4),O=d._bin.readASCII(_,0,4);if(O==="wOFF")U=t(U);else if(O==="wOF2")throw new Error("woff2 fonts not supported");return A(d.parse(U)[0])}}const oa=oe({name:"Typr Font Parser",dependencies:[ta,na,aa],init(d,t,c){const h=d(),e=t();return c(h,e)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function ia(){return function(d){var t=function(){this.buckets=new Map};t.prototype.add=function(C){var x=C>>5;this.buckets.set(x,(this.buckets.get(x)||0)|1<<(31&C))},t.prototype.has=function(C){var x=this.buckets.get(C>>5);return x!==void 0&&(x&1<<(31&C))!=0},t.prototype.serialize=function(){var C=[];return this.buckets.forEach(function(x,k){C.push((+k).toString(36)+":"+x.toString(36))}),C.join(",")},t.prototype.deserialize=function(C){var x=this;this.buckets.clear(),C.split(",").forEach(function(k){var A=k.split(":");x.buckets.set(parseInt(A[0],36),parseInt(A[1],36))})};var c=Math.pow(2,8),h=c-1,e=~h;function r(C){var x=function(A){return A&e}(C).toString(16),k=function(A){return(A&e)+c-1}(C).toString(16);return"codepoint-index/plane"+(C>>16)+"/"+x+"-"+k+".json"}function a(C,x){var k=C&h,A=x.codePointAt(k/6|0);return((A=(A||48)-48)&1<<k%6)!=0}function o(C,x){var k;(k=C,k.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(A){return A.split("-").map(function(U){return parseInt(U.trim(),16)})})).forEach(function(A){var U=A[0],_=A[1];_===void 0&&(_=U),x(U,_)})}function n(C,x){o(C,function(k,A){for(var U=k;U<=A;U++)x(U)})}var i={},s={},l=new WeakMap,u="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(C){var x=l.get(C);return x||(x=new t,n(C.ranges,function(k){return x.add(k)}),l.set(C,x)),x}var p,m=new Map;function y(C,x,k){return C[x]?x:C[k]?k:function(A){for(var U in A)return U}(C)}function M(C,x){var k=x;if(!C.includes(k)){k=1/0;for(var A=0;A<C.length;A++)Math.abs(C[A]-x)<Math.abs(k-x)&&(k=C[A])}return k}function F(C){return p||(p=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(x){p.add(x)})),p.has(C)}return d.CodePointSet=t,d.clearCache=function(){i={},s={}},d.getFontsForString=function(C,x){x===void 0&&(x={});var k,A=x.lang;A===void 0&&(A=new RegExp("\\p{Script=Hangul}","u").test(k=C)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(k)?"ja":"en");var U=x.category;U===void 0&&(U="sans-serif");var _=x.style;_===void 0&&(_="normal");var O=x.weight;O===void 0&&(O=400);var V=(x.dataUrl||u).replace(/\/$/g,""),H=new Map,g=new Uint8Array(C.length),D={},R={},$=new Array(C.length),j=new Map,nr=!1;function sr(v){var b=m.get(v);return b||(b=fetch(V+"/"+v).then(function(w){if(!w.ok)throw new Error(w.statusText);return w.json().then(function(T){if(!Array.isArray(T)||T[0]!==1)throw new Error("Incorrect schema version; need 1, got "+T[0]);return T[1]})}).catch(function(w){if(V!==u)return nr||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+V+'", trying default CDN. '+w.message),nr=!0),V=u,m.delete(v),sr(v);throw w}),m.set(v,b)),b}for(var G=function(v){var b=C.codePointAt(v),w=r(b);$[v]=w,i[w]||j.has(w)||j.set(w,sr(w).then(function(T){i[w]=T})),b>65535&&(v++,E=v)},E=0;E<C.length;E++)G(E);return Promise.all(j.values()).then(function(){j.clear();for(var v=function(w){var T=C.codePointAt(w),S=null,L=i[$[w]],I=void 0;for(var B in L){var q=R[B];if(q===void 0&&(q=R[B]=new RegExp(B).test(A||"en")),q){for(var Z in I=B,L[B])if(a(T,L[B][Z])){S=Z;break}break}}if(!S){r:for(var N in L)if(N!==I){for(var z in L[N])if(a(T,L[N][z])){S=z;break r}}}S||(console.debug("No font coverage for U+"+T.toString(16)),S="latin"),$[w]=S,s[S]||j.has(S)||j.set(S,sr("font-meta/"+S+".json").then(function(fr){s[S]=fr})),T>65535&&(w++,b=w)},b=0;b<C.length;b++)v(b);return Promise.all(j.values())}).then(function(){for(var v,b=null,w=0;w<C.length;w++){var T=C.codePointAt(w);if(b&&(F(T)||f(b).has(T)))g[w]=g[w-1];else{b=s[$[w]];var S=D[b.id];if(!S){var L=b.typeforms,I=y(L,U,"sans-serif"),B=y(L[I],_,"normal"),q=M((v=L[I])===null||v===void 0?void 0:v[B],O);S=D[b.id]=V+"/font-files/"+b.id+"/"+I+"."+B+"."+q+".woff"}var Z=H.get(S);Z==null&&(Z=H.size,H.set(S,Z)),g[w]=Z}T>65535&&(w++,g[w]=g[w-1])}return{fontUrls:Array.from(H.keys()),chars:g}})},Object.defineProperty(d,"__esModule",{value:!0}),d}({})}function sa(d,t){const c=Object.create(null),h=Object.create(null);function e(a,o){const n=i=>{console.error(`Failure loading font ${a}`,i)};try{const i=new XMLHttpRequest;i.open("get",a,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)n(new Error(i.statusText));else if(i.status>0)try{const s=d(i.response);s.src=a,o(s)}catch(s){n(s)}},i.onerror=n,i.send()}catch(i){n(i)}}function r(a,o){let n=c[a];n?o(n):h[a]?h[a].push(o):(h[a]=[o],e(a,i=>{i.src=a,c[a]=i,h[a].forEach(s=>s(i)),delete h[a]}))}return function(a,o,{lang:n,fonts:i=[],style:s="normal",weight:l="normal",unicodeFontsURL:u}={}){const f=new Uint8Array(a.length),p=[];a.length||F();const m=new Map,y=[];if(s!=="italic"&&(s="normal"),typeof l!="number"&&(l=l==="bold"?700:400),i&&!Array.isArray(i)&&(i=[i]),i=i.slice().filter(x=>!x.lang||x.lang.test(n)).reverse(),i.length){let x=0;(function k(A=0){for(let U=A,_=a.length;U<_;U++){const O=a.codePointAt(U);if(x===1&&p[f[U-1]].supportsCodePoint(O)||/\s/.test(a[U]))f[U]=f[U-1],x===2&&(y[y.length-1][1]=U);else for(let V=f[U],H=i.length;V<=H;V++)if(V===H){const g=x===2?y[y.length-1]:y[y.length]=[U,U];g[1]=U,x=2}else{f[U]=V;const{src:g,unicodeRange:D}=i[V];if(!D||C(O,D)){const R=c[g];if(!R){r(g,()=>{k(U)});return}if(R.supportsCodePoint(O)){let $=m.get(R);typeof $!="number"&&($=p.length,p.push(R),m.set(R,$)),f[U]=$,x=1;break}}}O>65535&&U+1<_&&(f[U+1]=f[U],U++,x===2&&(y[y.length-1][1]=U))}M()})()}else y.push([0,a.length-1]),M();function M(){if(y.length){const x=y.map(k=>a.substring(k[0],k[1]+1)).join(`
`);t.getFontsForString(x,{lang:n||void 0,style:s,weight:l,dataUrl:u}).then(({fontUrls:k,chars:A})=>{const U=p.length;let _=0;y.forEach(V=>{for(let H=0,g=V[1]-V[0];H<=g;H++)f[V[0]+H]=A[_++]+U;_++});let O=0;k.forEach((V,H)=>{r(V,g=>{p[H+U]=g,++O===k.length&&F()})})})}else F()}function F(){o({chars:f,fonts:p})}function C(x,k){for(let A=0;A<k.length;A++){const[U,_=U]=k[A];if(U<=x&&x<=_)return!0}return!1}}}const la=oe({name:"FontResolver",dependencies:[sa,oa,ia],init(d,t,c){return d(t,c())}});function ua(d,t){const c=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,h="[^\\S\\u00A0]",e=new RegExp(`${h}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function r({text:f,lang:p,fonts:m,style:y,weight:M,preResolvedFonts:F,unicodeFontsURL:C},x){const k=({chars:A,fonts:U})=>{let _,O;const V=[];for(let H=0;H<A.length;H++)A[H]!==O?(O=A[H],V.push(_={start:H,end:H,fontObj:U[A[H]]})):_.end=H;x(V)};F?k(F):d(f,k,{lang:p,fonts:m,style:y,weight:M,unicodeFontsURL:C})}function a({text:f="",font:p,lang:m,sdfGlyphSize:y=64,fontSize:M=400,fontWeight:F=1,fontStyle:C="normal",letterSpacing:x=0,lineHeight:k="normal",maxWidth:A=1/0,direction:U,textAlign:_="left",textIndent:O=0,whiteSpace:V="normal",overflowWrap:H="normal",anchorX:g=0,anchorY:D=0,metricsOnly:R=!1,unicodeFontsURL:$,preResolvedFonts:j=null,includeCaretPositions:nr=!1,chunkedBoundsSize:sr=8192,colorRanges:G=null},E){const v=s(),b={fontLoad:0,typesetting:0};f.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),f=f.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),M=+M,x=+x,A=+A,k=k||"normal",O=+O,r({text:f,lang:m,style:C,weight:F,fonts:typeof p=="string"?[{src:p}]:p,unicodeFontsURL:$,preResolvedFonts:j},w=>{b.fontLoad=s()-v;const T=isFinite(A);let S=null,L=null,I=null,B=null,q=null,Z=null,N=null,z=null,fr=0,hr=0,tr=V!=="nowrap";const Q=new Map,lr=s();let W=O,or=0,X=new l;const P=[X];w.forEach(er=>{const{fontObj:gr}=er,{ascender:Y,descender:dr,unitsPerEm:Sr,lineGap:_r,capHeight:yr,xHeight:Fr}=gr;let ir=Q.get(gr);if(!ir){const ur=M/Sr,cr=k==="normal"?(Y-dr+_r)*ur:k*M,$r=(cr-(Y-dr)*ur)/2,xr=Math.min(cr,(Y-dr)*ur),br=(Y+dr)/2*ur+xr/2;ir={index:Q.size,src:gr.src,fontObj:gr,fontSizeMult:ur,unitsPerEm:Sr,ascender:Y*ur,descender:dr*ur,capHeight:yr*ur,xHeight:Fr*ur,lineHeight:cr,baseline:-$r-Y*ur,caretTop:(Y+dr)/2*ur+xr/2,caretBottom:br-xr},Q.set(gr,ir)}const{fontSizeMult:mr}=ir,wr=f.slice(er.start,er.end+1);let kr,Ar;gr.forEachGlyph(wr,M,x,(ur,cr,$r,xr)=>{cr+=or,xr+=er.start,kr=cr,Ar=ur;const br=f.charAt(xr),Rr=ur.advanceWidth*mr,Tr=X.count;let vr;if("isEmpty"in ur||(ur.isWhitespace=!!br&&new RegExp(h).test(br),ur.canBreakAfter=!!br&&e.test(br),ur.isEmpty=ur.xMin===ur.xMax||ur.yMin===ur.yMax||c.test(br)),!ur.isWhitespace&&!ur.isEmpty&&hr++,tr&&T&&!ur.isWhitespace&&cr+Rr+W>A&&Tr){if(X.glyphAt(Tr-1).glyphObj.canBreakAfter)vr=new l,W=-cr;else for(let Ir=Tr;Ir--;)if(Ir===0&&H==="break-word"){vr=new l,W=-cr;break}else if(X.glyphAt(Ir).glyphObj.canBreakAfter){vr=X.splitAt(Ir+1);const Mr=vr.glyphAt(0).x;W-=Mr;for(let Cr=vr.count;Cr--;)vr.glyphAt(Cr).x-=Mr;break}vr&&(X.isSoftWrapped=!0,X=vr,P.push(X),fr=A)}let Ur=X.glyphAt(X.count);Ur.glyphObj=ur,Ur.x=cr+W,Ur.y=$r,Ur.width=Rr,Ur.charIndex=xr,Ur.fontData=ir,br===`
`&&(X=new l,P.push(X),W=-(cr+Rr+x*M)+O)}),or=kr+Ar.advanceWidth*mr+x*M});let pr=0;P.forEach(er=>{let gr=!0;for(let Y=er.count;Y--;){const dr=er.glyphAt(Y);gr&&!dr.glyphObj.isWhitespace&&(er.width=dr.x+dr.width,er.width>fr&&(fr=er.width),gr=!1);let{lineHeight:Sr,capHeight:_r,xHeight:yr,baseline:Fr}=dr.fontData;Sr>er.lineHeight&&(er.lineHeight=Sr);const ir=Fr-er.baseline;ir<0&&(er.baseline+=ir,er.cap+=ir,er.ex+=ir),er.cap=Math.max(er.cap,er.baseline+_r),er.ex=Math.max(er.ex,er.baseline+yr)}er.baseline-=pr,er.cap-=pr,er.ex-=pr,pr+=er.lineHeight});let J=0,rr=0;if(g&&(typeof g=="number"?J=-g:typeof g=="string"&&(J=-fr*(g==="left"?0:g==="center"?.5:g==="right"?1:n(g)))),D&&(typeof D=="number"?rr=-D:typeof D=="string"&&(rr=D==="top"?0:D==="top-baseline"?-P[0].baseline:D==="top-cap"?-P[0].cap:D==="top-ex"?-P[0].ex:D==="middle"?pr/2:D==="bottom"?pr:D==="bottom-baseline"?P[P.length-1].baseline:n(D)*pr)),!R){const er=t.getEmbeddingLevels(f,U);S=new Uint16Array(hr),L=new Uint8Array(hr),I=new Float32Array(hr*2),B={},N=[1/0,1/0,-1/0,-1/0],z=[],nr&&(Z=new Float32Array(f.length*4)),G&&(q=new Uint8Array(hr*3));let gr=0,Y=-1,dr=-1,Sr,_r;if(P.forEach((yr,Fr)=>{let{count:ir,width:mr}=yr;if(ir>0){let wr=0;for(let xr=ir;xr--&&yr.glyphAt(xr).glyphObj.isWhitespace;)wr++;let kr=0,Ar=0;if(_==="center")kr=(fr-mr)/2;else if(_==="right")kr=fr-mr;else if(_==="justify"&&yr.isSoftWrapped){let xr=0;for(let br=ir-wr;br--;)yr.glyphAt(br).glyphObj.isWhitespace&&xr++;Ar=(fr-mr)/xr}if(Ar||kr){let xr=0;for(let br=0;br<ir;br++){let Rr=yr.glyphAt(br);const Tr=Rr.glyphObj;Rr.x+=kr+xr,Ar!==0&&Tr.isWhitespace&&br<ir-wr&&(xr+=Ar,Rr.width+=Ar)}}const ur=t.getReorderSegments(f,er,yr.glyphAt(0).charIndex,yr.glyphAt(yr.count-1).charIndex);for(let xr=0;xr<ur.length;xr++){const[br,Rr]=ur[xr];let Tr=1/0,vr=-1/0;for(let Ur=0;Ur<ir;Ur++)if(yr.glyphAt(Ur).charIndex>=br){let Ir=Ur,Mr=Ur;for(;Mr<ir;Mr++){let Cr=yr.glyphAt(Mr);if(Cr.charIndex>Rr)break;Mr<ir-wr&&(Tr=Math.min(Tr,Cr.x),vr=Math.max(vr,Cr.x+Cr.width))}for(let Cr=Ir;Cr<Mr;Cr++){const Vr=yr.glyphAt(Cr);Vr.x=vr-(Vr.x+Vr.width-Tr)}break}}let cr;const $r=xr=>cr=xr;for(let xr=0;xr<ir;xr++){const br=yr.glyphAt(xr);cr=br.glyphObj;const Rr=cr.index,Tr=er.levels[br.charIndex]&1;if(Tr){const vr=t.getMirroredCharacter(f[br.charIndex]);vr&&br.fontData.fontObj.forEachGlyph(vr,0,0,$r)}if(nr){const{charIndex:vr,fontData:Ur}=br,Ir=br.x+J,Mr=br.x+br.width+J;Z[vr*4]=Tr?Mr:Ir,Z[vr*4+1]=Tr?Ir:Mr,Z[vr*4+2]=yr.baseline+Ur.caretBottom+rr,Z[vr*4+3]=yr.baseline+Ur.caretTop+rr;const Cr=vr-Y;Cr>1&&i(Z,Y,Cr),Y=vr}if(G){const{charIndex:vr}=br;for(;vr>dr;)dr++,G.hasOwnProperty(dr)&&(_r=G[dr])}if(!cr.isWhitespace&&!cr.isEmpty){const vr=gr++,{fontSizeMult:Ur,src:Ir,index:Mr}=br.fontData,Cr=B[Ir]||(B[Ir]={});Cr[Rr]||(Cr[Rr]={path:cr.path,pathBounds:[cr.xMin,cr.yMin,cr.xMax,cr.yMax]});const Vr=br.x+J,Jr=br.y+yr.baseline+rr;I[vr*2]=Vr,I[vr*2+1]=Jr;const jr=Vr+cr.xMin*Ur,Nr=Jr+cr.yMin*Ur,Hr=Vr+cr.xMax*Ur,Yr=Jr+cr.yMax*Ur;jr<N[0]&&(N[0]=jr),Nr<N[1]&&(N[1]=Nr),Hr>N[2]&&(N[2]=Hr),Yr>N[3]&&(N[3]=Yr),vr%sr===0&&(Sr={start:vr,end:vr,rect:[1/0,1/0,-1/0,-1/0]},z.push(Sr)),Sr.end++;const Or=Sr.rect;if(jr<Or[0]&&(Or[0]=jr),Nr<Or[1]&&(Or[1]=Nr),Hr>Or[2]&&(Or[2]=Hr),Yr>Or[3]&&(Or[3]=Yr),S[vr]=Rr,L[vr]=Mr,G){const Wr=vr*3;q[Wr]=_r>>16&255,q[Wr+1]=_r>>8&255,q[Wr+2]=_r&255}}}}}),Z){const yr=f.length-Y;yr>1&&i(Z,Y,yr)}}const K=[];Q.forEach(({index:er,src:gr,unitsPerEm:Y,ascender:dr,descender:Sr,lineHeight:_r,capHeight:yr,xHeight:Fr})=>{K[er]={src:gr,unitsPerEm:Y,ascender:dr,descender:Sr,lineHeight:_r,capHeight:yr,xHeight:Fr}}),b.typesetting=s()-lr,E({glyphIds:S,glyphFontIndices:L,glyphPositions:I,glyphData:B,fontData:K,caretPositions:Z,glyphColors:q,chunkedBounds:z,fontSize:M,topBaseline:rr+P[0].baseline,blockBounds:[J,rr-pr,J+fr,rr],visibleBounds:N,timings:b})})}function o(f,p){a({...f,metricsOnly:!0},m=>{const[y,M,F,C]=m.blockBounds;p({width:F-y,height:C-M})})}function n(f){let p=f.match(/^([\d.]+)%$/),m=p?parseFloat(p[1]):NaN;return isNaN(m)?0:m/100}function i(f,p,m){const y=f[p*4],M=f[p*4+1],F=f[p*4+2],C=f[p*4+3],x=(M-y)/m;for(let k=0;k<m;k++){const A=(p+k)*4;f[A]=y+x*k,f[A+1]=y+x*(k+1),f[A+2]=F,f[A+3]=C}}function s(){return(self.performance||Date).now()}function l(){this.data=[]}const u=["glyphObj","x","y","width","charIndex","fontData"];return l.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/u.length)},glyphAt(f){let p=l.flyweight;return p.data=this.data,p.index=f,p},splitAt(f){let p=new l;return p.data=this.data.splice(f*u.length),p}},l.flyweight=u.reduce((f,p,m,y)=>(Object.defineProperty(f,p,{get(){return this.data[this.index*u.length+m]},set(M){this.data[this.index*u.length+m]=M}}),f),{data:null,index:0}),{typeset:a,measure:o}}const Qr=()=>(self.performance||Date).now(),Be=ln();let Xt;function fa(d,t,c,h,e,r,a,o,n,i,s=!0){return s?da(d,t,c,h,e,r,a,o,n,i).then(null,l=>(Xt||(console.warn("WebGL SDF generation failed, falling back to JS",l),Xt=!0),Yt(d,t,c,h,e,r,a,o,n,i))):Yt(d,t,c,h,e,r,a,o,n,i)}const Ge=[],ha=5;let ct=0;function fn(){const d=Qr();for(;Ge.length&&Qr()-d<ha;)Ge.shift()();ct=Ge.length?setTimeout(fn,0):0}const da=(...d)=>new Promise((t,c)=>{Ge.push(()=>{const h=Qr();try{Be.webgl.generateIntoCanvas(...d),t({timing:Qr()-h})}catch(e){c(e)}}),ct||(ct=setTimeout(fn,0))}),ca=4,va=2e3,Jt={};let pa=0;function Yt(d,t,c,h,e,r,a,o,n,i){const s="TroikaTextSDFGenerator_JS_"+pa++%ca;let l=Jt[s];return l||(l=Jt[s]={workerModule:oe({name:s,workerId:s,dependencies:[ln,Qr],init(u,f){const p=u().javascript.generate;return function(...m){const y=f();return{textureData:p(...m),timing:f()-y}}},getTransferables(u){return[u.textureData.buffer]}}),requests:0,idleTimer:null}),l.requests++,clearTimeout(l.idleTimer),l.workerModule(d,t,c,h,e,r).then(({textureData:u,timing:f})=>{const p=Qr(),m=new Uint8Array(u.length*4);for(let y=0;y<u.length;y++)m[y*4+i]=u[y];return Be.webglUtils.renderImageData(a,m,o,n,d,t,1<<3-i),f+=Qr()-p,--l.requests===0&&(l.idleTimer=setTimeout(()=>{Hn(s)},va)),{timing:f}})}function ga(d){d._warm||(Be.webgl.isSupported(d),d._warm=!0)}const ma=Be.webglUtils.resizeWebGLCanvasWithoutClearing,Kr={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},ya=new vt;let hn=!1;function ae(){return(self.performance||Date).now()}function Ba(d){hn?console.warn("configureTextBuilder called after first font request; will be ignored."):vn(Kr,d)}const Pe=Object.create(null);function dn(d,t){hn=!0,d=vn({},d);const c=ae(),{defaultFontURL:h}=Kr,e=[];if(h&&e.push({label:"default",src:Zt(h)}),d.font&&e.push({label:"user",src:Zt(d.font)}),d.font=e,d.text=""+d.text,d.sdfGlyphSize=d.sdfGlyphSize||Kr.sdfGlyphSize,d.unicodeFontsURL=d.unicodeFontsURL||Kr.unicodeFontsURL,d.colorRanges!=null){let u={};for(let f in d.colorRanges)if(d.colorRanges.hasOwnProperty(f)){let p=d.colorRanges[f];typeof p!="number"&&(p=ya.set(p).getHex()),u[f]=p}d.colorRanges=u}Object.freeze(d);const{textureWidth:r,sdfExponent:a}=Kr,{sdfGlyphSize:o}=d,n=r/o*4;let i=Pe[o];if(!i){const u=document.createElement("canvas");u.width=r,u.height=o*256/n,i=Pe[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:u,sdfTexture:new wn(u,void 0,void 0,void 0,zt,zt),contextLost:!1,glyphsByFont:new Map},i.sdfTexture.generateMipmaps=!1,ba(i)}const{sdfTexture:s,sdfCanvas:l}=i;Ua(d).then(u=>{const{glyphIds:f,glyphFontIndices:p,fontData:m,glyphPositions:y,fontSize:M,timings:F}=u,C=[],x=new Float32Array(f.length*4);let k=0,A=0;const U=ae(),_=m.map(D=>{let R=i.glyphsByFont.get(D.src);return R||i.glyphsByFont.set(D.src,R=new Map),R});f.forEach((D,R)=>{const $=p[R],{src:j,unitsPerEm:nr}=m[$];let sr=_[$].get(D);if(!sr){const{path:w,pathBounds:T}=u.glyphData[j][D],S=Math.max(T[2]-T[0],T[3]-T[1])/o*(Kr.sdfMargin*o+.5),L=i.glyphCount++,I=[T[0]-S,T[1]-S,T[2]+S,T[3]+S];_[$].set(D,sr={path:w,atlasIndex:L,sdfViewBox:I}),C.push(sr)}const{sdfViewBox:G}=sr,E=y[A++],v=y[A++],b=M/nr;x[k++]=E+G[0]*b,x[k++]=v+G[1]*b,x[k++]=E+G[2]*b,x[k++]=v+G[3]*b,f[R]=sr.atlasIndex}),F.quads=(F.quads||0)+(ae()-U);const O=ae();F.sdf={};const V=l.height,H=Math.ceil(i.glyphCount/n),g=Math.pow(2,Math.ceil(Math.log2(H*o)));g>V&&(console.info(`Increasing SDF texture size ${V}->${g}`),ma(l,r,g),s.dispose()),Promise.all(C.map(D=>cn(D,i,d.gpuAccelerateSDF).then(({timing:R})=>{F.sdf[D.atlasIndex]=R}))).then(()=>{C.length&&!i.contextLost&&(pn(i),s.needsUpdate=!0),F.sdfTotal=ae()-O,F.total=ae()-c,t(Object.freeze({parameters:d,sdfTexture:s,sdfGlyphSize:o,sdfExponent:a,glyphBounds:x,glyphAtlasIndices:f,glyphColors:u.glyphColors,caretPositions:u.caretPositions,chunkedBounds:u.chunkedBounds,ascender:u.ascender,descender:u.descender,lineHeight:u.lineHeight,capHeight:u.capHeight,xHeight:u.xHeight,topBaseline:u.topBaseline,blockBounds:u.blockBounds,visibleBounds:u.visibleBounds,timings:u.timings}))})}),Promise.resolve().then(()=>{i.contextLost||ga(l)})}function cn({path:d,atlasIndex:t,sdfViewBox:c},{sdfGlyphSize:h,sdfCanvas:e,contextLost:r},a){if(r)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:n}=Kr,i=Math.max(c[2]-c[0],c[3]-c[1]),s=Math.floor(t/4),l=s%(o/h)*h,u=Math.floor(s/(o/h))*h,f=t%4;return fa(h,h,d,c,i,n,e,l,u,f,a)}function ba(d){const t=d.sdfCanvas;t.addEventListener("webglcontextlost",c=>{console.log("Context Lost",c),c.preventDefault(),d.contextLost=!0}),t.addEventListener("webglcontextrestored",c=>{console.log("Context Restored",c),d.contextLost=!1;const h=[];d.glyphsByFont.forEach(e=>{e.forEach(r=>{h.push(cn(r,d,!0))})}),Promise.all(h).then(()=>{pn(d),d.sdfTexture.needsUpdate=!0})})}function La({font:d,characters:t,sdfGlyphSize:c},h){let e=Array.isArray(t)?t.join(`
`):""+t;dn({font:d,sdfGlyphSize:c,text:e},h)}function vn(d,t){for(let c in t)t.hasOwnProperty(c)&&(d[c]=t[c]);return d}let Me;function Zt(d){return Me||(Me=typeof document>"u"?{}:document.createElement("a")),Me.href=d,Me.href}function pn(d){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:c}=d,{width:h,height:e}=t,r=d.sdfCanvas.getContext("webgl");let a=c.image.data;(!a||a.length!==h*e*4)&&(a=new Uint8Array(h*e*4),c.image={width:h,height:e,data:a},c.flipY=!1,c.isDataTexture=!0),r.readPixels(0,0,h,e,r.RGBA,r.UNSIGNED_BYTE,a)}}const xa=oe({name:"Typesetter",dependencies:[ua,la,Xn],init(d,t,c){return d(t,c())}}),Ua=oe({name:"Typesetter",dependencies:[xa],init(d){return function(t){return new Promise(c=>{d.typeset(t,c)})}},getTransferables(d){const t=[];for(let c in d)d[c]&&d[c].buffer&&t.push(d[c].buffer);return t}});function Wa(){Object.keys(Pe).forEach(d=>{const t=Pe[d].sdfCanvas,{width:c,height:h}=t;console.log("%c.",`
      background: url(${t.toDataURL()});
      background-size: ${c}px ${h}px;
      color: transparent;
      font-size: 0;
      line-height: ${h}px;
      padding-left: ${c}px;
    `)})}const Kt={};function Sa(d){let t=Kt[d];if(!t){const c=new gt(1,1,d,d),h=c.clone(),e=c.attributes,r=h.attributes,a=new An,o=e.uv.count;for(let n=0;n<o;n++)r.position.array[n*3]*=-1,r.normal.array[n*3+2]*=-1;["position","normal","uv"].forEach(n=>{a.setAttribute(n,new En([...e[n].array,...r[n].array],e[n].itemSize))}),a.setIndex([...c.index.array,...h.index.array.map(n=>n+o)]),a.translate(.5,.5,0),t=Kt[d]=a}return t}const ka="aTroikaGlyphBounds",Qt="aTroikaGlyphIndex",_a="aTroikaGlyphColor";class wa extends Tn{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Cn,this.boundingBox=new Fn}computeBoundingSphere(){}computeBoundingBox(){}setSide(t){const c=this.getIndex().count;this.setDrawRange(t===Rn?c/2:0,t===on?c:c/2)}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let c=Sa(t);["position","normal","uv"].forEach(h=>{this.attributes[h]=c.attributes[h].clone()}),this.setIndex(c.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,c,h,e,r){st(this,ka,t,4),st(this,Qt,c,1),st(this,_a,r,3),this._blockBounds=h,this._chunkedBounds=e,this.instanceCount=c.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:c,boundingBox:h}=this;if(c){const{PI:e,floor:r,min:a,max:o,sin:n,cos:i}=Math,s=e/2,l=e*2,u=Math.abs(c),f=t[0]/u,p=t[2]/u,m=r((f+s)/l)!==r((p+s)/l)?-u:a(n(f)*u,n(p)*u),y=r((f-s)/l)!==r((p-s)/l)?u:o(n(f)*u,n(p)*u),M=r((f+e)/l)!==r((p+e)/l)?u*2:o(u-i(f)*u,u-i(p)*u);h.min.set(m,t[1],c<0?-M:0),h.max.set(y,t[3],c<0?0:M)}else h.min.set(t[0],t[1],0),h.max.set(t[2],t[3],0);h.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let c=this.getAttribute(Qt).count,h=this._chunkedBounds;if(h)for(let e=h.length;e--;){c=h[e].end;let r=h[e].rect;if(r[1]<t.w&&r[3]>t.y&&r[0]<t.z&&r[2]>t.x)break}this.instanceCount=c}}function st(d,t,c,h){const e=d.getAttribute(t);c?e&&e.array.length===c.length?(e.array.set(c),e.needsUpdate=!0):(d.setAttribute(t,new Dn(c,h)),delete d._maxInstanceCount,d.dispose()):e&&d.deleteAttribute(t)}const Ta=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Ca=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Fa=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Ra=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Da(d){const t=dt(d,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Oe},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vt(0,0,0,0)},uTroikaClipRect:{value:new Vt(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Oe},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new vt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new In},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Ta,vertexTransform:Ca,fragmentDefs:Fa,fragmentColorTransform:Ra,customRewriter({vertexShader:c,fragmentShader:h}){let e=/\buniform\s+vec3\s+diffuse\b/;return e.test(h)&&(h=h.replace(e,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),e.test(c)||(c=c.replace(un,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:c,fragmentShader:h}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const yt=new Gn({color:16777215,side:on,transparent:!0}),rn=8421504,en=new On,Ae=new mt,lt=new mt,ge=[],Ia=new mt,ut="+x+y";function tn(d){return Array.isArray(d)?d[0]:d}let gn=()=>{const d=new pt(new gt(1,1),yt);return gn=()=>d,d},mn=()=>{const d=new pt(new gt(1,1,32,1),yt);return mn=()=>d,d};const Ma={type:"syncstart"},Aa={type:"synccomplete"},yn=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Ea=yn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Ga extends pt{constructor(){const t=new wa;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=rn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=ut,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(Ma),dn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},c=>{this._isSyncing=!1,this._textRenderInfo=c,this.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);const h=this._queuedSyncs;h&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{h.forEach(e=>e&&e())})),this.dispatchEvent(Aa),t&&t()})))}onBeforeRender(t,c,h,e,r,a){this.sync(),r.isTroikaTextMaterial&&this._prepareForRender(r),r._hadOwnSide=r.hasOwnProperty("side"),this.geometry.setSide(r._actualSide=r.side),r.side=Mn}onAfterRender(t,c,h,e,r,a){r._hadOwnSide?r.side=r._actualSide:delete r.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let t=this._derivedMaterial;const c=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=yt.clone());if((!t||t.baseMaterial!==c)&&(t=this._derivedMaterial=Da(c),c.addEventListener("dispose",function h(){c.removeEventListener("dispose",h),t.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let h=t._outlineMtl;return h||(h=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),h.isTextOutlineMaterial=!0,h.depthWrite=!1,h.map=null,t.addEventListener("dispose",function e(){t.removeEventListener("dispose",e),h.dispose()})),[h,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return tn(this.material).getDepthMaterial()}get customDistanceMaterial(){return tn(this.material).getDistanceMaterial()}_prepareForRender(t){const c=t.isTextOutlineMaterial,h=t.uniforms,e=this.textRenderInfo;if(e){const{sdfTexture:o,blockBounds:n}=e;h.uTroikaSDFTexture.value=o,h.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),h.uTroikaSDFGlyphSize.value=e.sdfGlyphSize,h.uTroikaSDFExponent.value=e.sdfExponent,h.uTroikaTotalBounds.value.fromArray(n),h.uTroikaUseGlyphColors.value=!c&&!!e.glyphColors;let i=0,s=0,l=0,u,f,p,m=0,y=0;if(c){let{outlineWidth:F,outlineOffsetX:C,outlineOffsetY:x,outlineBlur:k,outlineOpacity:A}=this;i=this._parsePercent(F)||0,s=Math.max(0,this._parsePercent(k)||0),u=A,m=this._parsePercent(C)||0,y=this._parsePercent(x)||0}else l=Math.max(0,this._parsePercent(this.strokeWidth)||0),l&&(p=this.strokeColor,h.uTroikaStrokeColor.value.set(p??rn),f=this.strokeOpacity,f==null&&(f=1)),u=this.fillOpacity;h.uTroikaDistanceOffset.value=i,h.uTroikaPositionOffset.value.set(m,y),h.uTroikaBlurRadius.value=s,h.uTroikaStrokeWidth.value=l,h.uTroikaStrokeOpacity.value=f,h.uTroikaFillOpacity.value=u??1,h.uTroikaCurveRadius.value=this.curveRadius||0;let M=this.clipRect;if(M&&Array.isArray(M)&&M.length===4)h.uTroikaClipRect.value.fromArray(M);else{const F=(this.fontSize||.1)*100;h.uTroikaClipRect.value.set(n[0]-F,n[1]-F,n[2]+F,n[3]+F)}this.geometry.applyClipRect(h.uTroikaClipRect.value)}h.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const r=c?this.outlineColor||0:this.color;if(r==null)delete t.color;else{const o=t.hasOwnProperty("color")?t.color:t.color=new vt;(r!==o._input||typeof r=="object")&&o.set(o._input=r)}let a=this.orientation||ut;if(a!==t._orientation){let o=h.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==ut&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,i,s,l,u]=n;Ae.set(0,0,0)[s]=i==="-"?1:-1,lt.set(0,0,0)[u]=l==="-"?-1:1,en.lookAt(Ia,Ae.cross(lt),lt),o.setFromMatrix4(en)}else o.identity();t._orientation=a}}_parsePercent(t){if(typeof t=="string"){let c=t.match(/^(-?[\d.]+)%$/),h=c?parseFloat(c[1]):NaN;t=(isNaN(h)?0:h/100)*this.fontSize}return t}localPositionToTextCoords(t,c=new Oe){c.copy(t);const h=this.curveRadius;return h&&(c.x=Math.atan2(t.x,Math.abs(h)-Math.abs(t.z))*Math.abs(h)),c}worldPositionToTextCoords(t,c=new Oe){return Ae.copy(t),this.localPositionToTextCoords(this.worldToLocal(Ae),c)}raycast(t,c){const{textRenderInfo:h,curveRadius:e}=this;if(h){const r=h.blockBounds,a=e?mn():gn(),o=a.geometry,{position:n,uv:i}=o.attributes;for(let s=0;s<i.count;s++){let l=r[0]+i.getX(s)*(r[2]-r[0]);const u=r[1]+i.getY(s)*(r[3]-r[1]);let f=0;e&&(f=e-Math.cos(l/e)*e,l=Math.sin(l/e)*e),n.setXYZ(s,l,u,f)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,ge.length=0,a.raycast(t,ge);for(let s=0;s<ge.length;s++)ge[s].object=this,c.push(ge[s])}}copy(t){const c=this.geometry;return super.copy(t),this.geometry=c,Ea.forEach(h=>{this[h]=t[h]}),this}clone(){return new this.constructor().copy(this)}}yn.forEach(d=>{const t="_private_"+d;Object.defineProperty(Ga.prototype,d,{get(){return this[t]},set(c){c!==this[t]&&(this[t]=c,this._needsSync=!0)}})});function za(d,t,c){let h=null;const e=Oa(d);let r=null;return e.forEach(a=>{(!r||Math.abs(c-(a.top+a.bottom)/2)<Math.abs(c-(r.top+r.bottom)/2))&&(r=a)}),r.carets.forEach(a=>{(!h||Math.abs(t-a.x)<Math.abs(t-h.x))&&(h=a)}),h}const nn=new WeakMap;function Va(d,t,c){let h;if(d){let e=nn.get(d);if(e&&e.start===t&&e.end===c)return e.rects;const{caretPositions:r}=d;if(c<t){const o=t;t=c,c=o}t=Math.max(t,0),c=Math.min(c,r.length+1),h=[];let a=null;for(let o=t;o<c;o++){const n=r[o*4],i=r[o*4+1],s=Math.min(n,i),l=Math.max(n,i),u=r[o*4+2],f=r[o*4+3];(!a||u!==a.bottom||f!==a.top||s>a.right||l<a.left)&&(a={left:1/0,right:-1/0,bottom:u,top:f},h.push(a)),a.left=Math.min(s,a.left),a.right=Math.max(l,a.right)}h.sort((o,n)=>n.bottom-o.bottom||o.left-n.left);for(let o=h.length-1;o-- >0;){const n=h[o],i=h[o+1];n.bottom===i.bottom&&n.top===i.top&&n.left<=i.right&&n.right>=i.left&&(i.left=Math.min(i.left,n.left),i.right=Math.max(i.right,n.right),h.splice(o,1))}nn.set(d,{start:t,end:c,rects:h})}return h}const an=new WeakMap;function Oa(d){let t=an.get(d);if(!t){t=[];const{caretPositions:c}=d;let h;const e=(a,o,n,i)=>{(!h||n<(h.top+h.bottom)/2)&&t.push(h={bottom:o,top:n,carets:[]}),n>h.top&&(h.top=n),o<h.bottom&&(h.bottom=o),h.carets.push({x:a,y:o,height:n-o,charIndex:i})};let r=0;for(;r<c.length;r+=4)e(c[r],c[r+2],c[r+3],r/4);e(c[r-3],c[r-2],c[r-1],r/4)}return an.set(d,t),t}export{wa as GlyphsGeometry,Ga as Text,Ba as configureTextBuilder,Da as createTextDerivedMaterial,Wa as dumpSDFTextures,la as fontResolverWorkerModule,za as getCaretAtPoint,Va as getSelectionRects,dn as getTextRenderInfo,La as preloadFont,xa as typesetterWorkerModule};
